<!doctype html><html lang="ja"><meta charset="utf-8"><title>useReducer</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="usereducer"><h1 id="usereducer">useReducer</h1><intro><p><code>useReducer</code> ã¯ã€<a href="/learn/extracting-state-logic-into-a-reducer">ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µ (reducer)</a> ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«è¿½åŠ ã™ã‚‹ãŸã‚ã® React ãƒ•ãƒƒã‚¯ã§ã™ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialArg<span class="token punctuation">,</span> init<span class="token operator">?</span><span class="token punctuation">)</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹-reference"><h2 id="ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹-reference">ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="usereducerreducer-initialarg-init-usereducer"><h3 id="usereducerreducer-initialarg-init-usereducer"><code>useReducer(reducer, initialArg, init?)</code> {/<em>usereducer</em>/}</h3><p><a href="/learn/extracting-state-logic-into-a-reducer">ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µ</a> ã§ state ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§ <code>useReducer</code> ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><a href="#usage">ã•ã‚‰ã«ä¾‹ã‚’è¦‹ã‚‹</a><section class="level4"aria-labelledby="å¼•æ•°-parameters"><h4 id="å¼•æ•°-parameters">å¼•æ•° {/<em>parameters</em>/}</h4><ul><li><code>reducer</code>: state ã‚’ã©ã®ã‚ˆã†ã«æ›´æ–°ã™ã‚‹ã‹ã‚’æŒ‡å®šã™ã‚‹ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µé–¢æ•°ã§ã™ã€‚ç´”ç²‹ã§ãªã‘ã‚Œã°ãªã‚‰ãšã€å¼•æ•°ã¨ã—ã¦ state ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–ã‚Šã€æ¬¡ã® state ã‚’è¿”ã—ã¾ã™ã€‚state ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã©ã®ã‚ˆã†ãªå‹ã§ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚<li><code>initialArg</code>: åˆæœŸ state ãŒè¨ˆç®—ã•ã‚Œã‚‹å…ƒã«ãªã‚‹å€¤ã§ã™ã€‚ä»»æ„ã®å‹ã®å€¤ã‚’æŒ‡å®šã§ãã¾ã™ã€‚ã©ã®ã‚ˆã†ã«åˆæœŸ state ã‚’è¨ˆç®—ã™ã‚‹ã‹ã¯ã€æ¬¡ã® <code>init</code> å¼•æ•°ã«ä¾å­˜ã—ã¾ã™ã€‚<li><strong>çœç•¥å¯èƒ½</strong> <code>init</code>: åˆæœŸ state ã‚’è¿”ã™åˆæœŸåŒ–é–¢æ•°ã§ã™ã€‚æŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€åˆæœŸ state ã¯ <code>initialArg</code> ãã®ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚æŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€åˆæœŸ state ã¯ <code>init(initialArg)</code> ã®çµæœã«ãªã‚Šã¾ã™ã€‚</ul></section><section class="level4"aria-labelledby="è¿”ã‚Šå€¤-returns"><h4 id="è¿”ã‚Šå€¤-returns">è¿”ã‚Šå€¤ {/<em>returns</em>/}</h4><p><code>useReducer</code> ã¯ã€2 ã¤ã®å€¤ã‚’æŒã¤é…åˆ—ã‚’è¿”ã—ã¾ã™ï¼š<ol><li>ç¾åœ¨ã® stateã€‚æœ€åˆã®ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸­ã«ã€<code>init(initialArg)</code> ã¾ãŸã¯ <code>initialArg</code>ï¼ˆ<code>init</code> ãŒãªã„å ´åˆï¼‰ãŒè¨­å®šã•ã‚Œã¾ã™ã€‚<li>state ã‚’åˆ¥ã®å€¤ã«æ›´æ–°ã—ã€å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ãƒˆãƒªã‚¬ã™ã‚‹ãŸã‚ã® <a href="#dispatch"><code>dispatch</code> é–¢æ•°</a>ã€‚</ol></section><section class="level4"aria-labelledby="æ³¨æ„ç‚¹-caveats"><h4 id="æ³¨æ„ç‚¹-caveats">æ³¨æ„ç‚¹ {/<em>caveats</em>/}</h4><ul><li><code>useReducer</code> ã¯ãƒ•ãƒƒã‚¯ãªã®ã§ã€<strong>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«</strong>ã¾ãŸã¯ç‹¬è‡ªã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯å†…ã§ã®ã¿å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ«ãƒ¼ãƒ—ã‚„æ¡ä»¶ã®ä¸­ã§å‘¼ã³å‡ºã™ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚å¿…è¦ãªå ´åˆã¯ã€æ–°ã—ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æŠœãå‡ºã—ã€ãã®ä¸­ã« state ã‚’ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚<li><code>dispatch</code> é–¢æ•°ã¯å¸¸ã«åŒä¸€ã®ã‚‚ã®ã¨ãªã‚‹ãŸã‚ã€å¤šãã®å ´åˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®ä¾å­˜é…åˆ—ã§ã¯çœç•¥ã•ã‚Œã¾ã™ãŒã€ä¾å­˜é…åˆ—ã«å«ã‚ã¦ã‚‚ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å†å®Ÿè¡Œã¯èµ·ã“ã‚Šã¾ã›ã‚“ã€‚ä¾å­˜å€¤ã‚’å‰Šé™¤ã—ã¦ã‚‚ãƒªãƒ³ã‚¿ãŒã‚¨ãƒ©ãƒ¼ã‚’å‡ºã•ãªã„å ´åˆã€å‰Šé™¤ã—ã¦ã‚‚å®‰å…¨ã§ã™ã€‚<a href="/learn/removing-effect-dependencies#move-dynamic-objects-and-functions-inside-your-effect">ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‹ã‚‰ä¾å­˜å€¤ã‚’å–ã‚Šé™¤ãæ–¹æ³•</a>ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚<li>Strict Mode ã§ã¯ã€React ã¯<a href="#my-reducer-or-initializer-function-runs-twice">ç´”ç²‹ã§ãªã„é–¢æ•°ã‚’è¦‹ã¤ã‘ã‚„ã™ãã™ã‚‹ãŸã‚ã«</a>ã€ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã¨åˆæœŸåŒ–é–¢æ•°ã‚’ 2 å›å‘¼ã³å‡ºã—ã¾ã™ã€‚ã“ã‚Œã¯é–‹ç™ºæ™‚ã®å‹•ä½œã§ã‚ã‚Šã€æœ¬ç•ªã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ã€‚ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã¨åˆæœŸåŒ–é–¢æ•°ãŒç´”ç²‹ã§ã‚ã‚Œã°ï¼ˆãã†ã‚ã‚‹ã¹ãã§ã™ï¼‰ã€ã“ã‚Œã¯ãƒ­ã‚¸ãƒƒã‚¯ã«å½±éŸ¿ã—ã¾ã›ã‚“ã€‚ç‰‡æ–¹ã®å‘¼ã³å‡ºã—ã®çµæœã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚</ul></section></section><section class="level3"aria-labelledby="dispatch-é–¢æ•°-dispatch"><h3 id="dispatch-é–¢æ•°-dispatch"><code>dispatch</code> é–¢æ•° {/<em>dispatch</em>/}</h3><p><code>useReducer</code> ã«ã‚ˆã£ã¦è¿”ã•ã‚Œã‚‹ <code>dispatch</code> é–¢æ•°ã‚’ä½¿ã†ã“ã¨ã§ã€state ã‚’åˆ¥ã®å€¤ã«æ›´æ–°ã—ã¦å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ãƒˆãƒªã‚¬ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚<code>dispatch</code> é–¢æ•°ã«ã¯ã€å”¯ä¸€ã®å¼•æ•°ã¨ã—ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p>React ãŒã‚»ãƒƒãƒˆã™ã‚‹æ¬¡ã® state ã¯ã€å¼•æ•°ã¨ã—ã¦ <code>state</code> ã®ç¾åœ¨å€¤ãŠã‚ˆã³ <code>dispatch</code> ã«æ¸¡ã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç”¨ã„ã¦ <code>reducer</code> é–¢æ•°ã‚’å‘¼ã³å‡ºã—ãŸçµæœã«ãªã‚Šã¾ã™ã€‚<section class="level4"aria-labelledby="å¼•æ•°-dispatch-parameters"><h4 id="å¼•æ•°-dispatch-parameters">å¼•æ•° {/<em>dispatch-parameters</em>/}</h4><ul><li><code>action</code>: ãƒ¦ãƒ¼ã‚¶ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚ä»»æ„ã®å‹ã®å€¤ã‚’æŒ‡å®šã§ãã¾ã™ã€‚æ…£ä¾‹ã¨ã—ã¦ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯é€šå¸¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚Šã€<code>type</code> ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§è­˜åˆ¥ã•ã‚Œã€ä»–ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¿½åŠ æƒ…å ±ã‚’ä¿æŒã—ã¾ã™ã€‚</ul></section><section class="level4"aria-labelledby="è¿”ã‚Šå€¤-dispatch-returns"><h4 id="è¿”ã‚Šå€¤-dispatch-returns">è¿”ã‚Šå€¤ {/<em>dispatch-returns</em>/}</h4><p><code>dispatch</code> é–¢æ•°ã«ã¯è¿”ã‚Šå€¤ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</section><section class="level4"aria-labelledby="æ³¨æ„ç‚¹-setstate-caveats"><h4 id="æ³¨æ„ç‚¹-setstate-caveats">æ³¨æ„ç‚¹ {/<em>setstate-caveats</em>/}</h4><ul><li><p><code>dispatch</code> é–¢æ•°ã¯ã€<strong>æ¬¡ã®ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ãŸã‚ã® state å¤‰æ•°ã®ã¿ã‚’æ›´æ–°</strong>ã—ã¾ã™ã€‚<code>dispatch</code> é–¢æ•°ã‚’å‘¼ã³å‡ºã—ãŸå¾Œã« state å¤‰æ•°ã‚’èª­ã¿å–ã‚‹ã¨ã€æ—¢ã«ç”»é¢ä¸Šã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã€<code>dispatch</code> å‘¼ã³å‡ºã—å‰ã®<a href="#ive-dispatched-an-action-but-logging-gives-me-the-old-state-value">å¤ã„å€¤ã‚’èª­ã¿å–ã‚Šã¾ã™</a>ã€‚<li><p>ä¸ãˆã‚‰ã‚ŒãŸæ–°ã—ã„å€¤ãŒã€<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a> ã®æ¯”è¼ƒã«ã‚ˆã‚Šã€ç¾åœ¨ã® <code>state</code> ã¨åŒã˜ã¨åˆ¤æ–­ã•ã‚ŒãŸå ´åˆã€React ã¯<strong>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ãã®å­è¦ç´ ã®å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ã‚¹ã‚­ãƒƒãƒ—</strong>ã—ã¾ã™ã€‚ã“ã‚Œã¯æœ€é©åŒ–ã§ã™ã€‚React ã¯çµæœã‚’ç„¡è¦–ã§ãã‚‹å ´åˆã§ã‚‚å¿…è¦ãŒã‚ã£ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã³å‡ºã™ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã“ã‚ŒãŒã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚<li><p>React ã¯ <a href="/learn/queueing-a-series-of-state-updates">state ã®æ›´æ–°ã®ãƒãƒƒãƒå‡¦ç†ï¼ˆbatching, æŸã­å‡¦ç†ï¼‰</a> ã‚’è¡Œã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€<strong>ã™ã¹ã¦ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãŒå®Ÿè¡Œã•ã‚Œ</strong>ã€ãã‚Œã‚‰ã® <code>set</code> é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚ŒãŸå¾Œã«ç”»é¢ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€1 ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆä¸­ã«è¤‡æ•°å›ã®å†ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã®ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚ç¨€ãªã‚±ãƒ¼ã‚¹ã¨ã—ã¦ã€DOM ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãªã©ã®ç†ç”±ã§ React ã«ç”»é¢ã‚’æ—©æœŸã«å¼·åˆ¶çš„ã«æ›´æ–°ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€<a href="/reference/react-dom/flushSync"><code>flushSync</code></a> ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚</ul></section></section></section><section class="level2"aria-labelledby="ä½¿ç”¨æ³•-usage"><h2 id="ä½¿ç”¨æ³•-usage">ä½¿ç”¨æ³• {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã‚’è¿½åŠ ã™ã‚‹-adding-a-reducer-to-a-component"><h3 id="ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã‚’è¿½åŠ ã™ã‚‹-adding-a-reducer-to-a-component">ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã‚’è¿½åŠ ã™ã‚‹ {/<em>adding-a-reducer-to-a-component</em>/}</h3><p>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§ <code>useReducer</code> ã‚’å‘¼ã³å‡ºã—ã¦ã€<a href="/learn/extracting-state-logic-into-a-reducer">ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µ</a>ã‚’ä½¿ã£ã¦ state ã‚’ç®¡ç†ã—ã¾ã™ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><code>useReducer</code> ã¯ã€2 ã¤ã®å€¤ã‚’æŒã¤é…åˆ—ã‚’è¿”ã—ã¾ã™ï¼š<ol><li>ã“ã® state å¤‰æ•°ã®<codestep step="{1}">ç¾åœ¨ã® state</codestep>ã€‚ä¸ãˆã‚‰ã‚ŒãŸ<codestep step="{3}">åˆæœŸ state</codestep>ãŒåˆæœŸå€¤ã¨ã—ã¦è¨­å®šã•ã‚Œã¾ã™ã€‚<li>ãƒ¦ãƒ¼ã‚¶æ“ä½œã«å¿œã˜ã¦ state ã‚’å¤‰æ›´ã™ã‚‹ãŸã‚ã®<codestep step="{2}"><code>dispatch</code> é–¢æ•°</codestep>ã€‚</ol><p>ç”»é¢ä¸Šã®å†…å®¹ã‚’æ›´æ–°ã™ã‚‹ã«ã¯ã€<em>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</em>ã¨å‘¼ã°ã‚Œã‚‹ã€ãƒ¦ãƒ¼ã‚¶ãŒè¡Œã£ãŸã“ã¨ã‚’è¡¨ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¼•æ•°ã¨ã—ã¦<codestep step="{2}"><code>dispatch</code></codestep>ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>React ã¯ç¾åœ¨ã® state ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’<codestep step="{4}">ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µé–¢æ•°</codestep>ã«æ¸¡ã—ã¾ã™ã€‚ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã¯æ¬¡ã® state ã‚’è¨ˆç®—ã—ã¦è¿”ã—ã¾ã™ã€‚React ã¯ãã®æ¬¡ã® state ã‚’ä¿å­˜ã™ã‚‹ã¨ã¨ã‚‚ã«ã€ãã® state ã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒ¼ã—ã€UI ã‚’æ›´æ–°ã—ã¾ã™ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span> <span class="token operator">===</span> <span class="token string">'incremented_age'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Increment</span> age
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Hello</span><span class="token operator">!</span> <span class="token maybe-class-name">You</span> are <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p><code>useReducer</code> ã¯ <a href="/reference/react/useState"><code>useState</code></a> ã¨éå¸¸ã«ä¼¼ã¦ã„ã¾ã™ãŒã€ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‹ã‚‰ state æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å¤–ã®å˜ä¸€ã®é–¢æ•°ã«ç§»å‹•ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è©³ã—ãã¯ã€<a href="/learn/extracting-state-logic-into-a-reducer#comparing-usestate-and-usereducer"><code>useState</code> ã¨ <code>useReducer</code> ã®é¸ã³æ–¹</a>ã‚’å‚ç…§ãã ã•ã„ã€‚</section><section class="level3"aria-labelledby="ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µé–¢æ•°ã®æ›¸ãæ–¹-writing-the-reducer-function"><h3 id="ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µé–¢æ•°ã®æ›¸ãæ–¹-writing-the-reducer-function">ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µé–¢æ•°ã®æ›¸ãæ–¹ {/<em>writing-the-reducer-function</em>/}</h3><p>ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µé–¢æ•°ã¯æ¬¡ã®ã‚ˆã†ã«å®£è¨€ã•ã‚Œã¾ã™ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>ãã®å¾Œã€æ¬¡ã® state ã‚’è¨ˆç®—ã—ã¦è¿”ã™ã‚³ãƒ¼ãƒ‰ã‚’ä¸­ã«æ›¸ã„ã¦ã„ãã¾ã™ã€‚æ…£ä¾‹ã¨ã—ã¦ã€<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/switch"><code>switch</code> æ–‡</a>ã¨ã—ã¦æ›¸ãã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚<code>switch</code> ã®å„ <code>case</code> ã”ã¨ã«ã€æ¬¡ã® state ã‚’è¨ˆç®—ã—ã¦è¿”ã—ã¾ã™ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'changed_name'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">nextName</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å½¢ã¯ã©ã®ã‚ˆã†ãªã‚‚ã®ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚æ…£ä¾‹ã¨ã—ã¦ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã® <code>type</code> ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã£ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã™ã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¯ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µãŒæ¬¡ã® state ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã«å¿…è¦ãªæœ€å°é™ã®æƒ…å ±ã‚’å«ã‚ã‚‹ã¹ãã§ã™ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Taylor'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">function</span> <span class="token function">handleButtonClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleInputChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'changed_name'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">nextName</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span></code></pre><p>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒ—åã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã«ãƒ­ãƒ¼ã‚«ãƒ«ãªã‚‚ã®ã§ã™ã€‚<a href="/learn/extracting-state-logic-into-a-reducer#writing-reducers-well">å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ã«ã¤ãªãŒã‚‹ã‚‚ã®ã§ã‚ã£ã¦ã‚‚ã€å˜ä¸€ã®ãƒ¦ãƒ¼ã‚¶æ“ä½œã‚’è¡¨ã™ã‚ˆã†ã«ã—ã¦ãã ã•ã„</a>ã€‚state ã®å½¢ã¯ä»»æ„ã§ã™ãŒã€é€šå¸¸ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¾ãŸã¯é…åˆ—ã«ãªã‚Šã¾ã™ã€‚<p>è©³ã—ãã¯ã€<a href="/learn/extracting-state-logic-into-a-reducer">ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã¸ã® state ãƒ­ã‚¸ãƒƒã‚¯ã®æŠ½å‡º</a>ã‚’å‚ç…§ãã ã•ã„ã€‚</p><pitfall><p>state ã¯èª­ã¿å–ã‚Šå°‚ç”¨ã§ã™ã€‚state å†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„é…åˆ—ã‚’å¤‰æ›´ã—ãªã„ã§ãã ã•ã„ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ğŸš© Don't mutate an object in state like this:</span>
      state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre><p>ä»£ã‚ã‚Šã«ã€å¸¸ã«æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã‹ã‚‰è¿”ã—ã¦ãã ã•ã„ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// âœ… Instead, return a new object</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre><p>è©³ã—ãã¯ã€<a href="/learn/updating-objects-in-state">state å†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ›´æ–°</a>ã¨ <a href="/learn/updating-arrays-in-state">state å†…ã®é…åˆ—ã®æ›´æ–°</a>ã‚’å‚ç…§ãã ã•ã„ã€‚</p></pitfall><recipes titletext="åŸºæœ¬çš„ãª useReducer ã®ä¾‹"titleid="examples-basic"><section class="level4"aria-labelledby="ãƒ•ã‚©ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ-form-object"><h4 id="ãƒ•ã‚©ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ-form-object">ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ {/<em>form-object</em>/}</h4><p>ã“ã®ä¾‹ã§ã¯ã€ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µãŒ 2 ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆ<code>name</code> ã¨ <code>age</code>ï¼‰ã‚’æŒã¤ state ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'changed_name'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">nextName</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Taylor'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleButtonClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleInputChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'changed_name'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">nextName</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleInputChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleButtonClick<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Increment</span> age
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Hello</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">You</span></span> are <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆé…åˆ—-todo-list-array"><h4 id="ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆé…åˆ—-todo-list-array">ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆï¼ˆé…åˆ—ï¼‰ {/<em>todo-list-array</em>/}</h4><p>ã“ã®ä¾‹ã§ã¯ã€ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µãŒã‚¿ã‚¹ã‚¯ã®é…åˆ—ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚é…åˆ—ã¯<a href="/learn/updating-arrays-in-state">æ›¸ãæ›ãˆãšã«æ›´æ–°ã™ã‚‹</a>å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">AddTask</span></span> <span class="token keyword module">from</span> <span class="token string">'./AddTask.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TaskList</span></span> <span class="token keyword module">from</span> <span class="token string">'./TaskList.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">tasksReducer</span><span class="token punctuation">(</span><span class="token parameter">tasks<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'added'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span><span class="token spread operator">...</span>tasks<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">text</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">,</span>
        <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'changed'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> tasks<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> action<span class="token punctuation">.</span><span class="token property-access">task</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">return</span> action<span class="token punctuation">.</span><span class="token property-access">task</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">return</span> t<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'deleted'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> tasks<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token arrow operator">=></span> t<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> action<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TaskApp</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tasks<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>
    tasksReducer<span class="token punctuation">,</span>
    initialTasks
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddTask</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'added'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> text<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleChangeTask</span><span class="token punctuation">(</span><span class="token parameter">task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'changed'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">task</span><span class="token operator">:</span> task
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleDeleteTask</span><span class="token punctuation">(</span><span class="token parameter">taskId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'deleted'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Prague</span> itinerary<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddTask</span>
        onAddTask<span class="token operator">=</span><span class="token punctuation">{</span>handleAddTask<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TaskList</span>
        tasks<span class="token operator">=</span><span class="token punctuation">{</span>tasks<span class="token punctuation">}</span>
        onChangeTask<span class="token operator">=</span><span class="token punctuation">{</span>handleChangeTask<span class="token punctuation">}</span>
        onDeleteTask<span class="token operator">=</span><span class="token punctuation">{</span>handleDeleteTask<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> initialTasks <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddTask</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onAddTask <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        placeholder<span class="token operator">=</span><span class="token string">"Add task"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onAddTask</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Add</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TaskList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  tasks<span class="token punctuation">,</span>
  onChangeTask<span class="token punctuation">,</span>
  onDeleteTask
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
      <span class="token punctuation">{</span>tasks<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Task</span>
            task<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChangeTask<span class="token punctuation">}</span>
            onDelete<span class="token operator">=</span><span class="token punctuation">{</span>onDeleteTask<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Task</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> task<span class="token punctuation">,</span> onChange<span class="token punctuation">,</span> onDelete <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isEditing<span class="token punctuation">,</span> setIsEditing<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> taskContent<span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isEditing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    taskContent <span class="token operator">=</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token spread operator">...</span>task<span class="token punctuation">,</span>
              <span class="token literal-property property">text</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsEditing</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Save</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    taskContent <span class="token operator">=</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsEditing</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Edit</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        type<span class="token operator">=</span><span class="token string">"checkbox"</span>
        checked<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">done</span><span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token spread operator">...</span>task<span class="token punctuation">,</span>
            <span class="token literal-property property">done</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>taskContent<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onDelete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Delete</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">ul<span class="token punctuation">,</span> li</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="immer-ã‚’ä½¿ã£ã¦ç°¡æ½”ãªæ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ã-writing-concise-update-logic-with-immer"><h4 id="immer-ã‚’ä½¿ã£ã¦ç°¡æ½”ãªæ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ã-writing-concise-update-logic-with-immer">Immer ã‚’ä½¿ã£ã¦ç°¡æ½”ãªæ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ã {/<em>writing-concise-update-logic-with-immer</em>/}</h4><p>é…åˆ—ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›¸ãæ›ãˆãšã«æ›´æ–°ã™ã‚‹ã®ãŒé¢å€’ãªå ´åˆã€<a href="https://github.com/immerjs/use-immer#useimmerreducer">Immer</a> ã®ã‚ˆã†ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦å†—é•·ãªã‚³ãƒ¼ãƒ‰ã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã™ã€‚Immer ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›¸ãæ›ãˆã¦ã„ã‚‹ã‹ã®ã‚ˆã†ãªç°¡æ½”ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ãŒã€å†…éƒ¨ã§ã¯ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªæ›´æ–°ãŒè¡Œã‚ã‚Œã¾ã™ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useImmerReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'use-immer'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">AddTask</span></span> <span class="token keyword module">from</span> <span class="token string">'./AddTask.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TaskList</span></span> <span class="token keyword module">from</span> <span class="token string">'./TaskList.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">tasksReducer</span><span class="token punctuation">(</span><span class="token parameter">draft<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'added'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      draft<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">text</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">,</span>
        <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'changed'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> index <span class="token operator">=</span> draft<span class="token punctuation">.</span><span class="token method function property-access">findIndex</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token arrow operator">=></span>
        t<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> action<span class="token punctuation">.</span><span class="token property-access">task</span><span class="token punctuation">.</span><span class="token property-access">id</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      draft<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> action<span class="token punctuation">.</span><span class="token property-access">task</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'deleted'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> draft<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token arrow operator">=></span> t<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> action<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TaskApp</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tasks<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useImmerReducer</span><span class="token punctuation">(</span>
    tasksReducer<span class="token punctuation">,</span>
    initialTasks
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddTask</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'added'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> text<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleChangeTask</span><span class="token punctuation">(</span><span class="token parameter">task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'changed'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">task</span><span class="token operator">:</span> task
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleDeleteTask</span><span class="token punctuation">(</span><span class="token parameter">taskId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'deleted'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Prague</span> itinerary<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddTask</span>
        onAddTask<span class="token operator">=</span><span class="token punctuation">{</span>handleAddTask<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TaskList</span>
        tasks<span class="token operator">=</span><span class="token punctuation">{</span>tasks<span class="token punctuation">}</span>
        onChangeTask<span class="token operator">=</span><span class="token punctuation">{</span>handleChangeTask<span class="token punctuation">}</span>
        onDeleteTask<span class="token operator">=</span><span class="token punctuation">{</span>handleDeleteTask<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> initialTasks <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddTask</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onAddTask <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        placeholder<span class="token operator">=</span><span class="token string">"Add task"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onAddTask</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Add</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TaskList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  tasks<span class="token punctuation">,</span>
  onChangeTask<span class="token punctuation">,</span>
  onDeleteTask
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
      <span class="token punctuation">{</span>tasks<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Task</span>
            task<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChangeTask<span class="token punctuation">}</span>
            onDelete<span class="token operator">=</span><span class="token punctuation">{</span>onDeleteTask<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Task</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> task<span class="token punctuation">,</span> onChange<span class="token punctuation">,</span> onDelete <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isEditing<span class="token punctuation">,</span> setIsEditing<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> taskContent<span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isEditing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    taskContent <span class="token operator">=</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token spread operator">...</span>task<span class="token punctuation">,</span>
              <span class="token literal-property property">text</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsEditing</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Save</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    taskContent <span class="token operator">=</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsEditing</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Edit</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        type<span class="token operator">=</span><span class="token string">"checkbox"</span>
        checked<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">done</span><span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token spread operator">...</span>task<span class="token punctuation">,</span>
            <span class="token literal-property property">done</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>taskContent<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onDelete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Delete</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">ul<span class="token punctuation">,</span> li</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"immer"</span><span class="token operator">:</span> <span class="token string">"1.7.3"</span><span class="token punctuation">,</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"use-immer"</span><span class="token operator">:</span> <span class="token string">"0.5.1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section></recipes></section><section class="level3"aria-labelledby="åˆæœŸ-state-ã®å†ä½œæˆã‚’é¿ã‘ã‚‹-avoiding-recreating-the-initial-state"><h3 id="åˆæœŸ-state-ã®å†ä½œæˆã‚’é¿ã‘ã‚‹-avoiding-recreating-the-initial-state">åˆæœŸ state ã®å†ä½œæˆã‚’é¿ã‘ã‚‹ {/<em>avoiding-recreating-the-initial-state</em>/}</h3><p>React ã¯åˆæœŸ state ã‚’ä¸€åº¦ä¿å­˜ã—ãŸã®ã¡ã€æ¬¡å›ä»¥é™ã®ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã¯ç„¡è¦–ã—ã¾ã™ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createInitialState</span><span class="token punctuation">(</span><span class="token parameter">username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> username <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token function">createInitialState</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><code>createInitialState(username)</code> ã®çµæœã¯åˆæœŸãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã®ã¿ä½¿ç”¨ã•ã‚Œã¾ã™ãŒã€ãƒ¬ãƒ³ãƒ€ãƒ¼ã®åº¦ã«æ¯å›ã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€å¤§ããªé…åˆ—ã‚’ä½œæˆã—ãŸã‚Šã€é«˜ã‚³ã‚¹ãƒˆãªè¨ˆç®—ã‚’è¡Œã£ãŸã‚Šã—ã¦ã„ã‚‹å ´åˆã«ç„¡é§„ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚<p>ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ã€<code>useReducer</code> ã® 3 ç•ªç›®ã®å¼•æ•°ã¨ã—ã¦<strong>åˆæœŸåŒ–é–¢æ•°ã‚’æ¸¡ã™</strong>ã“ã¨ãŒã§ãã¾ã™ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createInitialState</span><span class="token punctuation">(</span><span class="token parameter">username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> username <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> username<span class="token punctuation">,</span> createInitialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><code>createInitialState</code> ã‚’æ¸¡ã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯<em>é–¢æ•°ãã®ã‚‚ã®</em>ã§ã‚ã‚Šã€<code>createInitialState()</code> ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€åˆæœŸ state ã¯åˆæœŸåŒ–å¾Œã«å†ä½œæˆã•ã‚Œãªããªã‚Šã¾ã™ã€‚<p>ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€<code>createInitialState</code> ã¯ <code>username</code> å¼•æ•°ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚åˆæœŸåŒ–é–¢æ•°ãŒåˆæœŸ state ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã«æƒ…å ±ã‚’å¿…è¦ã¨ã—ãªã„å ´åˆã¯ã€<code>useReducer</code> ã«å¯¾ã—ã¦ 2 ç•ªç›®ã®å¼•æ•°ã¨ã—ã¦ <code>null</code> ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚</p><recipes titletext="åˆæœŸåŒ–é–¢æ•°ã¨åˆæœŸ state ã‚’ç›´æ¥æ¸¡ã™æ–¹æ³•ã®é•ã„"titleid="examples-initializer"><section class="level4"aria-labelledby="åˆæœŸåŒ–é–¢æ•°ã‚’æ¸¡ã™-passing-the-initializer-function"><h4 id="åˆæœŸåŒ–é–¢æ•°ã‚’æ¸¡ã™-passing-the-initializer-function">åˆæœŸåŒ–é–¢æ•°ã‚’æ¸¡ã™ {/<em>passing-the-initializer-function</em>/}</h4><p>ã“ã®ä¾‹ã§ã¯ã€åˆæœŸåŒ–é–¢æ•°ã‚’æ¸¡ã—ã¦ã„ã‚‹ãŸã‚ã€<code>createInitialState</code> é–¢æ•°ã¯åˆæœŸåŒ–æ™‚ã«ã®ã¿å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚åˆæœŸåŒ–é–¢æ•°ã¯å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ãªã©ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå†ãƒ¬ãƒ³ãƒ€ãƒ¼ã•ã‚ŒãŸã¨ã—ã¦ã‚‚å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TodoList</span></span> <span class="token keyword module">from</span> <span class="token string">'./TodoList.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TodoList</span> username<span class="token operator">=</span><span class="token string">"Taylor"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createInitialState</span><span class="token punctuation">(</span><span class="token parameter">username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> initialTodos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    initialTodos<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> username <span class="token operator">+</span> <span class="token string">"'s task #"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">draft</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">todos</span><span class="token operator">:</span> initialTodos<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'changed_draft'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">draft</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">nextDraft</span><span class="token punctuation">,</span>
        <span class="token literal-property property">todos</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'added_todo'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">draft</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          <span class="token literal-property property">text</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">draft</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token spread operator">...</span>state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> username <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>
    reducer<span class="token punctuation">,</span>
    username<span class="token punctuation">,</span>
    createInitialState
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">draft</span><span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'changed_draft'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">nextDraft</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'added_todo'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Add</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="åˆæœŸ-state-ã‚’ç›´æ¥æ¸¡ã™-passing-the-initial-state-directly"><h4 id="åˆæœŸ-state-ã‚’ç›´æ¥æ¸¡ã™-passing-the-initial-state-directly">åˆæœŸ state ã‚’ç›´æ¥æ¸¡ã™ {/<em>passing-the-initial-state-directly</em>/}</h4><p>ã“ã®ä¾‹ã§ã¯ã€åˆæœŸåŒ–é–¢æ•°ã‚’æ¸¡ã—ã¦<strong>ã„ãªã„</strong>ãŸã‚ã€<code>createInitialState</code> é–¢æ•°ã¯å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ãªã©ã€ãƒ¬ãƒ³ãƒ€ãƒ¼ã®åº¦ã«æ¯å›å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚å‹•ä½œã«ã¯ç›®ã«è¦‹ãˆã‚‹é•ã„ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€åŠ¹ç‡ãŒä¸‹ãŒã‚Šã¾ã™ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TodoList</span></span> <span class="token keyword module">from</span> <span class="token string">'./TodoList.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TodoList</span> username<span class="token operator">=</span><span class="token string">"Taylor"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createInitialState</span><span class="token punctuation">(</span><span class="token parameter">username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> initialTodos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    initialTodos<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> username <span class="token operator">+</span> <span class="token string">"'s task #"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">draft</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">todos</span><span class="token operator">:</span> initialTodos<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'changed_draft'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">draft</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">nextDraft</span><span class="token punctuation">,</span>
        <span class="token literal-property property">todos</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'added_todo'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">draft</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          <span class="token literal-property property">text</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">draft</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token spread operator">...</span>state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> username <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>
    reducer<span class="token punctuation">,</span>
    <span class="token function">createInitialState</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">draft</span><span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'changed_draft'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">nextDraft</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'added_todo'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Add</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section></recipes></section></section><section class="level2"aria-labelledby="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°-troubleshooting"><h2 id="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°-troubleshooting">ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ãŸãŒãƒ­ã‚°ã«ã¯å¤ã„-state-ã®å€¤ãŒè¡¨ç¤ºã•ã‚Œã‚‹-ive-dispatched-an-action-but-logging-gives-me-the-old-state-value"><h3 id="ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ãŸãŒãƒ­ã‚°ã«ã¯å¤ã„-state-ã®å€¤ãŒè¡¨ç¤ºã•ã‚Œã‚‹-ive-dispatched-an-action-but-logging-gives-me-the-old-state-value">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ãŸãŒãƒ­ã‚°ã«ã¯å¤ã„ state ã®å€¤ãŒè¡¨ç¤ºã•ã‚Œã‚‹ {/<em>ive-dispatched-an-action-but-logging-gives-me-the-old-state-value</em>/}</h3><p><code>dispatch</code> é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ã‚‚ã€<strong>å®Ÿè¡Œä¸­ã®ã‚³ãƒ¼ãƒ‰å†…ã® state ã¯å¤‰æ›´ã•ã‚Œã¾ã›ã‚“</strong>ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 42</span>

  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Request a re-render with 43</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Still 42!</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Also 42!</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>ã“ã‚Œã¯ <a href="/learn/state-as-a-snapshot">state ãŒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ã‚ˆã†ã«æŒ¯ã‚‹èˆã†</a>ãŸã‚ã§ã™ã€‚state ã‚’æ›´æ–°ã™ã‚‹ã¨ã€æ–°ã—ã„ state ã®å€¤ã§å†ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒè¦æ±‚ã•ã‚Œã¾ã™ãŒã€æ—¢ã«å®Ÿè¡Œä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©å†…ã® <code>state</code> JavaScript å¤‰æ•°ã«ã¯å½±éŸ¿ã‚’ä¸ãˆã¾ã›ã‚“ã€‚<p>æ¬¡ã® state ã®å€¤ã‚’æ¨æ¸¬ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã‚’è‡ªåˆ†ã§å‘¼ã³å‡ºã™ã“ã¨ã§æ‰‹å‹•ã§è¨ˆç®—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> nextState <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// { age: 42 }</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>nextState<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { age: 43 }</span></code></pre></section><section class="level3"aria-labelledby="ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ãŸãŒç”»é¢ãŒæ›´æ–°ã•ã‚Œãªã„-ive-dispatched-an-action-but-the-screen-doesnt-update"><h3 id="ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ãŸãŒç”»é¢ãŒæ›´æ–°ã•ã‚Œãªã„-ive-dispatched-an-action-but-the-screen-doesnt-update">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ãŸãŒç”»é¢ãŒæ›´æ–°ã•ã‚Œãªã„ {/<em>ive-dispatched-an-action-but-the-screen-doesnt-update</em>/}</h3><p>React ã¯ã€<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a> ã®æ¯”è¼ƒã«ã‚ˆã‚Šã€<strong>æ¬¡ã® state ãŒå‰ã® state ã¨ç­‰ã—ã„ã¨åˆ¤æ–­ã•ã‚Œã‚‹å ´åˆã€æ›´æ–°ã‚’ç„¡è¦–ã—ã¾ã™</strong>ã€‚ã“ã‚Œã¯é€šå¸¸ã€state å†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„é…åˆ—ã‚’ç›´æ¥æ›¸ãæ›ãˆãŸå ´åˆã«ç™ºç”Ÿã—ã¾ã™ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ğŸš© Wrong: mutating existing object</span>
      state<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'changed_name'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ğŸš© Wrong: mutating existing object</span>
      state<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> action<span class="token punctuation">.</span><span class="token property-access">nextName</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>æ—¢å­˜ã® <code>state</code> ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›¸ãæ›ãˆã¦è¿”ã—ã¦ã„ã‚‹ãŸã‚ã€React ã¯æ›´æ–°ã‚’ç„¡è¦–ã—ã¾ã™ã€‚ã“ã‚Œã‚’ä¿®æ­£ã™ã‚‹ã«ã¯ã€å¸¸ã« <a href="/learn/updating-objects-in-state">state å†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ›´æ–°</a>ã‚„ <a href="/learn/updating-arrays-in-state">state å†…ã®é…åˆ—ã®æ›´æ–°</a>ã‚’æ­£ã—ãè¡Œã„ã€ã“ã‚Œã‚‰ã®æ›¸ãæ›ãˆã‚’é¿ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// âœ… Correct: creating a new object</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'changed_name'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// âœ… Correct: creating a new object</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">nextName</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section class="level3"aria-labelledby="ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒå¾Œã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã‹ã‚‰ã®-state-ã®ä¸€éƒ¨ãŒ-undefined-ã«ãªã‚‹-a-part-of-my-reducer-state-becomes-undefined-after-dispatching"><h3 id="ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒå¾Œã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã‹ã‚‰ã®-state-ã®ä¸€éƒ¨ãŒ-undefined-ã«ãªã‚‹-a-part-of-my-reducer-state-becomes-undefined-after-dispatching">ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒå¾Œã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã‹ã‚‰ã® state ã®ä¸€éƒ¨ãŒ undefined ã«ãªã‚‹ {/<em>a-part-of-my-reducer-state-becomes-undefined-after-dispatching</em>/}</h3><p>æ–°ã—ã„ state ã‚’è¿”ã™éš›ã«ã€ã™ã¹ã¦ã® <code>case</code> ã®åˆ†å²ã«ãŠã„ã¦<strong>ã™ã¹ã¦ã®æ—¢å­˜ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹</strong>ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span> <span class="token comment">// Don't forget this!</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span></code></pre><p>ä¸Šè¨˜ã® <code>...state</code> ã‚’çœç•¥ã™ã‚‹ã¨ã€è¿”ã•ã‚Œã‚‹æ¬¡ã® state ã«ã¯ <code>age</code> ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿ãŒå«ã¾ã‚Œã€ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ä½•ã‚‚å«ã¾ã‚Œãªããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚</section><section class="level3"aria-labelledby="ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒå¾Œã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã‹ã‚‰ã®-state-å…¨ä½“ãŒ-undefined-ã«ãªã‚‹-my-entire-reducer-state-becomes-undefined-after-dispatching"><h3 id="ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒå¾Œã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã‹ã‚‰ã®-state-å…¨ä½“ãŒ-undefined-ã«ãªã‚‹-my-entire-reducer-state-becomes-undefined-after-dispatching">ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒå¾Œã«ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã‹ã‚‰ã® state å…¨ä½“ãŒ undefined ã«ãªã‚‹ {/<em>my-entire-reducer-state-becomes-undefined-after-dispatching</em>/}</h3><p>state ãŒäºˆæœŸã›ãš <code>undefined</code> ã«ãªã‚‹å ´åˆã€ãŠãã‚‰ãã„ãšã‚Œã‹ã® <code>case</code> ã§ state ã‚’ <code>return</code> ã—å¿˜ã‚Œã¦ã„ã‚‹ã‹ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒ—ãŒã„ãšã‚Œã® <code>case</code> ã¨ã‚‚ä¸€è‡´ã—ã¦ã„ãªã„ã‹ã‚‰ã§ã™ã€‚åŸå› ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ã€<code>switch</code> ã®å¤–ã§ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'edited_name'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>ã¾ãŸã€ã“ã®ã‚ˆã†ãªãƒŸã‚¹ã‚’ã‚­ãƒ£ãƒƒãƒã™ã‚‹ãŸã‚ã«ã€TypeScript ã®ã‚ˆã†ãªé™çš„å‹ãƒã‚§ãƒƒã‚«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚</section><section class="level3"aria-labelledby="too-many-re-renders-ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹-im-getting-an-error-too-many-re-renders"><h3 id="too-many-re-renders-ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹-im-getting-an-error-too-many-re-renders">"Too many re-renders" ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ {/<em>im-getting-an-error-too-many-re-renders</em>/}</h3><p><code>Too many re-renders. React limits the number of renders to prevent an infinite loop.</code> ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚é€šå¸¸ã€ã“ã‚Œã¯ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸­ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç„¡æ¡ä»¶ã§ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ã¦ã„ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒ«ãƒ¼ãƒ—ã«å…¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ï¼šãƒ¬ãƒ³ãƒ€ãƒ¼ã€ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒï¼ˆã“ã‚Œã«ã‚ˆã‚Šå†åº¦ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒç™ºç”Ÿï¼‰ã€ãƒ¬ãƒ³ãƒ€ãƒ¼ã€ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒï¼ˆã“ã‚Œã«ã‚ˆã‚Šå†åº¦ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒç™ºç”Ÿï¼‰ã€ã¨ã„ã£ãŸç¹°ã‚Šè¿”ã—ã§ã™ã€‚éå¸¸ã«å¤šãã®å ´åˆã€ã“ã‚Œã¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®æŒ‡å®šæ–¹æ³•ã®ãƒŸã‚¹ã«ã‚ˆã£ã¦å¼•ãèµ·ã“ã•ã‚Œã¾ã™ã€‚<pre class="language-js"><code class="language-js"><span class="token comment">// ğŸš© Wrong: calls the handler during render</span>
<span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Click</span> me<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>

<span class="token comment">// âœ… Correct: passes down the event handler</span>
<span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Click</span> me<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>

<span class="token comment">// âœ… Correct: passes down an inline function</span>
<span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">handleClick</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Click</span> me<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span></code></pre><p>ã“ã®ã‚¨ãƒ©ãƒ¼ã®åŸå› ãŒã‚ã‹ã‚‰ãªã„å ´åˆã¯ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ã‚¨ãƒ©ãƒ¼ã®æ¨ªã«ã‚ã‚‹çŸ¢å°ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€JavaScript ã‚¹ã‚¿ãƒƒã‚¯ã‚’èª¿ã¹ã¦ã‚¨ãƒ©ãƒ¼ã®åŸå› ã¨ãªã‚‹å…·ä½“çš„ãª <code>dispatch</code> é–¢æ•°å‘¼ã³å‡ºã—ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚</section><section class="level3"aria-labelledby="ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã¾ãŸã¯åˆæœŸåŒ–é–¢æ•°ãŒ-2-å›å®Ÿè¡Œã•ã‚Œã‚‹-my-reducer-or-initializer-function-runs-twice"><h3 id="ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã¾ãŸã¯åˆæœŸåŒ–é–¢æ•°ãŒ-2-å›å®Ÿè¡Œã•ã‚Œã‚‹-my-reducer-or-initializer-function-runs-twice">ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã¾ãŸã¯åˆæœŸåŒ–é–¢æ•°ãŒ 2 å›å®Ÿè¡Œã•ã‚Œã‚‹ {/<em>my-reducer-or-initializer-function-runs-twice</em>/}</h3><p><a href="/reference/react/StrictMode">Strict Mode</a> ã§ã¯ã€React ã¯ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µã¨åˆæœŸåŒ–é–¢æ•°ã‚’ 2 å›å‘¼ã³å‡ºã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ã‚³ãƒ¼ãƒ‰ãŒå£Šã‚Œã‚‹ã“ã¨ãŒã‚ã£ã¦ã¯ãªã‚Šã¾ã›ã‚“ã€‚<p>ã“ã®<strong>é–‹ç™ºå°‚ç”¨</strong>ã®æŒ¯ã‚‹èˆã„ã¯ã€<a href="/learn/keeping-components-pure">ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç´”ç²‹ã«ä¿ã¤</a>ãŸã‚ã«å½¹ç«‹ã¡ã¾ã™ã€‚React ã¯ 2 å›ã®å‘¼ã³å‡ºã—ã®ã†ã¡ã® 1 ã¤ã®çµæœã‚’ä½¿ç”¨ã—ã€ã‚‚ã† 1 ã¤ã®çµæœã¯ç„¡è¦–ã—ã¾ã™ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€ã‚¤ãƒ‹ã‚·ãƒ£ãƒ©ã‚¤ã‚¶ã€ãŠã‚ˆã³ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µé–¢æ•°ãŒç´”ç²‹ã§ã‚ã‚‹é™ã‚Šã€ã“ã‚Œã¯ãƒ­ã‚¸ãƒƒã‚¯ã«å½±éŸ¿ã‚’ä¸ãˆã¾ã›ã‚“ã€‚ãŸã ã—ã€ã“ã‚Œã‚‰ã®é–¢æ•°ãŒèª¤ã£ã¦ã„ã¦ä¸ç´”ã§ã‚ã‚‹å ´åˆã€ã“ã‚Œã«ã‚ˆã‚ŠãƒŸã‚¹ã«æ°—ä»˜ãã“ã¨ãŒã§ãã¾ã™ã€‚<p>ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ç´”ç²‹ã§ãªã„ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µé–¢æ•°ã¯ã‚¹ãƒ†ãƒ¼ãƒˆå†…ã®é…åˆ—ã‚’æ›¸ãæ›ãˆã¦ã„ã¾ã™ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'added_todo'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ğŸš© Mistake: mutating state</span>
      <span class="token keyword control-flow">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>React ãŒãƒªãƒ‡ãƒ¥ãƒ¼ã‚µé–¢æ•°ã‚’ 2 å›å‘¼ã³å‡ºã™ãŸã‚ã€todo ãŒ 2 å›è¿½åŠ ã•ã‚ŒãŸã“ã¨ãŒã‚ã‹ã‚Šã€ãƒŸã‚¹ãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€<a href="/learn/updating-arrays-in-state#adding-to-an-array">é…åˆ—ã®æ›¸ãæ›ãˆã§ã¯ãªãç½®ãæ›ãˆã‚’è¡Œã†</a>ã“ã¨ã§ãƒŸã‚¹ã‚’ä¿®æ­£ã§ãã¾ã™ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'added_todo'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// âœ… Correct: replacing with new state</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
        <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token spread operator">...</span>state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>ã“ã‚Œã§ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µé–¢æ•°ã¯ç´”ç²‹ã«ãªã£ãŸãŸã‚ã€1 å›ä½™åˆ†ã«å‘¼ã³å‡ºã•ã‚Œã¦ã‚‚å‹•ä½œã«å½±éŸ¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚ŒãŒ React ãŒ 2 å›å‘¼ã³å‡ºã™ã“ã¨ã§ãƒŸã‚¹ã‚’ç™ºè¦‹ã§ãã‚‹ç†ç”±ã§ã™ã€‚<strong>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€åˆæœŸåŒ–é–¢æ•°ã€ãŠã‚ˆã³ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µé–¢æ•°ã®ã¿ãŒç´”ç²‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</strong>ã€‚ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã¯ç´”ç²‹ã§ã‚ã‚‹å¿…è¦ã¯ãªã„ãŸã‚ã€React ã¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’ 2 å›å‘¼ã³å‡ºã™ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<p>è©³ç´°ã¯ã€<a href="/learn/keeping-components-pure">ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç´”ç²‹ã«ä¿ã¤</a>ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>