<!doctype html><html lang="pl"><meta charset="utf-8"><title>Rules of Hooks</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="rules-of-hooks"><h1 id="rules-of-hooks">Rules of Hooks</h1><p>JesteÅ› tu najprawdopodobniej z powodu bÅ‚Ä™du:</p><consoleblock level="error"><p>Hooks can only be called inside the body of a function component.</p></consoleblock><p>Zwykle pojawia siÄ™ on z trzech powodÃ³w:<ol><li>UÅ¼ywasz <strong>rÃ³Å¼nych wersji</strong> bibliotek React i React DOM.<li><strong>Åamiesz <a href="./hooks-rules.html">Zasady korzystania z hookÃ³w</a></strong>.<li>Masz <strong>wiÄ™cej niÅ¼ jednÄ… kopiÄ™ Reacta</strong> w danej aplikacji.</ol><p>Przyjrzyjmy siÄ™ bliÅ¼ej kaÅ¼demu z tych przypadkÃ³w.<section class="level2"aria-labelledby="Å‚amanie-zasad-korzystania-z-hookÃ³w-breaking-the-rules-of-hooks"><h2 id="Å‚amanie-zasad-korzystania-z-hookÃ³w-breaking-the-rules-of-hooks">Åamanie zasad korzystania z hookÃ³w {/<em>breaking-the-rules-of-hooks</em>/}</h2><p>Hooki moÅ¼na wywoÅ‚ywaÄ‡ <strong>tylko w komponentach funkcyjnych</strong>:<ul><li>âœ… WywoÅ‚uj je na gÅ‚Ã³wnym poziomie ciaÅ‚a komponentu funkcyjnego.<li>âœ… WywoÅ‚uj je na gÅ‚Ã³wnym poziomie ciaÅ‚a <a href="./hooks-custom.html">wÅ‚asnego hooka</a>.</ul><p><strong>WiÄ™cej na ten temat dowiesz siÄ™ w rozdziale pt. <a href="./hooks-rules.html">Zasady korzystania z hookÃ³w</a>.</strong><pre class="language-js{2-3,8-9}"><code class="language-js{2-3,8-9}">function Counter() {
  // âœ… Dobrze: gÅ‚Ã³wny poziom komponentu funkcyjnego
  const [count, setCount] = useState(0);
  // ...
}

function useWindowWidth() {
  // âœ… Dobrze: gÅ‚Ã³wny poziom wÅ‚asnego hooka
  const [width, setWidth] = useState(window.innerWidth);
  // ...
}</code></pre><p>Dla jasnoÅ›ci, hookÃ³w <strong>nie</strong> moÅ¼na wywoÅ‚ywaÄ‡ w Å¼aden inny sposÃ³b:<ul><li>ğŸ”´ Nie wywoÅ‚uj hookÃ³w w komponentach klasowych.<li>ğŸ”´ Nie wywoÅ‚uj hookÃ³w w procedurach obsÅ‚ugi zdarzeÅ„.<li>ğŸ”´ Nie wywoÅ‚uj hookÃ³w w funkcjach przekazywanych do <code>useMemo</code>, <code>useReducer</code> lub <code>useEffect</code>.</ul><p>JeÅ›li zÅ‚amiesz te zasady, otrzymasz powyÅ¼szy bÅ‚Ä…d.<pre class="language-js{3-4,11-12,20-21}"><code class="language-js{3-4,11-12,20-21}">function Bad({ cond }) {
  if (cond) {
    // ğŸ”´ Bad: inside a condition (to fix, move it outside!)
    const theme = useContext(ThemeContext);
  }
  // ...
}

function Bad() {
  for (let i = 0; i &#x3C; 10; i++) {
    // ğŸ”´ Bad: inside a loop (to fix, move it outside!)
    const theme = useContext(ThemeContext);
  }
  // ...
}

function Bad({ cond }) {
  if (cond) {
    return;
  }
  // ğŸ”´ Bad: after a conditional return (to fix, move it before the return!)
  const theme = useContext(ThemeContext);
  // ...
}

function Bad() {
  function handleClick() {
    // ğŸ”´ Å¹le: wewnÄ…trz procedury obsÅ‚ugi zdarzeÅ„ (wystarczy przenieÅ›Ä‡ na zewnÄ…trz!)
    const theme = useContext(ThemeContext);
  }
  // ...
}

function Bad() {
  const style = useMemo(() => {
    // ğŸ”´ Å¹le: wewnÄ…trz useMemo (wystarczy przenieÅ›Ä‡ na zewnÄ…trz!)
    const theme = useContext(ThemeContext);
    return createStyle(theme);
  });
  // ...
}

class Bad extends React.Component {
  render() {
    // ğŸ”´ Å¹le: w komponencie klasowym (to fix, write a function component instead of a class!)
    useEffect(() => {})
    // ...
  }
}</code></pre><p>Z pomocÄ… <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">wtyczki <code>eslint-plugin-react-hooks</code></a> moÅ¼esz wyÅ‚apaÄ‡ te bÅ‚Ä™dy w trakcie pisania kodu.</p><note><p><a href="./hooks-custom.html">WÅ‚asne hooki</a> <em>mogÄ…</em> wywoÅ‚ywaÄ‡ inne hooki (taki jest ich cel). Dzieje siÄ™ tak dlatego, Å¼e wÅ‚asne hooki takÅ¼e mogÄ… byÄ‡ wywoÅ‚ywane jedynie wewnÄ…trz komponentÃ³w funkcyjnych.</p></note></section><section class="level2"aria-labelledby="niepasujÄ…ce-wersje-reacta-i-react-dom-mismatching-versions-of-react-and-react-dom"><h2 id="niepasujÄ…ce-wersje-reacta-i-react-dom-mismatching-versions-of-react-and-react-dom">NiepasujÄ…ce wersje Reacta i React DOM {/<em>mismatching-versions-of-react-and-react-dom</em>/}</h2><p>ByÄ‡ moÅ¼e uÅ¼ywasz paczki <code>react-dom</code> (&#x3C; 16.8.0) lub <code>react-native</code> (&#x3C; 0.59), ktÃ³ra jeszcze nie obsÅ‚uguje hookÃ³w. Uruchom polecenie <code>npm ls react-dom</code> lub <code>npm ls react-native</code> w katalogu z aplikacjÄ…, aby sprawdziÄ‡ numer uÅ¼ywanej wersji. JeÅ›li ponadto na liÅ›cie zobaczysz co najmniej dwa takie same wpisy, moÅ¼e to byÄ‡ przyczynÄ… kolejnych problemÃ³w (o czym piszemy poniÅ¼ej).</section><section class="level2"aria-labelledby="duplikaty-biblioteki-react-duplicate-react"><h2 id="duplikaty-biblioteki-react-duplicate-react">Duplikaty biblioteki React {/<em>duplicate-react</em>/}</h2><p>Aby hooki mogÅ‚y dziaÅ‚aÄ‡, paczka <code>react</code> importowana w twojej aplikacji musi wskazywaÄ‡ na tÄ™ samÄ… paczkÄ™ <code>react</code> importowanÄ… przez <code>react-dom</code>.<p>JeÅ›li te importy wskazujÄ… na dwa rÃ³Å¼ne obiekty, zobaczysz powyÅ¼sze ostrzeÅ¼enie. MoÅ¼e siÄ™ to zdarzyÄ‡, gdy <strong>przypadkiem w projekcie znajdÄ… siÄ™ dwie kopie</strong> paczki <code>react</code>.<p>JeÅ›li uÅ¼ywasz Node'a do zarzÄ…dzania paczkami, moÅ¼esz to sprawdziÄ‡, uruchamiajÄ…c w folderze projektu polecenie:</p><terminalblock><p>npm ls react</p></terminalblock><p>JeÅ¼eli na zwrÃ³conej liÅ›cie zobaczysz wiÄ™cej niÅ¼ jednego Reacta, musisz znaleÅºÄ‡ przyczynÄ™ i naprawiÄ‡ drzewo zaleÅ¼noÅ›ci projektu. ByÄ‡ moÅ¼e ktÃ³raÅ› z uÅ¼ywanych przez ciebie paczek zamiast deklarowaÄ‡ <code>react</code> jako "peer dependency", deklaruje jÄ… jako "dependency". DopÃ³ki ta paczka nie zostanie naprawiona, moÅ¼esz obejÅ›Ä‡ problem korzystajÄ…c z <a href="https://yarnpkg.com/lang/en/docs/selective-version-resolutions/">Yarn resolutions</a>.<p>W zdiagnozowaniu problemu moÅ¼e pomÃ³c dodanie paru logÃ³w do aplikacji i zrestartowanie serwera deweloperskiego:<pre class="language-js"><code class="language-js"><span class="token comment">// Dodaj w node_modules/react-dom/index.js</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">React1</span></span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Dodaj w pliku z komponentem</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">React2</span></span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">React1</span></span> <span class="token operator">===</span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">React2</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>JeÅ›li w konsoli pojawi siÄ™ <code>false</code>, to najprawdopodobniej uÅ¼ywasz dwÃ³ch rÃ³Å¼nych paczek Reacta i musisz dowiedzieÄ‡ siÄ™, jaka jest tego przyczyna. W <a href="https://github.com/facebook/react/issues/13991">tym zgÅ‚oszonym problemie</a> opisano niektÃ³re z najczÄ™stszych przyczyn tego problemu.<p>InnÄ… przyczynÄ… moÅ¼e byÄ‡ uÅ¼ycie polecenia <code>npm link</code> lub podobnego. W takim przypadku twÃ³j bundler (ang. <em>narzÄ™dzie pakujÄ…ce</em>) moÅ¼e "widzieÄ‡" dwa Reacty - jeden w folderze aplikacji i jeden w folderze z bibliotekami. ZakÅ‚adajÄ…c, Å¼e foldery <code>myapp</code> i <code>mylib</code> znajdujÄ… siÄ™ na tym samym poziomie, pomÃ³c moÅ¼e uruchomienie polecenia <code>npm link ../myapp/node_modules/react</code> z folderu <code>mylib</code>. Powinno to zmusiÄ‡ bibliotekÄ™ do uÅ¼ywania kopii Reacta naleÅ¼Ä…cej do aplikacji.</p><note><p>Z zaÅ‚oÅ¼enia React pozwala na uÅ¼ywanie kilku niezaleÅ¼nych kopii biblioteki na jednej stronie (np. gdy korzystajÄ… z niej zarÃ³wno aplikacja, jak i zewnÄ™trzny widget). Problem wystÄ™puje tylko wtedy, gdy wywoÅ‚anie <code>require('react')</code> wskazuje co innego dla komponentu, a co innego renderujÄ…cej go kopii biblioteki <code>react-dom</code>.</p></note></section><section class="level2"aria-labelledby="inne-przypadki-other-causes"><h2 id="inne-przypadki-other-causes">Inne przypadki {/<em>other-causes</em>/}</h2><p>JeÅ›li nie pomogÅ‚o Å¼adne z powyÅ¼szych rozwiÄ…zaÅ„, napisz komentarz w <a href="https://github.com/facebook/react/issues/13991">tym wÄ…tku</a>, a sprÃ³bujemy ci pomÃ³c. Postaraj siÄ™ przygotowaÄ‡ prosty przykÅ‚ad ilustrujÄ…cy problem - moÅ¼liwe, Å¼e znajdziesz rozwiÄ…zanie w trakcie opisywania problemu. <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>