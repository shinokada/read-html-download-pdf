<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>å°†äº‹ä»¶ä» Effect ä¸­åˆ†å¼€</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="å°†äº‹ä»¶ä»-effect-ä¸­åˆ†å¼€"><h1 id="å°†äº‹ä»¶ä»-effect-ä¸­åˆ†å¼€">å°†äº‹ä»¶ä» Effect ä¸­åˆ†å¼€</h1><intro><p>äº‹ä»¶å¤„ç†å‡½æ•°åªæœ‰åœ¨ä½ å†æ¬¡æ‰§è¡ŒåŒæ ·çš„äº¤äº’æ—¶æ‰ä¼šé‡æ–°è¿è¡Œã€‚Effect å’Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸ä¸€æ ·ï¼Œå®ƒåªæœ‰åœ¨è¯»å–çš„ props æˆ– state å€¼å’Œä¸Šä¸€æ¬¡æ¸²æŸ“ä¸ä¸€æ ·æ—¶æ‰ä¼šé‡æ–°åŒæ­¥ã€‚æœ‰æ—¶ä½ éœ€è¦è¿™ä¸¤ç§è¡Œä¸ºçš„æ··åˆä½“ï¼šå³ä¸€ä¸ª Effect åªåœ¨å“åº”æŸäº›å€¼æ—¶é‡æ–°è¿è¡Œï¼Œä½†æ˜¯åœ¨å…¶ä»–å€¼å˜åŒ–æ—¶ä¸é‡æ–°è¿è¡Œã€‚æœ¬ç« å°†ä¼šæ•™ä½ æ€ä¹ˆå®ç°è¿™ä¸€ç‚¹ã€‚</p></intro><youwilllearn><ul><li>æ€ä¹ˆåœ¨äº‹ä»¶å¤„ç†å‡½æ•°å’Œ Effect ä¹‹é—´åšé€‰æ‹©<li>ä¸ºä»€ä¹ˆ Effect æ˜¯å“åº”å¼çš„ï¼Œè€Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸æ˜¯<li>å½“ä½ æƒ³è¦ Effect çš„éƒ¨åˆ†ä»£ç å˜æˆéå“åº”å¼æ—¶è¦åšäº›ä»€ä¹ˆ<li>Effect Event æ˜¯ä»€ä¹ˆï¼Œä»¥åŠæ€ä¹ˆä» Effect ä¸­æå–<li>æ€ä¹ˆä½¿ç”¨ Effect Event è¯»å–æœ€æ–°çš„ props å’Œ state</ul></youwilllearn><section class="level2"aria-labelledby="åœ¨äº‹ä»¶å¤„ç†å‡½æ•°å’Œ-effect-ä¸­åšé€‰æ‹©-choosing-between-event-handlers-and-effects"><h2 id="åœ¨äº‹ä»¶å¤„ç†å‡½æ•°å’Œ-effect-ä¸­åšé€‰æ‹©-choosing-between-event-handlers-and-effects">åœ¨äº‹ä»¶å¤„ç†å‡½æ•°å’Œ Effect ä¸­åšé€‰æ‹© {/<em>choosing-between-event-handlers-and-effects</em>/}</h2><p>é¦–å…ˆè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹äº‹ä»¶å¤„ç†å‡½æ•°å’Œ Effect çš„åŒºåˆ«ã€‚<p>å‡è®¾ä½ æ­£åœ¨å®ç°ä¸€ä¸ªèŠå¤©å®¤ç»„ä»¶ï¼Œéœ€æ±‚å¦‚ä¸‹ï¼š<ol><li>ç»„ä»¶åº”è¯¥è‡ªåŠ¨è¿æ¥é€‰ä¸­çš„èŠå¤©å®¤ã€‚<li>æ¯å½“ä½ ç‚¹å‡»â€œSendâ€æŒ‰é’®ï¼Œç»„ä»¶åº”è¯¥åœ¨å½“å‰èŠå¤©ç•Œé¢å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚</ol><p>å‡è®¾ä½ å·²ç»å®ç°äº†è¿™éƒ¨åˆ†ä»£ç ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ç¡®å®šåº”è¯¥æ”¾åœ¨å“ªé‡Œã€‚ä½ æ˜¯åº”è¯¥ç”¨äº‹ä»¶å¤„ç†å‡½æ•°è¿˜æ˜¯ Effect å‘¢ï¼Ÿæ¯å½“ä½ éœ€è¦å›ç­”è¿™ä¸ªé—®é¢˜æ—¶ï¼Œè¯·è€ƒè™‘ä¸€ä¸‹ <a href="/learn/synchronizing-with-effects#what-are-effects-and-how-are-they-different-from-events">ä¸ºä»€ä¹ˆä»£ç éœ€è¦è¿è¡Œ</a>ã€‚<section class="level3"aria-labelledby="äº‹ä»¶å¤„ç†å‡½æ•°åªåœ¨å“åº”ç‰¹å®šçš„äº¤äº’æ“ä½œæ—¶è¿è¡Œ-event-handlers-run-in-response-to-specific-interactions"><h3 id="äº‹ä»¶å¤„ç†å‡½æ•°åªåœ¨å“åº”ç‰¹å®šçš„äº¤äº’æ“ä½œæ—¶è¿è¡Œ-event-handlers-run-in-response-to-specific-interactions">äº‹ä»¶å¤„ç†å‡½æ•°åªåœ¨å“åº”ç‰¹å®šçš„äº¤äº’æ“ä½œæ—¶è¿è¡Œ {/<em>event-handlers-run-in-response-to-specific-interactions</em>/}</h3><p>ä»ç”¨æˆ·è§’åº¦å‡ºå‘ï¼Œå‘é€æ¶ˆæ¯æ˜¯ <strong>å› ä¸º</strong> ä»–ç‚¹å‡»äº†ç‰¹å®šçš„â€œSendâ€æŒ‰é’®ã€‚å¦‚æœåœ¨ä»»æ„æ—¶é—´æˆ–è€…å› ä¸ºå…¶ä»–åŸå› å‘é€æ¶ˆæ¯ï¼Œç”¨æˆ·ä¼šè§‰å¾—éå¸¸æ··ä¹±ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‘é€æ¶ˆæ¯åº”è¯¥ä½¿ç”¨äº‹ä»¶å¤„ç†å‡½æ•°ã€‚äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯è®©ä½ å¤„ç†ç‰¹å®šçš„äº¤äº’æ“ä½œçš„ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">handleSendClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleSendClick<span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Send</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>å€ŸåŠ©äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä½ å¯ä»¥ç¡®ä¿ <code>sendMessage(message)</code> <strong>åª</strong> åœ¨ç”¨æˆ·ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™è¿è¡Œã€‚</section><section class="level3"aria-labelledby="æ¯å½“éœ€è¦åŒæ­¥effect-å°±ä¼šè¿è¡Œ-effects-run-whenever-synchronization-is-needed"><h3 id="æ¯å½“éœ€è¦åŒæ­¥effect-å°±ä¼šè¿è¡Œ-effects-run-whenever-synchronization-is-needed">æ¯å½“éœ€è¦åŒæ­¥ï¼ŒEffect å°±ä¼šè¿è¡Œ {/<em>effects-run-whenever-synchronization-is-needed</em>/}</h3><p>å›æƒ³ä¸€ä¸‹ï¼Œä½ è¿˜éœ€è¦è®©ç»„ä»¶å’ŒèŠå¤©å®¤ä¿æŒè¿æ¥ã€‚ä»£ç æ”¾å“ªé‡Œå‘¢ï¼Ÿ<p>è¿è¡Œè¿™ä¸ªä»£ç çš„ <strong>åŸå› </strong> ä¸æ˜¯ç‰¹å®šçš„äº¤äº’æ“ä½œã€‚ç”¨æˆ·ä¸ºä»€ä¹ˆæˆ–æ€ä¹ˆå¯¼èˆªåˆ°èŠå¤©å®¤å±å¹•çš„éƒ½ä¸é‡è¦ã€‚æ—¢ç„¶ç”¨æˆ·æ­£åœ¨çœ‹å®ƒå¹¶ä¸”èƒ½å¤Ÿå’Œå®ƒäº¤äº’ï¼Œç»„ä»¶å°±è¦å’Œé€‰ä¸­çš„èŠå¤©æœåŠ¡å™¨ä¿æŒè¿æ¥ã€‚å³ä½¿èŠå¤©å®¤ç»„ä»¶æ˜¾ç¤ºçš„æ˜¯åº”ç”¨çš„åˆå§‹å±å¹•ï¼Œç”¨æˆ·æ ¹æœ¬è¿˜æ²¡æœ‰æ‰§è¡Œä»»ä½•äº¤äº’ï¼Œä»ç„¶åº”è¯¥éœ€è¦ä¿æŒè¿æ¥ã€‚è¿™å°±æ˜¯è¿™é‡Œç”¨ Effect çš„åŸå› ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><strong>æ— è®º</strong> ç”¨æˆ·æ˜¯å¦æ‰§è¡ŒæŒ‡å®šäº¤äº’æ“ä½œï¼Œè¿™æ®µä»£ç éƒ½å¯ä»¥ä¿è¯å½“å‰é€‰ä¸­çš„èŠå¤©å®¤æœåŠ¡å™¨ä¸€ç›´æœ‰ä¸€ä¸ªæ´»è·ƒè¿æ¥ã€‚ç”¨æˆ·æ˜¯å¦åªå¯åŠ¨äº†åº”ç”¨ï¼Œæˆ–é€‰ä¸­äº†ä¸åŒçš„èŠå¤©å®¤ï¼Œåˆæˆ–è€…å¯¼èˆªåˆ°å¦ä¸€ä¸ªå±å¹•åè¿”å›ï¼ŒEffect éƒ½å¯ä»¥ç¡®ä¿ç»„ä»¶å’Œå½“å‰é€‰ä¸­çš„èŠå¤©å®¤ä¿æŒåŒæ­¥ï¼Œå¹¶åœ¨å¿…è¦æ—¶ <a href="/learn/lifecycle-of-reactive-effects#why-synchronization-may-need-to-happen-more-than-once">é‡æ–°è¿æ¥</a>ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection<span class="token punctuation">,</span> sendMessage <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleSendClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Welcome</span> to the <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> room<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleSendClick<span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Send</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'general'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>show<span class="token punctuation">,</span> setShow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">Choose</span> the chat room<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>general<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>travel<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>music<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setShow</span><span class="token punctuation">(</span><span class="token operator">!</span>show<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>show <span class="token operator">?</span> <span class="token string">'Close chat'</span> <span class="token operator">:</span> <span class="token string">'Open chat'</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">{</span>show <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
      <span class="token punctuation">{</span>show <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'ğŸ”µ You sent: '</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… Connecting to "'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'" room at '</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ Disconnected from "'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'" room at '</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input<span class="token punctuation">,</span> select</span> <span class="token punctuation">{</span> <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack></section></section><section class="level2"aria-labelledby="å“åº”å¼å€¼å’Œå“åº”å¼é€»è¾‘-reactive-values-and-reactive-logic"><h2 id="å“åº”å¼å€¼å’Œå“åº”å¼é€»è¾‘-reactive-values-and-reactive-logic">å“åº”å¼å€¼å’Œå“åº”å¼é€»è¾‘ {/<em>reactive-values-and-reactive-logic</em>/}</h2><p>ç›´è§‚ä¸Šï¼Œä½ å¯ä»¥è¯´äº‹ä»¶å¤„ç†å‡½æ•°æ€»æ˜¯â€œæ‰‹åŠ¨â€è§¦å‘çš„ï¼Œä¾‹å¦‚ç‚¹å‡»æŒ‰é’®ã€‚å¦ä¸€æ–¹é¢ï¼Œ Effect æ˜¯è‡ªåŠ¨è§¦å‘ï¼šæ¯å½“éœ€è¦ä¿æŒåŒæ­¥çš„æ—¶å€™ä»–ä»¬å°±ä¼šå¼€å§‹è¿è¡Œå’Œé‡æ–°è¿è¡Œã€‚<p>æœ‰ä¸€ä¸ªæ›´ç²¾ç¡®çš„æ–¹å¼æ¥è€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚<p>ç»„ä»¶å†…éƒ¨å£°æ˜çš„ state å’Œ props å˜é‡è¢«ç§°ä¸º<codestep step="{2}">å“åº”å¼å€¼</codestep>ã€‚æœ¬ç¤ºä¾‹ä¸­çš„ <code>serverUrl</code> ä¸æ˜¯å“åº”å¼å€¼ï¼Œä½† <code>roomId</code> å’Œ <code>message</code> æ˜¯ã€‚ä»–ä»¬å‚ä¸ç»„ä»¶çš„æ¸²æŸ“æ•°æ®æµï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>åƒè¿™æ ·çš„å“åº”å¼å€¼å¯ä»¥å› ä¸ºé‡æ–°æ¸²æŸ“è€Œå˜åŒ–ã€‚ä¾‹å¦‚ç”¨æˆ·å¯èƒ½ä¼šç¼–è¾‘ <code>message</code> æˆ–è€…åœ¨ä¸‹æ‹‰èœå•ä¸­é€‰ä¸­ä¸åŒçš„ <code>roomId</code>ã€‚äº‹ä»¶å¤„ç†å‡½æ•°å’Œ Effect å¯¹äºå˜åŒ–çš„å“åº”æ˜¯ä¸ä¸€æ ·çš„ï¼š<ul><li><strong>äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨çš„é€»è¾‘æ˜¯éå“åº”å¼çš„</strong>ã€‚é™¤éç”¨æˆ·åˆæ‰§è¡Œäº†åŒæ ·çš„æ“ä½œï¼ˆä¾‹å¦‚ç‚¹å‡»ï¼‰ï¼Œå¦åˆ™è¿™æ®µé€»è¾‘ä¸ä¼šå†è¿è¡Œã€‚äº‹ä»¶å¤„ç†å‡½æ•°å¯ä»¥åœ¨â€œä¸å“åº”â€ä»–ä»¬å˜åŒ–çš„æƒ…å†µä¸‹è¯»å–å“åº”å¼å€¼ã€‚<li><strong>Effect å†…éƒ¨çš„é€»è¾‘æ˜¯å“åº”å¼çš„</strong>ã€‚å¦‚æœ Effect è¦è¯»å–å“åº”å¼å€¼ï¼Œ<a href="/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values">ä½ å¿…é¡»å°†å®ƒæŒ‡å®šä¸ºä¾èµ–é¡¹</a>ã€‚å¦‚æœæ¥ä¸‹æ¥çš„é‡æ–°æ¸²æŸ“å¼•èµ·é‚£ä¸ªå€¼å˜åŒ–ï¼ŒReact å°±ä¼šä½¿ç”¨æ–°å€¼é‡æ–°è¿è¡Œ Effect å†…çš„é€»è¾‘ã€‚</ul><p>è®©æˆ‘ä»¬é‡æ–°çœ‹çœ‹å‰é¢çš„ç¤ºä¾‹æ¥è¯´æ˜å·®å¼‚ã€‚<section class="level3"aria-labelledby="äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨çš„é€»è¾‘æ˜¯éå“åº”å¼çš„-logic-inside-event-handlers-is-not-reactive"><h3 id="äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨çš„é€»è¾‘æ˜¯éå“åº”å¼çš„-logic-inside-event-handlers-is-not-reactive">äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨çš„é€»è¾‘æ˜¯éå“åº”å¼çš„ {/<em>logic-inside-event-handlers-is-not-reactive</em>/}</h3><p>çœ‹è¿™è¡Œä»£ç ã€‚è¿™ä¸ªé€»è¾‘æ˜¯å“åº”å¼çš„å—ï¼Ÿ<pre class="language-js"><code class="language-js">    <span class="token comment">// ...</span>
    <span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span></code></pre><p>ä»ç”¨æˆ·è§’åº¦å‡ºå‘ï¼Œ<strong><code>message</code> çš„å˜åŒ–å¹¶ä¸æ„å‘³ç€ä»–ä»¬æƒ³è¦å‘é€æ¶ˆæ¯</strong>ã€‚å®ƒåªèƒ½è¡¨æ˜ç”¨æˆ·æ­£åœ¨è¾“å…¥ã€‚æ¢å¥è¯è¯´ï¼Œå‘é€æ¶ˆæ¯çš„é€»è¾‘ä¸åº”è¯¥æ˜¯å“åº”å¼çš„ã€‚å®ƒä¸åº”è¯¥ä»…ä»…å› ä¸º<codestep step="{2}">å“åº”å¼å€¼</codestep>å˜åŒ–è€Œå†æ¬¡è¿è¡Œã€‚è¿™å°±æ˜¯åº”è¯¥æŠŠå®ƒå½’å…¥äº‹ä»¶å¤„ç†å‡½æ•°çš„åŸå› ï¼š<pre class="language-js"><code class="language-js">  <span class="token keyword">function</span> <span class="token function">handleSendClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre><p>äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯éå“åº”å¼çš„ï¼Œæ‰€ä»¥ <code>sendMessage(message)</code> åªä¼šåœ¨ç”¨æˆ·ç‚¹å‡»â€œSendâ€æŒ‰é’®çš„æ—¶å€™è¿è¡Œã€‚</section><section class="level3"aria-labelledby="effect-å†…éƒ¨çš„é€»è¾‘æ˜¯å“åº”å¼çš„-logic-inside-effects-is-reactive"><h3 id="effect-å†…éƒ¨çš„é€»è¾‘æ˜¯å“åº”å¼çš„-logic-inside-effects-is-reactive">Effect å†…éƒ¨çš„é€»è¾‘æ˜¯å“åº”å¼çš„ {/<em>logic-inside-effects-is-reactive</em>/}</h3><p>ç°åœ¨è®©æˆ‘ä»¬è¿”å›è¿™å‡ è¡Œä»£ç ï¼š<pre class="language-js"><code class="language-js">    <span class="token comment">// ...</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span></code></pre><p>ä»ç”¨æˆ·è§’åº¦å‡ºå‘ï¼Œ<strong><code>roomId</code> çš„å˜åŒ–æ„å‘³ç€ä»–ä»¬çš„ç¡®æƒ³è¦è¿æ¥åˆ°ä¸åŒçš„æˆ¿é—´</strong>ã€‚æ¢å¥è¯è¯´ï¼Œè¿æ¥æˆ¿é—´çš„é€»è¾‘åº”è¯¥æ˜¯å“åº”å¼çš„ã€‚ä½  <strong>éœ€è¦</strong> è¿™å‡ è¡Œä»£ç å’Œå“åº”å¼å€¼â€œä¿æŒåŒæ­¥â€ï¼Œå¹¶åœ¨å€¼ä¸åŒæ—¶å†æ¬¡è¿è¡Œã€‚è¿™å°±æ˜¯å®ƒè¢«å½’å…¥ Effect çš„åŸå› ï¼š<pre class="language-js"><code class="language-js">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Effect æ˜¯å“åº”å¼çš„ï¼Œæ‰€ä»¥ <code>createConnection(serverUrl, roomId)</code> å’Œ <code>connection.connect()</code> ä¼šå› ä¸º <code>roomId</code> æ¯ä¸ªä¸åŒçš„å€¼è€Œè¿è¡Œã€‚Effect è®©èŠå¤©å®¤è¿æ¥å’Œå½“å‰é€‰ä¸­çš„æˆ¿é—´ä¿æŒäº†åŒæ­¥ã€‚</section></section><section class="level2"aria-labelledby="ä»-effect-ä¸­æå–éå“åº”å¼é€»è¾‘-extracting-non-reactive-logic-out-of-effects"><h2 id="ä»-effect-ä¸­æå–éå“åº”å¼é€»è¾‘-extracting-non-reactive-logic-out-of-effects">ä» Effect ä¸­æå–éå“åº”å¼é€»è¾‘ {/<em>extracting-non-reactive-logic-out-of-effects</em>/}</h2><p>å½“ä½ æƒ³æ··åˆä½¿ç”¨å“åº”å¼é€»è¾‘å’Œéå“åº”å¼é€»è¾‘æ—¶ï¼Œäº‹æƒ…å˜å¾—æ›´åŠ æ£˜æ‰‹ã€‚<p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³åœ¨ç”¨æˆ·è¿æ¥åˆ°èŠå¤©å®¤æ—¶å±•ç¤ºä¸€ä¸ªé€šçŸ¥ã€‚å¹¶ä¸”é€šè¿‡ä» props ä¸­è¯»å–å½“å‰ themeï¼ˆdark æˆ–è€… lightï¼‰æ¥å±•ç¤ºå¯¹åº”é¢œè‰²çš„é€šçŸ¥ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Connected!'</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span></code></pre><p>ä½†æ˜¯ <code>theme</code> æ˜¯ä¸€ä¸ªå“åº”å¼å€¼ï¼ˆå®ƒä¼šç”±äºé‡æ–°æ¸²æŸ“è€Œå˜åŒ–ï¼‰ï¼Œå¹¶ä¸” <a href="/learn/lifecycle-of-reactive-effects#react-verifies-that-you-specified-every-reactive-value-as-a-dependency">Effect è¯»å–çš„æ¯ä¸€ä¸ªå“åº”å¼å€¼éƒ½å¿…é¡»åœ¨å…¶ä¾èµ–é¡¹ä¸­å£°æ˜</a>ã€‚ç°åœ¨ä½ å¿…é¡»æŠŠ <code>theme</code> ä½œä¸º Effect çš„ä¾èµ–é¡¹ä¹‹ä¸€ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Connected!'</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> theme<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… å£°æ˜æ‰€æœ‰ä¾èµ–é¡¹</span>
  <span class="token comment">// ...</span></code></pre><p>ç”¨è¿™ä¸ªä¾‹å­è¯•ä¸€ä¸‹ï¼Œçœ‹ä½ èƒ½å¦çœ‹å‡ºè¿™ä¸ªç”¨æˆ·ä½“éªŒé—®é¢˜ï¼š</p><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"toastify-js"</span><span class="token operator">:</span> <span class="token string">"1.12.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection<span class="token punctuation">,</span> sendMessage <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> showNotification <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./notifications.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Connected!'</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> theme<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Welcome</span> to the <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> room<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'general'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isDark<span class="token punctuation">,</span> setIsDark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">Choose</span> the chat room<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>general<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>travel<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>music<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isDark<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setIsDark</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">Use</span> dark theme
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
        roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
        theme<span class="token operator">=</span><span class="token punctuation">{</span>isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword">let</span> connectedCallback<span class="token punctuation">;</span>
  <span class="token keyword">let</span> timeout<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Cannot add the handler twice.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>event <span class="token operator">!==</span> <span class="token string">'connected'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Only "connected" event is supported.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      connectedCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Toastify</span></span> <span class="token keyword module">from</span> <span class="token string">'toastify-js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'toastify-js/src/toastify.css'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> theme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function"><span class="token maybe-class-name">Toastify</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">gravity</span><span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'right'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">background</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'black'</span> <span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'white'</span> <span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">showToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>å½“ <code>roomId</code> å˜åŒ–æ—¶ï¼ŒèŠå¤©ä¼šå’Œé¢„æœŸä¸€æ ·é‡æ–°è¿æ¥ã€‚ä½†æ˜¯ç”±äº <code>theme</code> ä¹Ÿæ˜¯ä¸€ä¸ªä¾èµ–é¡¹ï¼Œæ‰€ä»¥æ¯æ¬¡ä½ åœ¨ dark å’Œ light ä¸»é¢˜é—´åˆ‡æ¢æ—¶ï¼ŒèŠå¤© <strong>ä¹Ÿä¼š</strong> é‡è¿ã€‚è¿™ä¸æ˜¯å¾ˆå¥½ï¼<p>æ¢è¨€ä¹‹ï¼Œå³ä½¿å®ƒåœ¨ Effect å†…éƒ¨ï¼ˆè¿™æ˜¯å“åº”å¼çš„ï¼‰ï¼Œä½ ä¹Ÿä¸æƒ³è®©è¿™è¡Œä»£ç å˜æˆå“åº”å¼ï¼š<pre class="language-js"><code class="language-js">      <span class="token comment">// ...</span>
      <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Connected!'</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// ...</span></code></pre><p>ä½ éœ€è¦ä¸€ä¸ªå°†è¿™ä¸ªéå“åº”å¼é€»è¾‘å’Œå‘¨å›´å“åº”å¼ Effect éš”ç¦»å¼€æ¥çš„æ–¹æ³•ã€‚<section class="level3"aria-labelledby="å£°æ˜ä¸€ä¸ª-effect-event-declaring-an-effect-event"><h3 id="å£°æ˜ä¸€ä¸ª-effect-event-declaring-an-effect-event">å£°æ˜ä¸€ä¸ª Effect Event {/<em>declaring-an-effect-event</em>/}</h3><wip><p>æœ¬ç« èŠ‚æè¿°äº†ä¸€ä¸ªåœ¨ React ç¨³å®šç‰ˆä¸­ <strong>è¿˜æ²¡æœ‰å‘å¸ƒçš„å®éªŒæ€§ API</strong>ã€‚</p></wip><p>ä½¿ç”¨ <a href="/reference/react/experimental_useEffectEvent"><code>useEffectEvent</code></a> è¿™ä¸ªç‰¹æ®Šçš„ Hook ä» Effect ä¸­æå–éå“åº”å¼é€»è¾‘ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onConnected <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Connected!'</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p>è¿™é‡Œçš„ <code>onConnected</code> è¢«ç§°ä¸º <strong>Effect Event</strong>ã€‚å®ƒæ˜¯ Effect é€»è¾‘çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯å…¶è¡Œä¸ºæ›´åƒäº‹ä»¶å¤„ç†å‡½æ•°ã€‚å®ƒå†…éƒ¨çš„é€»è¾‘ä¸æ˜¯å“åº”å¼çš„ï¼Œè€Œä¸”èƒ½ä¸€ç›´â€œçœ‹è§â€æœ€æ–°çš„ props å’Œ stateã€‚<p>ç°åœ¨ä½ å¯ä»¥åœ¨ Effect å†…éƒ¨è°ƒç”¨ <code>onConnected</code> Effect Eventï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onConnected <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Connected!'</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">onConnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… å£°æ˜æ‰€æœ‰ä¾èµ–é¡¹</span>
  <span class="token comment">// ...</span></code></pre><p>è¿™ä¸ªæ–¹æ³•è§£å†³äº†é—®é¢˜ã€‚æ³¨æ„ä½ å¿…é¡»ä» Effect ä¾èµ–é¡¹ä¸­ <strong>ç§»é™¤</strong> <code>onConnected</code>ã€‚<strong>Effect Event æ˜¯éå“åº”å¼çš„å¹¶ä¸”å¿…é¡»ä»ä¾èµ–é¡¹ä¸­åˆ é™¤</strong>ã€‚<p>éªŒè¯æ–°è¡¨ç°æ˜¯å¦å’Œä½ é¢„æœŸçš„ä¸€æ ·ï¼š</p><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"toastify-js"</span><span class="token operator">:</span> <span class="token string">"1.12.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection<span class="token punctuation">,</span> sendMessage <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> showNotification <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./notifications.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onConnected <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Connected!'</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">onConnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Welcome</span> to the <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> room<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'general'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isDark<span class="token punctuation">,</span> setIsDark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">Choose</span> the chat room<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>general<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>travel<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>music<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isDark<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setIsDark</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">Use</span> dark theme
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
        roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
        theme<span class="token operator">=</span><span class="token punctuation">{</span>isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword">let</span> connectedCallback<span class="token punctuation">;</span>
  <span class="token keyword">let</span> timeout<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Cannot add the handler twice.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>event <span class="token operator">!==</span> <span class="token string">'connected'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Only "connected" event is supported.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      connectedCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Toastify</span></span> <span class="token keyword module">from</span> <span class="token string">'toastify-js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'toastify-js/src/toastify.css'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> theme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function"><span class="token maybe-class-name">Toastify</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">gravity</span><span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'right'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">background</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'black'</span> <span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'white'</span> <span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">showToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>ä½ å¯ä»¥å°† Effect Event çœ‹æˆå’Œäº‹ä»¶å¤„ç†å‡½æ•°ç›¸ä¼¼çš„ä¸œè¥¿ã€‚ä¸»è¦åŒºåˆ«æ˜¯äº‹ä»¶å¤„ç†å‡½æ•°åªåœ¨å“åº”ç”¨æˆ·äº¤äº’çš„æ—¶å€™è¿è¡Œï¼Œè€Œ Effect Event æ˜¯ä½ åœ¨ Effect ä¸­è§¦å‘çš„ã€‚Effect Event è®©ä½ åœ¨ Effect å“åº”æ€§å’Œä¸åº”æ˜¯å“åº”å¼çš„ä»£ç é—´â€œæ‰“ç ´é“¾æ¡â€ã€‚</section><section class="level3"aria-labelledby="ä½¿ç”¨-effect-event-è¯»å–æœ€æ–°çš„-props-å’Œ-state-reading-latest-props-and-state-with-effect-events"><h3 id="ä½¿ç”¨-effect-event-è¯»å–æœ€æ–°çš„-props-å’Œ-state-reading-latest-props-and-state-with-effect-events">ä½¿ç”¨ Effect Event è¯»å–æœ€æ–°çš„ props å’Œ state {/<em>reading-latest-props-and-state-with-effect-events</em>/}</h3><wip><p>æœ¬ç« èŠ‚æè¿°äº†ä¸€ä¸ªåœ¨ React ç¨³å®šç‰ˆä¸­ <strong>è¿˜æ²¡æœ‰å‘å¸ƒçš„å®éªŒæ€§ API</strong>ã€‚</p></wip><p>Effect Event å¯ä»¥ä¿®å¤ä¹‹å‰è®¸å¤šä½ å¯èƒ½è¯•å›¾æŠ‘åˆ¶ä¾èµ–é¡¹æ£€æŸ¥å·¥å…·çš„åœ°æ–¹ã€‚<p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªè®°å½•é¡µé¢è®¿é—®çš„ Effectï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">logVisit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>ç¨åå‘ä½ çš„ç«™ç‚¹æ·»åŠ å¤šä¸ªè·¯ç”±ã€‚ç°åœ¨ <code>Page</code> ç»„ä»¶æ¥æ”¶åŒ…å«å½“å‰è·¯å¾„çš„ <code>url</code> propsã€‚ä½ æƒ³æŠŠ <code>url</code> ä½œä¸º <code>logVisit</code> è°ƒç”¨çš„ä¸€éƒ¨åˆ†è¿›è¡Œä¼ é€’ï¼Œä½†æ˜¯ä¾èµ–é¡¹æ£€æŸ¥å·¥å…·ä¼šæç¤ºï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">logVisit</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ”´ React Hook useEffect ç¼ºå°‘ä¸€ä¸ªä¾èµ–é¡¹: 'url'</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>æƒ³æƒ³ä½ æƒ³è¦ä»£ç åšä»€ä¹ˆã€‚ä½  <strong>éœ€è¦</strong> ä¸ºä¸åŒçš„ URL è®°å½•å•ç‹¬çš„è®¿é—®ï¼Œå› ä¸ºæ¯ä¸ª URL ä»£è¡¨ä¸åŒçš„é¡µé¢ã€‚æ¢è¨€ä¹‹ï¼Œ<code>logVisit</code> è°ƒç”¨å¯¹äº <code>url</code> <strong>åº”è¯¥</strong> æ˜¯å“åº”å¼çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ éµå¾ªä¾èµ–é¡¹æ£€æŸ¥å·¥å…·å¹¶æ·»åŠ  <code>url</code> ä½œä¸ºä¸€ä¸ªä¾èµ–é¡¹å¾ˆæœ‰æ„ä¹‰ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">logVisit</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… å£°æ˜æ‰€æœ‰ä¾èµ–é¡¹</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>ç°åœ¨å‡è®¾ä½ æƒ³åœ¨æ¯æ¬¡é¡µé¢è®¿é—®ä¸­åŒ…å«è´­ç‰©è½¦ä¸­çš„å•†å“æ•°é‡ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> items <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ShoppingCartContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> numberOfItems <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">logVisit</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> numberOfItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ”´ React Hook useEffect ç¼ºå°‘ä¾èµ–é¡¹: â€˜numberOfItemsâ€™</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>ä½ åœ¨ Effect å†…éƒ¨ä½¿ç”¨äº† <code>numberOfItems</code>ï¼Œæ‰€ä»¥ä»£ç æ£€æŸ¥å·¥å…·ä¼šè®©ä½ æŠŠå®ƒåŠ åˆ°ä¾èµ–é¡¹ä¸­ã€‚ä½†æ˜¯ï¼Œä½  <strong>ä¸</strong> æƒ³è¦ <code>logVisit</code> è°ƒç”¨å“åº” <code>numberOfItems</code>ã€‚å¦‚æœç”¨æˆ·æŠŠæŸæ ·ä¸œè¥¿æ”¾å…¥è´­ç‰©è½¦ï¼Œ <code>numberOfItems</code> ä¼šå˜åŒ–ï¼Œè¿™ <strong>å¹¶ä¸æ„å‘³ç€</strong> ç”¨æˆ·å†æ¬¡è®¿é—®äº†è¿™ä¸ªé¡µé¢ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨æŸç§æ„ä¹‰ä¸Šï¼Œ<strong>è®¿é—®é¡µé¢</strong> æ˜¯ä¸€ä¸ªâ€œäº‹ä»¶â€ã€‚å®ƒå‘ç”Ÿåœ¨æŸä¸ªå‡†ç¡®çš„æ—¶åˆ»ã€‚<p>å°†ä»£ç åˆ†å‰²ä¸ºä¸¤éƒ¨åˆ†ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> items <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ShoppingCartContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> numberOfItems <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> onVisit <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token parameter">visitedUrl</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">logVisit</span><span class="token punctuation">(</span>visitedUrl<span class="token punctuation">,</span> numberOfItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">onVisit</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… å£°æ˜æ‰€æœ‰ä¾èµ–é¡¹</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>è¿™é‡Œçš„ <code>onVisit</code> æ˜¯ä¸€ä¸ª Effect Eventã€‚é‡Œé¢çš„ä»£ç ä¸æ˜¯å“åº”å¼çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ å¯ä»¥ä½¿ç”¨ <code>numberOfItems</code>ï¼ˆæˆ–è€…ä»»æ„å“åº”å¼å€¼ï¼ï¼‰è€Œä¸ç”¨æ‹…å¿ƒå¼•èµ·å‘¨å›´ä»£ç å› ä¸ºå˜åŒ–è€Œé‡æ–°æ‰§è¡Œã€‚<p>å¦ä¸€æ–¹é¢ï¼ŒEffect æœ¬èº«ä»ç„¶æ˜¯å“åº”å¼çš„ã€‚å…¶å†…éƒ¨çš„ä»£ç ä½¿ç”¨äº† <code>url</code> propsï¼Œæ‰€ä»¥æ¯æ¬¡å› ä¸ºä¸åŒçš„ <code>url</code> é‡æ–°æ¸²æŸ“å Effect éƒ½ä¼šé‡æ–°è¿è¡Œã€‚è¿™ä¼šä¾æ¬¡è°ƒç”¨ <code>onVisit</code> è¿™ä¸ª Effect Eventã€‚<p>ç»“æœæ˜¯ä½ ä¼šå› ä¸º <code>url</code> çš„å˜åŒ–å»è°ƒç”¨ <code>logVisit</code>ï¼Œå¹¶ä¸”è¯»å–çš„ä¸€ç›´éƒ½æ˜¯æœ€æ–°çš„ <code>numberOfItems</code>ã€‚ä½†æ˜¯å¦‚æœ <code>numberOfItems</code> è‡ªå·±å˜åŒ–ï¼Œä¸ä¼šå¼•èµ·ä»»ä½•ä»£ç çš„é‡æ–°è¿è¡Œã€‚</p><note><p>ä½ å¯èƒ½æƒ³çŸ¥é“æ˜¯å¦å¯ä»¥æ— å‚æ•°è°ƒç”¨ <code>onVisit()</code> å¹¶ä¸”è¯»å–å†…éƒ¨çš„ <code>url</code>ï¼š<pre class="language-js"><code class="language-js">  <span class="token keyword">const</span> onVisit <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">logVisit</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> numberOfItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">onVisit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™å¯ä»¥èµ·ä½œç”¨ï¼Œä½†æ˜¯æ›´å¥½çš„æ–¹æ³•æ˜¯å°†è¿™ä¸ª <code>url</code> æ˜¾å¼ä¼ é€’ç»™Effect Eventã€‚<strong>é€šè¿‡å°† <code>url</code> ä½œä¸ºå‚æ•°ä¼ ç»™ Effect Eventï¼Œä½ å¯ä»¥è¯´ä»ç”¨æˆ·è§’åº¦æ¥çœ‹ä½¿ç”¨ä¸åŒçš„ <code>url</code> è®¿é—®é¡µé¢æ„æˆäº†ä¸€ä¸ªç‹¬ç«‹çš„â€œäº‹ä»¶â€</strong>ã€‚<code>visitedUrl</code> æ˜¯å‘ç”Ÿçš„â€œäº‹ä»¶â€çš„ä¸€éƒ¨åˆ†ï¼š<pre class="language-js"><code class="language-js">  <span class="token keyword">const</span> onVisit <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token parameter">visitedUrl</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">logVisit</span><span class="token punctuation">(</span>visitedUrl<span class="token punctuation">,</span> numberOfItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">onVisit</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç”±äº Effect æ˜ç¡®â€œè¦æ±‚â€ <code>visitedUrl</code>ï¼Œæ‰€ä»¥ç°åœ¨ä½ ä¸ä¼šä¸å°å¿ƒåœ°ä» Effect çš„ä¾èµ–é¡¹ä¸­ç§»é™¤ <code>url</code>ã€‚å¦‚æœä½ ç§»é™¤äº† <code>url</code> ä¾èµ–é¡¹ï¼ˆå¯¼è‡´ä¸åŒçš„é¡µé¢è®¿é—®è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªï¼‰ï¼Œä»£ç æ£€æŸ¥å·¥å…·ä¼šå‘ä½ æå‡ºè­¦å‘Šã€‚å¦‚æœä½ æƒ³è¦ <code>onVisit</code> èƒ½å¯¹ <code>url</code> çš„å˜åŒ–åšå‡ºå“åº”ï¼Œä¸è¦è¯»å–å†…éƒ¨çš„ <code>url</code>ï¼ˆè¿™é‡Œä¸æ˜¯å“åº”å¼çš„ï¼‰ï¼Œè€Œæ˜¯åº”è¯¥å°†å®ƒ <strong>ä»</strong> Effect ä¸­ä¼ å…¥ã€‚<p>å¦‚æœ Effect å†…éƒ¨æœ‰ä¸€äº›å¼‚æ­¥é€»è¾‘ï¼Œè¿™å°±å˜å¾—éå¸¸é‡è¦äº†ï¼š<pre class="language-js"><code class="language-js">  <span class="token keyword">const</span> onVisit <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token parameter">visitedUrl</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">logVisit</span><span class="token punctuation">(</span>visitedUrl<span class="token punctuation">,</span> numberOfItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">onVisit</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å»¶è¿Ÿè®°å½•è®¿é—®</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åœ¨è¿™é‡Œï¼Œ<code>onVisit</code> å†…çš„ <code>url</code> å¯¹åº” <strong>æœ€æ–°çš„</strong> <code>url</code>ï¼ˆå¯èƒ½å·²ç»å˜åŒ–äº†ï¼‰ï¼Œä½†æ˜¯ <code>visitedUrl</code> å¯¹åº”çš„æ˜¯æœ€å¼€å§‹å¼•èµ·è¿™ä¸ª Effectï¼ˆå¹¶ä¸”æ˜¯æœ¬æ¬¡ <code>onVisit</code> è°ƒç”¨ï¼‰è¿è¡Œçš„ <code>url</code> ã€‚</p></note><deepdive><section class="level4"aria-labelledby="æŠ‘åˆ¶ä¾èµ–é¡¹æ£€æŸ¥æ˜¯å¯è¡Œçš„å—-is-it-okay-to-suppress-the-dependency-linter-instead"><h4 id="æŠ‘åˆ¶ä¾èµ–é¡¹æ£€æŸ¥æ˜¯å¯è¡Œçš„å—-is-it-okay-to-suppress-the-dependency-linter-instead">æŠ‘åˆ¶ä¾èµ–é¡¹æ£€æŸ¥æ˜¯å¯è¡Œçš„å—ï¼Ÿ {/<em>is-it-okay-to-suppress-the-dependency-linter-instead</em>/}</h4><p>åœ¨å·²ç»å­˜åœ¨çš„ä»£ç åº“ä¸­ï¼Œä½ å¯èƒ½æœ‰æ—¶ä¼šçœ‹è§åƒè¿™æ ·çš„æ£€æŸ¥è§„åˆ™æŠ‘åˆ¶ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> items <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ShoppingCartContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> numberOfItems <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">logVisit</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> numberOfItems<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ğŸ”´ é¿å…åƒè¿™æ ·æŠ‘åˆ¶ä»£ç æ£€æŸ¥:</span>
    <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>ç­‰ <code>useEffectEvent</code> æˆä¸º React ç¨³å®šéƒ¨åˆ†åï¼Œæˆ‘ä»¬ä¼šæ¨è <strong>æ°¸è¿œä¸è¦æŠ‘åˆ¶ä»£ç æ£€æŸ¥å·¥å…·</strong>ã€‚<p>æŠ‘åˆ¶è§„åˆ™çš„ç¬¬ä¸€ä¸ªç¼ºç‚¹æ˜¯å½“ Effect éœ€è¦å¯¹ä¸€ä¸ªå·²ç»åœ¨ä»£ç ä¸­å‡ºç°è¿‡çš„æ–°å“åº”å¼ä¾èµ–é¡¹åšå‡ºâ€œå“åº”â€æ—¶ï¼ŒReact ä¸ä¼šå†å‘å‡ºè­¦å‘Šã€‚åœ¨ç¨æ—©ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œä½ å°† <code>url</code> æ·»åŠ ä¸ºä¾èµ–é¡¹ï¼Œ<strong>æ˜¯å› ä¸º</strong> React æé†’ä½ å»åšè¿™ä»¶äº‹ã€‚å¦‚æœç¦ç”¨ä»£ç æ£€æŸ¥ï¼Œä½ æœªæ¥å°†ä¸ä¼šå†æ”¶åˆ°ä»»ä½•å…³äº Effect ä¿®æ”¹çš„æé†’ã€‚è¿™å¼•èµ·äº† bugã€‚<p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªç”±æŠ‘åˆ¶ä»£ç æ£€æŸ¥å¼•èµ·çš„å¥‡æ€ª bugã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>handleMove</code> åº”è¯¥è¯»å–å½“å‰çš„ state å˜é‡ <code>canMove</code> çš„å€¼æ¥å†³å®šè¿™ä¸ªç‚¹æ˜¯å¦åº”è¯¥è·Ÿéšå…‰æ ‡ã€‚ä½†æ˜¯ <code>handleMove</code> ä¸­çš„ <code>canMove</code> ä¸€ç›´æ˜¯ <code>true</code>ã€‚<p>ä½ èƒ½çœ‹å‡ºæ˜¯ä¸ºä»€ä¹ˆå—ï¼Ÿ</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>canMove<span class="token punctuation">,</span> setCanMove<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleMove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>canMove<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientY</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pointermove'</span><span class="token punctuation">,</span> handleMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'pointermove'</span><span class="token punctuation">,</span> handleMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>canMove<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setCanMove</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">The</span> dot is allowed to move
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'pink'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">borderRadius</span><span class="token operator">:</span> <span class="token string">'50%'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">pointerEvents</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>è¿™æ®µä»£ç çš„é—®é¢˜åœ¨äºæŠ‘åˆ¶ä¾èµ–é¡¹æ£€æŸ¥ã€‚å¦‚æœç§»é™¤ï¼Œä½ å¯ä»¥çœ‹åˆ° Effect åº”è¯¥ä¾èµ–äº <code>handleMove</code> å‡½æ•°ã€‚è¿™éå¸¸æœ‰æ„ä¹‰ï¼š<code>handleMove</code> æ˜¯åœ¨ç»„ä»¶å†…å£°æ˜çš„ï¼Œæ˜¯å“åº”å¼å€¼ã€‚è€Œæ¯ä¸ªå“åº”å¼å€¼éƒ½å¿…é¡»è¢«æŒ‡å®šä¸ºä¾èµ–é¡¹ï¼Œå¦åˆ™å®ƒå¯èƒ½ä¼šéšç€æ—¶é—´è€Œè¿‡æ—¶ï¼<p>åŸä»£ç çš„ä½œè€…å¯¹ React â€œæ’’è°â€è¯´ Effect ä¸ä¾èµ–äºä»»ä½•å“åº”å¼å€¼ï¼ˆ<code>[]</code>ï¼‰ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ <code>canMove</code>ï¼ˆä»¥åŠ <code>handleMove</code>ï¼‰å˜åŒ–å React æ²¡æœ‰é‡æ–°åŒæ­¥ã€‚å› ä¸º React æ²¡æœ‰é‡æ–°åŒæ­¥ Effectï¼Œæ‰€ä»¥ä½œä¸ºç›‘å¬å™¨é™„åŠ çš„ <code>handleMove</code> è¿˜æ˜¯åˆæ¬¡æ¸²æŸ“æœŸé—´åˆ›å»ºçš„ <code>handleMove</code> å‡½æ•°ã€‚åˆæ¬¡æ¸²æŸ“æœŸé—´ï¼Œ<code>canMove</code> çš„å€¼æ˜¯ <code>true</code>ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¥è‡ªåˆæ¬¡æ¸²æŸ“çš„ <code>handleMove</code> æ°¸è¿œåªèƒ½çœ‹åˆ°è¿™ä¸ªå€¼ã€‚<p><strong>å¦‚æœä½ ä»æ¥æ²¡æœ‰æŠ‘åˆ¶ä»£ç æ£€æŸ¥ï¼Œå°±æ°¸è¿œä¸ä¼šé‡è§è¿‡æœŸå€¼çš„é—®é¢˜ã€‚</strong><p>æœ‰äº† <code>useEffectEvent</code>ï¼Œå°±ä¸éœ€è¦å¯¹ä»£ç æ£€æŸ¥å·¥å…·â€œè¯´è°â€ï¼Œå¹¶ä¸”ä»£ç ä¹Ÿèƒ½å’Œä½ é¢„æœŸçš„ä¸€æ ·å·¥ä½œï¼š</p><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>canMove<span class="token punctuation">,</span> setCanMove<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> onMove <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>canMove<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientY</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pointermove'</span><span class="token punctuation">,</span> onMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'pointermove'</span><span class="token punctuation">,</span> onMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>canMove<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setCanMove</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">The</span> dot is allowed to move
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'pink'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">borderRadius</span><span class="token operator">:</span> <span class="token string">'50%'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">pointerEvents</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>è¿™ä¸æ„å‘³ç€ <code>useEffectEvent</code> <strong>æ€»æ˜¯</strong> æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆã€‚ä½ åªèƒ½æŠŠå®ƒç”¨åœ¨ä½ ä¸éœ€è¦å˜æˆå“åº”å¼çš„ä»£ç ä¸Šã€‚ä¸Šé¢çš„ sandbox ä¸­ï¼Œä½ ä¸éœ€è¦ Effect çš„ä»£ç å“åº” <code>canMove</code>ã€‚è¿™å°±æ˜¯æå– Effect Event å¾ˆæœ‰æ„ä¹‰çš„åŸå› ã€‚<p>é˜…è¯» <a href="/learn/removing-effect-dependencies">ç§»é™¤ Effect ä¾èµ–é¡¹</a> å¯»æ‰¾æŠ‘åˆ¶ä»£ç æ£€æŸ¥çš„å…¶ä»–æ­£ç¡®çš„æ›¿ä»£æ–¹å¼ã€‚</section></deepdive></section><section class="level3"aria-labelledby="effect-event-çš„å±€é™æ€§-limitations-of-effect-events"><h3 id="effect-event-çš„å±€é™æ€§-limitations-of-effect-events">Effect Event çš„å±€é™æ€§ {/<em>limitations-of-effect-events</em>/}</h3><wip><p>æœ¬ç« èŠ‚æè¿°äº†ä¸€ä¸ªåœ¨ React ç¨³å®šç‰ˆä¸­ <strong>è¿˜æ²¡æœ‰å‘å¸ƒçš„å®éªŒæ€§ API</strong>ã€‚</p></wip><p>Effect Event çš„å±€é™æ€§åœ¨äºä½ å¦‚ä½•ä½¿ç”¨ä»–ä»¬ï¼š<ul><li><strong>åªåœ¨ Effect å†…éƒ¨è°ƒç”¨ä»–ä»¬</strong>ã€‚<li><strong>æ°¸è¿œä¸è¦æŠŠä»–ä»¬ä¼ ç»™å…¶ä»–çš„ç»„ä»¶æˆ–è€… Hook</strong>ã€‚</ul><p>ä¾‹å¦‚ä¸è¦åƒè¿™æ ·å£°æ˜å’Œä¼ é€’ Effect Eventï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Timer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> onTick <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useTimer</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>delay<span class="token punctuation">,</span> callback<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éœ€è¦åœ¨ä¾èµ–é¡¹ä¸­æŒ‡å®šâ€œcallbackâ€</span>
<span class="token punctuation">}</span></code></pre><p>å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œæ°¸è¿œç›´æ¥åœ¨ä½¿ç”¨ä»–ä»¬çš„ Effect æ—è¾¹å£°æ˜ Effect Eventï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Timer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useTimer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useTimer</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onTick <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">onTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… Good: åªåœ¨ Effect å†…éƒ¨å±€éƒ¨è°ƒç”¨</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>delay<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸éœ€è¦æŒ‡å®š â€œonTickâ€ (Effect Event) ä½œä¸ºä¾èµ–é¡¹</span>
<span class="token punctuation">}</span></code></pre><p>Effect Event æ˜¯ Effect ä»£ç çš„éå“åº”å¼â€œç‰‡æ®µâ€ã€‚ä»–ä»¬åº”è¯¥åœ¨ä½¿ç”¨ä»–ä»¬çš„ Effect çš„æ—è¾¹ã€‚</p><recap><ul><li>äº‹ä»¶å¤„ç†å‡½æ•°åœ¨å“åº”ç‰¹å®šäº¤äº’æ—¶è¿è¡Œã€‚<li>Effect åœ¨éœ€è¦åŒæ­¥çš„æ—¶å€™è¿è¡Œã€‚<li>äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨çš„é€»è¾‘æ˜¯éå“åº”å¼çš„ã€‚<li>Effect å†…éƒ¨çš„é€»è¾‘æ˜¯å“åº”å¼çš„ã€‚<li>ä½ å¯ä»¥å°†éå“åº”å¼é€»è¾‘ä» Effect ç§»åˆ° Effect Event ä¸­ã€‚<li>åªåœ¨ Effect å†…éƒ¨è°ƒç”¨ Effect Eventã€‚<li>ä¸è¦å°† Effect Event ä¼ ç»™å…¶ä»–ç»„ä»¶æˆ–è€… Hookã€‚</ul></recap><challenges><section class="level4"aria-labelledby="ä¿®å¤ä¸€ä¸ªä¸æ›´æ–°çš„å˜é‡-fix-a-variable-that-doesnt-update"><h4 id="ä¿®å¤ä¸€ä¸ªä¸æ›´æ–°çš„å˜é‡-fix-a-variable-that-doesnt-update">ä¿®å¤ä¸€ä¸ªä¸æ›´æ–°çš„å˜é‡ {/<em>fix-a-variable-that-doesnt-update</em>/}</h4><p><code>Timer</code> ç»„ä»¶ä¿å­˜äº†ä¸€ä¸ª <code>count</code> çš„ state å˜é‡ï¼Œè¿™ä¸ªå˜é‡æ¯ç§’å¢åŠ ä¸€æ¬¡ã€‚æ¯æ¬¡å¢åŠ çš„å€¼å­˜å‚¨åœ¨ <code>increment</code> state å˜é‡ä¸­ã€‚ä½ å¯ä»¥ä½¿ç”¨åŠ å‡æŒ‰é’®æ§åˆ¶ <code>increment</code> å˜é‡ã€‚<p>ä½†æ˜¯æ— è®ºä½ ç‚¹å‡»åŠ å·æŒ‰é’®å¤šå°‘æ¬¡ï¼Œè®¡æ•°å™¨æ¯ç§’éƒ½åªå¢åŠ  ï¼‘ã€‚è¿™æ®µä»£ç å­˜åœ¨ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿä¸ºä»€ä¹ˆ Effect å†…éƒ¨çš„ <code>increment</code> æ€»æ˜¯ç­‰äº <code>1</code> å‘¢ï¼Ÿæ‰¾å‡ºé”™è¯¯å¹¶ä¿®å¤å®ƒã€‚</p><hint><p>ä¿®å¤è¿™æ®µä»£ç ï¼Œå¿…é¡»è¶³å¤Ÿéµå¾ªè¿™äº›è§„åˆ™ã€‚</p></hint><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Timer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>increment<span class="token punctuation">,</span> setIncrement<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span> c <span class="token operator">+</span> increment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>
        <span class="token literal-property property">Counter</span><span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Reset</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Every</span> second<span class="token punctuation">,</span> increment by<span class="token operator">:</span>
        <span class="token operator">&#x3C;</span>button disabled<span class="token operator">=</span><span class="token punctuation">{</span>increment <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>â€“<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>å’Œå¾€å¸¸ä¸€æ ·ï¼Œå½“ä½ å¯»æ‰¾ Effect ä¸­çš„ bug æ—¶ï¼Œä»å¯»æ‰¾ä»£ç æ£€æŸ¥æŠ‘åˆ¶å¼€å§‹ã€‚<p>å¦‚æœä½ ç§»é™¤äº†æŠ‘åˆ¶æ³¨é‡Šï¼ŒReact å°±ä¼šå‘Šè¯‰ä½ è¿™ä¸ª Effect çš„ä»£ç ä¾èµ–äº <code>increment</code>ï¼Œä½†æ˜¯ä½ é€šè¿‡å®£ç§°è¿™ä¸ª Effect ä¸ä¾èµ–äºå“åº”å¼å€¼ï¼ˆ<code>[]</code>ï¼‰â€œæ¬ºéª—â€äº† Reactã€‚å°† <code>increment</code> æ·»åŠ åˆ°ä¾èµ–é¡¹æ•°ç»„ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Timer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>increment<span class="token punctuation">,</span> setIncrement<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span> c <span class="token operator">+</span> increment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>increment<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>
        <span class="token literal-property property">Counter</span><span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Reset</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Every</span> second<span class="token punctuation">,</span> increment by<span class="token operator">:</span>
        <span class="token operator">&#x3C;</span>button disabled<span class="token operator">=</span><span class="token punctuation">{</span>increment <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>â€“<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>ç°åœ¨å½“ <code>increment</code> å˜åŒ–æ—¶ï¼ŒReact ä¼šé‡æ–°åŒæ­¥ä½ çš„ Effectï¼Œè¿™ä¼šé‡å¯ intervalã€‚</p></solution></section><section class="level4"aria-labelledby="ä¿®å¤ä¸€ä¸ªå†»ç»“çš„è®¡æ•°å™¨-fix-a-freezing-counter"><h4 id="ä¿®å¤ä¸€ä¸ªå†»ç»“çš„è®¡æ•°å™¨-fix-a-freezing-counter">ä¿®å¤ä¸€ä¸ªå†»ç»“çš„è®¡æ•°å™¨ {/<em>fix-a-freezing-counter</em>/}</h4><p><code>Timer</code> ç»„ä»¶ä¿å­˜äº†ä¸€ä¸ª <code>count</code> çš„ state å˜é‡ï¼Œè¿™ä¸ªå˜é‡æ¯ç§’å¢åŠ ä¸€æ¬¡ã€‚æ¯æ¬¡å¢åŠ çš„å€¼å­˜å‚¨åœ¨ <code>increment</code> state å˜é‡ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨åŠ å‡æŒ‰é’®æ§åˆ¶å®ƒã€‚ä¾‹å¦‚ï¼Œå°è¯•ç‚¹å‡»åŠ å·æŒ‰é’®ä¹æ¬¡ï¼Œæ³¨æ„ç°åœ¨ <code>count</code> æ¯æ¬¡éƒ½å¢åŠ  10 è€Œä¸æ˜¯ 1ã€‚<p>è¿™ä¸ªç”¨æˆ·æ¥å£æœ‰ä¸€ä¸ªå°é—®é¢˜ã€‚ä½ å¯èƒ½æ³¨æ„åˆ°å¦‚æœä½ æ¯ç§’å†…æŒ‰å‹åŠ å‡æŒ‰é’®ä¸æ­¢ä¸€æ¬¡ï¼Œ é‚£è®¡æ—¶å™¨æœ¬èº«ä¼¼ä¹å°±ä¼šæš‚åœã€‚å®ƒåªåœ¨ä½ æœ€åä¸€æ¬¡æŒ‰å‹æŒ‰é’®çš„ä¸€ç§’åæ¢å¤ã€‚æ‰¾å‡ºä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§ç°è±¡ï¼Œå¹¶ä¿®å¤å®ƒä»¥ä¾¿è®¡æ—¶å™¨èƒ½ <strong>æ¯</strong> ç§’æ»´ç­”ä½œå“è€Œä¸ä¸­æ–­ã€‚</p><hint><p>ä¼¼ä¹è®¾ç½®è®¡æ—¶å™¨çš„ Effect å¯¹ <code>increment</code> å€¼çš„å˜åŒ–åšå‡ºäº†â€œå“åº”â€ã€‚ä¸ºäº†è°ƒç”¨ <code>setCount</code> è€Œä½¿ç”¨å½“å‰ <code>increment</code> å€¼çš„ä»£ç è¡ŒçœŸçš„éœ€è¦æ˜¯å“åº”å¼å—ï¼Ÿ</p></hint><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Timer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>increment<span class="token punctuation">,</span> setIncrement<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span> c <span class="token operator">+</span> increment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>increment<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>
        <span class="token literal-property property">Counter</span><span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Reset</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Every</span> second<span class="token punctuation">,</span> increment by<span class="token operator">:</span>
        <span class="token operator">&#x3C;</span>button disabled<span class="token operator">=</span><span class="token punctuation">{</span>increment <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>â€“<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>é—®é¢˜åœ¨äº Effect å†…éƒ¨çš„ä»£ç ä½¿ç”¨äº† <code>increment</code> è¿™ä¸ª state å˜é‡ã€‚å› ä¸ºå®ƒæ˜¯ Effect çš„ä¸€ä¸ªä¾èµ–é¡¹ï¼Œæ¯æ¬¡ <code>increment</code> å˜åŒ–éƒ½ä¼šå¼•èµ· Effect é‡æ–°åŒæ­¥ï¼Œè¿™å¼•èµ·äº† interval æ¸…ç†ã€‚å¦‚æœä½ æ¯æ¬¡æœ‰æœºä¼šè§¦å‘ä¹‹å‰å°±æ¸…ç† intervalï¼Œå®ƒä¼šè¡¨ç°å¾—å¥½åƒè®¡æ—¶å™¨å·²ç»åœæ­¢äº†ã€‚<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ä» Effect ä¸­æå–ä¸€ä¸ª Effect Event <code>onTick</code>ï¼š</p><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Timer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>increment<span class="token punctuation">,</span> setIncrement<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> onTick <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span> c <span class="token operator">+</span> increment<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">onTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>
        <span class="token literal-property property">Counter</span><span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Reset</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Every</span> second<span class="token punctuation">,</span> increment by<span class="token operator">:</span>
        <span class="token operator">&#x3C;</span>button disabled<span class="token operator">=</span><span class="token punctuation">{</span>increment <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>â€“<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>ç”±äº <code>onTick</code> æ˜¯ä¸€ä¸ª Effect Eventï¼Œæ‰€ä»¥å†…éƒ¨çš„ä»£ç æ˜¯éå“åº”å¼çš„ã€‚<code>increment</code> çš„å˜åŒ–ä¸ä¼šè§¦å‘ä»»ä½• Effectã€‚</p></solution></section><section class="level4"aria-labelledby="ä¿®å¤ä¸å¯è°ƒæ•´çš„å»¶è¿Ÿ-fix-a-non-adjustable-delay"><h4 id="ä¿®å¤ä¸å¯è°ƒæ•´çš„å»¶è¿Ÿ-fix-a-non-adjustable-delay">ä¿®å¤ä¸å¯è°ƒæ•´çš„å»¶è¿Ÿ {/<em>fix-a-non-adjustable-delay</em>/}</h4><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰ interval å»¶è¿Ÿã€‚å®ƒè¢«å‚¨å­˜åœ¨ä¸€ä¸ªç”±ä¸¤ä¸ªæŒ‰é’®æ›´æ–°çš„ <code>delay</code> state å˜é‡ä¸­ã€‚ä½†ä½ å³ä½¿æŒ‰äº†â€œåŠ  100 msâ€æŒ‰é’®åˆ° <code>delay</code> ä¸º 1000 æ¯«ç§’ï¼ˆå³ 1 ç§’ï¼‰ï¼Œå¯ä»¥æ³¨æ„åˆ°è®¡æ—¶å™¨ä»ç„¶åœ¨å¿«é€Ÿå¢åŠ ï¼ˆæ¯ 100 msï¼‰ã€‚ä½ å¯¹ <code>delay</code> çš„ä¿®æ”¹å¥½åƒè¢«å¿½ç•¥äº†ã€‚æ‰¾åˆ°å¹¶ä¿®å¤è¿™ä¸ª bugã€‚</p><hint><p>Effect Event å†…éƒ¨çš„ä»£ç æ˜¯éå“åº”å¼çš„ã€‚å“ªäº›æƒ…å†µä¸‹ä½ ä¼š <strong>æƒ³è¦</strong> <code>setInterval</code> è°ƒç”¨é‡æ–°è¿è¡Œå‘¢ï¼Ÿ</p></hint><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Timer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>increment<span class="token punctuation">,</span> setIncrement<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>delay<span class="token punctuation">,</span> setDelay<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> onTick <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span> c <span class="token operator">+</span> increment<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> onMount <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">onTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">onMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>
        <span class="token literal-property property">Counter</span><span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Reset</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Increment</span> by<span class="token operator">:</span>
        <span class="token operator">&#x3C;</span>button disabled<span class="token operator">=</span><span class="token punctuation">{</span>increment <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>â€“<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Increment</span> delay<span class="token operator">:</span>
        <span class="token operator">&#x3C;</span>button disabled<span class="token operator">=</span><span class="token punctuation">{</span>delay <span class="token operator">===</span> <span class="token number">100</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setDelay</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token arrow operator">=></span> d <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>â€“<span class="token number">100</span> ms<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>delay<span class="token punctuation">}</span> ms<span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setDelay</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token arrow operator">=></span> d <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">100</span> ms<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>ä¸Šé¢è¿™ä¸ªç¤ºä¾‹çš„é—®é¢˜åœ¨äºå®ƒæ²¡æœ‰è€ƒè™‘ä»£ç å®é™…æ­£åœ¨åšä»€ä¹ˆå°±ç›´æ¥æå–äº†ä¸€ä¸ªå«åš <code>onMount</code> çš„ Effect Eventã€‚ä½ åº”è¯¥åªä¸ºç‰¹å®šçš„åŸå› æå– Effect Eventï¼šä½ æƒ³è®©ä»£ç çš„ä¸€éƒ¨åˆ†ç§°ä¸ºéå“åº”å¼ã€‚ä½†æ˜¯ï¼Œ<code>setInterval</code> è°ƒç”¨ state å˜é‡ <code>delay</code> çš„å˜åŒ– <strong>åº”è¯¥</strong> æ˜¯å“åº”å¼çš„ã€‚å¦‚æœ <code>delay</code> å˜åŒ–äº†ï¼Œä½ æƒ³è¦é‡æ–°è®¾ç½® intervalï¼ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦å°†æ‰€æœ‰çš„å“åº”å¼ä»£ç æ”¾å›åˆ° Effect å†…éƒ¨ï¼š</p><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Timer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>increment<span class="token punctuation">,</span> setIncrement<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>delay<span class="token punctuation">,</span> setDelay<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> onTick <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span> c <span class="token operator">+</span> increment<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">onTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>delay<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>
        <span class="token literal-property property">Counter</span><span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Reset</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Increment</span> by<span class="token operator">:</span>
        <span class="token operator">&#x3C;</span>button disabled<span class="token operator">=</span><span class="token punctuation">{</span>increment <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>â€“<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        <span class="token maybe-class-name">Increment</span> delay<span class="token operator">:</span>
        <span class="token operator">&#x3C;</span>button disabled<span class="token operator">=</span><span class="token punctuation">{</span>delay <span class="token operator">===</span> <span class="token number">100</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setDelay</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token arrow operator">=></span> d <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>â€“<span class="token number">100</span> ms<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>delay<span class="token punctuation">}</span> ms<span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setDelay</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token arrow operator">=></span> d <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">100</span> ms<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>æ€»çš„æ¥è¯´ï¼Œä½ åº”è¯¥å¯¹åƒ <code>onMount</code> è¿™æ ·ä¸»è¦å…³æ³¨ <strong>æ‰§è¡Œæ—¶æœº</strong> è€Œé <strong>ç›®çš„</strong> çš„å‡½æ•°æŒæœ‰æ€€ç–‘æ€åº¦ã€‚å¼€å§‹å¯èƒ½ä¼šæ„Ÿè§‰â€œæ›´å…·æè¿°æ€§â€ï¼Œä½†æ˜¯å¯èƒ½ä¼šæ¨¡ç³Šä½ çš„æ„å›¾ã€‚æ ¹æ®ç»éªŒæ¥è¯´ï¼ŒEffect Event åº”è¯¥å¯¹åº”ä»â€œç”¨æˆ·çš„â€è§’åº¦å‘ç”Ÿçš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œ<code>onMessage</code>ï¼Œ<code>onTick</code>ï¼Œ<code>onVisit</code> æˆ–è€… <code>onConnected</code> æ˜¯ä¼˜ç§€çš„ Effect Event åç§°ã€‚å®ƒä»¬å†…éƒ¨çš„ä»£ç å¯èƒ½ä¸éœ€è¦æ˜¯å“åº”å¼çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œ<code>onMount</code>ï¼Œ<code>onUpdate</code>ï¼Œ<code>onUnmount</code> æˆ–è€… <code>onAfterRender</code> å¤ªé€šç”¨äº†ï¼Œä»¥è‡³äºå¾ˆå®¹æ˜“ä¸å°å¿ƒå°±æŠŠä¸€äº›"åº”è¯¥"æ˜¯å“åº”å¼çš„ä»£ç æ”¾å…¥å…¶ä¸­ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ åº”è¯¥ç”¨ <strong>ç”¨æˆ·æƒ³è¦ä»€ä¹ˆå‘ç”Ÿ</strong> æ¥ç»™ä½ çš„ Effect Event å‘½åï¼Œè€Œä¸æ˜¯ç”¨æŸäº›ä»£ç æ­£å¥½è¿è¡Œçš„æ—¶æœºå‘½åã€‚</p></solution></section><section class="level4"aria-labelledby="ä¿®å¤å»¶è¿Ÿé€šçŸ¥-fix-a-delayed-notification"><h4 id="ä¿®å¤å»¶è¿Ÿé€šçŸ¥-fix-a-delayed-notification">ä¿®å¤å»¶è¿Ÿé€šçŸ¥ {/<em>fix-a-delayed-notification</em>/}</h4><p>å½“ä½ åŠ å…¥ä¸€ä¸ªèŠå¤©å®¤æ—¶ï¼Œè¿™ä¸ªç»„ä»¶å±•ç¤ºä¸€ä¸ªé€šçŸ¥ã€‚ä½†æ˜¯å®ƒä¸ä¼šç«‹åˆ»å±•ç¤ºé€šçŸ¥ã€‚ç›¸åï¼ŒæŠŠé€šçŸ¥äººå·¥å»¶è¿Ÿ 2 ç§’é’Ÿï¼Œä»¥ä¾¿ç”¨æˆ·æœ‰æœºä¼šæŸ¥çœ‹ UIã€‚<p>è¿™å‡ ä¹ç”Ÿæ•ˆäº†ï¼Œä½†è¿˜æ˜¯æœ‰ä¸€ä¸ª bugã€‚å°è¯•å°†ä¸‹æ‹‰èœå•ä»â€œgeneralâ€å˜æˆâ€œtravelâ€å¹¶ä¸”æ¥ä¸‹æ¥éå¸¸å¿«é€Ÿçš„å˜æˆâ€œmusicâ€ã€‚å¦‚æœä½ åŠ¨ä½œè¶³å¤Ÿå¿«ï¼Œä½ ä¼šçœ‹åˆ°ä¸¤ä¸ªé€šçŸ¥ï¼ˆå’Œé¢„æœŸä¸€æ ·ï¼ï¼‰ï¼Œä½†æ˜¯ä»–ä»¬ <strong>éƒ½æ˜¯</strong> å±•ç¤º â€œWelcome to musicâ€ã€‚<p>ä¿®å¤å®ƒï¼Œè®©å®ƒèƒ½åœ¨ä½ å¿«é€Ÿä»â€œgeneralâ€åˆ‡æ¢åˆ°â€œtravelâ€å†åˆ°â€œmusicâ€çš„æ—¶å€™çœ‹è§ä¸¤ä¸ªé€šçŸ¥ï¼Œç¬¬ä¸€ä¸ªæ˜¯â€œWelcome to travelâ€ ï¼Œç¬¬äºŒä¸ªæ˜¯â€œWelcome to musicâ€ï¼ˆæœ‰ä¸€ä¸ªé¢å¤–çš„æŒ‘æˆ˜ï¼Œå‡è®¾ä½  <strong>å·²ç»</strong> è®©é€šçŸ¥æ˜¾ç¤ºäº†æ­£ç¡®çš„æˆ¿é—´ï¼Œè¯·ä¿®æ”¹ä»£ç åªå±•ç¤ºåé¢çš„é€šçŸ¥ï¼‰ã€‚</p><hint><p>ä½ çš„ Effect çŸ¥é“å®ƒè¿æ¥çš„æ˜¯å“ªä¸€ä¸ªæˆ¿é—´ã€‚æœ‰ä»»ä½•ä½ å¯èƒ½æƒ³è¦ä¼ ç»™ Effect Event çš„ä¿¡æ¯å—ï¼Ÿ</p></hint><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"toastify-js"</span><span class="token operator">:</span> <span class="token string">"1.12.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection<span class="token punctuation">,</span> sendMessage <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> showNotification <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./notifications.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onConnected <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Welcome to '</span> <span class="token operator">+</span> roomId<span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onConnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Welcome</span> to the <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> room<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'general'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isDark<span class="token punctuation">,</span> setIsDark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">Choose</span> the chat room<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>general<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>travel<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>music<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isDark<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setIsDark</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">Use</span> dark theme
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
        roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
        theme<span class="token operator">=</span><span class="token punctuation">{</span>isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword">let</span> connectedCallback<span class="token punctuation">;</span>
  <span class="token keyword">let</span> timeout<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Cannot add the handler twice.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>event <span class="token operator">!==</span> <span class="token string">'connected'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Only "connected" event is supported.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      connectedCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Toastify</span></span> <span class="token keyword module">from</span> <span class="token string">'toastify-js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'toastify-js/src/toastify.css'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> theme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function"><span class="token maybe-class-name">Toastify</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">gravity</span><span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'right'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">background</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'black'</span> <span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'white'</span> <span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">showToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>åœ¨ Effect Event å†…éƒ¨ï¼Œ<code>roomId</code> æ˜¯ <strong>Effect Event è¢«è°ƒç”¨æ—¶åˆ»</strong> çš„å€¼ã€‚<p>Effect Event ä¼´éšç€ä¸¤ç§’çš„å»¶è¿Ÿè¢«è°ƒç”¨ã€‚å¦‚æœä½ å¿«é€Ÿåœ°ä» travel åˆ‡æ¢åˆ° music èŠå¤©å®¤ï¼Œç›´åˆ° travel èŠå¤©å®¤çš„é€šçŸ¥æ˜¾ç¤ºå‡ºæ¥ï¼Œ<code>roomId</code> å·²ç»æ˜¯ <code>â€œmusicâ€</code> äº†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸¤ä¸ªé€šçŸ¥éƒ½æ˜¯ â€œWelcome to musicâ€ã€‚<p>ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œä¸è¦åœ¨ Effect Event é‡Œé¢è¯»å– <strong>æœ€æ–°çš„</strong> <code>roomId</code>ï¼Œè€Œæ˜¯å¦‚åŒä¸‹é¢çš„ <code>connectedRoomId</code> ä¸€æ ·è®©å®ƒæˆä¸º Effect Event çš„å‚æ•°ã€‚ç„¶åé€šè¿‡è°ƒç”¨ <code>onConnected(roomId)</code> å°† <code>roomId</code> ä» Effect ä¸­ä¼ å…¥ï¼š</p><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"toastify-js"</span><span class="token operator">:</span> <span class="token string">"1.12.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection<span class="token punctuation">,</span> sendMessage <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> showNotification <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./notifications.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onConnected <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token parameter">connectedRoomId</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Welcome to '</span> <span class="token operator">+</span> connectedRoomId<span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onConnected</span><span class="token punctuation">(</span>roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Welcome</span> to the <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> room<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'general'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isDark<span class="token punctuation">,</span> setIsDark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">Choose</span> the chat room<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>general<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>travel<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>music<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isDark<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setIsDark</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">Use</span> dark theme
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
        roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
        theme<span class="token operator">=</span><span class="token punctuation">{</span>isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword">let</span> connectedCallback<span class="token punctuation">;</span>
  <span class="token keyword">let</span> timeout<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Cannot add the handler twice.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>event <span class="token operator">!==</span> <span class="token string">'connected'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Only "connected" event is supported.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      connectedCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Toastify</span></span> <span class="token keyword module">from</span> <span class="token string">'toastify-js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'toastify-js/src/toastify.css'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> theme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function"><span class="token maybe-class-name">Toastify</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">gravity</span><span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'right'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">background</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'black'</span> <span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'white'</span> <span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">showToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>å°† <code>roomId</code> è®¾ç½®ä¸º <code>â€œtravelâ€</code>ï¼ˆæ‰€ä»¥å®ƒè¿æ¥åˆ°äº† <code>â€œtravelâ€</code> èŠå¤©å®¤ï¼‰çš„ Effect å°†ä¼šå±•ç¤º <code>â€œtravelâ€</code> çš„é€šçŸ¥ã€‚å°† <code>roomId</code> è®¾ç½®ä¸º <code>â€œmusicâ€</code>ï¼ˆæ‰€ä»¥å®ƒè¿æ¥åˆ°äº† <code>â€œmusicâ€</code> èŠå¤©å®¤ï¼‰çš„ Effect å°†ä¼šå±•ç¤º <code>"music"</code> çš„é€šçŸ¥ã€‚æ¢è¨€ä¹‹ï¼Œ<code>connectedRoomId</code> æ¥è‡ª Effectï¼ˆæ˜¯å“åº”å¼çš„ï¼‰ï¼Œè€Œ <code>theme</code> æ€»æ˜¯ä½¿ç”¨æœ€æ–°å€¼ã€‚<p>ä¸ºäº†è§£å†³é¢å¤–çš„æŒ‘æˆ˜ï¼Œä¿å­˜é€šçŸ¥çš„ timeout IDï¼Œå¹¶åœ¨ Effect çš„æ¸…ç†å‡½æ•°ä¸­è¿›è¡Œæ¸…ç†ï¼š</p><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"toastify-js"</span><span class="token operator">:</span> <span class="token string">"1.12.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection<span class="token punctuation">,</span> sendMessage <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> showNotification <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./notifications.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onConnected <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token parameter">connectedRoomId</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Welcome to '</span> <span class="token operator">+</span> connectedRoomId<span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> notificationTimeoutId<span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      notificationTimeoutId <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">onConnected</span><span class="token punctuation">(</span>roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>notificationTimeoutId <span class="token operator">!==</span> <span class="token keyword nil">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>notificationTimeoutId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Welcome</span> to the <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> room<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'general'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isDark<span class="token punctuation">,</span> setIsDark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token maybe-class-name">Choose</span> the chat room<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>general<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>travel<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>music<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isDark<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setIsDark</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">Use</span> dark theme
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
        roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
        theme<span class="token operator">=</span><span class="token punctuation">{</span>isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword">let</span> connectedCallback<span class="token punctuation">;</span>
  <span class="token keyword">let</span> timeout<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Cannot add the handler twice.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>event <span class="token operator">!==</span> <span class="token string">'connected'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Only "connected" event is supported.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      connectedCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Toastify</span></span> <span class="token keyword module">from</span> <span class="token string">'toastify-js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'toastify-js/src/toastify.css'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> theme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function"><span class="token maybe-class-name">Toastify</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">gravity</span><span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'right'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">background</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'black'</span> <span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'white'</span> <span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">showToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>è¿™ç¡®ä¿äº†å½“ä½ ä¿®æ”¹èŠå¤©å®¤æ—¶ï¼Œå·²ç»å®‰æ’å¥½ï¼ˆä½†è¿˜æ²¡å±•ç¤ºï¼‰çš„é€šçŸ¥ä¼šè¢«å–æ¶ˆã€‚</p></solution><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></challenges></section></section></section>