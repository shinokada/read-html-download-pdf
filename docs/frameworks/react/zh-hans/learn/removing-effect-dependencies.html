<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>'ç§»é™¤ Effect ä¾èµ–'</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="ç§»é™¤-effect-ä¾èµ–"><h1 id="ç§»é™¤-effect-ä¾èµ–">'ç§»é™¤ Effect ä¾èµ–'</h1><intro><p>å½“ç¼–å†™ Effect æ—¶ï¼Œlinter ä¼šéªŒè¯æ˜¯å¦å·²ç»å°† Effect è¯»å–çš„æ¯ä¸€ä¸ªå“åº”å¼å€¼ï¼ˆå¦‚ props å’Œ stateï¼‰åŒ…å«åœ¨ Effect çš„ä¾èµ–ä¸­ã€‚è¿™å¯ä»¥ç¡®ä¿ Effect ä¸ç»„ä»¶çš„ props å’Œ state ä¿æŒåŒæ­¥ã€‚ä¸å¿…è¦çš„ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´ Effect è¿è¡Œè¿‡äºé¢‘ç¹ï¼Œç”šè‡³äº§ç”Ÿæ— é™å¾ªç¯ã€‚è¯·æŒ‰ç…§æœ¬æŒ‡å—å®¡æŸ¥å¹¶ç§»é™¤ Effect ä¸­ä¸å¿…è¦çš„ä¾èµ–ã€‚</p></intro><youwilllearn><ul><li>ä¿®å¤æ— é™çš„ Effect ä¾èµ–æ€§å¾ªç¯<li>å½“ä½ æƒ³ç§»é™¤ä¾èµ–æ—¶ï¼Œè¯¥æ€ä¹ˆåš<li>ä» Effect ä¸­è¯»å–å€¼è€Œä¸å¯¹å®ƒä½œå‡ºâ€œååº”â€<li>ä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•é¿å…å¯¹è±¡å’Œå‡½æ•°çš„ä¾èµ–ï¼Ÿ<li>ä¸ºä»€ä¹ˆæŠ‘åˆ¶ä¾èµ–ä»£ç æ£€æŸ¥å™¨çš„æ£€æŸ¥æ˜¯å±é™©çš„ï¼Œä»¥åŠåº”è¯¥å¦‚ä½•åšï¼Ÿ</ul></youwilllearn><section class="level2"aria-labelledby="ä¾èµ–åº”è¯¥å’Œä»£ç ä¿æŒä¸€è‡´-dependencies-should-match-the-code"><h2 id="ä¾èµ–åº”è¯¥å’Œä»£ç ä¿æŒä¸€è‡´-dependencies-should-match-the-code">ä¾èµ–åº”è¯¥å’Œä»£ç ä¿æŒä¸€è‡´ {/<em>dependencies-should-match-the-code</em>/}</h2><p>å½“ä½ ç¼–å†™ Effect æ—¶ï¼Œæ— è®ºè¿™ä¸ª Effect è¦åšä»€ä¹ˆï¼Œä½ é¦–å…ˆè¦æ˜ç¡®å…¶ <a href="/learn/lifecycle-of-reactive-effects#the-lifecycle-of-an-effect">ç”Ÿå‘½å‘¨æœŸ</a>ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  	<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>å¦‚æœä½ è®¾ç½® Effect çš„ä¾èµ–æ˜¯ç©ºæ•°ç»„ï¼ˆ<code>[]</code>ï¼‰ï¼Œé‚£ä¹ˆ linter å°†ä¼šå»ºè®®åˆé€‚çš„ä¾èµ–ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x3C;-- ä¿®å¤è¿™é‡Œçš„ä¾èµ–ï¼</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ‰€æœ‰"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ—…æ¸¸"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"éŸ³ä¹"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ°â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>æŒ‰ç…§ linter çš„å»ºè®®ï¼ŒæŠŠå®ƒä»¬å¡«è¿›å»ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><a href="/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values">Effect â€œååº”â€å“åº”å¼å€¼</a> å› ä¸ºè¿™é‡Œçš„ <code>roomId</code> æ˜¯ä¸€ä¸ªå“åº”å¼å€¼ï¼ˆå®ƒå¯èƒ½éšé‡æ–°æ¸²æŸ“è€Œæ”¹å˜ï¼‰ï¼Œæ‰€ä»¥ linter ä¼šéªŒè¯ä½ æ˜¯å¦å°†å®ƒæŒ‡å®šä¸ºä¾èµ–ã€‚å¦‚æœ <code>roomId</code> å˜æˆä¸åŒçš„å€¼ï¼ŒReact å°†é‡æ–°è¿è¡Œ Effectã€‚è¿™å¯ä»¥ç¡®ä¿èŠå¤©ç•Œé¢ä¸æ‰€é€‰æˆ¿é—´ä¿æŒä¸€è‡´ï¼Œå¹¶æŠŠå˜åŒ–â€œåé¦ˆâ€ç»™ä¸‹æ‹‰èœå•ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ‰€æœ‰"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ—…æ¸¸"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"éŸ³ä¹"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ°â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><section class="level3"aria-labelledby="å½“è¦ç§»é™¤ä¸€ä¸ªä¾èµ–æ—¶è¯·è¯æ˜å®ƒä¸æ˜¯ä¸€ä¸ªä¾èµ–-to-remove-a-dependency-prove-that-its-not-a-dependency"><h3 id="å½“è¦ç§»é™¤ä¸€ä¸ªä¾èµ–æ—¶è¯·è¯æ˜å®ƒä¸æ˜¯ä¸€ä¸ªä¾èµ–-to-remove-a-dependency-prove-that-its-not-a-dependency">å½“è¦ç§»é™¤ä¸€ä¸ªä¾èµ–æ—¶ï¼Œè¯·è¯æ˜å®ƒä¸æ˜¯ä¸€ä¸ªä¾èµ– {/<em>to-remove-a-dependency-prove-that-its-not-a-dependency</em>/}</h3><p>æ³¨æ„ï¼Œä½ ä¸èƒ½â€œé€‰æ‹©â€ Effect çš„ä¾èµ–ã€‚æ¯ä¸ªè¢« Effect æ‰€ä½¿ç”¨çš„<codestep step="{2}">å“åº”å¼å€¼</codestep>ï¼Œå¿…é¡»åœ¨ä¾èµ–ä¸­å£°æ˜ã€‚ä¾èµ–æ˜¯ç”± Effect çš„ä»£ç å†³å®šçš„ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è¿™æ˜¯ä¸€ä¸ªå“åº”å¼å€¼</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Effect åœ¨è¿™é‡Œè¯»å–å“åº”å¼å€¼</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€ä»¥ä½ å¿…é¡»åœ¨ä¾èµ–ä¸­å£°æ˜ Effect ä½¿ç”¨çš„å“åº”å¼å€¼</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><a href="/learn/lifecycle-of-reactive-effects#all-variables-declared-in-the-component-body-are-reactive">å“åº”å¼å€¼</a> åŒ…æ‹¬ props ä»¥åŠæ‰€æœ‰ä½ ç›´æ¥åœ¨ç»„ä»¶ä¸­å£°æ˜çš„å˜é‡å’Œå‡½æ•°ã€‚ç”±äº <code>roomId</code> æ˜¯å“åº”å¼å€¼ï¼Œä½ ä¸èƒ½æŠŠå®ƒä»ä¾èµ–ä¸­ç§»é™¤ã€‚linter ä¸å…è®¸è¿™æ ·åšï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ”´ React Hook useEffect ç¼ºå¤±ä¾èµ–: 'roomId'</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>linter æ˜¯å¯¹çš„ï¼ ç”±äº <code>roomId</code> å¯èƒ½ä¼šéšæ—¶é—´å˜åŒ–ï¼Œè¿™ä¼šåœ¨ä»£ç ä¸­å¼•å…¥é”™è¯¯ã€‚<p><strong>ç§»é™¤ä¸€ä¸ªä¾èµ–ï¼Œä½ éœ€è¦å‘ linter è¯æ˜å…¶ä¸éœ€è¦è¿™ä¸ªä¾èµ–</strong>ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°† <code>roomId</code> ç§»å‡ºç»„ä»¶ï¼Œä»¥è¯æ˜å®ƒä¸æ˜¯å“åº”çš„ï¼Œä¹Ÿä¸ä¼šåœ¨é‡æ–°æ¸²æŸ“æ—¶æ”¹å˜ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> roomId <span class="token operator">=</span> <span class="token string">'éŸ³ä¹'</span><span class="token punctuation">;</span> <span class="token comment">// ä¸å†æ˜¯å“åº”å¼å€¼</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>ç°åœ¨ <code>roomId</code> ä¸æ˜¯å“åº”å¼å€¼ï¼ˆå¹¶ä¸”ä¸èƒ½åœ¨é‡æ–°æ¸²æŸ“æ—¶æ”¹å˜ï¼‰ï¼Œé‚£å®ƒä¸å°±ä¸æ˜¯ä¾èµ–ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> roomId <span class="token operator">=</span> <span class="token string">'éŸ³ä¹'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ°â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ç°åœ¨å¯ä»¥æŒ‡å®š <a href="/learn/lifecycle-of-reactive-effects#what-an-effect-with-empty-dependencies-means">ç©ºï¼ˆ<code>[]</code>ï¼‰ä¾èµ–</a>ã€‚Effect <strong>çœŸçš„ä¸</strong> ä¾èµ–ä»»ä½•å“åº”å¼å€¼äº†ï¼Œä¹Ÿ <strong>çœŸçš„ä¸</strong> éœ€è¦åœ¨ç»„ä»¶çš„ props æˆ– state æ”¹å˜æ—¶é‡æ–°è¿è¡Œã€‚</section><section class="level3"aria-labelledby="è¦æ”¹å˜ä¾èµ–è¯·æ”¹å˜ä»£ç -to-change-the-dependencies-change-the-code"><h3 id="è¦æ”¹å˜ä¾èµ–è¯·æ”¹å˜ä»£ç -to-change-the-dependencies-change-the-code">è¦æ”¹å˜ä¾èµ–ï¼Œè¯·æ”¹å˜ä»£ç  {/<em>to-change-the-dependencies-change-the-code</em>/}</h3><p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°å·¥ä½œæµç¨‹ä¸­æœ‰ä¸€ä¸ªæ¨¡å¼ï¼š<ol><li>é¦–å…ˆï¼Œä½  <strong>æ”¹å˜ Effect çš„ä»£ç </strong> æˆ–å“åº”å¼å€¼çš„å£°æ˜æ–¹å¼ã€‚<li>ç„¶åï¼Œä½ é‡‡çº³ linter çš„å»ºè®®ï¼Œè°ƒæ•´ä¾èµ–ï¼Œä»¥ <strong>åŒ¹é…ä½ æ‰€æ”¹å˜çš„ä»£ç </strong>ã€‚<li>å¦‚æœä½ å¯¹ä¾èµ–ä¸æ»¡æ„ï¼Œä½ å¯ä»¥ <strong>å›åˆ°ç¬¬ä¸€æ­¥</strong>ï¼ˆå¹¶å†æ¬¡ä¿®æ”¹ä»£ç ï¼‰ã€‚</ol><p>æœ€åä¸€éƒ¨åˆ†å¾ˆé‡è¦ã€‚<strong>å¦‚æœä½ æƒ³æ”¹å˜ä¾èµ–ï¼Œé¦–å…ˆè¦æ”¹å˜æ‰€æ¶‰åŠåˆ°çš„ä»£ç </strong>ã€‚ä½ å¯ä»¥æŠŠä¾èµ–çœ‹ä½œæ˜¯ <a href="/learn/lifecycle-of-reactive-effects#react-verifies-that-you-specified-every-reactive-value-as-a-dependency">Effectçš„ä»£ç æ‰€ä¾èµ–çš„æ‰€æœ‰å“åº”å¼å€¼çš„åˆ—è¡¨</a>ã€‚ä½ ä¸è¦ <strong>é€‰æ‹©</strong> æŠŠä»€ä¹ˆæ”¾åœ¨è¿™ä¸ªåˆ—è¡¨ä¸Šã€‚è¯¥åˆ—è¡¨ <strong>æè¿°äº†</strong> ä»£ç ã€‚è¦æ”¹å˜ä¾èµ–ï¼Œè¯·æ”¹å˜ä»£ç ã€‚<p>è¿™å¯èƒ½æ„Ÿè§‰å°±åƒè§£æ–¹ç¨‹ä¸€æ ·ã€‚ä½ æœ‰ä¸€ä¸ªç›®æ ‡ï¼ˆä¾‹å¦‚ï¼Œç§»é™¤ä¸€ä¸ªä¾èµ–ï¼‰ï¼Œä½ éœ€è¦â€œæ‰¾åˆ°â€ä¸è¯¥ç›®æ ‡ç›¸åŒ¹é…çš„ä»£ç ã€‚ä¸æ˜¯æ¯ä¸ªäººéƒ½è§‰å¾—è§£æ–¹ç¨‹å¾ˆæœ‰è¶£ï¼Œå†™ Effect ä¹Ÿæ˜¯å¦‚æ­¤ï¼å¹¸è¿çš„æ˜¯ï¼Œä¸‹é¢æœ‰ä¸€äº›å¸¸è§çš„è§£å†³æ–¹æ¡ˆä½ å¯ä»¥å»å°è¯•ã€‚</p><pitfall><p>å¦‚æœä½ æœ‰ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ä»£ç åº“ï¼Œä½ å¯èƒ½ä¼šæœ‰ä¸€äº›åƒè¿™æ ·æŠ‘åˆ¶ linter çš„ä»£ç ï¼š<pre class="language-js"><code class="language-js"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// ğŸ”´ é¿å…åƒè¿™æ ·æŠ‘åˆ¶ linter çš„è­¦å‘Šæˆ–é”™è¯¯æç¤ºï¼š</span>
  <span class="token comment">// eslint-ignore-next-line react-hooks/exhaustive-deps</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>å½“ä¾èµ–ä¸ä»£ç ä¸åŒ¹é…æ—¶ï¼Œææœ‰å¯èƒ½å¼•å…¥ bug</strong>ã€‚é€šè¿‡æŠ‘åˆ¶ linterï¼Œä½ æ˜¯åœ¨ Effect æ‰€ä¾èµ–çš„å€¼ä¸Šå¯¹ React "æ’’è°"ã€‚<p>ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŠ€æœ¯ã€‚</p></pitfall><deepdive><section class="level4"aria-labelledby="ä¸ºä»€ä¹ˆæŠ‘åˆ¶-linter-å¯¹ä¾èµ–çš„æ£€æŸ¥å¦‚æ­¤å±é™©-why-is-suppressing-the-dependency-linter-so-dangerous"><h4 id="ä¸ºä»€ä¹ˆæŠ‘åˆ¶-linter-å¯¹ä¾èµ–çš„æ£€æŸ¥å¦‚æ­¤å±é™©-why-is-suppressing-the-dependency-linter-so-dangerous">ä¸ºä»€ä¹ˆæŠ‘åˆ¶ linter å¯¹ä¾èµ–çš„æ£€æŸ¥å¦‚æ­¤å±é™©ï¼Ÿ {/<em>why-is-suppressing-the-dependency-linter-so-dangerous</em>/}</h4><p>æŠ‘åˆ¶ linter ä¼šå¯¼è‡´éå¸¸ä¸ç›´è§‚çš„ bugï¼Œè¿™å°†å¾ˆéš¾å‘ç°å’Œä¿®å¤ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Timer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>increment<span class="token punctuation">,</span> setIncrement<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">onTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> increment<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>onTick<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>
        è®¡æ•°å™¨ï¼š<span class="token punctuation">{</span>count<span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>é‡åˆ¶<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>
        æ¯ç§’é€’å¢ï¼š
        <span class="token operator">&#x3C;</span>button disabled<span class="token operator">=</span><span class="token punctuation">{</span>increment <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>â€“<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setIncrement</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token arrow operator">=></span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>æ¯”æ–¹è¯´ï¼Œä½ æƒ³â€œåªåœ¨ mount æ—¶â€è¿è¡Œ Effectã€‚ä½ å·²ç»çŸ¥é“å¯ä»¥é€šè¿‡è®¾ç½® <a href="/learn/lifecycle-of-reactive-effects#what-an-effect-with-empty-dependencies-means">ç©ºï¼ˆ<code>[]</code>ï¼‰ä¾èµ–</a> æ¥è¾¾åˆ°è¿™ç§æ•ˆæœï¼Œæ‰€ä»¥ä½ å†³å®šå¿½ç•¥ linter çš„æ£€æŸ¥ï¼Œå¼ºè¡ŒæŒ‡å®š <code>[]</code> ä¸ºä¾èµ–ã€‚<p>ä¸Šé¢çš„è®¡æ•°å™¨ä¾‹å­ï¼Œæœ¬åº”è¯¥æ¯ç§’é€’å¢ï¼Œé€’å¢é‡å¯ä»¥é€šè¿‡ä¸¤ä¸ªæŒ‰é’®æ¥æ§åˆ¶ã€‚ç„¶è€Œï¼Œç”±äºä½ å¯¹ React â€œæ’’è°â€ï¼Œè¯´è¿™ä¸ª Effect ä¸ä¾èµ–äºä»»ä½•ä¸œè¥¿ï¼ŒReact ä¾¿ä¸€ç›´ä½¿ç”¨åˆæ¬¡æ¸²æŸ“æ—¶çš„ <code>onTick</code> å‡½æ•°ã€‚<a href="/learn/state-as-a-snapshot#rendering-takes-a-snapshot-in-time">åœ¨åç»­æ¸²æŸ“ä¸­</a>ï¼Œ <code>count</code> æ€»æ˜¯ <code>0</code> ï¼Œ<code>increment</code> æ€»æ˜¯ <code>1</code>ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå®šæ—¶å™¨æ¯ç§’è°ƒç”¨ <code>onTick</code> å‡½æ•°ï¼Œå®é™…è¿è¡Œçš„æ˜¯ <code>setCount(0 + 1)</code><sup><a href="#note1">[1]</a></sup>ï¼Œæ‰€ä»¥ä½ æ€»æ˜¯çœ‹åˆ° <code>1</code>ã€‚åƒè¿™æ ·çš„é”™è¯¯ï¼Œå½“å®ƒä»¬åˆ†æ•£åœ¨å¤šä¸ªç»„ä»¶ä¸­æ—¶ï¼Œå°±æ›´éš¾è§£å†³äº†ã€‚<p>è¿™é‡Œæœ‰ä¸€ä¸ªæ¯”å¿½ç•¥ linter æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ! é‚£ä¾¿æ˜¯å°† <code>onTick</code> æ·»åŠ åˆ°ä¾èµ–ä¸­ã€‚(ä¸ºäº†ç¡®ä¿ interval åªè®¾ç½®ä¸€æ¬¡ï¼Œ<a href="/learn/separating-events-from-effects#reading-latest-props-and-state-with-effect-events">ä½¿ <code>onTick</code> æˆä¸º Effect Event</a>ã€‚)<p><strong>æˆ‘ä»¬å»ºè®®å°†ä¾èµ–æ€§ lint é”™è¯¯ä½œä¸ºä¸€ä¸ªç¼–è¯‘é”™è¯¯æ¥å¤„ç†ã€‚å¦‚æœä½ ä¸æŠ‘åˆ¶å®ƒï¼Œä½ å°†æ°¸è¿œä¸ä¼šé‡åˆ°åƒä¸Šé¢è¿™æ ·çš„é”™è¯¯</strong>ã€‚æœ¬é¡µé¢çš„å‰©ä¸‹éƒ¨åˆ†å°†ä»‹ç»è¿™ä¸ªå’Œå…¶ä»–æƒ…å†µçš„æ›¿ä»£æ–¹æ¡ˆã€‚</section></deepdive></section></section><section class="level2"aria-labelledby="ç§»é™¤éå¿…éœ€çš„ä¾èµ–-removing-unnecessary-dependencies"><h2 id="ç§»é™¤éå¿…éœ€çš„ä¾èµ–-removing-unnecessary-dependencies">ç§»é™¤éå¿…éœ€çš„ä¾èµ– {/<em>removing-unnecessary-dependencies</em>/}</h2><p>æ¯å½“ä½ è°ƒæ•´ Effect çš„ä¾èµ–ä»¥é€‚é…ä»£ç æ—¶ï¼Œè¯·æ³¨æ„ä¸€ä¸‹å½“å‰çš„ä¾èµ–ã€‚å½“è¿™äº›ä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè®© Effect é‡æ–°è¿è¡Œæ˜¯å¦æœ‰æ„ä¹‰ï¼Ÿæœ‰æ—¶ï¼Œç­”æ¡ˆæ˜¯â€œä¸â€ï¼š<ul><li>ä½ å¯èƒ½æƒ³åœ¨ä¸åŒçš„æ¡ä»¶ä¸‹é‡æ–°æ‰§è¡Œ Effect çš„ <strong>ä¸åŒéƒ¨åˆ†</strong>ã€‚<li>ä½ å¯èƒ½æƒ³åªè¯»å–æŸä¸ªä¾èµ–çš„ <strong>æœ€æ–°å€¼</strong>ï¼Œè€Œä¸æ˜¯å¯¹å…¶å˜åŒ–åšå‡ºâ€œååº”â€ã€‚<li>ä¾èµ–å¯èƒ½ä¼šå› ä¸ºå®ƒçš„ç±»å‹æ˜¯å¯¹è±¡æˆ–å‡½æ•°è€Œ <strong>æ— æ„é—´</strong> æ”¹å˜å¤ªé¢‘ç¹ã€‚</ul><p>ä¸ºäº†æ‰¾åˆ°æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆï¼Œä½ éœ€è¦å›ç­”å…³äº Effect çš„å‡ ä¸ªé—®é¢˜ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›é—®é¢˜ã€‚<section class="level3"aria-labelledby="è¿™æ®µä»£ç åº”è¯¥ç§»åˆ°äº‹ä»¶å¤„ç†ç¨‹åºä¸­å—-should-this-code-move-to-an-event-handler"><h3 id="è¿™æ®µä»£ç åº”è¯¥ç§»åˆ°äº‹ä»¶å¤„ç†ç¨‹åºä¸­å—-should-this-code-move-to-an-event-handler">è¿™æ®µä»£ç åº”è¯¥ç§»åˆ°äº‹ä»¶å¤„ç†ç¨‹åºä¸­å—ï¼Ÿ {/<em>should-this-code-move-to-an-event-handler</em>/}</h3><p>ä½ åº”è¯¥è€ƒè™‘çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼Œè¿™æ®µä»£ç æ˜¯å¦åº”è¯¥æˆä¸º Effectã€‚<p>æƒ³è±¡ä¸€ä¸ªè¡¨å•ï¼Œåœ¨æäº¤æ—¶ä½ å°† <code>submitted</code> çŠ¶æ€å˜é‡è®¾ç½®ä¸º <code>true</code>ï¼Œå¹¶åœ¨ <code>submitted</code> ä¸º <code>true</code> æ—¶ï¼Œéœ€è¦å‘é€ POST è¯·æ±‚å¹¶æ˜¾ç¤ºé€šçŸ¥ã€‚ä½ æŠŠè¿™ä¸ªé€»è¾‘æ”¾åœ¨ Effect å†…ï¼Œå¹¶æ ¹æ® <code>submitted</code> ä¸º <code>true</code> â€œååº”â€ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>submitted<span class="token punctuation">,</span> setSubmitted<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>submitted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ğŸ”´ é¿å…: Effect ä¸­æœ‰ç‰¹å®šäº‹ä»¶çš„é€»è¾‘</span>
      <span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/register'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Successfully registered!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>submitted<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setSubmitted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>åæ¥ï¼Œä½ æƒ³é€šè¿‡è¯»å–å½“å‰çš„ä¸»é¢˜å€¼æ¥è°ƒæ•´é€šçŸ¥ä¿¡æ¯çš„æ ·å¼ã€‚å› ä¸º <code>theme</code> æ˜¯åœ¨ç»„ä»¶ä¸­å£°æ˜çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯å“åº”å¼å€¼ï¼Œä½ å†³å®šæŠŠå®ƒä½œä¸ºä¾èµ–åŠ å…¥ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>submitted<span class="token punctuation">,</span> setSubmitted<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>submitted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ğŸ”´ é¿å…: Effect ä¸­æœ‰ç‰¹å®šäº‹ä»¶çš„é€»è¾‘</span>
      <span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/register'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Successfully registered!'</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>submitted<span class="token punctuation">,</span> theme<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>

  <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setSubmitted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>å¦‚æœè¿™ä¹ˆåšï¼Œä½ å°†å¼•å…¥ä¸€ä¸ªé”™è¯¯ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ å…ˆæäº¤è¡¨å•ï¼Œç„¶ååˆ‡æ¢æš—äº®ä¸»é¢˜ã€‚å½“ <code>theme</code> æ”¹å˜åï¼ŒEffect é‡æ–°è¿è¡Œï¼Œè¿™å°†å¯¼è‡´æ˜¾ç¤ºä¸¤æ¬¡ç›¸åŒçš„é€šçŸ¥ï¼<p><strong>é¦–å…ˆï¼Œè¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œä»£ç ä¸åº”è¯¥ä»¥ Effect å®ç°</strong>ã€‚ä½ æƒ³å‘é€è¿™ä¸ª POST è¯·æ±‚ï¼Œå¹¶åœ¨ <strong>æäº¤è¡¨å•æ—¶æ˜¾ç¤ºé€šçŸ¥</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹å®šçš„äº¤äº’ã€‚ç‰¹å®šçš„äº¤äº’è¯·å°†è¯¥é€»è¾‘ç›´æ¥æ”¾åˆ°ç›¸åº”çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ThemeContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// âœ… å¥½ï¼šä»äº‹ä»¶å¤„ç†ç¨‹åºè°ƒç”¨ç‰¹å®šäºäº‹ä»¶çš„é€»è¾‘</span>
    <span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/register'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'Successfully registered!'</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>ç°åœ¨ï¼Œä»£ç åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œå®ƒä¸æ˜¯å“åº”å¼çš„ â€”â€” æ‰€ä»¥å®ƒåªåœ¨ç”¨æˆ·æäº¤è¡¨å•æ—¶è¿è¡Œã€‚é˜…è¯»æ›´å¤šå…³äº <a href="/learn/separating-events-from-effects#reactive-values-and-reactive-logic">åœ¨äº‹ä»¶å¤„ç†ç¨‹åºå’Œ Effect ä¹‹é—´åšå‡ºé€‰æ‹©</a> å’Œ <a href="/learn/you-might-not-need-an-effect">å¦‚ä½•åˆ é™¤ä¸å¿…è¦çš„ Effect</a>ã€‚</section><section class="level3"aria-labelledby="effect-æ˜¯å¦åœ¨åšå‡ ä»¶ä¸ç›¸å…³çš„äº‹æƒ…-is-your-effect-doing-several-unrelated-things"><h3 id="effect-æ˜¯å¦åœ¨åšå‡ ä»¶ä¸ç›¸å…³çš„äº‹æƒ…-is-your-effect-doing-several-unrelated-things">Effect æ˜¯å¦åœ¨åšå‡ ä»¶ä¸ç›¸å…³çš„äº‹æƒ…ï¼Ÿ {/<em>is-your-effect-doing-several-unrelated-things</em>/}</h3><p>ä¸‹ä¸€ä¸ªåº”è¯¥é—®è‡ªå·±çš„é—®é¢˜æ˜¯ï¼ŒEffect æ˜¯å¦åœ¨åšå‡ ä»¶ä¸ç›¸å…³çš„äº‹æƒ…ã€‚<p>å¦‚ä¸‹ä¾‹å­ï¼Œä½ æ­£åœ¨å®ç°è¿è¾“è¡¨å•ï¼Œç”¨æˆ·éœ€è¦é€‰æ‹©ä»–ä»¬çš„åŸå¸‚å’Œåœ°åŒºã€‚ä½ æ ¹æ®æ‰€é€‰çš„â€œå›½å®¶â€ä»æœåŠ¡å™¨ä¸Šè·å–â€œåŸå¸‚â€åˆ—è¡¨ï¼Œç„¶ååœ¨ä¸‹æ‹‰èœå•ä¸­æ˜¾ç¤ºï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ShippingForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> country <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>cities<span class="token punctuation">,</span> setCities<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>city<span class="token punctuation">,</span> setCity<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ignore <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/cities?country=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>country<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token arrow operator">=></span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setCities</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      ignore <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>country<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>

  <span class="token comment">// ...</span></code></pre><p>è¿™æ˜¯ä¸€ä¸ª <a href="/learn/you-might-not-need-an-effect#fetching-data">åœ¨Effectä¸­è·å–æ•°æ®</a> çš„å¥½ä¾‹å­ï¼š<code>cities</code> state é€šè¿‡ç½‘ç»œå’Œ <code>country</code> props è¿›è¡Œâ€œåŒæ­¥â€ã€‚ä½†ä½ ä¸èƒ½åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­è¿™æ ·åšï¼Œå› ä¸ºä½ éœ€è¦åœ¨ <code>ShippingForm</code> æ˜¾ç¤ºæ—¶å’Œ <code>country</code> å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆä¸ç®¡æ˜¯å“ªä¸ªäº¤äº’å¯¼è‡´çš„ï¼‰ç«‹å³è·å–ã€‚<p>ç°åœ¨æˆ‘ä»¬å‡è®¾ä½ è¦ä¸ºåŸå¸‚åŒºåŸŸæ·»åŠ ç¬¬äºŒä¸ªé€‰æ‹©æ¡†ï¼Œå®ƒåº”è¯¥è·å–å½“å‰é€‰æ‹©çš„ <code>city</code> çš„ <code>areas</code>ã€‚ä½ ä¹Ÿè®¸ä¼šåœ¨åŒä¸€ä¸ª Effect ä¸­æ·»åŠ ç¬¬äºŒä¸ª <code>fetch</code> è°ƒç”¨æ¥è·å–åœ°åŒºåˆ—è¡¨ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ShippingForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> country <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>cities<span class="token punctuation">,</span> setCities<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>city<span class="token punctuation">,</span> setCity<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>areas<span class="token punctuation">,</span> setAreas<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ignore <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/cities?country=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>country<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token arrow operator">=></span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setCities</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ğŸ”´ é¿å…: å•ä¸ª Effect åŒæ­¥ä¸¤ä¸ªç‹¬ç«‹é€»è¾‘å¤„ç†</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>city<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/areas?city=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token arrow operator">=></span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setAreas</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      ignore <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>country<span class="token punctuation">,</span> city<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>

  <span class="token comment">// ...</span></code></pre><p>ç„¶è€Œï¼Œç”±äº Effect ç°åœ¨ä½¿ç”¨ <code>city</code> state å˜é‡ï¼Œä½ ä¸å¾—ä¸æŠŠ <code>city</code> åŠ å…¥åˆ°ä¾èµ–ä¸­ã€‚è¿™åˆå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šå½“ç”¨æˆ·é€‰æ‹©ä¸åŒçš„åŸå¸‚æ—¶ï¼ŒEffect å°†é‡æ–°è¿è¡Œå¹¶è°ƒç”¨ <code>fetchCities(country)</code>ã€‚è¿™å°†å¯¼è‡´ä¸å¿…è¦åœ°å¤šæ¬¡è·å–åŸå¸‚åˆ—è¡¨ã€‚<p><strong>è¿™æ®µä»£ç çš„é—®é¢˜åœ¨äºï¼Œä½ åœ¨åŒæ­¥ä¸¤ä¸ªä¸åŒçš„ã€ä¸ç›¸å…³çš„ä¸œè¥¿</strong>ï¼š<ol><li>ä½ æƒ³è¦æ ¹æ® <code>country</code> props é€šè¿‡ç½‘ç»œåŒæ­¥ <code>city</code> state<li>ä½ æƒ³è¦æ ¹æ® <code>city</code> çŠ¶æ€é€šè¿‡ç½‘ç»œåŒæ­¥ <code>areas</code> state</ol><p>å°†é€»è¾‘åˆ†åˆ° 2 ä¸ª Effect ä¸­ï¼Œæ¯ä¸ª Effect ä»…å“åº”å…¶éœ€è¦åŒæ­¥å“åº”çš„ propsï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ShippingForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> country <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>cities<span class="token punctuation">,</span> setCities<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ignore <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/cities?country=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>country<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token arrow operator">=></span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setCities</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      ignore <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>country<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>city<span class="token punctuation">,</span> setCity<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>areas<span class="token punctuation">,</span> setAreas<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>city<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> ignore <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/areas?city=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token arrow operator">=></span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setAreas</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        ignore <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>city<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>

  <span class="token comment">// ...</span></code></pre><p>ç°åœ¨ï¼Œç¬¬ä¸€ä¸ª Effect åªåœ¨ <code>country</code> æ”¹å˜æ—¶é‡æ–°è¿è¡Œï¼Œè€Œç¬¬äºŒä¸ª Effect åœ¨ <code>city</code> æ”¹å˜æ—¶é‡æ–°è¿è¡Œã€‚ä½ å·²ç»æŒ‰ç›®çš„æŠŠå®ƒä»¬åˆ†å¼€äº†ï¼šä¸¤ä»¶ä¸åŒçš„äº‹æƒ…ç”±ä¸¤ä¸ªç‹¬ç«‹çš„ Effect æ¥åŒæ­¥ã€‚ä¸¤ä¸ªç‹¬ç«‹çš„ Effect æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„ä¾èµ–ï¼Œæ‰€ä»¥å®ƒä»¬ä¸ä¼šåœ¨æ— æ„ä¸­ç›¸äº’è§¦å‘ã€‚<p>æœ€ç»ˆå®Œæˆçš„ä»£ç æ¯”æœ€åˆçš„è¦é•¿ï¼Œä½†æ˜¯æ‹†åˆ†è¿™äº› Effect æ˜¯éå¸¸æ­£ç¡®çš„ã€‚<a href="/learn/lifecycle-of-reactive-effects#each-effect-represents-a-separate-synchronization-process">æ¯ä¸ª Effect åº”è¯¥ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹</a>ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåˆ é™¤ä¸€ä¸ª Effect å¹¶ä¸ä¼šå½±å“åˆ°å¦ä¸€ä¸ª Effect çš„é€»è¾‘ã€‚è¿™æ„å‘³ç€ä»–ä»¬ <strong>åŒæ­¥ä¸åŒçš„äº‹æƒ…</strong>ï¼Œåˆ†å¼€ä»–ä»¬å¤„ç†æ˜¯ä¸€ä»¶å¥½äº‹ã€‚å¦‚æœä½ æ‹…å¿ƒé‡å¤ä»£ç çš„é—®é¢˜ï¼Œä½ å¯ä»¥é€šè¿‡ <a href="/learn/reusing-logic-with-custom-hooks#when-to-use-custom-hooks">æå–ç›¸åŒé€»è¾‘åˆ°è‡ªå®šä¹‰ Hook</a> æ¥æå‡ä»£ç è´¨é‡</section><section class="level3"aria-labelledby="æ˜¯å¦åœ¨è¯»å–ä¸€äº›çŠ¶æ€æ¥è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€-are-you-reading-some-state-to-calculate-the-next-state"><h3 id="æ˜¯å¦åœ¨è¯»å–ä¸€äº›çŠ¶æ€æ¥è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€-are-you-reading-some-state-to-calculate-the-next-state">æ˜¯å¦åœ¨è¯»å–ä¸€äº›çŠ¶æ€æ¥è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Ÿ {/<em>are-you-reading-some-state-to-calculate-the-next-state</em>/}</h3><p>æ¯æ¬¡æœ‰æ–°çš„æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œè¿™ä¸ª Effect ä¼šç”¨æ–°åˆ›å»ºçš„æ•°ç»„æ›´æ–° <code>messages</code> stateï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">receivedMessage</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token spread operator">...</span>messages<span class="token punctuation">,</span> receivedMessage<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span></code></pre><p>å®ƒä½¿ç”¨ <code>messages</code> å˜é‡æ¥ <a href="/learn/updating-arrays-in-state">åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„</a>ï¼šä»æ‰€æœ‰ç°æœ‰çš„æ¶ˆæ¯å¼€å§‹ï¼Œå¹¶åœ¨æœ€åæ·»åŠ æ–°çš„æ¶ˆæ¯ã€‚ç„¶è€Œï¼Œç”±äº <code>messages</code> æ˜¯ä¸€ä¸ªç”± Effect è¯»å–çš„å“åº”å¼å€¼ï¼Œå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä¾èµ–ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">receivedMessage</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token spread operator">...</span>messages<span class="token punctuation">,</span> receivedMessage<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> messages<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>è€Œè®© <code>messages</code> æˆä¸ºä¾èµ–ä¼šå¸¦æ¥é—®é¢˜ã€‚<p>æ¯å½“ä½ æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œ<code>setMessages()</code> å°±ä¼šä½¿è¯¥ç»„ä»¶é‡æ–°æ¸²æŸ“ä¸€ä¸ªæ–°çš„ <code>messages</code> æ•°ç»„ï¼Œå…¶ä¸­åŒ…æ‹¬æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ç„¶è€Œï¼Œç”±äºè¯¥ Effect ç°åœ¨ä¾èµ–äº <code>messages</code>ï¼Œè¿™ <strong>ä¹Ÿå°†</strong> é‡æ–°åŒæ­¥è¯¥ Effectã€‚æ‰€ä»¥æ¯æ¡æ–°æ¶ˆæ¯éƒ½ä¼šä½¿èŠå¤©é‡æ–°è¿æ¥ã€‚ç”¨æˆ·ä¸ä¼šå–œæ¬¢è¿™æ ·ï¼<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸è¦åœ¨ Effect é‡Œé¢è¯»å– <code>messages</code>ã€‚ç›¸åï¼Œåº”è¯¥å°†ä¸€ä¸ª <a href="/reference/react/useState#updating-state-based-the-previous-state">state æ›´æ–°å‡½æ•°</a> ä¼ é€’ç»™ <code>setMessages</code>ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">receivedMessage</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token parameter">msgs</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token spread operator">...</span>msgs<span class="token punctuation">,</span> receivedMessage<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p><strong>æ³¨æ„ Effect ç°åœ¨æ ¹æœ¬ä¸è¯»å– <code>messages</code> å˜é‡</strong>ã€‚ä½ åªéœ€è¦ä¼ é€’ä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼Œæ¯”å¦‚ <code>msgs => [...msgs, receivedMessage]</code>ã€‚React <a href="/learn/queueing-a-series-of-state-updates">å°†æ›´æ–°ç¨‹åºå‡½æ•°æ”¾å…¥é˜Ÿåˆ—</a> å¹¶å°†åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æœŸé—´å‘å…¶æä¾› <code>msgs</code> å‚æ•°ã€‚è¿™å°±æ˜¯ Effect æœ¬èº«ä¸å†éœ€è¦ä¾èµ– <code>messages</code> çš„åŸå› ã€‚ä¿®å¤åï¼Œæ¥æ”¶èŠå¤©æ¶ˆæ¯å°†ä¸å†ä½¿èŠå¤©é‡æ–°è¿æ¥ã€‚</section><section class="level3"aria-labelledby="ä½ æƒ³è¯»å–ä¸€ä¸ªå€¼è€Œä¸å¯¹å…¶å˜åŒ–åšå‡ºååº”å—-do-you-want-to-read-a-value-without-reacting-to-its-changes"><h3 id="ä½ æƒ³è¯»å–ä¸€ä¸ªå€¼è€Œä¸å¯¹å…¶å˜åŒ–åšå‡ºååº”å—-do-you-want-to-read-a-value-without-reacting-to-its-changes">ä½ æƒ³è¯»å–ä¸€ä¸ªå€¼è€Œä¸å¯¹å…¶å˜åŒ–åšå‡ºâ€œååº”â€å—ï¼Ÿ {/<em>do-you-want-to-read-a-value-without-reacting-to-its-changes</em>/}</h3><wip><p>æœ¬èŠ‚æè¿°äº†ä¸€ä¸ªåœ¨ç¨³å®šç‰ˆæœ¬çš„ React ä¸­ <strong>å°šæœªå‘å¸ƒçš„å®éªŒæ€§</strong> APIã€‚</p></wip><p>å‡è®¾ä½ å¸Œæœ›åœ¨ç”¨æˆ·æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶æ’­æ”¾å£°éŸ³ï¼Œ<code>isMuted</code> ä¸º <code>true</code> é™¤å¤–ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isMuted<span class="token punctuation">,</span> setIsMuted<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">receivedMessage</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token parameter">msgs</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token spread operator">...</span>msgs<span class="token punctuation">,</span> receivedMessage<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMuted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">playSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span></code></pre><p>ç”±äº Effect ç°åœ¨åœ¨å…¶ä»£ç ä¸­ä½¿ç”¨äº† <code>isMuted</code> ï¼Œå› æ­¤ä½ å¿…é¡»å°†å…¶æ·»åŠ åˆ°ä¾èµ–ä¸­ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isMuted<span class="token punctuation">,</span> setIsMuted<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">receivedMessage</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token parameter">msgs</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token spread operator">...</span>msgs<span class="token punctuation">,</span> receivedMessage<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMuted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">playSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> isMuted<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>é—®é¢˜æ˜¯æ¯æ¬¡ <code>isMuted</code> æ”¹å˜æ—¶ï¼ˆä¾‹å¦‚ï¼Œå½“ç”¨æˆ·æŒ‰ä¸‹â€œé™éŸ³â€å¼€å…³æ—¶ï¼‰ï¼ŒEffect å°†é‡æ–°åŒæ­¥ï¼Œå¹¶é‡æ–°è¿æ¥åˆ°èŠå¤©ã€‚è¿™ä¸æ˜¯ç†æƒ³çš„ç”¨æˆ·ä½“éªŒï¼ï¼ˆåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå³ä½¿ç¦ç”¨ linter ä¹Ÿä¸èµ·ä½œç”¨â€”â€”å¦‚æœä½ è¿™æ ·åšï¼Œ<code>isMuted</code> å°†â€œä¿æŒâ€å…¶æ—§å€¼ã€‚ï¼‰<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å°†ä¸åº”è¯¥å“åº”å¼çš„é€»è¾‘ä» Effect ä¸­æŠ½å–å‡ºæ¥ã€‚ä½ ä¸å¸Œæœ›æ­¤ Effect å¯¹ <code>isMuted</code> ä¸­çš„æ›´æ”¹åšå‡ºâ€œååº”â€ã€‚<a href="/learn/separating-events-from-effects#declaring-an-effect-event">å°†è¿™æ®µéå“åº”å¼é€»è¾‘ç§»è‡³ Effect Event ä¸­</a>ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isMuted<span class="token punctuation">,</span> setIsMuted<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> onMessage <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token parameter">receivedMessage</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token parameter">msgs</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token spread operator">...</span>msgs<span class="token punctuation">,</span> receivedMessage<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMuted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">playSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">receivedMessage</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">onMessage</span><span class="token punctuation">(</span>receivedMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>Effect Events è®©ä½ å¯ä»¥å°† Effect åˆ†æˆå“åº”å¼éƒ¨åˆ†ï¼ˆåº”è¯¥â€œååº”â€å“åº”å¼å€¼ï¼Œå¦‚ <code>roomId</code> åŠå…¶å˜åŒ–ï¼‰å’Œéå“åº”å¼éƒ¨åˆ†ï¼ˆåªè¯»å–å®ƒä»¬çš„æœ€æ–°å€¼ï¼Œå¦‚ <code>onMessage</code> è¯»å– <code>isMuted</code>ï¼‰ã€‚<strong>ç°åœ¨ä½ åœ¨ Effect Event ä¸­è¯»å–äº† <code>isMuted</code>ï¼Œå®ƒä¸éœ€è¦æ·»åŠ åˆ° Effect ä¾èµ–ä¸­</strong>ã€‚å› æ­¤ï¼Œå½“ä½ æ‰“å¼€æˆ–è€…å…³é—­â€œé™éŸ³â€è®¾ç½®æ—¶ï¼ŒèŠå¤©ä¸ä¼šé‡æ–°è¿æ¥ã€‚è‡³æ­¤ï¼Œè§£å†³åŸå§‹é—®é¢˜ï¼<section class="level4"aria-labelledby="åŒ…è£…æ¥è‡ª-props-çš„äº‹ä»¶å¤„ç†ç¨‹åº-wrapping-an-event-handler-from-the-props"><h4 id="åŒ…è£…æ¥è‡ª-props-çš„äº‹ä»¶å¤„ç†ç¨‹åº-wrapping-an-event-handler-from-the-props">åŒ…è£…æ¥è‡ª props çš„äº‹ä»¶å¤„ç†ç¨‹åº {/<em>wrapping-an-event-handler-from-the-props</em>/}</h4><p>å½“ç»„ä»¶æ¥æ”¶äº‹ä»¶å¤„ç†å‡½æ•°ä½œä¸º props æ—¶ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> onReceiveMessage <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">receivedMessage</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">onReceiveMessage</span><span class="token punctuation">(</span>receivedMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> onReceiveMessage<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>å‡è®¾çˆ¶ç»„ä»¶åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼ é€’äº†ä¸€ä¸ª <strong>ä¸åŒçš„</strong> <code>onReceiveMessage</code> å‡½æ•°ï¼š<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
  roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
  onReceiveMessage<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">receivedMessage</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">></span></code></pre><p>ç”±äº <code>onReceiveMessage</code> æ˜¯ä¾èµ–ï¼Œå®ƒä¼šå¯¼è‡´ Effect åœ¨æ¯æ¬¡çˆ¶çº§é‡æ–°æ¸²æŸ“åé‡æ–°åŒæ­¥ã€‚è¿™å°†å¯¼è‡´èŠå¤©é‡æ–°è¿æ¥ã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·ç”¨ Effect Event åŒ…è£¹ä¹‹åå†è°ƒç”¨ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> onReceiveMessage <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> onMessage <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token parameter">receivedMessage</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">onReceiveMessage</span><span class="token punctuation">(</span>receivedMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">receivedMessage</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">onMessage</span><span class="token punctuation">(</span>receivedMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>Effect Events ä¸æ˜¯å“åº”å¼çš„ï¼Œå› æ­¤ä½ ä¸éœ€è¦å°†å®ƒä»¬æŒ‡å®šä¸ºä¾èµ–ã€‚å› æ­¤ï¼Œå³ä½¿çˆ¶ç»„ä»¶ä¼ é€’çš„å‡½æ•°åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶éƒ½ä¸åŒï¼ŒèŠå¤©ä¹Ÿå°†ä¸å†é‡æ–°è¿æ¥ã€‚</section><section class="level4"aria-labelledby="åˆ†ç¦»å“åº”å¼å’Œéå“åº”å¼ä»£ç -separating-reactive-and-non-reactive-code"><h4 id="åˆ†ç¦»å“åº”å¼å’Œéå“åº”å¼ä»£ç -separating-reactive-and-non-reactive-code">åˆ†ç¦»å“åº”å¼å’Œéå“åº”å¼ä»£ç  {/<em>separating-reactive-and-non-reactive-code</em>/}</h4><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä½ å¸Œæœ›åœ¨æ¯æ¬¡ <code>roomId</code> æ›´æ”¹æ—¶è®°å½•ä¸€æ¬¡ã€‚ä½ å¸Œæœ›åœ¨æ¯ä¸ªæ—¥å¿—ä¸­åŒ…å«å½“å‰çš„ <code>notificationCount</code>ï¼Œä½†ä½  <strong>ä¸</strong> å¸Œæœ›é€šè¿‡æ›´æ”¹ <code>notificationCount</code> æ¥è§¦å‘æ—¥å¿—äº‹ä»¶ã€‚<p>è§£å†³æ–¹æ¡ˆè¿˜æ˜¯å°†éå“åº”å¼ä»£ç æ‹†åˆ†ï¼Œå°†å…¶æ”¾åˆ° Effect Event å†…ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Chat</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> notificationCount <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onVisit <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token parameter">visitedRoomId</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">logVisit</span><span class="token punctuation">(</span>visitedRoomId<span class="token punctuation">,</span> notificationCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">onVisit</span><span class="token punctuation">(</span>roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>ä½ å¸Œæœ›é€»è¾‘å¯¹ <code>roomId</code> åšå‡ºå“åº”ï¼Œå› æ­¤ä½ åœ¨ Effect ä¸­è¯»å– <code>roomId</code>ã€‚ä½†æ˜¯ï¼Œä½ ä¸å¸Œæœ›æ›´æ”¹ <code>notificationCount</code> æ¥è®°å½•é¢å¤–çš„æ—¥å¿—è¾“å‡ºï¼Œå› æ­¤ä½ å¯ä»¥åœ¨ Effect Event ä¸­è¯»å– <code>notificationCount</code>ã€‚<a href="/learn/separating-events-from-effects#reading-latest-props-and-state-with-effect-events">äº†è§£ä½¿ç”¨ Effect Events åœ¨ Effect ä¸­è¯»å–æœ€æ–° props å’Œ state çš„æ›´å¤šä¿¡æ¯</a>ã€‚</section></section><section class="level3"aria-labelledby="ä¸€äº›å“åº”å¼å€¼æ˜¯å¦æ— æ„ä¸­æ”¹å˜äº†-does-some-reactive-value-change-unintentionally"><h3 id="ä¸€äº›å“åº”å¼å€¼æ˜¯å¦æ— æ„ä¸­æ”¹å˜äº†-does-some-reactive-value-change-unintentionally">ä¸€äº›å“åº”å¼å€¼æ˜¯å¦æ— æ„ä¸­æ”¹å˜äº†ï¼Ÿ {/<em>does-some-reactive-value-change-unintentionally</em>/}</h3><p>æœ‰æ—¶ï¼Œä½  <strong>ç¡®å®</strong> å¸Œæœ› Effect å¯¹æŸä¸ªå€¼â€œåšå‡ºååº”â€ï¼Œä½†è¯¥å€¼çš„å˜åŒ–æ¯”ä½ å¸Œæœ›çš„æ›´é¢‘ç¹â€”â€”å¹¶ä¸”å¯èƒ½ä¸ä¼šä»ç”¨æˆ·çš„è§’åº¦åæ˜ ä»»ä½•å®é™…å˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ åœ¨ç»„ä»¶ä¸­åˆ›å»ºäº† <code>options</code> å¯¹è±¡ï¼Œç„¶åä» Effect å†…éƒ¨è¯»å–è¯¥å¯¹è±¡ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl<span class="token punctuation">,</span>
    <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span></code></pre><p>è¯¥å¯¹è±¡åœ¨ç»„ä»¶ä¸­å£°æ˜ï¼Œå› æ­¤å®ƒæ˜¯ <a href="/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values">å“åº”å¼å€¼</a>ã€‚å½“ä½ åœ¨ Effect ä¸­è¯»å–è¿™æ ·çš„å“åº”å¼å€¼æ—¶ï¼Œä½ å°†å…¶å£°æ˜ä¸ºä¾èµ–ã€‚è¿™å¯ç¡®ä¿ Effect å¯¹å…¶æ›´æ”¹åšå‡ºâ€œååº”â€ï¼š<pre class="language-js"><code class="language-js">  <span class="token comment">// ...</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>å°†å…¶å£°æ˜ä¸ºä¾èµ–å¾ˆé‡è¦ï¼ä¾‹å¦‚ï¼Œè¿™å¯ä»¥ç¡®ä¿å¦‚æœ <code>roomId</code> å‘ç”Ÿå˜åŒ–ï¼ŒEffect å°†ä½¿ç”¨æ–°çš„ <code>options</code> é‡æ–°è¿æ¥åˆ°èŠå¤©ã€‚ä½†æ˜¯ï¼Œä¸Šé¢çš„ä»£ç ä¹Ÿæœ‰é—®é¢˜ã€‚è¦æŸ¥çœ‹å®ƒï¼Œè¯·å°è¯•åœ¨ä¸‹é¢çš„æ²™ç›’ä¸­è¾“å…¥å†…å®¹ï¼Œç„¶åè§‚å¯Ÿæ§åˆ¶å°ä¸­å‘ç”Ÿçš„æƒ…å†µï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æš‚æ—¶ç¦ç”¨ linter ä»¥æ¼”ç¤ºé—®é¢˜</span>
  <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl<span class="token punctuation">,</span>
    <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ‰€æœ‰"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ—…æ¸¸"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"éŸ³ä¹"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> serverUrl<span class="token punctuation">,</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ°â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>åœ¨ä¸Šé¢çš„æ²™ç®±ä¸­ï¼Œè¾“å…¥ä»…æ›´æ–° <code>message</code> çŠ¶æ€å˜é‡ã€‚ä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸åº”è¯¥å½±å“èŠå¤©è¿æ¥ã€‚ä½†æ˜¯ï¼Œæ¯æ¬¡æ›´æ–° <code>message</code> æ—¶ï¼Œç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚å½“ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œå…¶ä¸­çš„ä»£ç ä¼šä»å¤´å¼€å§‹é‡æ–°è¿è¡Œã€‚<p>åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“ <code>ChatRoom</code> ç»„ä»¶æ—¶ï¼Œéƒ½ä¼šä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>options</code> å¯¹è±¡ã€‚React å‘ç° <code>options</code> å¯¹è±¡ä¸ä¸Šæ¬¡æ¸²æŸ“æœŸé—´åˆ›å»ºçš„ <code>options</code> å¯¹è±¡æ˜¯ <strong>ä¸åŒçš„å¯¹è±¡</strong>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¼šé‡æ–°åŒæ­¥ Effectï¼ˆä¾èµ–äº <code>options</code>ï¼‰ï¼Œå¹¶ä¸”ä¼šåœ¨ä½ è¾“å…¥æ—¶é‡æ–°è¿æ¥èŠå¤©ã€‚<p><strong>æ­¤é—®é¢˜ä»…å½±å“å¯¹è±¡å’Œå‡½æ•°ã€‚åœ¨ JavaScript ä¸­ï¼Œæ¯ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡å’Œå‡½æ•°éƒ½è¢«è®¤ä¸ºä¸å…¶ä»–æ‰€æœ‰å¯¹è±¡å’Œå‡½æ•°ä¸åŒã€‚å³ä½¿ä»–ä»¬çš„å€¼ç›¸åŒä¹Ÿæ²¡å…³ç³»</strong>ï¼<pre class="language-js"><code class="language-js"><span class="token comment">// ç¬¬ä¸€æ¬¡æ¸²æŸ“</span>
<span class="token keyword">const</span> options1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">,</span> <span class="token literal-property property">roomId</span><span class="token operator">:</span> <span class="token string">'éŸ³ä¹'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ä¸‹ä¸€æ¬¡æ¸²æŸ“</span>
<span class="token keyword">const</span> options2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">,</span> <span class="token literal-property property">roomId</span><span class="token operator">:</span> <span class="token string">'éŸ³ä¹'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// è¿™æ˜¯ 2 ä¸ªä¸åŒçš„å¯¹è±¡</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">is</span><span class="token punctuation">(</span>options1<span class="token punctuation">,</span> options2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span></code></pre><p><strong>å¯¹è±¡å’Œå‡½æ•°ä½œä¸ºä¾èµ–ï¼Œä¼šä½¿ Effect æ¯”ä½ éœ€è¦çš„æ›´é¢‘ç¹åœ°é‡æ–°åŒæ­¥</strong>ã€‚<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ åº”è¯¥å°½å¯èƒ½é¿å…å°†å¯¹è±¡å’Œå‡½æ•°ä½œä¸º Effect çš„ä¾èµ–ã€‚æ‰€ä»¥ï¼Œå°è¯•å°†å®ƒä»¬ç§»åˆ°ç»„ä»¶å¤–éƒ¨ã€Effect å†…éƒ¨ï¼Œæˆ–ä»ä¸­æå–åŸå§‹å€¼ã€‚<section class="level4"aria-labelledby="å°†é™æ€å¯¹è±¡å’Œå‡½æ•°ç§»å‡ºç»„ä»¶-move-static-objects-and-functions-outside-your-component"><h4 id="å°†é™æ€å¯¹è±¡å’Œå‡½æ•°ç§»å‡ºç»„ä»¶-move-static-objects-and-functions-outside-your-component">å°†é™æ€å¯¹è±¡å’Œå‡½æ•°ç§»å‡ºç»„ä»¶ {/<em>move-static-objects-and-functions-outside-your-component</em>/}</h4><p>å¦‚æœè¯¥å¯¹è±¡ä¸ä¾èµ–äºä»»ä½• props å’Œ stateï¼Œä½ å¯ä»¥å°†è¯¥å¯¹è±¡ç§»åˆ°ç»„ä»¶ä¹‹å¤–ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">roomId</span><span class="token operator">:</span> <span class="token string">'éŸ³ä¹'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>è¿™æ ·ï¼Œä½ å‘ linter <strong>è¯æ˜</strong> å®ƒä¸æ˜¯å“åº”å¼çš„ã€‚å®ƒä¸ä¼šå› ä¸ºé‡æ–°æ¸²æŸ“è€Œæ”¹å˜ï¼Œæ‰€ä»¥å®ƒä¸æ˜¯ä¾èµ–ã€‚ç°åœ¨é‡æ–°æ¸²æŸ“ <code>ChatRoom</code> ä¸ä¼šå¯¼è‡´ Effect é‡æ–°åŒæ­¥ã€‚<p>è¿™ä¹Ÿé€‚ç”¨äºå‡½æ•°åœºæ™¯ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">roomId</span><span class="token operator">:</span> <span class="token string">'éŸ³ä¹'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">createOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>ç”±äº <code>createOptions</code> æ˜¯åœ¨ç»„ä»¶å¤–éƒ¨å£°æ˜çš„ï¼Œå› æ­¤å®ƒä¸æ˜¯å“åº”å¼å€¼ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸éœ€è¦åœ¨ Effect çš„ä¾èµ–ä¸­æŒ‡å®šï¼Œä»¥åŠä¸ºä»€ä¹ˆå®ƒæ°¸è¿œä¸ä¼šå¯¼è‡´ Effect é‡æ–°åŒæ­¥ã€‚</section><section class="level4"aria-labelledby="å°†åŠ¨æ€å¯¹è±¡å’Œå‡½æ•°ç§»åŠ¨åˆ°-effect-ä¸­-move-dynamic-objects-and-functions-inside-your-effect"><h4 id="å°†åŠ¨æ€å¯¹è±¡å’Œå‡½æ•°ç§»åŠ¨åˆ°-effect-ä¸­-move-dynamic-objects-and-functions-inside-your-effect">å°†åŠ¨æ€å¯¹è±¡å’Œå‡½æ•°ç§»åŠ¨åˆ° Effect ä¸­ {/<em>move-dynamic-objects-and-functions-inside-your-effect</em>/}</h4><p>å¦‚æœå¯¹è±¡ä¾èµ–äºä¸€äº›å¯èƒ½å› é‡æ–°æ¸²æŸ“è€Œæ”¹å˜çš„å“åº”å¼å€¼ï¼Œä¾‹å¦‚ <code>roomId</code> propsï¼Œé‚£ä¹ˆä½ ä¸èƒ½å°†å®ƒæ”¾ç½®äºç»„ä»¶ <strong>å¤–éƒ¨</strong>ã€‚ä½ å¯ä»¥åœ¨ Effect <strong>å†…éƒ¨</strong> åˆ›å»ºå®ƒï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl<span class="token punctuation">,</span>
      <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>ç°åœ¨ <code>options</code> å·²åœ¨ Effect ä¸­å£°æ˜ï¼Œå®ƒä¸å†æ˜¯ Effect çš„ä¾èµ–ã€‚ç›¸åï¼ŒEffect ä½¿ç”¨çš„å”¯ä¸€å“åº”å¼å€¼æ˜¯ <code>roomId</code>ã€‚ç”±äº <code>roomId</code> ä¸æ˜¯å¯¹è±¡æˆ–å‡½æ•°ï¼Œä½ å¯ä»¥ç¡®å®šå®ƒä¸ä¼š <strong>æ— æ„é—´</strong> å˜ä¸åŒã€‚åœ¨ JavaScript ä¸­ï¼Œæ•°å­—å’Œå­—ç¬¦ä¸²æ ¹æ®å®ƒä»¬çš„å†…å®¹è¿›è¡Œæ¯”è¾ƒï¼š<pre class="language-js"><code class="language-js"><span class="token comment">// ç¬¬ä¸€æ¬¡æ¸²æŸ“</span>
<span class="token keyword">const</span> roomId1 <span class="token operator">=</span> <span class="token string">'éŸ³ä¹'</span><span class="token punctuation">;</span>

<span class="token comment">// ä¸‹ä¸€æ¬¡æ¸²æŸ“</span>
<span class="token keyword">const</span> roomId2 <span class="token operator">=</span> <span class="token string">'éŸ³ä¹'</span><span class="token punctuation">;</span>

<span class="token comment">// è¿™ 2 ä¸ªå­—ç¬¦ä¸²æ˜¯ç›¸åŒçš„</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">is</span><span class="token punctuation">(</span>roomId1<span class="token punctuation">,</span> roomId2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code></pre><p>å¾—ç›Šäºæ­¤ä¿®å¤ï¼Œå½“ä½ ç¼–è¾‘è¾“å…¥æ—¶ï¼ŒèŠå¤©å°†ä¸å†é‡æ–°è¿æ¥ï¼š<sandpack></sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl<span class="token punctuation">,</span>
      <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´<span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token literal-property property">é€‰æ‹©èŠå¤©å®¤</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ‰€æœ‰"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ—…æ¸¸"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"éŸ³ä¹"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> serverUrl<span class="token punctuation">,</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ°â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre><p>ç„¶è€Œï¼Œå½“ä½ æ›´æ”¹ <code>roomId</code> ä¸‹æ‹‰åˆ—è¡¨æ—¶ï¼Œå®ƒ <strong>ç¡®å®</strong> é‡æ–°è¿æ¥ï¼Œæ­£å¦‚ä½ æ‰€æœŸæœ›çš„é‚£æ ·ã€‚<p>è¿™ä¹Ÿé€‚ç”¨äºå‡½æ•°çš„åœºæ™¯ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">createOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl<span class="token punctuation">,</span>
        <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">createOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>ä½ å¯ä»¥ç¼–å†™è‡ªå·±çš„å‡½æ•°æ¥ç»„ç»‡ Effect ä¸­çš„é€»è¾‘ã€‚åªè¦å°†è¿™äº›å‡½æ•°å£°æ˜åœ¨ Effect <strong>å†…éƒ¨</strong>ï¼Œå®ƒä»¬å°±ä¸æ˜¯å“åº”å¼å€¼ï¼Œå› æ­¤å®ƒä»¬ä¹Ÿä¸æ˜¯ Effect çš„ä¾èµ–ã€‚</section><section class="level4"aria-labelledby="ä»å¯¹è±¡ä¸­è¯»å–åŸå§‹å€¼-read-primitive-values-from-objects"><h4 id="ä»å¯¹è±¡ä¸­è¯»å–åŸå§‹å€¼-read-primitive-values-from-objects">ä»å¯¹è±¡ä¸­è¯»å–åŸå§‹å€¼ {/<em>read-primitive-values-from-objects</em>/}</h4><p>æœ‰æ—¶ï¼Œä½ å¯èƒ½ä¼šé€šè¿‡ props æ¥æ”¶åˆ°ç±»å‹ä¸ºå¯¹è±¡çš„å€¼ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> options <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>è¿™é‡Œçš„é£é™©æ˜¯çˆ¶ç»„ä»¶ä¼šåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­åˆ›å»ºå¯¹è±¡ï¼š<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
  roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
  options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
    <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl<span class="token punctuation">,</span>
    <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">></span></code></pre><p>è¿™å°†å¯¼è‡´ Effect åœ¨æ¯æ¬¡çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶é‡æ–°è¿æ¥ã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·ä» Effect <strong>å¤–éƒ¨</strong> è¯»å–å¯¹è±¡ä¿¡æ¯ï¼Œå¹¶é¿å…ä¾èµ–å¯¹è±¡å’Œå‡½æ•°ç±»å‹ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> options <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> serverUrl <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId<span class="token punctuation">,</span>
      <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> serverUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>é€»è¾‘æœ‰ç‚¹é‡å¤ï¼ˆä½ ä» Effect å¤–éƒ¨çš„å¯¹è±¡è¯»å–ä¸€äº›å€¼ï¼Œç„¶ååœ¨ Effect å†…éƒ¨åˆ›å»ºå…·æœ‰ç›¸åŒå€¼çš„å¯¹è±¡ï¼‰ã€‚ä½†è¿™ä½¿å¾— Effect <strong>å®é™…</strong> ä¾èµ–çš„ä¿¡æ¯éå¸¸æ˜ç¡®ã€‚å¦‚æœå¯¹è±¡è¢«çˆ¶ç»„ä»¶æ— æ„ä¸­é‡æ–°åˆ›å»ºï¼ŒèŠå¤©ä¹Ÿä¸ä¼šé‡æ–°è¿æ¥ã€‚ä½†æ˜¯ï¼Œå¦‚æœ <code>options.roomId</code> æˆ– <code>options.serverUrl</code> ç¡®å®ä¸åŒï¼ŒèŠå¤©å°†é‡æ–°è¿æ¥ã€‚</section><section class="level4"aria-labelledby="ä»å‡½æ•°ä¸­è®¡ç®—åŸå§‹å€¼-calculate-primitive-values-from-functions"><h4 id="ä»å‡½æ•°ä¸­è®¡ç®—åŸå§‹å€¼-calculate-primitive-values-from-functions">ä»å‡½æ•°ä¸­è®¡ç®—åŸå§‹å€¼ {/<em>calculate-primitive-values-from-functions</em>/}</h4><p>åŒæ ·çš„æ–¹æ³•ä¹Ÿé€‚ç”¨äºå‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå‡è®¾çˆ¶ç»„ä»¶ä¼ é€’äº†ä¸€ä¸ªå‡½æ•°ï¼š<pre class="language-js"><code class="language-js"><span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
  roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
  getOptions<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl<span class="token punctuation">,</span>
      <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">></span></code></pre><p>ä¸ºé¿å…ä½¿å…¶æˆä¸ºä¾èµ–ï¼ˆå¹¶å¯¼è‡´å®ƒåœ¨é‡æ–°æ¸²æŸ“æ—¶é‡æ–°è¿æ¥ï¼‰ï¼Œè¯·åœ¨ Effect å¤–éƒ¨è°ƒç”¨å®ƒã€‚è¿™ä¸ºä½ æä¾›äº†ä¸æ˜¯å¯¹è±¡çš„ <code>roomId</code> å’Œ <code>serverUrl</code> å€¼ï¼Œä½ å¯ä»¥ä» Effect ä¸­è¯»å–å®ƒä»¬ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> getOptions <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> serverUrl <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId<span class="token punctuation">,</span>
      <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> serverUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span>
  <span class="token comment">// ...</span></code></pre><p>è¿™ä»…é€‚ç”¨äº <a href="/learn/keeping-components-pure">çº¯</a> å‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬åœ¨æ¸²æŸ“æœŸé—´å¯ä»¥å®‰å…¨è°ƒç”¨ã€‚å¦‚æœå‡½æ•°æ˜¯ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œä½†ä½ ä¸å¸Œæœ›å®ƒçš„æ›´æ”¹é‡æ–°åŒæ­¥ Effectï¼Œ<a href="#do-you-want-to-read-a-value-without-reacting-to-its-changes">å°†å®ƒåŒ…è£…åˆ° Effect Event ä¸­</a>ã€‚</p><recap><ul><li>ä¾èµ–åº”å§‹ç»ˆä¸ä»£ç åŒ¹é…ã€‚<li>å½“ä½ å¯¹ä¾èµ–ä¸æ»¡æ„æ—¶ï¼Œä½ éœ€è¦ç¼–è¾‘çš„æ˜¯ä»£ç ã€‚<li>æŠ‘åˆ¶ linter ä¼šå¯¼è‡´éå¸¸æ··ä¹±çš„é”™è¯¯ï¼Œä½ åº”è¯¥å§‹ç»ˆé¿å…å®ƒã€‚<li>è¦ç§»é™¤ä¾èµ–ï¼Œä½ éœ€è¦å‘ linter â€œè¯æ˜â€å®ƒä¸æ˜¯å¿…éœ€çš„ã€‚<li>å¦‚æœæŸäº›ä»£ç æ˜¯ä¸ºäº†å“åº”ç‰¹å®šäº¤äº’ï¼Œè¯·å°†è¯¥ä»£ç ç§»è‡³äº‹ä»¶å¤„ç†çš„åœ°æ–¹ã€‚<li>å¦‚æœ Effect çš„ä¸åŒéƒ¨åˆ†å› ä¸åŒåŸå› éœ€è¦é‡æ–°è¿è¡Œï¼Œè¯·å°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ª Effectã€‚<li>å¦‚æœä½ æƒ³æ ¹æ®ä»¥å‰çš„çŠ¶æ€æ›´æ–°ä¸€äº›çŠ¶æ€ï¼Œä¼ é€’ä¸€ä¸ªæ›´æ–°å‡½æ•°ã€‚<li>å¦‚æœä½ æƒ³è¯»å–æœ€æ–°å€¼è€Œä¸â€œååº”â€å®ƒï¼Œè¯·ä» Effect ä¸­æå–å‡ºä¸€ä¸ª Effect Eventã€‚<li>åœ¨ JavaScript ä¸­ï¼Œå¦‚æœå¯¹è±¡å’Œå‡½æ•°æ˜¯åœ¨ä¸åŒæ—¶é—´åˆ›å»ºçš„ï¼Œåˆ™å®ƒä»¬è¢«è®¤ä¸ºæ˜¯ä¸åŒçš„ã€‚<li>å°½é‡é¿å…å¯¹è±¡å’Œå‡½æ•°ä¾èµ–ã€‚å°†å®ƒä»¬ç§»åˆ°ç»„ä»¶å¤–æˆ– Effect å†…ã€‚</ul></recap><challenges></challenges></section><section class="level4"aria-labelledby="ä¿®å¤é‡ç½®-interval-fix-a-resetting-interval"><h4 id="ä¿®å¤é‡ç½®-interval-fix-a-resetting-interval">ä¿®å¤é‡ç½® interval {/<em>fix-a-resetting-interval</em>/}</h4><p>è¿™ä¸ª Effect è®¾ç½®äº†ä¸€ä¸ªæ¯ç§’è¿è¡Œçš„ intervalã€‚ä½ å·²ç»æ³¨æ„åˆ°ä¸€äº›å¥‡æ€ªçš„äº‹æƒ…ï¼šä¼¼ä¹æ¯æ¬¡ interval éƒ½ä¼šè¢«é”€æ¯å¹¶é‡æ–°åˆ›å»ºã€‚ä¿®å¤ä»£ç ï¼Œä½¿ interval ä¸ä¼šè¢«ä¸æ–­é‡æ–°åˆ›å»ºã€‚<hint></hint><p>çœ‹èµ·æ¥è¿™ä¸ª Effect çš„ä»£ç ä¾èµ–äº <code>count</code>ã€‚æœ‰ä»€ä¹ˆæ–¹æ³•ä¸éœ€è¦è¿™ä¾èµ–å—ï¼Ÿæœ‰ï¼Œé‚£å°±æ˜¯æ ¹æ®å…¶ä¹‹å‰çš„å€¼æ›´æ–° <code>count</code> stateï¼Œä»è€Œé¿å…æ·»åŠ å¯¹è¯¥å€¼çš„ä¾èµ–ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Timer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… åˆ›å»ºå®šæ—¶å™¨'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'â° Interval'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ¸…é™¤å®šæ—¶å™¨'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>è®¡æ•°å™¨<span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span></code></pre></sandpack><solution><p>ä½ æƒ³è¦ä» Effect å†…éƒ¨å°† <code>count</code> çŠ¶æ€æ›´æ–°ä¸º <code>count + 1</code>ã€‚ä½†æ˜¯ï¼Œè¿™ä¼šä½¿ Effect ä¾èµ–äº <code>count</code>ï¼Œå®ƒä¼šéšç€æ¯æ¬¡æ»´ç­”è€Œå˜åŒ–ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ interval ä¼šåœ¨æ¯æ¬¡æ»´ç­”æ—¶é‡æ–°åˆ›å»ºã€‚<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯·ä½¿ç”¨ <a href="/reference/react/useState#updating-state-based-on-the-previous-state">æ›´æ–°å‡½æ•°</a> å¹¶ç¼–å†™ <code>setCount(c => c + 1)</code> è€Œä¸æ˜¯ <code>setCount(count + 1)</code>:</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Timer</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… åˆ›å»ºå®šæ—¶å™¨'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'â° Interval'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ¸…é™¤å®šæ—¶å™¨'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>è®¡æ•°å™¨<span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span></code></pre></sandpack><p>ä½ ä¸åº”åœ¨ Effect ä¸­è¯»å– <code>count</code>ï¼Œè€Œæ˜¯å°† <code>c => c + 1</code> æŒ‡ä»¤ï¼ˆâ€œå¢åŠ æ­¤æ•°å­—ï¼â€ï¼‰ä¼ é€’ç»™ Reactã€‚React å°†åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œå®ƒã€‚ç”±äºä½ ä¸å†éœ€è¦è¯»å– Effect ä¸­ <code>count</code> çš„å€¼ï¼Œå› æ­¤ä½ å¯ä»¥å°† Effect çš„ä¾èµ–ä¿æŒä¸ºç©ºï¼ˆ<code>[]</code>ï¼‰ã€‚è¿™å¯ä»¥é˜²æ­¢ Effect åœ¨æ¯æ¬¡æ‰§è¡Œæ—¶é‡æ–°åˆ›å»ºå®šæ—¶å™¨ intervalã€‚</p></solution></section><section class="level4"aria-labelledby="ä¿®å¤é‡æ–°è§¦å‘åŠ¨ç”»çš„é—®é¢˜-fix-a-retriggering-animation"><h4 id="ä¿®å¤é‡æ–°è§¦å‘åŠ¨ç”»çš„é—®é¢˜-fix-a-retriggering-animation">ä¿®å¤é‡æ–°è§¦å‘åŠ¨ç”»çš„é—®é¢˜ {/<em>fix-a-retriggering-animation</em>/}</h4><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå½“ä½ æŒ‰ä¸‹â€œæ˜¾ç¤ºâ€æ—¶ï¼Œæ¬¢è¿æ¶ˆæ¯æ·¡å…¥ã€‚åŠ¨ç”»æŒç»­ä¸€ç§’é’Ÿã€‚å½“ä½ æŒ‰ä¸‹â€œç§»é™¤â€æ—¶ï¼Œæ¬¢è¿ä¿¡æ¯ç«‹å³æ¶ˆå¤±ã€‚æ·¡å…¥åŠ¨ç”»çš„é€»è¾‘åœ¨ <code>animation.js</code> æ–‡ä»¶ä¸­ä»¥çº¯ JavaScript <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/window/requestAnimationFrame">åŠ¨ç”»å¾ªç¯</a> å®ç°ã€‚ä½ ä¸éœ€è¦æ”¹å˜é‚£ä¸ªé€»è¾‘ã€‚ä½ å¯ä»¥å°†å…¶è§†ä¸ºç¬¬ä¸‰æ–¹åº“ã€‚Effect çš„é€»è¾‘æ˜¯ä¸º DOM èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ª <code>FadeInAnimation</code> å®ä¾‹ï¼Œç„¶åè°ƒç”¨ <code>start(duration)</code> æˆ– <code>stop()</code> æ¥æ§åˆ¶åŠ¨ç”»ã€‚<code>duration</code> ç”±æ»‘å—æ§åˆ¶ã€‚è°ƒæ•´æ»‘å—å¹¶æŸ¥çœ‹åŠ¨ç”»å¦‚ä½•å˜åŒ–ã€‚<p>æ­¤ä»£ç å·²ç»èƒ½å·¥ä½œï¼Œä½†ä½ éœ€è¦æ›´æ”¹ä¸€äº›å†…å®¹ã€‚ç›®å‰ï¼Œå½“ä½ ç§»åŠ¨æ§åˆ¶ <code>duration</code> çŠ¶æ€å˜é‡çš„æ»‘å—æ—¶ï¼Œå®ƒä¼šé‡æ–°è§¦å‘åŠ¨ç”»ã€‚æ›´æ”¹è¡Œä¸ºï¼Œä½¿ Effect ä¸ä¼šå¯¹ <code>duration</code> å˜é‡åšå‡ºâ€œååº”â€ã€‚å½“ä½ æŒ‰ä¸‹â€œæ˜¾ç¤ºâ€æ—¶ï¼ŒEffect åº”è¯¥ä½¿ç”¨æ»‘å—ä¸Šçš„å½“å‰ <code>duration</code> å€¼ã€‚ä½†æ˜¯ï¼Œç§»åŠ¨æ»‘å—æœ¬èº«ä¸åº”é‡æ–°è§¦å‘åŠ¨ç”»ã€‚</p><hint><p>Effect ä¸­æ˜¯å¦æœ‰ä¸€è¡Œä»£ç ä¸åº”è¯¥æ˜¯å“åº”å¼çš„ï¼Ÿå¦‚ä½•å°†éå“åº”å¼ä»£ç ç§»å‡º Effectï¼Ÿ</p></hint><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">FadeInAnimation</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./animation.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Welcome</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> duration <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> animation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FadeInAnimation</span><span class="token punctuation">(</span>ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    animation<span class="token punctuation">.</span><span class="token method function property-access">start</span><span class="token punctuation">(</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      animation<span class="token punctuation">.</span><span class="token method function property-access">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>duration<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1
      ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span>
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
        <span class="token literal-property property">textAlign</span><span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
        <span class="token literal-property property">backgroundImage</span><span class="token operator">:</span> <span class="token string">'radial-gradient(circle, rgba(63,94,251,1) 0%, rgba(252,70,107,1) 100%)'</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      æ¬¢è¿
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>duration<span class="token punctuation">,</span> setDuration<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>show<span class="token punctuation">,</span> setShow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"range"</span>
          min<span class="token operator">=</span><span class="token string">"100"</span>
          max<span class="token operator">=</span><span class="token string">"3000"</span>
          value<span class="token operator">=</span><span class="token punctuation">{</span>duration<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setDuration</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Number</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
        æ·¡å…¥ interval<span class="token operator">:</span> <span class="token punctuation">{</span>duration<span class="token punctuation">}</span> ms
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setShow</span><span class="token punctuation">(</span><span class="token operator">!</span>show<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>show <span class="token operator">?</span> <span class="token string">'ç§»é™¤'</span> <span class="token operator">:</span> <span class="token string">'æ˜¾ç¤º'</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>show <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Welcome</span> duration<span class="token operator">=</span><span class="token punctuation">{</span>duration<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name">FadeInAnimation</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">node</span> <span class="token operator">=</span> node<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter">duration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">duration</span> <span class="token operator">=</span> duration<span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">duration</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Jump to end immediately</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onProgress</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onProgress</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Start animating</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">startTime</span> <span class="token operator">=</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">frameId</span> <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">onFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> timePassed <span class="token operator">=</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">startTime</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> progress <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">min</span><span class="token punctuation">(</span>timePassed <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">duration</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onProgress</span><span class="token punctuation">(</span>progress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>progress <span class="token operator">&#x3C;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// We still have more frames to paint</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">frameId</span> <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">onProgress</span><span class="token punctuation">(</span><span class="token parameter">progress</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">opacity</span> <span class="token operator">=</span> progress<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">frameId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">startTime</span> <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">frameId</span> <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">duration</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label<span class="token punctuation">,</span> button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">html<span class="token punctuation">,</span> body</span> <span class="token punctuation">{</span> <span class="token property">min-height</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>Effect éœ€è¦è¯»å– <code>duration</code> çš„æœ€æ–°å€¼ï¼Œä½†ä½ ä¸å¸Œæœ›å®ƒå¯¹ <code>duration</code> çš„å˜åŒ–åšå‡ºâ€œååº”â€ã€‚ä½ ä½¿ç”¨ <code>duration</code> æ¥å¯åŠ¨åŠ¨ç”»ï¼Œä½†å¯åŠ¨åŠ¨ç”»ä¸æ˜¯å“åº”å¼çš„ã€‚å°†éå“åº”å¼ä»£ç è¡Œæå–åˆ° Effect Event ä¸­ï¼Œå¹¶ä» Effect ä¸­è°ƒç”¨è¯¥å‡½æ•°ã€‚</p><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">FadeInAnimation</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./animation.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Welcome</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> duration <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> onAppear <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token parameter">animation</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    animation<span class="token punctuation">.</span><span class="token method function property-access">start</span><span class="token punctuation">(</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> animation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FadeInAnimation</span><span class="token punctuation">(</span>ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onAppear</span><span class="token punctuation">(</span>animation<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      animation<span class="token punctuation">.</span><span class="token method function property-access">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>h1
      ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span>
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
        <span class="token literal-property property">textAlign</span><span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
        <span class="token literal-property property">backgroundImage</span><span class="token operator">:</span> <span class="token string">'radial-gradient(circle, rgba(63,94,251,1) 0%, rgba(252,70,107,1) 100%)'</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      æ¬¢è¿
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>duration<span class="token punctuation">,</span> setDuration<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>show<span class="token punctuation">,</span> setShow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"range"</span>
          min<span class="token operator">=</span><span class="token string">"100"</span>
          max<span class="token operator">=</span><span class="token string">"3000"</span>
          value<span class="token operator">=</span><span class="token punctuation">{</span>duration<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setDuration</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Number</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>br <span class="token operator">/</span><span class="token operator">></span>
        æ·¡å…¥ interval<span class="token operator">:</span> <span class="token punctuation">{</span>duration<span class="token punctuation">}</span> ms
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setShow</span><span class="token punctuation">(</span><span class="token operator">!</span>show<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>show <span class="token operator">?</span> <span class="token string">'ç§»é™¤'</span> <span class="token operator">:</span> <span class="token string">'æ˜¾ç¤º'</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>show <span class="token operator">&#x26;&#x26;</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Welcome</span> duration<span class="token operator">=</span><span class="token punctuation">{</span>duration<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name">FadeInAnimation</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">node</span> <span class="token operator">=</span> node<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter">duration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">duration</span> <span class="token operator">=</span> duration<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onProgress</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">startTime</span> <span class="token operator">=</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">frameId</span> <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">onFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> timePassed <span class="token operator">=</span> <span class="token dom variable">performance</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">startTime</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> progress <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">min</span><span class="token punctuation">(</span>timePassed <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">duration</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onProgress</span><span class="token punctuation">(</span>progress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>progress <span class="token operator">&#x3C;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// We still have more frames to paint</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">frameId</span> <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">onProgress</span><span class="token punctuation">(</span><span class="token parameter">progress</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">opacity</span> <span class="token operator">=</span> progress<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">frameId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">startTime</span> <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">frameId</span> <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">duration</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label<span class="token punctuation">,</span> button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">html<span class="token punctuation">,</span> body</span> <span class="token punctuation">{</span> <span class="token property">min-height</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>åƒ <code>onAppear</code> è¿™æ ·çš„ Effect Events ä¸æ˜¯å“åº”å¼çš„ï¼Œå› æ­¤ä½ å¯ä»¥åœ¨ä¸é‡æ–°è§¦å‘åŠ¨ç”»çš„æƒ…å†µä¸‹è¯»å–å†…éƒ¨çš„ <code>duration</code>ã€‚</p></solution></section><section class="level4"aria-labelledby="ä¿®å¤èŠå¤©é‡æ–°è¿æ¥çš„é—®é¢˜-fix-a-reconnecting-chat"><h4 id="ä¿®å¤èŠå¤©é‡æ–°è¿æ¥çš„é—®é¢˜-fix-a-reconnecting-chat">ä¿®å¤èŠå¤©é‡æ–°è¿æ¥çš„é—®é¢˜ {/<em>fix-a-reconnecting-chat</em>/}</h4><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ¯æ¬¡ä½ æŒ‰â€œåˆ‡æ¢ä¸»é¢˜â€æ—¶ï¼ŒèŠå¤©éƒ½ä¼šé‡æ–°è¿æ¥ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿä¿®å¤é”™è¯¯ï¼Œåªæœ‰å½“ä½ ç¼–è¾‘æœåŠ¡å™¨ URL æˆ–é€‰æ‹©ä¸åŒçš„èŠå¤©å®¤æ—¶ï¼ŒèŠå¤©æ‰ä¼šé‡æ–°è¿æ¥ã€‚<p>å°† <code>chat.js</code> è§†ä¸ºå¤–éƒ¨ç¬¬ä¸‰æ–¹åº“ï¼šä½ å¯ä»¥æŸ¥é˜…å®ƒä»¥æ£€æŸ¥å…¶ APIï¼Œä½†ä¸è¦å¯¹å…¶è¿›è¡Œç¼–è¾‘ã€‚</p><hint><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ä¸æ­¢ä¸€ç§ï¼Œä½†æœ€ç»ˆä½ å¸Œæœ›é¿å…å°†å¯¹è±¡ä½œä¸ºä¾èµ–ã€‚</p></hint><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ChatRoom</span></span> <span class="token keyword module">from</span> <span class="token string">'./ChatRoom.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isDark<span class="token punctuation">,</span> setIsDark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>serverUrl<span class="token punctuation">,</span> setServerUrl<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'https://localhost:1234'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl<span class="token punctuation">,</span>
    <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsDark</span><span class="token punctuation">(</span><span class="token operator">!</span>isDark<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        åˆ‡æ¢ä¸»é¢˜
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        æœåŠ¡å™¨åœ°å€ï¼š
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>serverUrl<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setServerUrl</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ‰€æœ‰"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ—…æ¸¸"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"éŸ³ä¹"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> options<span class="token operator">=</span><span class="token punctuation">{</span>options<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> options <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>options<span class="token punctuation">.</span><span class="token property-access">roomId</span><span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> serverUrl<span class="token punctuation">,</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> serverUrl <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› serverUrl æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> roomId <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› roomId æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ°â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label<span class="token punctuation">,</span> button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.dark</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#eee</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>Effect å› ä¾èµ–äº <code>options</code> å¯¹è±¡ï¼Œå¯¼è‡´å…¶é‡æ–°è¿è¡Œã€‚å¯¹è±¡å¯èƒ½ä¼šåœ¨æ— æ„ä¸­è¢«é‡æ–°åˆ›å»ºï¼Œä½ åº”è¯¥å°½å¯èƒ½é¿å…å°†å®ƒä»¬ä½œä¸º Effect çš„ä¾èµ–ã€‚<p>ä¾µå…¥æ€§æœ€å°çš„ä¿®å¤æ–¹æ³•æ˜¯åœ¨ Effect å¤–éƒ¨è¯»å– <code>roomId</code> å’Œ <code>serverUrl</code>ï¼Œç„¶åä½¿ Effect ä¾èµ–äºè¿™äº›åŸå§‹å€¼ï¼ˆä¸èƒ½æ— æ„åœ°æ›´æ”¹ï¼‰ã€‚åœ¨ Effect å†…éƒ¨ï¼Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶å°†å…¶ä¼ é€’ç»™ <code>createConnection</code>ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ChatRoom</span></span> <span class="token keyword module">from</span> <span class="token string">'./ChatRoom.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isDark<span class="token punctuation">,</span> setIsDark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>serverUrl<span class="token punctuation">,</span> setServerUrl<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'https://localhost:1234'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl<span class="token punctuation">,</span>
    <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsDark</span><span class="token punctuation">(</span><span class="token operator">!</span>isDark<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        åˆ‡æ¢ä¸»é¢˜
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        æœåŠ¡å™¨åœ°å€ï¼š
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>serverUrl<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setServerUrl</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ‰€æœ‰"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ—…æ¸¸"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"éŸ³ä¹"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> options<span class="token operator">=</span><span class="token punctuation">{</span>options<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> options <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> serverUrl <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId<span class="token punctuation">,</span>
      <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> serverUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>options<span class="token punctuation">.</span><span class="token property-access">roomId</span><span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> serverUrl<span class="token punctuation">,</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> serverUrl <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› serverUrl æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> roomId <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› roomId æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ°â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label<span class="token punctuation">,</span> button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.dark</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#eee</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>ç”¨æ›´å…·ä½“çš„ <code>roomId</code> å’Œ <code>serverUrl</code> props æ›¿æ¢å¯¹è±¡ <code>options</code> props ä¼šæ›´å¥½ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ChatRoom</span></span> <span class="token keyword module">from</span> <span class="token string">'./ChatRoom.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isDark<span class="token punctuation">,</span> setIsDark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>serverUrl<span class="token punctuation">,</span> setServerUrl<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'https://localhost:1234'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsDark</span><span class="token punctuation">(</span><span class="token operator">!</span>isDark<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        åˆ‡æ¢ä¸»é¢˜
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        æœåŠ¡å™¨åœ°å€ï¼š
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>serverUrl<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setServerUrl</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ‰€æœ‰"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ—…æ¸¸"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"éŸ³ä¹"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
        roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
        serverUrl<span class="token operator">=</span><span class="token punctuation">{</span>serverUrl<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> serverUrl <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId<span class="token punctuation">,</span>
      <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> serverUrl<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> serverUrl<span class="token punctuation">,</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> serverUrl <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› serverUrl æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> roomId <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› roomId æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ°â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼Œåœ¨ '</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label<span class="token punctuation">,</span> button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.dark</span></span> <span class="token punctuation">{</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#222</span><span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#eee</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>å°½å¯èƒ½åšæŒä½¿ç”¨åŸå§‹ propsï¼Œä»¥ä¾¿ä»¥åæ›´å®¹æ˜“ä¼˜åŒ–ç»„ä»¶ã€‚</p></solution></section><section class="level4"aria-labelledby="å†æ¬¡ä¿®å¤èŠå¤©é‡æ–°è¿æ¥çš„é—®é¢˜-fix-a-reconnecting-chat-again"><h4 id="å†æ¬¡ä¿®å¤èŠå¤©é‡æ–°è¿æ¥çš„é—®é¢˜-fix-a-reconnecting-chat-again">å†æ¬¡ä¿®å¤èŠå¤©é‡æ–°è¿æ¥çš„é—®é¢˜ {/<em>fix-a-reconnecting-chat-again</em>/}</h4><p>æ­¤ç¤ºä¾‹ä½¿ç”¨æˆ–ä¸ä½¿ç”¨åŠ å¯†è¿æ¥åˆ°èŠå¤©ã€‚åˆ‡æ¢å¤é€‰æ¡†å¹¶æ³¨æ„åŠ å¯†æ‰“å¼€å’Œå…³é—­æ—¶æ§åˆ¶å°ä¸­çš„ä¸åŒæ¶ˆæ¯ã€‚æ¢ä¸ªæˆ¿é—´è¯•è¯•ï¼Œç„¶åï¼Œå°è¯•åˆ‡æ¢ä¸»é¢˜ã€‚å½“ä½ è¿æ¥åˆ°èŠå¤©å®¤æ—¶ï¼Œæ¯éš”å‡ ç§’é’Ÿå°±ä¼šæ”¶åˆ°ä¸€æ¡æ–°æ¶ˆæ¯ã€‚éªŒè¯å®ƒä»¬çš„é¢œè‰²æ˜¯å¦ä¸ä½ é€‰æ‹©çš„ä¸»é¢˜ç›¸åŒ¹é…ã€‚<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ¯æ¬¡ä½ å°è¯•æ›´æ”¹ä¸»é¢˜æ—¶èŠå¤©éƒ½ä¼šé‡æ–°è¿æ¥ã€‚è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¿®å¤åï¼Œæ›´æ”¹ä¸»é¢˜ä¸åº”é‡æ–°è¿æ¥èŠå¤©ï¼Œä½†åˆ‡æ¢åŠ å¯†è®¾ç½®æˆ–æ›´æ”¹æˆ¿é—´åº”é‡æ–°è¿æ¥ã€‚<p>ä¸è¦æ›´æ”¹ <code>chat.js</code> ä¸­çš„ä»»ä½•ä»£ç ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ å¯ä»¥æ›´æ”¹ä»»ä½•ä»£ç ï¼Œåªè¦å®ƒå¼•èµ·ç›¸åŒçš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½ä¼šå‘ç°æ›´æ”¹æ­£åœ¨ä¼ é€’çš„ props å¾ˆæœ‰å¸®åŠ©ã€‚</p><hint><p>ä½ ä¼ é€’äº†ä¸¤ä¸ªå‡½æ•°ï¼š<code>onMessage</code> å’Œ <code>createConnection</code>ã€‚æ¯æ¬¡ <code>App</code> é‡æ–°æ¸²æŸ“æ—¶ï¼Œå®ƒä»¬éƒ½æ˜¯ä»å¤´å¼€å§‹åˆ›å»ºçš„ã€‚å®ƒä»¬æ¯æ¬¡éƒ½è¢«è§†ä¸ºæ–°å€¼ï¼Œè¿™å°±æ˜¯å®ƒä»¬é‡æ–°è§¦å‘ Effect çš„åŸå› ã€‚<p>å‰è€…æ˜¯äº‹ä»¶å¤„ç†ç¨‹åºã€‚ä½ çŸ¥é“åœ¨ä¸å¯¹æ–°çš„äº‹ä»¶å¤„ç†å‡½æ•°â€œåšå‡ºååº”â€çš„æƒ…å†µä¸‹è°ƒç”¨äº‹ä»¶å¤„ç†ç¨‹åº Effect çš„æ–¹æ³•å—ï¼Ÿè¿™ä¸ªé—®é¢˜ä½ è¿Ÿæ—©è¦é‡åˆ°ï¼<p>åè€…ä»…ç”¨äºå°†æŸäº›çŠ¶æ€ä¼ é€’ç»™å¯¼å…¥çš„ API æ–¹æ³•ã€‚è¿™ä¸ªå‡½æ•°çœŸçš„æœ‰å¿…è¦å—ï¼Ÿä¼ é€’çš„åŸºæœ¬ä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Ÿä½ å¯èƒ½éœ€è¦å°†ä¸€äº›å¯¼å…¥ä» <code>App.js</code> ç§»è‡³ <code>ChatRoom.js</code>ã€‚</p></hint><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"toastify-js"</span><span class="token operator">:</span> <span class="token string">"1.12.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ChatRoom</span></span> <span class="token keyword module">from</span> <span class="token string">'./ChatRoom.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>
  createEncryptedConnection<span class="token punctuation">,</span>
  createUnencryptedConnection<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> showNotification <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./notifications.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isDark<span class="token punctuation">,</span> setIsDark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isEncrypted<span class="token punctuation">,</span> setIsEncrypted<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isDark<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setIsDark</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        ä½¿ç”¨æš—é»‘ä¸»é¢˜
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isEncrypted<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setIsEncrypted</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        å¼€å¯åŠ å¯†åŠŸèƒ½
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ‰€æœ‰"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ—…æ¸¸"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"éŸ³ä¹"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
        roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
        onMessage<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">msg</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'æ–°æ¶ˆæ¯ï¼š'</span> <span class="token operator">+</span> msg<span class="token punctuation">,</span> isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        createConnection<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isEncrypted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword control-flow">return</span> <span class="token function">createEncryptedConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
            <span class="token keyword control-flow">return</span> <span class="token function">createUnencryptedConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> createConnection<span class="token punctuation">,</span> onMessage <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>createConnection<span class="token punctuation">,</span> onMessage<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createEncryptedConnection</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> serverUrl<span class="token punctuation">,</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> serverUrl <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› serverUrl æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> roomId <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› roomId æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> intervalId<span class="token punctuation">;</span>
  <span class="token keyword">let</span> messageCallback<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… ğŸ” è¿æ¥åˆ°â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´...ï¼ˆå·²åŠ å¯†ï¼‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      intervalId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>messageCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">messageCallback</span><span class="token punctuation">(</span><span class="token string">'hey'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
            <span class="token function">messageCallback</span><span class="token punctuation">(</span><span class="token string">'lol'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      messageCallback <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ ğŸ” æ–­å¼€â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼ˆå·²åŠ å¯†ï¼‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>messageCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ä¸èƒ½æ·»åŠ  handler 2æ¬¡'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>event <span class="token operator">!==</span> <span class="token string">'message'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ä»…æ”¯æŒ "message" äº‹ä»¶'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      messageCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createUnencryptedConnection</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> serverUrl<span class="token punctuation">,</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> serverUrl <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› serverUrl æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> roomId <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› roomId æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> intervalId<span class="token punctuation">;</span>
  <span class="token keyword">let</span> messageCallback<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ°â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼ˆæœªåŠ å¯†ï¼‰...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      intervalId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>messageCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">messageCallback</span><span class="token punctuation">(</span><span class="token string">'hey'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
            <span class="token function">messageCallback</span><span class="token punctuation">(</span><span class="token string">'lol'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      messageCallback <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼ˆæœªåŠ å¯†ï¼‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>messageCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ä¸èƒ½æ·»åŠ  handler 2æ¬¡'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>event <span class="token operator">!==</span> <span class="token string">'message'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ä»…æ”¯æŒ "message" äº‹ä»¶'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      messageCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Toastify</span></span> <span class="token keyword module">from</span> <span class="token string">'toastify-js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'toastify-js/src/toastify.css'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> theme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function"><span class="token maybe-class-name">Toastify</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">gravity</span><span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'right'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">background</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'black'</span> <span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'white'</span> <span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">showToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label<span class="token punctuation">,</span> button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ­£ç¡®æ–¹æ³•ä¸æ­¢ä¸€ç§ï¼Œä¸‹é¢è¦ä»‹ç»çš„æ˜¯ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚<p>åœ¨åŸå§‹ç¤ºä¾‹ä¸­ï¼Œåˆ‡æ¢ä¸»é¢˜ä¼šå¯¼è‡´åˆ›å»ºå’Œä¼ é€’ä¸åŒçš„ <code>onMessage</code> å’Œ <code>createConnection</code> å‡½æ•°ã€‚ç”±äº Effect ä¾èµ–äºè¿™äº›åŠŸèƒ½ï¼Œå› æ­¤æ¯æ¬¡åˆ‡æ¢ä¸»é¢˜æ—¶èŠå¤©éƒ½ä¼šé‡æ–°è¿æ¥ã€‚<p>è¦è§£å†³ <code>onMessage</code> çš„é—®é¢˜ï¼Œä½ éœ€è¦å°†å…¶åŒ…è£…åˆ° Effect Event ä¸­ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> createConnection<span class="token punctuation">,</span> onMessage <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onReceiveMessage <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span>onMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onReceiveMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span></code></pre><p>ä¸ <code>onMessage</code> props ä¸åŒï¼Œ<code>onReceiveMessage</code> Effect Event ä¸æ˜¯å“åº”å¼çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸éœ€è¦æˆä¸º Effect çš„ä¾èµ–ã€‚å› æ­¤ï¼Œå¯¹ <code>onMessage</code> çš„æ›´æ”¹ä¸ä¼šå¯¼è‡´èŠå¤©é‡æ–°è¿æ¥ã€‚<p>ä½ ä¸èƒ½å¯¹ <code>createConnection</code> åšåŒæ ·çš„äº‹æƒ…ï¼Œå› ä¸ºå®ƒ <strong>åº”è¯¥</strong> æ˜¯å“åº”å¼çš„ã€‚å¦‚æœç”¨æˆ·åœ¨åŠ å¯†å’ŒæœªåŠ å¯†è¿æ¥ä¹‹é—´åˆ‡æ¢ï¼Œæˆ–è€…å¦‚æœç”¨æˆ·åˆ‡æ¢å½“å‰æˆ¿é—´ï¼Œä½  <strong>å¸Œæœ›</strong> é‡æ–°è§¦å‘ Effectã€‚ä½†æ˜¯ï¼Œå› ä¸º <code>createConnection</code> æ˜¯å‡½æ•°ï¼Œä½ æ— æ³•æ£€æŸ¥å®ƒè¯»å–çš„ä¿¡æ¯æ˜¯å¦ <strong>å®é™…</strong> å‘ç”Ÿäº†å˜åŒ–ã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·ä¼ é€’åŸå§‹çš„ <code>roomId</code> å’Œ <code>isEncrypted</code> å€¼ï¼Œè€Œä¸æ˜¯ä» App ç»„ä»¶å‘ä¸‹ä¼ é€’ <code>createConnection</code> ï¼š<pre class="language-js"><code class="language-js">      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
        roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
        isEncrypted<span class="token operator">=</span><span class="token punctuation">{</span>isEncrypted<span class="token punctuation">}</span>
        onMessage<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">msg</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'æ–°æ¶ˆæ¯ï¼š'</span> <span class="token operator">+</span> msg<span class="token punctuation">,</span> isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span></code></pre><p>ç°åœ¨ä½ å¯ä»¥å°† <code>createConnection</code> å‡½æ•°ç§»åˆ° Effect é‡Œé¢ï¼Œè€Œä¸æ˜¯ä» <code>App</code> å‘ä¸‹ä¼ é€’å®ƒï¼š<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>
  createEncryptedConnection<span class="token punctuation">,</span>
  createUnencryptedConnection<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> isEncrypted<span class="token punctuation">,</span> onMessage <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onReceiveMessage <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span>onMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isEncrypted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token function">createEncryptedConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token function">createUnencryptedConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span></code></pre><p>åœ¨è¿™ä¸¤ä¸ªæ›´æ”¹ä¹‹åï¼ŒEffect ä¸å†ä¾èµ–äºä»»ä½•å‡½æ•°å€¼ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> isEncrypted<span class="token punctuation">,</span> onMessage <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Reactive values</span>
  <span class="token keyword">const</span> onReceiveMessage <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span>onMessage<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Not reactive</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId <span class="token comment">// è¯»å–å“åº”å¼å€¼</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isEncrypted<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è¯»å–å“åº”å¼å€¼</span>
        <span class="token keyword control-flow">return</span> <span class="token function">createEncryptedConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token function">createUnencryptedConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onReceiveMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> isEncrypted<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span></code></pre><p>å› æ­¤ï¼Œä»…å½“æœ‰æ„ä¹‰çš„å†…å®¹ï¼ˆ<code>roomId</code> æˆ– <code>isEncrypted</code>ï¼‰å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒèŠå¤©æ‰ä¼šé‡æ–°è¿æ¥ï¼š</p><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"toastify-js"</span><span class="token operator">:</span> <span class="token string">"1.12.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ChatRoom</span></span> <span class="token keyword module">from</span> <span class="token string">'./ChatRoom.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> showNotification <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./notifications.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isDark<span class="token punctuation">,</span> setIsDark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isEncrypted<span class="token punctuation">,</span> setIsEncrypted<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isDark<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setIsDark</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        ä½¿ç”¨æš—é»‘ä¸»é¢˜
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isEncrypted<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setIsEncrypted</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        å¼€å¯åŠ å¯†åŠŸèƒ½
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ‰€æœ‰"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"æ—…æ¸¸"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"éŸ³ä¹"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
        roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
        isEncrypted<span class="token operator">=</span><span class="token punctuation">{</span>isEncrypted<span class="token punctuation">}</span>
        onMessage<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">msg</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'æ–°æ¶ˆæ¯ï¼š'</span> <span class="token operator">+</span> msg<span class="token punctuation">,</span> isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>
  createEncryptedConnection<span class="token punctuation">,</span>
  createUnencryptedConnection<span class="token punctuation">,</span>
<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> isEncrypted<span class="token punctuation">,</span> onMessage <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onReceiveMessage <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span>onMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isEncrypted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token function">createEncryptedConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token function">createUnencryptedConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onReceiveMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> isEncrypted<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createEncryptedConnection</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> serverUrl<span class="token punctuation">,</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> serverUrl <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› serverUrl æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> roomId <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› roomId æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> intervalId<span class="token punctuation">;</span>
  <span class="token keyword">let</span> messageCallback<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… ğŸ” è¿æ¥åˆ°â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´...ï¼ˆå·²åŠ å¯†ï¼‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      intervalId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>messageCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">messageCallback</span><span class="token punctuation">(</span><span class="token string">'hey'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
            <span class="token function">messageCallback</span><span class="token punctuation">(</span><span class="token string">'lol'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      messageCallback <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ ğŸ” æ–­å¼€â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼ˆå·²åŠ å¯†ï¼‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>messageCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ä¸èƒ½æ·»åŠ  handler 2æ¬¡'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>event <span class="token operator">!==</span> <span class="token string">'message'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ä»…æ”¯æŒ "message" äº‹ä»¶'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      messageCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createUnencryptedConnection</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> serverUrl<span class="token punctuation">,</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> serverUrl <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› serverUrl æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> roomId <span class="token operator">!==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æœŸæœ› roomId æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ”¶åˆ°ï¼š'</span> <span class="token operator">+</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> intervalId<span class="token punctuation">;</span>
  <span class="token keyword">let</span> messageCallback<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ°â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼ˆæœªåŠ å¯†ï¼‰...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      intervalId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>messageCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">messageCallback</span><span class="token punctuation">(</span><span class="token string">'hey'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
            <span class="token function">messageCallback</span><span class="token punctuation">(</span><span class="token string">'lol'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      messageCallback <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€â€œ'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'â€æˆ¿é—´ï¼ˆæœªåŠ å¯†ï¼‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>messageCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ä¸èƒ½æ·»åŠ  handler 2æ¬¡'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>event <span class="token operator">!==</span> <span class="token string">'message'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ä»…æ”¯æŒ "message" äº‹ä»¶'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      messageCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Toastify</span></span> <span class="token keyword module">from</span> <span class="token string">'toastify-js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'toastify-js/src/toastify.css'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> theme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function"><span class="token maybe-class-name">Toastify</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">gravity</span><span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'right'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">background</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'black'</span> <span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'white'</span> <span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">showToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label<span class="token punctuation">,</span> button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack></solution><p><strong>è¯‘æ³¨</strong>ï¼š <a name="note1"></a>åœ¨åˆ›å»º <code>onTick</code> å‡½æ•°æ—¶ï¼Œç”±äºé—­åŒ…çš„ç¼˜æ•…ï¼Œ<code>setCount(count + increment)</code> æ•è·çš„æ˜¯åˆ›å»ºæ—¶ <code>count</code> å’Œ <code>increment</code> å€¼ã€‚ç”±äºè¿™é‡Œçš„â€œè¯´è°â€ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶æ–°åˆ›å»ºçš„ <code>onTick</code> å‡½æ•°ä¸èƒ½æ›¿æ¢æ‰ Effect é‡Œæ—§ <code>onTick</code> å‡½æ•°ï¼Œäºæ˜¯æœ€ç»ˆçš„æ•ˆæœå°±æ˜¯ <code>setCount(0 + 1)</code><br><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section></section></section>