<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>è„±å›´æœºåˆ¶</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="è„±å›´æœºåˆ¶"><h1 id="è„±å›´æœºåˆ¶">è„±å›´æœºåˆ¶</h1><intro><p>æœ‰äº›ç»„ä»¶å¯èƒ½éœ€è¦æ§åˆ¶å’ŒåŒæ­¥ React ä¹‹å¤–çš„ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨æµè§ˆå™¨ API èšç„¦è¾“å…¥æ¡†ï¼Œæˆ–è€…åœ¨æ²¡æœ‰ React çš„æƒ…å†µä¸‹å®ç°è§†é¢‘æ’­æ”¾å™¨ï¼Œæˆ–è€…è¿æ¥å¹¶ç›‘å¬è¿œç¨‹æœåŠ¡å™¨çš„æ¶ˆæ¯ã€‚åœ¨æœ¬ç« ä¸­ï¼Œä½ å°†å­¦ä¹ åˆ°ä¸€äº›è„±å›´æœºåˆ¶ï¼Œè®©ä½ å¯ä»¥â€œèµ°å‡ºâ€ React å¹¶è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿã€‚å¤§å¤šæ•°åº”ç”¨é€»è¾‘å’Œæ•°æ®æµä¸åº”è¯¥ä¾èµ–è¿™äº›åŠŸèƒ½ã€‚</p></intro><youwilllearn ischapter="{true}"><ul><li><a href="/learn/referencing-values-with-refs">åœ¨ä¸é‡æ–°æ¸²æŸ“çš„æƒ…å†µä¸‹â€œè®°ä½â€ä¿¡æ¯</a><li><a href="/learn/manipulating-the-dom-with-refs">è®¿é—® React ç®¡ç†çš„ DOM å…ƒç´ </a><li><a href="/learn/synchronizing-with-effects">å°†ç»„ä»¶ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥</a><li><a href="/learn/you-might-not-need-an-effect">ä»ç»„ä»¶ä¸­åˆ é™¤ä¸å¿…è¦çš„ Effect</a><li><a href="/learn/lifecycle-of-reactive-effects">Effect çš„ç”Ÿå‘½å‘¨æœŸä¸ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæœ‰ä½•ä¸åŒ</a><li><a href="/learn/separating-events-from-effects">é˜²æ­¢æŸäº›å€¼é‡æ–°è§¦å‘ Effect</a><li><a href="/learn/removing-effect-dependencies">å‡å°‘ Effect é‡æ–°æ‰§è¡Œçš„é¢‘ç‡</a><li><a href="/learn/reusing-logic-with-custom-hooks">åœ¨ç»„ä»¶ä¹‹é—´å…±äº«é€»è¾‘</a></ul></youwilllearn><section class="level2"aria-labelledby="ä½¿ç”¨-ref-å¼•ç”¨å€¼-referencing-values-with-refs"><h2 id="ä½¿ç”¨-ref-å¼•ç”¨å€¼-referencing-values-with-refs">ä½¿ç”¨ ref å¼•ç”¨å€¼ {/<em>referencing-values-with-refs</em>/}</h2><p>å½“ä½ å¸Œæœ›ç»„ä»¶â€œè®°ä½â€æŸäº›ä¿¡æ¯ï¼Œä½†åˆä¸æƒ³è®©è¿™äº›ä¿¡æ¯ <a href="/learn/render-and-commit">è§¦å‘æ–°çš„æ¸²æŸ“</a> æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <strong>ref</strong>ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¸ state ä¸€æ ·ï¼Œref åœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´ç”± React ä¿ç•™ã€‚ä½†æ˜¯ï¼Œè®¾ç½® state ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ï¼Œè€Œæ›´æ”¹ ref ä¸ä¼šï¼ä½ å¯ä»¥é€šè¿‡ <code>ref.current</code> å±æ€§è®¿é—®è¯¥ ref çš„å½“å‰å€¼ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ref<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'ä½ ç‚¹å‡»äº† '</span> <span class="token operator">+</span> ref<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">+</span> <span class="token string">' æ¬¡!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span>
      ç‚¹æˆ‘ï¼
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><p>ref å°±åƒç»„ä»¶çš„ä¸€ä¸ªä¸è¢« React è¿½è¸ªçš„ç§˜å¯†å£è¢‹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ ref æ¥å­˜å‚¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout#return_value">timeout ID</a>ã€<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element">DOM å…ƒç´ </a> å’Œå…¶ä»–ä¸å½±å“ç»„ä»¶æ¸²æŸ“è¾“å‡ºçš„å¯¹è±¡ã€‚</p><learnmore path="/learn/referencing-values-with-refs"><p>é˜…è¯» <strong><a href="/learn/referencing-values-with-refs">ä½¿ç”¨ ref å¼•ç”¨å€¼</a></strong> ä»¥äº†è§£å¦‚ä½•ä½¿ç”¨ ref æ¥è®°ä½ä¿¡æ¯ã€‚</p></learnmore></section><section class="level2"aria-labelledby="ä½¿ç”¨-ref-æ“ä½œ-dom-manipulating-the-dom-with-refs"><h2 id="ä½¿ç”¨-ref-æ“ä½œ-dom-manipulating-the-dom-with-refs">ä½¿ç”¨ ref æ“ä½œ DOM {/<em>manipulating-the-dom-with-refs</em>/}</h2><p>ç”±äº React ä¼šè‡ªåŠ¨æ›´æ–° <a href="https://developer.mozilla.org/docs/Web/API/Document_Object_Model/Introduction">DOM</a> ä»¥åŒ¹é…æ¸²æŸ“è¾“å‡ºï¼Œå› æ­¤ç»„ä»¶é€šå¸¸ä¸éœ€è¦æ“ä½œ DOMã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å¯èƒ½éœ€è¦è®¿é—®ç”± React ç®¡ç†çš„ DOM å…ƒç´ â€”â€”ä¾‹å¦‚èšç„¦èŠ‚ç‚¹ã€æ»šåŠ¨åˆ°æ­¤èŠ‚ç‚¹ï¼Œä»¥åŠæµ‹é‡å®ƒçš„å°ºå¯¸å’Œä½ç½®ã€‚React æ²¡æœ‰å†…ç½®çš„æ–¹æ³•æ¥æ‰§è¡Œæ­¤ç±»æ“ä½œï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªæŒ‡å‘ DOM èŠ‚ç‚¹çš„ ref æ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œç‚¹å‡»æŒ‰é’®å°†ä½¿ç”¨ ref èšç„¦è¾“å…¥æ¡†ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useRef <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    inputRef<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span>
        èšç„¦è¾“å…¥æ¡†
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><learnmore path="/learn/manipulating-the-dom-with-refs"><p>é˜…è¯» <strong><a href="/learn/manipulating-the-dom-with-refs">ä½¿ç”¨ ref æ“ä½œ DOM</a></strong> ä»¥äº†è§£å¦‚ä½•è®¿é—® React ç®¡ç†çš„ DOM å…ƒç´ ã€‚</p></learnmore></section><section class="level2"aria-labelledby="ä½¿ç”¨-effect-è¿›è¡ŒåŒæ­¥-synchronizing-with-effects"><h2 id="ä½¿ç”¨-effect-è¿›è¡ŒåŒæ­¥-synchronizing-with-effects">ä½¿ç”¨ Effect è¿›è¡ŒåŒæ­¥ {/<em>synchronizing-with-effects</em>/}</h2><p>æœ‰äº›ç»„ä»¶éœ€è¦ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½éœ€è¦æ ¹æ® React çŠ¶æ€æ§åˆ¶é React ç»„ä»¶ã€è®¾ç½®æœåŠ¡å™¨è¿æ¥æˆ–åœ¨ç»„ä»¶å‡ºç°åœ¨å±å¹•ä¸Šæ—¶å‘é€åˆ†ææ—¥å¿—ã€‚ä¸å¤„ç†ç‰¹å®šäº‹ä»¶çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸åŒï¼Œ<strong>Effect</strong> åœ¨æ¸²æŸ“åè¿è¡Œä¸€äº›ä»£ç ã€‚ä½¿ç”¨å®ƒå°†ç»„ä»¶ä¸ React ä¹‹å¤–çš„ç³»ç»ŸåŒæ­¥ã€‚<p>å¤šæŒ‰å‡ æ¬¡æ’­æ”¾/æš‚åœï¼Œè§‚å¯Ÿè§†é¢‘æ’­æ”¾å™¨å¦‚ä½•ä¸ <code>isPlaying</code> å±æ€§å€¼ä¿æŒåŒæ­¥ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">VideoPlayer</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> src<span class="token punctuation">,</span> isPlaying <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isPlaying<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      ref<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>isPlaying<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>video ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> src<span class="token operator">=</span><span class="token punctuation">{</span>src<span class="token punctuation">}</span> loop playsInline <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPlaying<span class="token punctuation">,</span> setIsPlaying<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsPlaying</span><span class="token punctuation">(</span><span class="token operator">!</span>isPlaying<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token punctuation">{</span>isPlaying <span class="token operator">?</span> <span class="token string">'æš‚åœ'</span> <span class="token operator">:</span> <span class="token string">'æ’­æ”¾'</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">VideoPlayer</span>
        isPlaying<span class="token operator">=</span><span class="token punctuation">{</span>isPlaying<span class="token punctuation">}</span>
        src<span class="token operator">=</span><span class="token string">"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">video</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">250</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>è®¸å¤š Effect ä¹Ÿä¼šè‡ªè¡Œâ€œæ¸…ç†â€ã€‚ä¾‹å¦‚ï¼Œä¸èŠå¤©æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„ Effect åº”è¯¥è¿”å›ä¸€ä¸ª <strong>cleanup å‡½æ•°</strong>ï¼Œå‘Šè¯‰ React å¦‚ä½•æ–­å¼€ç»„ä»¶ä¸è¯¥æœåŠ¡å™¨çš„è¿æ¥ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿å‰æ¥èŠå¤©ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥ä¸­...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€è¿æ¥ã€‚'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒReact å°†ç«‹å³è¿è¡Œå¹¶é¢å¤–æ¸…ç†ä¸€æ¬¡ Effectã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ä¼šçœ‹åˆ° <code>"âœ… è¿æ¥ä¸­..."</code> æ‰“å°äº†ä¸¤æ¬¡ã€‚è¿™èƒ½å¤Ÿç¡®ä¿ä½ ä¸ä¼šå¿˜è®°å®ç°æ¸…ç†åŠŸèƒ½ã€‚</p><learnmore path="/learn/synchronizing-with-effects"><p>é˜…è¯» <strong><a href="/learn/synchronizing-with-effects">ä½¿ç”¨ Effect è¿›è¡ŒåŒæ­¥</a></strong> ä»¥äº†è§£å¦‚ä½•å°†ç»„ä»¶ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥ã€‚</p></learnmore></section><section class="level2"aria-labelledby="ä½ å¯èƒ½ä¸éœ€è¦-effect-you-might-not-need-an-effect"><h2 id="ä½ å¯èƒ½ä¸éœ€è¦-effect-you-might-not-need-an-effect">ä½ å¯èƒ½ä¸éœ€è¦ Effect {/<em>you-might-not-need-an-effect</em>/}</h2><p>Effect æ˜¯ React èŒƒå¼ä¸­çš„ä¸€ç§è„±å›´æœºåˆ¶ã€‚å®ƒä»¬å¯ä»¥â€œé€ƒå‡ºâ€ React å¹¶ä½¿ç»„ä»¶å’Œä¸€äº›å¤–éƒ¨ç³»ç»ŸåŒæ­¥ã€‚å¦‚æœæ²¡æœ‰æ¶‰åŠåˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼Œéœ€è¦æ ¹æ®ä¸€äº› props æˆ– state çš„å˜åŒ–æ¥æ›´æ–°ä¸€ä¸ªç»„ä»¶çš„ stateï¼‰ï¼Œä¸åº”è¯¥ä½¿ç”¨ Effectã€‚ç§»é™¤ä¸å¿…è¦çš„ Effect å¯ä»¥è®©ä»£ç æ›´å®¹æ˜“ç†è§£ï¼Œè¿è¡Œå¾—æ›´å¿«ï¼Œå¹¶ä¸”æ›´å°‘å‡ºé”™ã€‚<p>æœ‰ä¸¤ç§å¸¸è§çš„ä¸å¿…ä½¿ç”¨ Effect çš„æƒ…å†µï¼š<ul><li><strong>ä¸å¿…ä¸ºäº†æ¸²æŸ“è€Œä½¿ç”¨ Effect æ¥è½¬æ¢æ•°æ®ã€‚</strong><li><strong>ä¸å¿…ä½¿ç”¨ Effect æ¥å¤„ç†ç”¨æˆ·äº‹ä»¶ã€‚</strong></ul><p>ä¾‹å¦‚ï¼Œä¸éœ€è¦ Effect æ¥æ ¹æ®å…¶ä»–çŠ¶æ€è°ƒæ•´æŸäº›çŠ¶æ€ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> setFirstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ³°å‹’'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastName<span class="token punctuation">,</span> setLastName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ–¯å¨å¤«ç‰¹'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ğŸ”´ é¿å…ï¼šå¤šä½™çš„ state å’Œä¸å¿…è¦çš„ Effect</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>fullName<span class="token punctuation">,</span> setFullName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setFullName</span><span class="token punctuation">(</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>ç›¸åï¼Œåœ¨æ¸²æŸ“æ—¶è¿›è¡Œå°½å¯èƒ½å¤šåœ°è®¡ç®—ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> setFirstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ³°å‹’'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastName<span class="token punctuation">,</span> setLastName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ–¯å¨å¤«ç‰¹'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// âœ… éå¸¸å¥½ï¼šåœ¨æ¸²æŸ“æœŸé—´è¿›è¡Œè®¡ç®—</span>
  <span class="token keyword">const</span> fullName <span class="token operator">=</span> firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>ä½  <strong>çš„ç¡®</strong> å¯ä»¥ä½¿ç”¨ Effect æ¥å’Œå¤–éƒ¨ç³»ç»ŸåŒæ­¥ã€‚</p><learnmore path="/learn/you-might-not-need-an-effect"><p>é˜…è¯» <strong><a href="/learn/you-might-not-need-an-effect">ä½ å¯èƒ½ä¸éœ€è¦ Effect</a></strong> ä»¥äº†è§£å¦‚ä½•ç§»é™¤ä¸å¿…è¦çš„ Effectã€‚</p></learnmore></section><section class="level2"aria-labelledby="å“åº”å¼-effect-çš„ç”Ÿå‘½å‘¨æœŸ-lifecycle-of-reactive-effects"><h2 id="å“åº”å¼-effect-çš„ç”Ÿå‘½å‘¨æœŸ-lifecycle-of-reactive-effects">å“åº”å¼ Effect çš„ç”Ÿå‘½å‘¨æœŸ {/<em>lifecycle-of-reactive-effects</em>/}</h2><p>Effect çš„ç”Ÿå‘½å‘¨æœŸä¸åŒäºç»„ä»¶ã€‚ç»„ä»¶å¯ä»¥æŒ‚è½½ã€æ›´æ–°æˆ–å¸è½½ã€‚Effect åªèƒ½åšä¸¤ä»¶äº‹ï¼šå¼€å§‹åŒæ­¥æŸäº›ä¸œè¥¿ï¼Œç„¶ååœæ­¢åŒæ­¥å®ƒã€‚å¦‚æœ Effect ä¾èµ–äºéšæ—¶é—´å˜åŒ–çš„ props å’Œ stateï¼Œè¿™ä¸ªå¾ªç¯å¯èƒ½ä¼šå‘ç”Ÿå¤šæ¬¡ã€‚<p>è¿™ä¸ª Effect ä¾èµ–äº <code>roomId</code> props çš„å€¼ã€‚props æ˜¯ <strong>å“åº”å€¼</strong>ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥åœ¨é‡æ–°æ¸²æŸ“æ—¶æ”¹å˜ã€‚æ³¨æ„ï¼Œå¦‚æœ <code>roomId</code> æ›´æ”¹ï¼ŒEffect å°†ä¼š <strong>é‡æ–°åŒæ­¥</strong>ï¼ˆå¹¶é‡æ–°è¿æ¥åˆ°æœåŠ¡å™¨ï¼‰ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'general'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š<span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ° "'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'" æˆ¿é—´ï¼Œåœ¨'</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€ "'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'" æˆ¿é—´ï¼Œåœ¨'</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>React æä¾›äº†æ£€æŸ¥å·¥å…·è§„åˆ™æ¥æ£€æŸ¥æ˜¯å¦æ­£ç¡®åœ°æŒ‡å®šäº† Effect çš„ä¾èµ–é¡¹ã€‚å¦‚æœå¿˜è®°åœ¨ä¸Šè¿°ç¤ºä¾‹çš„ä¾èµ–é¡¹åˆ—è¡¨ä¸­æŒ‡å®š <code>roomId</code>ï¼Œæ£€æŸ¥å·¥å…·ä¼šè‡ªåŠ¨æ‰¾åˆ°è¯¥é”™è¯¯ã€‚</p><learnmore path="/learn/lifecycle-of-reactive-effects"><p>é˜…è¯» <strong><a href="/learn/lifecycle-of-reactive-effects">å“åº”å¼ Effect çš„ç”Ÿå‘½å‘¨æœŸ</a></strong> ä»¥äº†è§£ Effect çš„ç”Ÿå‘½å‘¨æœŸä¸ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæœ‰ä½•ä¸åŒã€‚</p></learnmore></section><section class="level2"aria-labelledby="å°†äº‹ä»¶ä»-effect-ä¸­åˆ†å¼€-separating-events-from-effects"><h2 id="å°†äº‹ä»¶ä»-effect-ä¸­åˆ†å¼€-separating-events-from-effects">å°†äº‹ä»¶ä» Effect ä¸­åˆ†å¼€ {/<em>separating-events-from-effects</em>/}</h2><wip><p>æœ¬èŠ‚æè¿°äº†ä¸€ä¸ªåœ¨ç¨³å®šç‰ˆæœ¬çš„ React ä¸­ <strong>å°šæœªå‘å¸ƒ</strong> çš„å®éªŒæ€§ APIã€‚</p></wip><p>äº‹ä»¶å¤„ç†ç¨‹åºä»…åœ¨å†æ¬¡æ‰§è¡Œç›¸åŒçš„äº¤äº’æ—¶é‡æ–°è¿è¡Œã€‚ä¸äº‹ä»¶å¤„ç†ç¨‹åºä¸åŒï¼Œå¦‚æœ Effect è¯»å–çš„ä»»ä½•å€¼ï¼ˆå¦‚ props æˆ– stateï¼‰ä¸ä¸Šæ¬¡æ¸²æŸ“æœŸé—´ä¸åŒï¼Œåˆ™ä¼šé‡æ–°åŒæ­¥ã€‚æœ‰æ—¶ï¼Œéœ€è¦æ··åˆä¸¤ç§è¡Œä¸ºï¼šEffect é‡æ–°è¿è¡Œä»¥å“åº”æŸäº›å€¼è€Œä¸æ˜¯å…¶ä»–å€¼ã€‚<p>Effect ä¸­çš„æ‰€æœ‰ä»£ç éƒ½æ˜¯ <strong>å“åº”å¼çš„</strong>ã€‚å¦‚æœå®ƒè¯»å–çš„æŸäº›å“åº”å¼çš„å€¼ç”±äºé‡æ–°æ¸²æŸ“è€Œå‘ç”Ÿå˜åŒ–ï¼Œå®ƒå°†å†æ¬¡è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>roomId</code> æˆ– <code>theme</code> å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ª Effect å°†é‡æ–°è¿æ¥åˆ°èŠå¤©ï¼š</p><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"toastify-js"</span><span class="token operator">:</span> <span class="token string">"1.12.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection<span class="token punctuation">,</span> sendMessage <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> showNotification <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./notifications.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'å·²è¿æ¥ï¼'</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> theme<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isDark<span class="token punctuation">,</span> setIsDark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š<span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isDark<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setIsDark</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        ä½¿ç”¨æ·±è‰²ä¸»é¢˜
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
        roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
        theme<span class="token operator">=</span><span class="token punctuation">{</span>isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">}</span> 
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword">let</span> connectedCallback<span class="token punctuation">;</span>
  <span class="token keyword">let</span> timeout<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ä¸èƒ½æ·»åŠ å¤„ç†ç¨‹åºä¸¤æ¬¡ã€‚'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>event <span class="token operator">!==</span> <span class="token string">'connected'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ä»…æ”¯æŒâ€œå·²è¿æ¥â€äº‹ä»¶ã€‚'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      connectedCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Toastify</span></span> <span class="token keyword module">from</span> <span class="token string">'toastify-js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'toastify-js/src/toastify.css'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> theme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function"><span class="token maybe-class-name">Toastify</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">gravity</span><span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'right'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">background</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'black'</span> <span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'white'</span> <span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">showToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>è¿™å¹¶ä¸ç†æƒ³ã€‚å› ä¸ºä»…å½“ <code>roomId</code> å·²æ›´æ”¹æ—¶ï¼Œæ‰æƒ³é‡æ–°è¿æ¥åˆ°èŠå¤©ï¼Œæ‰€ä»¥åˆ‡æ¢ <code>theme</code> ä¸åº”è¯¥é‡æ–°è¿æ¥åˆ°èŠå¤©ï¼è€ƒè™‘å°†è¯»å– <code>theme</code> çš„ä»£ç ä» Effect ç§»åˆ° <strong>Effect Event</strong> ä¸­ï¼š</p><sandpack><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"experimental"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"toastify-js"</span><span class="token operator">:</span> <span class="token string">"1.12.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> experimental_useEffectEvent <span class="token keyword module">as</span> useEffectEvent <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection<span class="token punctuation">,</span> sendMessage <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> showNotification <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./notifications.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId<span class="token punctuation">,</span> theme <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onConnected <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'å·²è¿æ¥ï¼'</span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">,</span> roomId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">onConnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isDark<span class="token punctuation">,</span> setIsDark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š<span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>isDark<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setIsDark</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        ä½¿ç”¨æ·±è‰²ä¸»é¢˜
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span>
        roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
        theme<span class="token operator">=</span><span class="token punctuation">{</span>isDark <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">}</span> 
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter">serverUrl<span class="token punctuation">,</span> roomId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword">let</span> connectedCallback<span class="token punctuation">;</span>
  <span class="token keyword">let</span> timeout<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>connectedCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ä¸èƒ½æ·»åŠ å¤„ç†ç¨‹åºä¸¤æ¬¡ã€‚'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>event <span class="token operator">!==</span> <span class="token string">'connected'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'ä»…æ”¯æŒâ€œå·²è¿æ¥â€äº‹ä»¶ã€‚'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      connectedCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">Toastify</span></span> <span class="token keyword module">from</span> <span class="token string">'toastify-js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token string">'toastify-js/src/toastify.css'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> theme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function"><span class="token maybe-class-name">Toastify</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">gravity</span><span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'right'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">background</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'black'</span> <span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> theme <span class="token operator">===</span> <span class="token string">'dark'</span> <span class="token operator">?</span> <span class="token string">'white'</span> <span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">showToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Effect Events ä¸­çš„ä»£ç ä¸æ˜¯å“åº”å¼çš„ï¼Œå› æ­¤æ›´æ”¹â€œä¸»é¢˜â€ä¸å†ä½¿ Effect é‡æ–°è¿æ¥ã€‚</p><learnmore path="/learn/separating-events-from-effects"><p>é˜…è¯» <strong><a href="/learn/separating-events-from-effects">å°†äº‹ä»¶ä» Effect ä¸­åˆ†å¼€</a></strong>ï¼Œäº†è§£å¦‚ä½•é˜²æ­¢æŸäº›å€¼é‡æ–°è§¦å‘ Effectã€‚</p></learnmore></section><section class="level2"aria-labelledby="ç§»é™¤-effect-ä¾èµ–-removing-effect-dependencies"><h2 id="ç§»é™¤-effect-ä¾èµ–-removing-effect-dependencies">ç§»é™¤ Effect ä¾èµ– {/<em>removing-effect-dependencies</em>/}</h2><p>å½“ä½ å†™ Effect æ—¶ï¼Œä»£ç æ£€æŸ¥å™¨ä¼šéªŒè¯æ˜¯å¦å·²ç»å°† Effect è¯»å–çš„æ¯ä¸€ä¸ªå“åº”å¼å€¼ï¼ˆå¦‚ props å’Œ stateï¼‰åŒ…å«åœ¨ Effect çš„ä¾èµ–åˆ—è¡¨ä¸­ã€‚è¿™å¯ä»¥ç¡®ä¿ Effect ä¸ç»„ä»¶çš„ props å’Œ state ä¿æŒåŒæ­¥ã€‚ä¸å¿…è¦çš„ä¾èµ–å…³ç³»å¯èƒ½ä¼šå¯¼è‡´ Effect è¿è¡Œè¿‡äºé¢‘ç¹ï¼Œç”šè‡³äº§ç”Ÿæ— é™å¾ªç¯ã€‚åˆ é™¤å®ƒä»¬çš„æ–¹å¼å–å†³äºå…·ä½“æƒ…å†µã€‚<p>ä¾‹å¦‚ï¼Œè¿™ä¸ª Effect ä¾èµ–äºæ¯æ¬¡ç¼–è¾‘è¾“å…¥æ—¶éƒ½ä¼šé‡æ–°åˆ›å»ºçš„ <code>options</code> å¯¹è±¡ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl<span class="token punctuation">,</span>
    <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š<span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>general<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>travel<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>music<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> serverUrl<span class="token punctuation">,</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ° "'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'" æˆ¿é—´ï¼Œåœ¨'</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€ "'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'" æˆ¿é—´ï¼Œåœ¨'</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>ä½ ä¸å¸Œæœ›æ¯æ¬¡å¼€å§‹åœ¨èŠå¤©ä¸­è¾“å…¥æ¶ˆæ¯æ—¶èŠå¤©éƒ½é‡æ–°è¿æ¥ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ åº”è¯¥åœ¨ Effect ä¸­åˆ›å»º <code>options</code> å¯¹è±¡ï¼Œä½¿å¾— Effect ä»…ä¾èµ–äº <code>roomId</code> å­—ç¬¦ä¸²ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createConnection <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./chat.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> serverUrl <span class="token operator">=</span> <span class="token string">'https://localhost:1234'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatRoom</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">serverUrl</span><span class="token operator">:</span> serverUrl<span class="token punctuation">,</span>
      <span class="token literal-property property">roomId</span><span class="token operator">:</span> roomId
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> connection<span class="token punctuation">.</span><span class="token method function property-access">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span>æ¬¢è¿æ¥åˆ° <span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> æˆ¿é—´ï¼<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>roomId<span class="token punctuation">,</span> setRoomId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'æ‰€æœ‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        é€‰æ‹©èŠå¤©å®¤ï¼š<span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>select
          value<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setRoomId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"general"</span><span class="token operator">></span>æ‰€æœ‰<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"travel"</span><span class="token operator">></span>æ—…æ¸¸<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
          <span class="token operator">&#x3C;</span>option value<span class="token operator">=</span><span class="token string">"music"</span><span class="token operator">></span>éŸ³ä¹<span class="token operator">&#x3C;</span><span class="token operator">/</span>option<span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>select<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ChatRoom</span> roomId<span class="token operator">=</span><span class="token punctuation">{</span>roomId<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> serverUrl<span class="token punctuation">,</span> roomId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âœ… è¿æ¥åˆ° "'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'" æˆ¿é—´ï¼Œåœ¨'</span> <span class="token operator">+</span> serverUrl <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'âŒ æ–­å¼€ "'</span> <span class="token operator">+</span> roomId <span class="token operator">+</span> <span class="token string">'" æˆ¿é—´ï¼Œåœ¨'</span> <span class="token operator">+</span> serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>è¯·æ³¨æ„ï¼Œä½ å¹¶æ²¡æœ‰é€šè¿‡ç¼–è¾‘ä¾èµ–é¡¹åˆ—è¡¨æ¥åˆ é™¤ <code>options</code> ä¾èµ–é¡¹ï¼Œé‚£æ˜¯é”™è¯¯çš„ã€‚ç›¸åï¼Œä½ æ›´æ”¹äº†å‘¨å›´çš„ä»£ç ï¼Œä½¿ä¾èµ–å…³ç³»å˜å¾— <strong>ä¸å¿…è¦</strong>ã€‚å°†ä¾èµ–å…³ç³»åˆ—è¡¨è§†ä¸º Effect ä»£ç ä½¿ç”¨çš„æ‰€æœ‰å“åº”å€¼çš„åˆ—è¡¨ã€‚ä¸å¿…åˆ»æ„é€‰æ‹©æŠŠä»€ä¹ˆæ”¾åœ¨è¯¥åˆ—è¡¨ä¸­ã€‚è¯¥åˆ—è¡¨æè¿°äº†ä½ çš„ä»£ç ã€‚è¦æ”¹å˜ä¾èµ–æ€§åˆ—è¡¨ï¼Œè¯·æ”¹å˜ä»£ç ã€‚</p><learnmore path="/learn/removing-effect-dependencies"><p>é˜…è¯» <strong><a href="/learn/removing-effect-dependencies">ç§»é™¤ Effect ä¾èµ–</a></strong> ä»¥äº†è§£å¦‚ä½•å‡å°‘ Effect é‡æ–°è¿è¡Œçš„é¢‘ç‡ã€‚</p></learnmore></section><section class="level2"aria-labelledby="ä½¿ç”¨è‡ªå®šä¹‰-hook-å¤ç”¨é€»è¾‘-reusing-logic-with-custom-hooks"><h2 id="ä½¿ç”¨è‡ªå®šä¹‰-hook-å¤ç”¨é€»è¾‘-reusing-logic-with-custom-hooks">ä½¿ç”¨è‡ªå®šä¹‰ Hook å¤ç”¨é€»è¾‘ {/<em>reusing-logic-with-custom-hooks</em>/}</h2><p>React æœ‰ä¸€äº›å†…ç½® Hookï¼Œä¾‹å¦‚ <code>useState</code>ï¼Œ<code>useContext</code> å’Œ <code>useEffect</code>ã€‚æœ‰æ—¶éœ€è¦ç”¨é€”æ›´ç‰¹æ®Šçš„ Hookï¼šä¾‹å¦‚è·å–æ•°æ®ï¼Œè®°å½•ç”¨æˆ·æ˜¯å¦åœ¨çº¿æˆ–è€…è¿æ¥èŠå¤©å®¤ã€‚ä¸ºäº†å®ç°æ•ˆæœï¼Œå¯ä»¥æ ¹æ®åº”ç”¨éœ€æ±‚åˆ›å»ºè‡ªå·±çš„ Hookã€‚<p>è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œè‡ªå®šä¹‰ Hook <code>usePointerPosition</code> è¿½è¸ªå½“å‰æŒ‡é’ˆä½ç½®ï¼Œè€Œè‡ªå®šä¹‰ Hook <code>useDelayedValue</code> è¿”å›ä¸€ä¸ªâ€œæ»åâ€ä¼ é€’çš„å€¼ä¸€å®šæ¯«ç§’æ•°çš„å€¼ã€‚å°†å…‰æ ‡ç§»åˆ°æ²™ç›’é¢„è§ˆåŒºåŸŸä¸Šä»¥æŸ¥çœ‹è·Ÿéšå…‰æ ‡ç§»åŠ¨çš„ç‚¹è½¨è¿¹ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> usePointerPosition <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./usePointerPosition.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useDelayedValue <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./useDelayedValue.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Canvas</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pos1 <span class="token operator">=</span> <span class="token function">usePointerPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pos2 <span class="token operator">=</span> <span class="token function">useDelayedValue</span><span class="token punctuation">(</span>pos1<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pos3 <span class="token operator">=</span> <span class="token function">useDelayedValue</span><span class="token punctuation">(</span>pos2<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pos4 <span class="token operator">=</span> <span class="token function">useDelayedValue</span><span class="token punctuation">(</span>pos3<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pos5 <span class="token operator">=</span> <span class="token function">useDelayedValue</span><span class="token punctuation">(</span>pos4<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Dot</span> position<span class="token operator">=</span><span class="token punctuation">{</span>pos1<span class="token punctuation">}</span> opacity<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Dot</span> position<span class="token operator">=</span><span class="token punctuation">{</span>pos2<span class="token punctuation">}</span> opacity<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0.8</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Dot</span> position<span class="token operator">=</span><span class="token punctuation">{</span>pos3<span class="token punctuation">}</span> opacity<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0.6</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Dot</span> position<span class="token operator">=</span><span class="token punctuation">{</span>pos4<span class="token punctuation">}</span> opacity<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0.4</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Dot</span> position<span class="token operator">=</span><span class="token punctuation">{</span>pos5<span class="token punctuation">}</span> opacity<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0.2</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Dot</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> position<span class="token punctuation">,</span> opacity <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
      <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'pink'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">borderRadius</span><span class="token operator">:</span> <span class="token string">'50%'</span><span class="token punctuation">,</span>
      opacity<span class="token punctuation">,</span>
      <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">pointerEvents</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">usePointerPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">handleMove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">clientY</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pointermove'</span><span class="token punctuation">,</span> handleMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'pointermove'</span><span class="token punctuation">,</span> handleMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> position<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">useDelayedValue</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>delayedValue<span class="token punctuation">,</span> setDelayedValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setDelayedValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> delay<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> delayedValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span> <span class="token property">min-height</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>ä½ å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ Hooksï¼Œå°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ï¼Œåœ¨å®ƒä»¬ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œå¹¶åœ¨ç»„ä»¶ä¹‹é—´é‡ç”¨å®ƒä»¬ã€‚éšç€åº”ç”¨ä¸æ–­å˜å¤§ï¼Œä½ å°†å‡å°‘æ‰‹åŠ¨ç¼–å†™çš„ Effectï¼Œå› ä¸ºä½ å°†èƒ½å¤Ÿé‡ç”¨å·²ç»ç¼–å†™çš„è‡ªå®šä¹‰ Hooksã€‚React ç¤¾åŒºä¹Ÿç»´æŠ¤äº†è®¸å¤šä¼˜ç§€çš„è‡ªå®šä¹‰ Hooksã€‚</p><learnmore path="/learn/reusing-logic-with-custom-hooks"><p>é˜…è¯» <strong><a href="/learn/reusing-logic-with-custom-hooks">ä½¿ç”¨è‡ªå®šä¹‰ Hook å¤ç”¨é€»è¾‘</a></strong> ä»¥äº†è§£å¦‚ä½•åœ¨ç»„ä»¶ä¹‹é—´å…±äº«é€»è¾‘ã€‚</p></learnmore></section><section class="level2"aria-labelledby="ä¸‹èŠ‚é¢„å‘Š-whats-next"><h2 id="ä¸‹èŠ‚é¢„å‘Š-whats-next">ä¸‹èŠ‚é¢„å‘Š {/<em>whats-next</em>/}</h2><p>è·³è½¬åˆ° <a href="/learn/referencing-values-with-refs">ä½¿ç”¨ ref å¼•ç”¨å€¼</a> è¿™ä¸€èŠ‚å¹¶å¼€å§‹ä¸€é¡µé¡µçš„é˜…è¯»ï¼ <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>