<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>cache</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="cache"><h1 id="cache">cache</h1><p>canary: true</p><canary>* `cache` ä»…ä¾›ä¸ [React æœåŠ¡å™¨ç»„ä»¶](/blog/2023/03/22/react-labs-what-we-have-been-working-on-march-2023#react-server-components) ä¸€èµ·ä½¿ç”¨ã€‚è¯·å‚é˜…æ”¯æŒ React æœåŠ¡å™¨ç»„ä»¶çš„ [æ¡†æ¶](/learn/start-a-new-react-project#bleeding-edge-react-frameworks)ã€‚<ul><li><code>cache</code> ä»…åœ¨ React çš„ <a href="/community/versioning-policy#canary-channel">Canary</a> å’Œ <a href="/community/versioning-policy#experimental-channel">experimental</a> æ¸ é“ä¸­å¯ç”¨ã€‚åœ¨å°† <code>cache</code> ç”¨äºç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼Œè¯·ç¡®ä¿äº†è§£å…¶é™åˆ¶ã€‚æŸ¥çœ‹æ­¤å¤„äº†è§£æœ‰å…³ <a href="/community/versioning-policy#all-release-channels">React å‘å¸ƒæ¸ é“çš„æ›´å¤šä¿¡æ¯</a>ã€‚</ul><intro><p><code>cache</code> å…è®¸ç¼“å­˜æ•°æ®è·å–æˆ–è®¡ç®—çš„ç»“æœã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> cachedFn <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="å‚è€ƒ-reference"><h2 id="å‚è€ƒ-reference">å‚è€ƒ {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="cachefn-cache"><h3 id="cachefn-cache"><code>cache(fn)</code> {/<em>cache</em>/}</h3><p>åœ¨ä»»ä½•ç»„ä»¶ä¹‹å¤–è°ƒç”¨ <code>cache</code> ä»¥åˆ›å»ºå¸¦æœ‰ç¼“å­˜çš„å‡½æ•°ç‰ˆæœ¬ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">calculateMetrics</span> <span class="token keyword module">from</span> <span class="token string">'lib/metrics'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getMetrics <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateMetrics<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Chart</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>data<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getMetrics</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>å½“é¦–æ¬¡ä½¿ç”¨ <code>data</code> è°ƒç”¨ <code>getMetrics</code> æ—¶ï¼Œ<code>getMetrics</code> å°†è°ƒç”¨ <code>calculateMetrics(data)</code> å¹¶å°†ç»“æœå­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚å¦‚æœå†æ¬¡ä½¿ç”¨ç›¸åŒçš„ <code>data</code> è°ƒç”¨ <code>getMetrics</code>ï¼Œå®ƒå°†è¿”å›ç¼“å­˜çš„ç»“æœï¼Œè€Œä¸ä¼šå†æ¬¡è°ƒç”¨ <code>calculateMetrics(data)</code>ã€‚<p><a href="#usage">å‚è§ä¸‹æ–¹æ›´å¤šç¤ºä¾‹</a>ã€‚<section class="level4"aria-labelledby="å‚æ•°-parameters"><h4 id="å‚æ•°-parameters">å‚æ•° {/<em>parameters</em>/}</h4><ul><li><code>fn</code>ï¼šè¦å¯¹å…¶ç»“æœè¿›è¡Œç¼“å­˜çš„å‡½æ•°ã€‚<code>fn</code> å¯ä»¥æ¥å—ä»»ä½•å‚æ•°å¹¶è¿”å›ä»»ä½•å€¼ã€‚</ul></section><section class="level4"aria-labelledby="è¿”å›å€¼-returns"><h4 id="è¿”å›å€¼-returns">è¿”å›å€¼ {/<em>returns</em>/}</h4><p><code>cache</code> è¿”å›ä¸€ä¸ªä¸ <code>fn</code> å…·æœ‰ç›¸åŒç±»å‹ç­¾åçš„å·²ç¼“å­˜ç‰ˆæœ¬ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå®ƒä¸ä¼šè°ƒç”¨ <code>fn</code>ã€‚<p>åœ¨ä½¿ç”¨ç»™å®šçš„å‚æ•°è°ƒç”¨ <code>cachedFn</code> æ—¶ï¼Œå®ƒé¦–å…ˆæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç¼“å­˜çš„ç»“æœã€‚å¦‚æœå­˜åœ¨ç¼“å­˜çš„ç»“æœï¼Œå®ƒå°†è¿”å›è¯¥ç»“æœã€‚å¦‚æœæ²¡æœ‰ï¼Œå®ƒå°†ä½¿ç”¨å‚æ•°è°ƒç”¨ <code>fn</code>ï¼Œå°†ç»“æœå­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œå¹¶è¿”å›è¯¥ç»“æœã€‚åªæœ‰åœ¨ç¼“å­˜æœªå‘½ä¸­æ—¶æ‰ä¼šè°ƒç”¨ <code>fn</code>ã€‚</p><note><p>åŸºäºè¾“å…¥è¿›è¡Œè¿”å›å€¼ç¼“å­˜çš„ä¼˜åŒ–ç§°ä¸º <a href="https://en.wikipedia.org/wiki/Memoization">è®°å¿†åŒ–</a>ã€‚æˆ‘ä»¬å°†ä» <code>cache</code> è¿”å›çš„å‡½æ•°ç§°ä¸ºä¸€ä¸ªè®°å¿†åŒ–å‡½æ•°ã€‚</p></note></section><section class="level4"aria-labelledby="æ³¨æ„-caveats"><h4 id="æ³¨æ„-caveats">æ³¨æ„ {/<em>caveats</em>/}</h4><ul><li>React å°†åœ¨æ¯æ¬¡æœåŠ¡å™¨è¯·æ±‚æ—¶ä½¿æ‰€æœ‰è®°å¿†åŒ–å‡½æ•°çš„ç¼“å­˜å¤±æ•ˆã€‚<li>æ¯æ¬¡è°ƒç”¨ <code>cache</code> éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚è¿™æ„å‘³ç€å¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„å‡½æ•°è°ƒç”¨ <code>cache</code> å°†è¿”å›ä¸å…±äº«ç›¸åŒç¼“å­˜çš„ä¸åŒè®°å¿†åŒ–å‡½æ•°ã€‚<li><code>cachedFn</code> è¿˜ä¼šç¼“å­˜é”™è¯¯ã€‚å¦‚æœå¯¹äºæŸäº›å‚æ•° <code>fn</code> æŠ›å‡ºé”™è¯¯ï¼Œé”™è¯¯å°†è¢«ç¼“å­˜ï¼Œå½“ä½¿ç”¨ç›¸åŒå‚æ•°è°ƒç”¨ <code>cachedFn</code> æ—¶ï¼Œç›¸åŒçš„é”™è¯¯å°†è¢«é‡æ–°æŠ›å‡ºã€‚<li><code>cache</code> ä»…ä¾›åœ¨ <a href="/blog/2023/03/22/react-labs-what-we-have-been-working-on-march-2023#react-server-components">æœåŠ¡å™¨ç»„ä»¶</a> ä¸­ä½¿ç”¨ã€‚</ul></section></section></section><section class="level2"aria-labelledby="ç”¨æ³•-usage"><h2 id="ç”¨æ³•-usage">ç”¨æ³• {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="ç¼“å­˜ä»£ä»·æ˜‚è´µçš„è®¡ç®—-cache-expensive-computation"><h3 id="ç¼“å­˜ä»£ä»·æ˜‚è´µçš„è®¡ç®—-cache-expensive-computation">ç¼“å­˜ä»£ä»·æ˜‚è´µçš„è®¡ç®— {/<em>cache-expensive-computation</em>/}</h3><p>ä½¿ç”¨ <code>cache</code> è·³è¿‡é‡å¤å·¥ä½œã€‚<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">calculateUserMetrics</span> <span class="token keyword module">from</span> <span class="token string">'lib/user'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getUserMetrics <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateUserMetrics<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Profile</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>user<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> metrics <span class="token operator">=</span> <span class="token function">getUserMetrics</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TeamReport</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>users<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> user <span class="token keyword">in</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> metrics <span class="token operator">=</span> <span class="token function">getUserMetrics</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>å¦‚æœç›¸åŒçš„ <code>user</code> å¯¹è±¡åœ¨ <code>Profile</code> å’Œ <code>TeamReport</code> ä¸­éƒ½è¢«æ¸²æŸ“ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç»„ä»¶å¯ä»¥å…±äº«å·¥ä½œï¼Œå¹¶ä¸”åªä¸ºè¯¥ <code>user</code> è°ƒç”¨ä¸€æ¬¡ <code>calculateUserMetrics</code>ã€‚<p>å‡è®¾é¦–å…ˆæ¸²æŸ“äº† <code>Profile</code>ã€‚å®ƒå°†è°ƒç”¨<codestep step="{1}"><code>getUserMetrics</code></codestep>ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦æœ‰ç¼“å­˜çš„ç»“æœã€‚ç”±äºè¿™æ˜¯ç¬¬ä¸€æ¬¡ä»¥è¯¥ <code>user</code> è°ƒç”¨ <code>getUserMetrics</code>ï¼Œæ‰€ä»¥ç¼“å­˜æœªå‘½ä¸­ã€‚äºæ˜¯ <code>getUserMetrics</code> å°†ä¼šä½¿ç”¨ <code>user</code> è°ƒç”¨ <code>calculateUserMetrics</code> å¹¶å°†ç»“æœå†™å…¥ç¼“å­˜ã€‚<p>å½“ <code>TeamReport</code> ä½¿ç”¨ç›¸åŒçš„ <code>user</code> å¯¹è±¡æ¥æ¸²æŸ“ <code>users</code> åˆ—è¡¨æ—¶ï¼Œå®ƒå°†è°ƒç”¨<codestep step="{2}"><code>getUserMetrics</code></codestep>å¹¶ä»ç¼“å­˜ä¸­è¯»å–ç»“æœã€‚</p><pitfall><section class="level5"aria-labelledby="è°ƒç”¨ä¸åŒçš„è®°å¿†åŒ–å‡½æ•°å°†ä»ä¸åŒçš„ç¼“å­˜ä¸­è¯»å–æ•°æ®-pitfall-different-memoized-functions"><h5 id="è°ƒç”¨ä¸åŒçš„è®°å¿†åŒ–å‡½æ•°å°†ä»ä¸åŒçš„ç¼“å­˜ä¸­è¯»å–æ•°æ®-pitfall-different-memoized-functions">è°ƒç”¨ä¸åŒçš„è®°å¿†åŒ–å‡½æ•°å°†ä»ä¸åŒçš„ç¼“å­˜ä¸­è¯»å–æ•°æ® {/<em>pitfall-different-memoized-functions</em>/}</h5><p>è¦è®¿é—®ç›¸åŒçš„ç¼“å­˜ï¼Œç»„ä»¶å¿…é¡»è°ƒç”¨åŒä¸€ä¸ªè®°å¿†åŒ–å‡½æ•°ã€‚<pre class="language-js"><code class="language-js"><span class="token comment">// Temperature.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>calculateWeekReport<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./report'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Temperature</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>cityData<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ğŸš© é”™è¯¯ç¤ºä¾‹ï¼šåœ¨ç»„ä»¶ä¸­è°ƒç”¨ `cache` ä¼šä¸ºæ¯æ¬¡æ¸²æŸ“åˆ›å»ºæ–°çš„ `getWeekReport`ã€‚</span>
  <span class="token keyword">const</span> getWeekReport <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateWeekReport<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getWeekReport</span><span class="token punctuation">(</span>cityData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// Precipitation.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>calculateWeekReport<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./report'</span><span class="token punctuation">;</span>

<span class="token comment">// ğŸš© é”™è¯¯ç¤ºä¾‹ï¼š`getWeekReport` ä»…ä¾› `Precipitation` ç»„ä»¶è®¿é—®ã€‚</span>
<span class="token keyword">const</span> getWeekReport <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateWeekReport<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Precipitation</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>cityData<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getWeekReport</span><span class="token punctuation">(</span>cityData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<codestep step="{2}"><code>Precipitation</code></codestep>å’Œ<codestep step="{1}"><code>Temperature</code></codestep>éƒ½å°†è°ƒç”¨ <code>cache</code> åˆ›å»ºæ–°çš„è®°å¿†åŒ–å‡½æ•°ï¼Œå¹¶ä½¿ç”¨è‡ªå·±çš„ç¼“å­˜æŸ¥æ‰¾ã€‚å¦‚æœä¸¤ä¸ªç»„ä»¶éƒ½ä½¿ç”¨ç›¸åŒçš„ <code>cityData</code> è¿›è¡Œæ¸²æŸ“ï¼Œå®ƒä»¬å°†é‡å¤è°ƒç”¨ <code>calculateWeekReport</code>ï¼Œè¿›è¡Œé‡å¤çš„å·¥ä½œã€‚<p>æ­¤å¤–ï¼Œ<code>Temperature</code> æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶éƒ½åˆ›å»ºä¸€ä¸ª<codestep step="{1}">æ–°çš„è®°å¿†åŒ–å‡½æ•°</codestep>ï¼Œè¿™ä¸å…è®¸ä»»ä½•ç¼“å­˜å…±äº«ã€‚<p>ä¸ºäº†æœ€å¤§åŒ–ç¼“å­˜å‘½ä¸­ç‡å¹¶å‡å°‘å·¥ä½œé‡ï¼Œè¿™ä¸¤ä¸ªç»„ä»¶åº”è¯¥è°ƒç”¨ç›¸åŒçš„è®°å¿†åŒ–å‡½æ•°ä»¥è®¿é—®ç›¸åŒçš„ç¼“å­˜ã€‚å› æ­¤åº”è¯¥åœ¨ä¸“ç”¨æ¨¡å—ä¸­å®šä¹‰è®°å¿†åŒ–å‡½æ•°ï¼Œä»¥åœ¨ä¸åŒç»„ä»¶ä¹‹é—´ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/import"><code>import</code>-ed</a> è¿›è¡Œå…±äº«ã€‚<pre class="language-js"><code class="language-js"><span class="token comment">// getWeekReport.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>calculateWeekReport<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./report'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateWeekReport<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// Temperature.js</span>
<span class="token keyword module">import</span> <span class="token imports">getWeekReport</span> <span class="token keyword module">from</span> <span class="token string">'./getWeekReport'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Temperature</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>cityData<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getWeekReport</span><span class="token punctuation">(</span>cityData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// Precipitation.js</span>
<span class="token keyword module">import</span> <span class="token imports">getWeekReport</span> <span class="token keyword module">from</span> <span class="token string">'./getWeekReport'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Precipitation</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>cityData<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getWeekReport</span><span class="token punctuation">(</span>cityData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>åœ¨è¿™é‡Œï¼Œä¸¤ä¸ªç»„ä»¶éƒ½è°ƒç”¨ä» <code>./getWeekReport.js</code> å¯¼å‡ºçš„<codestep step="{3}">ç›¸åŒçš„è®°å¿†åŒ–å‡½æ•°</codestep>æ¥è¯»å–å’Œå†™å…¥ç›¸åŒçš„ç¼“å­˜ã€‚</section></pitfall></section><section class="level3"aria-labelledby="å…±äº«æ•°æ®å¿«ç…§-take-and-share-snapshot-of-data"><h3 id="å…±äº«æ•°æ®å¿«ç…§-take-and-share-snapshot-of-data">å…±äº«æ•°æ®å¿«ç…§ {/<em>take-and-share-snapshot-of-data</em>/}</h3><p>è¦åœ¨ç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®å¿«ç…§ï¼Œè¯·ä½¿ç”¨ç±»ä¼¼ <code>fetch</code> çš„æ•°æ®è·å–å‡½æ•°è°ƒç”¨ <code>cache</code>ã€‚å½“å¤šä¸ªç»„ä»¶è¿›è¡Œç›¸åŒçš„æ•°æ®è·å–æ—¶ï¼Œåªä¼šå‘å‡ºä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”è¿”å›çš„æ•°æ®ä¼šè¢«ç¼“å­˜å¹¶åœ¨å„ä¸ªç»„ä»¶ä¹‹é—´å…±äº«ã€‚æ‰€æœ‰ç»„ä»¶åœ¨æœåŠ¡å™¨æ¸²æŸ“æœŸé—´éƒ½å¼•ç”¨ç›¸åŒçš„æ•°æ®å¿«ç…§ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>fetchTemperature<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./api.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getTemperature <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">city</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
	<span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token function">fetchTemperature</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AnimatedWeatherCard</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>city<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> temperature <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getTemperature</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MinimalWeatherCard</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>city<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> temperature <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getTemperature</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>å¦‚æœ <code>AnimatedWeatherCard</code> å’Œ <code>MinimalWeatherCard</code> éƒ½ä¸ºç›¸åŒçš„<codestep step="{1}"><code>city</code></codestep>è¿›è¡Œæ¸²æŸ“ï¼Œå®ƒä»¬å°†ä»<codestep step="{2}">è®°å¿†åŒ–å‡½æ•°</codestep>æ¥æ”¶ç›¸åŒçš„æ•°æ®å¿«ç…§ã€‚<p>å¦‚æœ <code>AnimatedWeatherCard</code> å’Œ <code>MinimalWeatherCard</code> å‘<codestep step="{2}"><code>getTemperature</code></codestep>æä¾›ä¸åŒçš„<codestep step="{1}"><code>city</code></codestep>å‚æ•°ï¼Œé‚£ä¹ˆå°†è°ƒç”¨ä¸¤æ¬¡ <code>fetchTemperature</code>ï¼Œå¹¶ä¸”æ¯ä¸ªè°ƒç”¨ç«™ç‚¹å°†æ¥æ”¶ä¸åŒçš„æ•°æ®ã€‚<p><codestep step="{1}"><code>city</code></codestep>åœ¨å…¶ä¸­å……å½“ç¼“å­˜é”®ã€‚</p><note><p><codestep step="{3}">å¼‚æ­¥æ¸²æŸ“</codestep>åªåœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­æ”¯æŒã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AnimatedWeatherCard</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>city<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> temperature <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getTemperature</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></note></section><section class="level3"aria-labelledby="é¢„åŠ è½½æ•°æ®-preload-data"><h3 id="é¢„åŠ è½½æ•°æ®-preload-data">é¢„åŠ è½½æ•°æ® {/<em>preload-data</em>/}</h3><p>é€šè¿‡ç¼“å­˜é•¿æ—¶é—´è¿è¡Œçš„æ•°æ®è·å–ï¼Œä½ å¯ä»¥åœ¨æ¸²æŸ“ç»„ä»¶ä¹‹å‰å¼€å§‹å¼‚æ­¥å·¥ä½œã€‚<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> getUser <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Profile</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>section</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>img</span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span><span class="token property-access">profilePic</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>user<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>section</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šå¼€å§‹è·å–ç”¨æˆ·æ•°æ®ã€‚</span>
  <span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// â€¦â€¦ä¸€äº›è®¡ç®—å·¥ä½œ</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Profile</span></span> <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>åœ¨æ¸²æŸ“ <code>Page</code> æ—¶ï¼Œç»„ä»¶è°ƒç”¨<codestep step="{1}"><code>getUser</code></codestep>ï¼Œä½†è¯·æ³¨æ„å®ƒå¹¶ä¸ä½¿ç”¨è¿”å›çš„æ•°æ®ã€‚è¿™ä¸ªæ—©æœŸçš„<codestep step="{1}"><code>getUser</code></codestep>è°ƒç”¨ä¼šå¯åŠ¨å¼‚æ­¥æ•°æ®åº“æŸ¥è¯¢ï¼Œè€Œåœ¨ <code>Page</code> æ‰§è¡Œå…¶ä»–è®¡ç®—å·¥ä½œå¹¶æ¸²æŸ“å­ç»„ä»¶æ—¶è¿›è¡Œã€‚<p>åœ¨æ¸²æŸ“ <code>Profile</code> æ—¶ï¼Œæˆ‘ä»¬å†æ¬¡è°ƒç”¨<codestep step="{2}"><code>getUser</code></codestep>ã€‚å¦‚æœåˆå§‹<codestep step="{1}"><code>getUser</code></codestep>è°ƒç”¨å·²ç»è¿”å›å¹¶ç¼“å­˜äº†ç”¨æˆ·æ•°æ®ï¼Œé‚£ä¹ˆå½“ <code>Profile</code> åœ¨<codestep step="{2}">è¯·æ±‚å¹¶ç­‰å¾…è¿™äº›æ•°æ®</codestep>æ—¶ï¼Œå®ƒå¯ä»¥ç®€å•åœ°ä»ç¼“å­˜ä¸­è¯»å–ï¼Œè€Œæ— éœ€è¿›è¡Œå¦ä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚å¦‚æœåˆå§‹<codestep step="{1}"><code>fetchData</code></codestep>è¿˜æ²¡æœ‰å®Œæˆï¼Œé‚£ä¹ˆåœ¨è¿™ç§æ¨¡å¼ä¸‹é¢„åŠ è½½æ•°æ®å¯ä»¥å‡å°‘æ•°æ®è·å–çš„å»¶è¿Ÿã€‚</p><deepdive><section class="level4"aria-labelledby="ç¼“å­˜å¼‚æ­¥å·¥ä½œ-caching-asynchronous-work"><h4 id="ç¼“å­˜å¼‚æ­¥å·¥ä½œ-caching-asynchronous-work">ç¼“å­˜å¼‚æ­¥å·¥ä½œ {/<em>caching-asynchronous-work</em>/}</h4><p>åœ¨è¯„ä¼° <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function">å¼‚æ­¥å‡½æ•°</a> æ—¶ï¼Œä½ å°†æ”¶åˆ°ä¸€ä¸ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>ï¼Œè¯¥ Promise åŒ…å«äº†è¯¥å·¥ä½œçš„çŠ¶æ€ï¼ˆpendingï¼Œfulfilledï¼Œfailedï¼‰å’Œæœ€ç»ˆçš„å®Œæˆç»“æœã€‚<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå¼‚æ­¥å‡½æ•°<codestep step="{1}"><code>fetchData</code></codestep>è¿”å›ä¸€ä¸ªç­‰å¾… <code>fetch</code> çš„ promiseã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> getData <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>fetchData<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// â€¦â€¦ä¸€äº›è®¡ç®—å·¥ä½œ</span>
  <span class="token keyword control-flow">await</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// â€¦â€¦</span>
<span class="token punctuation">}</span></code></pre><p>åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨<codestep step="{2}"><code>getData</code></codestep>æ—¶ï¼Œä»<codestep step="{1}"><code>fetchData</code></codestep>è¿”å›çš„ promise å°†è¢«ç¼“å­˜ã€‚éšåçš„æŸ¥æ‰¾å°†è¿”å›ç›¸åŒçš„ promiseã€‚<p>è¯·æ³¨æ„ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨<codestep step="{2}"><code>getData</code></codestep>ä¸ä½¿ç”¨ <code>await</code>ï¼Œè€Œ<codestep step="{3}">ç¬¬äºŒæ¬¡</codestep>è°ƒç”¨ä¼šä½¿ç”¨ã€‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/await"><code>await</code></a> æ˜¯ JavaScript ä¸­çš„ä¸€ä¸ªæ“ä½œç¬¦ï¼Œå®ƒä¼šç­‰å¾…å¹¶è¿”å› promise çš„å·²è§£å†³ç»“æœã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨<codestep step="{2}"><code>getData</code></codestep>ä»…å¯åŠ¨ <code>fetch</code> ä»¥ç¼“å­˜ promiseï¼Œä»¥ä¾›<codestep step="{3}">ç¬¬äºŒæ¬¡</codestep>æŸ¥æ‰¾ã€‚<p>å¦‚æœåœ¨<codestep step="{3}">ç¬¬äºŒæ¬¡</codestep>è°ƒç”¨æ—¶ï¼Œpromise ä»å¤„äº pending çŠ¶æ€ï¼Œé‚£ä¹ˆ <code>await</code> ä¼šç­‰å¾…ç»“æœã€‚ä¼˜åŒ–ä¹‹å¤„åœ¨äºï¼Œåœ¨ç­‰å¾… <code>fetch</code> çš„åŒæ—¶ï¼ŒReact å¯ä»¥ç»§ç»­è¿›è¡Œè®¡ç®—å·¥ä½œï¼Œä»è€Œå‡å°‘äº†ç¬¬äºŒæ¬¡è°ƒç”¨çš„ç­‰å¾…æ—¶é—´ã€‚<p>å¦‚æœ promise å·²ç»è§£å†³ï¼Œæ— è®ºæ˜¯å¾—åˆ°é”™è¯¯è¿˜æ˜¯ fulfilled çš„ç»“æœï¼Œ<code>await</code> éƒ½ä¼šç«‹å³è¿”å›è¯¥å€¼ã€‚åœ¨è¿™ä¸¤ç§ç»“æœä¸­ï¼Œéƒ½å­˜åœ¨æ€§èƒ½ä¼˜åŠ¿ã€‚</p><pitfall><section class="level5"aria-labelledby="åœ¨ç»„ä»¶å¤–éƒ¨è°ƒç”¨è®°å¿†åŒ–å‡½æ•°å°†ä¸ä½¿ç”¨ç¼“å­˜-pitfall-memoized-call-outside-component"><h5 id="åœ¨ç»„ä»¶å¤–éƒ¨è°ƒç”¨è®°å¿†åŒ–å‡½æ•°å°†ä¸ä½¿ç”¨ç¼“å­˜-pitfall-memoized-call-outside-component">åœ¨ç»„ä»¶å¤–éƒ¨è°ƒç”¨è®°å¿†åŒ–å‡½æ•°å°†ä¸ä½¿ç”¨ç¼“å­˜ {/<em>pitfall-memoized-call-outside-component</em>/}</h5><pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getUser <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ğŸš© é”™è¯¯ç¤ºä¾‹ï¼šåœ¨ç»„ä»¶å¤–éƒ¨è°ƒç”¨è®°å¿†åŒ–å‡½æ•°å°†ä¸è¿›è¡Œè®°å¿†åŒ–ã€‚</span>
<span class="token function">getUser</span><span class="token punctuation">(</span><span class="token string">'demo-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">DemoProfile</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// âœ… æ­£ç¡®ç¤ºä¾‹ï¼š`getUser` å°†è¿›è¡Œè®°å¿†åŒ–ã€‚</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token string">'demo-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Profile</span></span> <span class="token attr-name">user</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>React åªå…è®¸åœ¨ç»„ä»¶å†…è®¿é—®è®°å¿†åŒ–å‡½æ•°çš„ç¼“å­˜ã€‚åœ¨ç»„ä»¶å¤–éƒ¨è°ƒç”¨<codestep step="{1}"><code>getUser</code></codestep>æ—¶ï¼Œå®ƒä»ä¼šè¯„ä¼°å‡½æ•°ï¼Œä½†ä¸ä¼šè¯»å–æˆ–æ›´æ–°ç¼“å­˜ã€‚<p>è¿™æ˜¯å› ä¸ºç¼“å­˜è®¿é—®æ˜¯é€šè¿‡ <a href="/learn/passing-data-deeply-with-context">ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰</a> æä¾›çš„ï¼Œè€Œä¸Šä¸‹æ–‡åªèƒ½ä»ç»„ä»¶ä¸­è®¿é—®ã€‚</p><deepdive></deepdive></section></pitfall></section><section class="level4"aria-labelledby="åº”è¯¥ä½•æ—¶ä½¿ç”¨-cachememo-å’Œ-usememo-cache-memo-usememo"><h4 id="åº”è¯¥ä½•æ—¶ä½¿ç”¨-cachememo-å’Œ-usememo-cache-memo-usememo">åº”è¯¥ä½•æ—¶ä½¿ç”¨ <code>cache</code>ã€<a href="/reference/react/memo"><code>memo</code></a> å’Œ <a href="/reference/react/useMemo"><code>useMemo</code></a>ï¼Ÿ {/<em>cache-memo-usememo</em>/}</h4><p>æ‰€æœ‰æåˆ°çš„ API éƒ½æä¾›äº†è®°å¿†åŒ–åŠŸèƒ½ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºè®°å¿†åŒ–ä»€ä¹ˆã€è°å¯ä»¥è®¿é—®ç¼“å­˜ä»¥åŠä½•æ—¶ç¼“å­˜ä¼šå¤±æ•ˆã€‚</section><section class="level4"aria-labelledby="usememo-deep-dive-use-memo"><h4 id="usememo-deep-dive-use-memo"><code>useMemo</code> {/<em>deep-dive-use-memo</em>/}</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<a href="/reference/react/useMemo"><code>useMemo</code></a> ç”¨äºåœ¨å®¢æˆ·ç«¯ç»„ä»¶è·¨æ¸²æŸ“æ—¶ç¼“å­˜æ˜‚è´µçš„è®¡ç®—ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç”¨å®ƒæ¥è®°å¿†åŒ–ç»„ä»¶å†…éƒ¨æ•°æ®çš„è½¬æ¢ã€‚<pre class="language-jsx"><code class="language-jsx"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">WeatherReport</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> avgTemp <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">calculateAvg</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> record <span class="token operator">=</span> <span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">WeatherReport</span></span> <span class="token attr-name">record</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">WeatherReport</span></span> <span class="token attr-name">record</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>App</code> æ¸²æŸ“äº†ä¸¤ä¸ªå…·æœ‰ç›¸åŒè®°å½•çš„ <code>WeatherReport</code>ã€‚å°½ç®¡è¿™ä¸¤ä¸ªç»„ä»¶éƒ½æ‰§è¡Œç›¸åŒçš„å·¥ä½œï¼Œä½†å®ƒä»¬æ— æ³•å…±äº«å·¥ä½œã€‚<code>useMemo</code> çš„ç¼“å­˜ä»…åœ¨ç»„ä»¶å†…éƒ¨å¯ç”¨ã€‚<p>ä½†æ˜¯ <code>useMemo</code> èƒ½å¤Ÿç¡®ä¿å¦‚æœ <code>App</code> é‡æ–°æ¸²æŸ“å¹¶ä¸” <code>record</code> å¯¹è±¡æ²¡æœ‰æ›´æ”¹ï¼Œæ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½å°†è·³è¿‡å·¥ä½œå¹¶ä½¿ç”¨ <code>avgTemp</code> çš„è®°å¿†åŒ–å€¼ã€‚<code>useMemo</code> ä»…ä¼šç¼“å­˜å…·æœ‰ç»™å®šä¾èµ–é¡¹çš„ <code>avgTemp</code> çš„æœ€åä¸€æ¬¡è®¡ç®—ç»“æœã€‚</section><section class="level4"aria-labelledby="cache-deep-dive-cache"><h4 id="cache-deep-dive-cache"><code>cache</code> {/<em>deep-dive-cache</em>/}</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>cache</code> åº”ç”¨äºæœåŠ¡å™¨ç»„ä»¶ä»¥è®°å¿†åŒ–å¯ä»¥è·¨ç»„ä»¶å…±äº«çš„å·¥ä½œã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> cachedFetchReport <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>fetchReport<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">WeatherReport</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>city<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">cachedFetchReport</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> city <span class="token operator">=</span> <span class="token string">"Los Angeles"</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">WeatherReport</span> city<span class="token operator">=</span><span class="token punctuation">{</span>city<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">WeatherReport</span> city<span class="token operator">=</span><span class="token punctuation">{</span>city<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>ä½¿ç”¨ <code>cache</code> é‡æ–°ç¼–å†™å‰é¢çš„ç¤ºä¾‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<codestep step="{3}"><code>WeatherReport</code> çš„ç¬¬äºŒä¸ªå®ä¾‹</codestep>å°†èƒ½å¤Ÿè·³è¿‡é‡å¤çš„å·¥ä½œå¹¶ä»ä¸ç¬¬ä¸€ä¸ª <code>WeatherReport</code> ç›¸åŒçš„ç¼“å­˜ä¸­è¯»å–ã€‚ä¸å‰é¢çš„ç¤ºä¾‹ä¸åŒçš„å¦ä¸€ä¸ªåœ°æ–¹æ˜¯ï¼Œ<code>cache</code> ä¹Ÿæ¨èç”¨äº<codestep step="{2}">è®°å¿†åŒ–æ•°æ®è·å–</codestep>ï¼Œè€Œ <code>useMemo</code> åªåº”ç”¨äºè®¡ç®—ã€‚<p>ç›®å‰ <code>cache</code> åº”è¯¥ä»…åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”ç¼“å­˜ä¼šåœ¨æœåŠ¡å™¨è¯·æ±‚ä¹‹é—´å¤±æ•ˆã€‚</section><section class="level4"aria-labelledby="memo-deep-dive-memo"><h4 id="memo-deep-dive-memo"><code>memo</code> {/<em>deep-dive-memo</em>/}</h4><p>ä½ åº”è¯¥ä½¿ç”¨ <a href="reference/react/memo"><code>memo</code></a> é˜²æ­¢ç»„ä»¶åœ¨å…¶ <code>props</code> æœªæ›´æ”¹æ—¶é‡æ–°æ¸²æŸ“ã€‚<pre class="language-js"><code class="language-js"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">WeatherReport</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> avgTemp <span class="token operator">=</span> <span class="token function">calculateAvg</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">MemoWeatherReport</span> <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token maybe-class-name">WeatherReport</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> record <span class="token operator">=</span> <span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MemoWeatherReport</span> record<span class="token operator">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MemoWeatherReport</span> record<span class="token operator">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä¸¤ä¸ª <code>MemoWeatherReport</code> ç»„ä»¶åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè°ƒç”¨ <code>calculateAvg</code>ã€‚ç„¶è€Œï¼Œå¦‚æœ <code>App</code> é‡æ–°æ¸²æŸ“ï¼Œä½†æ²¡æœ‰æ›´æ”¹ <code>record</code>ï¼Œåˆ™æ²¡æœ‰ props å‘ç”Ÿæ›´æ”¹ï¼Œ<code>MemoWeatherReport</code> å°†ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚<p>ä¸ <code>useMemo</code> ç›¸æ¯”ï¼Œ<code>memo</code> æ ¹æ® props è€Œä¸æ˜¯ç‰¹å®šè®¡ç®—æ¥è®°å¿†åŒ–ç»„ä»¶æ¸²æŸ“ã€‚ä¸ <code>useMemo</code> ç±»ä¼¼ï¼Œè®°å¿†åŒ–çš„ç»„ä»¶åªç¼“å­˜äº†å…·æœ‰æœ€åä¸€ç»„ prop å€¼çš„æœ€åä¸€æ¬¡æ¸²æŸ“ã€‚ä¸€æ—¦ props æ›´æ”¹ï¼Œç¼“å­˜å°†å¤±æ•ˆï¼Œç»„ä»¶å°†é‡æ–°æ¸²æŸ“ã€‚</section></deepdive></section></section><section class="level2"aria-labelledby="ç–‘éš¾è§£ç­”-troubleshooting"><h2 id="ç–‘éš¾è§£ç­”-troubleshooting">ç–‘éš¾è§£ç­” {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="å°½ç®¡ä¼ é€’çš„æ˜¯ç›¸åŒå‚æ•°æˆ‘çš„è®°å¿†åŒ–å‡½æ•°ä»åœ¨é‡æ–°è¿è¡Œ-memoized-function-still-runs"><h3 id="å°½ç®¡ä¼ é€’çš„æ˜¯ç›¸åŒå‚æ•°æˆ‘çš„è®°å¿†åŒ–å‡½æ•°ä»åœ¨é‡æ–°è¿è¡Œ-memoized-function-still-runs">å°½ç®¡ä¼ é€’çš„æ˜¯ç›¸åŒå‚æ•°ï¼Œæˆ‘çš„è®°å¿†åŒ–å‡½æ•°ä»åœ¨é‡æ–°è¿è¡Œ {/<em>memoized-function-still-runs</em>/}</h3><p>è¯·æŸ¥çœ‹ä¹‹å‰æåˆ°çš„å¸¸è§é—®é¢˜ï¼š<ul><li><a href="#pitfall-different-memoized-functions">è°ƒç”¨ä¸åŒçš„è®°å¿†åŒ–å‡½æ•°å°†ä»ä¸åŒçš„ç¼“å­˜ä¸­è¯»å–</a>ã€‚<li><a href="#pitfall-memoized-call-outside-component">åœ¨ç»„ä»¶å¤–éƒ¨è°ƒç”¨è®°å¿†åŒ–å‡½æ•°å°†ä¸ä½¿ç”¨ç¼“å­˜</a>ã€‚</ul><p>å¦‚æœä»¥ä¸Šé—®é¢˜éƒ½ä¸é€‚ç”¨ï¼Œé‚£ä¹ˆå¯èƒ½æ˜¯ä¸ React æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨å†…å®¹çš„æ–¹å¼æœ‰å…³ã€‚<p>å¦‚æœå‚æ•°ä¸æ˜¯åŸå§‹æ•°æ®ç±»å‹(<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Primitive)%EF%BC%88%E4%BE%8B%E5%A6%82%E5%AF%B9%E8%B1%A1%E3%80%81%E5%87%BD%E6%95%B0%E3%80%81%E6%95%B0%E7%BB%84%EF%BC%89%EF%BC%8C%E8%AF%B7%E7%A1%AE%E4%BF%9D%E4%BC%A0%E9%80%92%E7%9A%84%E6%98%AF%E7%9B%B8%E5%90%8C%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%BC%95%E7%94%A8%E3%80%82">https://developer.mozilla.org/zh-CN/docs/Glossary/Primitive)ï¼ˆä¾‹å¦‚å¯¹è±¡ã€å‡½æ•°ã€æ•°ç»„ï¼‰ï¼Œè¯·ç¡®ä¿ä¼ é€’çš„æ˜¯ç›¸åŒçš„å¯¹è±¡å¼•ç”¨ã€‚</a><p>åœ¨è°ƒç”¨è®°å¿†åŒ–å‡½æ•°æ—¶ï¼ŒReact å°†æŸ¥æ‰¾è¾“å…¥å‚æ•°ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦å·²ç»ç¼“å­˜äº†ç»“æœã€‚React å°†ä½¿ç”¨æµ…ç›¸ç­‰ç¡®å®šæ˜¯å¦å­˜åœ¨ç¼“å­˜ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> calculateNorm <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">vector</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MapMarker</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ğŸš© é”™è¯¯ç¤ºä¾‹ï¼šprops æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šæ›´æ”¹</span>
  <span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token function">calculateNorm</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸¤ä¸ª <code>MapMarker</code> çœ‹èµ·æ¥æ‰§è¡Œç›¸åŒçš„å·¥ä½œï¼Œå¹¶ä½¿ç”¨ç›¸åŒçš„å€¼ <code>{x: 10, y: 10, z: 10}</code> è°ƒç”¨ <code>calculateNorm</code>ã€‚å°½ç®¡è¿™äº›å¯¹è±¡åŒ…å«ç›¸åŒçš„å€¼ï¼Œä½†å®ƒä»¬ä¸æ˜¯ç›¸åŒçš„å¯¹è±¡å¼•ç”¨ï¼Œå› ä¸ºæ¯ä¸ªç»„ä»¶éƒ½åˆ›å»ºäº†è‡ªå·±çš„ props å¯¹è±¡ã€‚<p>React å°†è°ƒç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is">Object.is</a> æ¥éªŒè¯æ˜¯å¦å­˜åœ¨ç¼“å­˜å‘½ä¸­ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> calculateNorm <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MapMarker</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šä¼ é€’åŸå§‹ç±»å‹ç»™è®°å¿†åŒ–å‡½æ•°</span>
  <span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token function">calculateNorm</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span><span class="token property-access">z</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯å°†å‘é‡çš„ç»´åº¦ä¼ é€’ç»™ <code>calculateNorm</code>ã€‚è¿™ä¸ªæ–¹æ³•æœ‰æ•ˆï¼Œå› ä¸ºç»´åº¦æœ¬èº«æ˜¯åŸå§‹æ•°æ®ç±»å‹ã€‚<p>å¦ä¸€ç§è§£å†³æ–¹æ¡ˆå¯èƒ½æ˜¯å°†å‘é‡å¯¹è±¡æœ¬èº«ä½œä¸ºä¸€ä¸ª prop ä¼ é€’ç»™ç»„ä»¶ã€‚æˆ‘ä»¬éœ€è¦å°†ç›¸åŒçš„å¯¹è±¡ä¼ é€’ç»™ä¸¤ä¸ªç»„ä»¶å®ä¾‹ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> calculateNorm <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">vector</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MapMarker</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šä¼ é€’ç›¸åŒçš„ `vector` å¯¹è±¡ã€‚</span>
  <span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token function">calculateNorm</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token property-access">vector</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vector <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> vector<span class="token operator">=</span><span class="token punctuation">{</span>vector<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> vector<span class="token operator">=</span><span class="token punctuation">{</span>vector<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></canary></section>