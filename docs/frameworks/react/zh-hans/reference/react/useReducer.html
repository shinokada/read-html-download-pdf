<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>useReducer</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="usereducer"><h1 id="usereducer">useReducer</h1><intro><p><code>useReducer</code> æ˜¯ä¸€ä¸ª React Hookï¼Œå®ƒå…è®¸ä½ å‘ç»„ä»¶é‡Œé¢æ·»åŠ ä¸€ä¸ª <a href="/learn/extracting-state-logic-into-a-reducer">reducer</a>ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialArg<span class="token punctuation">,</span> init<span class="token operator">?</span><span class="token punctuation">)</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="å‚è€ƒ-reference"><h2 id="å‚è€ƒ-reference">å‚è€ƒ {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="usereducerreducer-initialarg-init-usereducer"><h3 id="usereducerreducer-initialarg-init-usereducer"><code>useReducer(reducer, initialArg, init?)</code> {/<em>usereducer</em>/}</h3><p>åœ¨ç»„ä»¶çš„é¡¶å±‚ä½œç”¨åŸŸè°ƒç”¨ <code>useReducer</code> ä»¥åˆ›å»ºä¸€ä¸ªç”¨äºç®¡ç†çŠ¶æ€çš„ <a href="/learn/extracting-state-logic-into-a-reducer">reducer</a>ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><a href="#usage">å‚è§ä¸‹æ–¹æ›´å¤šç¤ºä¾‹</a>ã€‚<section class="level4"aria-labelledby="å‚æ•°-parameters"><h4 id="å‚æ•°-parameters">å‚æ•° {/<em>parameters</em>/}</h4><ul><li><code>reducer</code>ï¼šç”¨äºæ›´æ–° state çš„çº¯å‡½æ•°ã€‚å‚æ•°ä¸º state å’Œ actionï¼Œè¿”å›å€¼æ˜¯æ›´æ–°åçš„ stateã€‚state ä¸ action å¯ä»¥æ˜¯ä»»æ„åˆæ³•å€¼ã€‚<li><code>initialArg</code>ï¼šç”¨äºåˆå§‹åŒ– state çš„ä»»æ„å€¼ã€‚åˆå§‹å€¼çš„è®¡ç®—é€»è¾‘å–å†³äºæ¥ä¸‹æ¥çš„ <code>init</code> å‚æ•°ã€‚<li><strong>å¯é€‰å‚æ•°</strong> <code>init</code>ï¼šç”¨äºè®¡ç®—åˆå§‹å€¼çš„å‡½æ•°ã€‚å¦‚æœå­˜åœ¨ï¼Œä½¿ç”¨ <code>init(initialArg)</code> çš„æ‰§è¡Œç»“æœä½œä¸ºåˆå§‹å€¼ï¼Œå¦åˆ™ä½¿ç”¨ <code>initialArg</code>ã€‚</ul></section><section class="level4"aria-labelledby="è¿”å›å€¼-returns"><h4 id="è¿”å›å€¼-returns">è¿”å›å€¼ {/<em>returns</em>/}</h4><p><code>useReducer</code> è¿”å›ä¸€ä¸ªç”±ä¸¤ä¸ªå€¼ç»„æˆçš„æ•°ç»„ï¼š<ol><li>å½“å‰çš„ stateã€‚åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œå®ƒæ˜¯ <code>init(initialArg)</code> æˆ– <code>initialArg</code> ï¼ˆå¦‚æœæ²¡æœ‰ <code>init</code> å‡½æ•°ï¼‰ã€‚<li><a href="#dispatch"><code>dispatch</code> å‡½æ•°</a>ã€‚ç”¨äºæ›´æ–° state å¹¶è§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</ol></section><section class="level4"aria-labelledby="æ³¨æ„äº‹é¡¹-caveats"><h4 id="æ³¨æ„äº‹é¡¹-caveats">æ³¨æ„äº‹é¡¹ {/<em>caveats</em>/}</h4><ul><li><code>useReducer</code> æ˜¯ä¸€ä¸ª Hookï¼Œæ‰€ä»¥åªèƒ½åœ¨ <strong>ç»„ä»¶çš„é¡¶å±‚ä½œç”¨åŸŸ</strong> æˆ–è‡ªå®šä¹‰ Hook ä¸­è°ƒç”¨ï¼Œè€Œä¸èƒ½åœ¨å¾ªç¯æˆ–æ¡ä»¶è¯­å¥ä¸­è°ƒç”¨ã€‚å¦‚æœä½ æœ‰è¿™ç§éœ€æ±‚ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œå¹¶æŠŠ state ç§»å…¥å…¶ä¸­ã€‚<li>ä¸¥æ ¼æ¨¡å¼ä¸‹ React ä¼š <strong>è°ƒç”¨ä¸¤æ¬¡ reducer å’Œåˆå§‹åŒ–å‡½æ•°</strong>ï¼Œè¿™å¯ä»¥ <a href="#my-reducer-or-initializer-function-runs-twice">å¸®åŠ©ä½ å‘ç°æ„å¤–çš„å‰¯ä½œç”¨</a>ã€‚è¿™åªæ˜¯å¼€å‘æ¨¡å¼ä¸‹çš„è¡Œä¸ºï¼Œå¹¶ä¸ä¼šå½±å“ç”Ÿäº§ç¯å¢ƒã€‚åªè¦ reducer å’Œåˆå§‹åŒ–å‡½æ•°æ˜¯çº¯å‡½æ•°ï¼ˆç†åº”å¦‚æ­¤ï¼‰å°±ä¸ä¼šæ”¹å˜ä½ çš„é€»è¾‘ã€‚å…¶ä¸­ä¸€ä¸ªè°ƒç”¨ç»“æœä¼šè¢«å¿½ç•¥ã€‚</ul></section></section><section class="level3"aria-labelledby="dispatch-å‡½æ•°-dispatch"><h3 id="dispatch-å‡½æ•°-dispatch"><code>dispatch</code> å‡½æ•° {/<em>dispatch</em>/}</h3><p><code>useReducer</code> è¿”å›çš„ <code>dispatch</code> å‡½æ•°å…è®¸ä½ æ›´æ–° state å¹¶è§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚å®ƒéœ€è¦ä¼ å…¥ä¸€ä¸ª action ä½œä¸ºå‚æ•°ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p>React ä¼šè°ƒç”¨ <code>reducer</code> å‡½æ•°ä»¥æ›´æ–° stateï¼Œ<code>reducer</code> å‡½æ•°çš„å‚æ•°ä¸ºå½“å‰çš„ state ä¸ä¼ é€’çš„ actionã€‚<section class="level4"aria-labelledby="å‚æ•°-dispatch-parameters"><h4 id="å‚æ•°-dispatch-parameters">å‚æ•° {/<em>dispatch-parameters</em>/}</h4><ul><li><code>action</code>ï¼šç”¨æˆ·æ‰§è¡Œçš„æ“ä½œã€‚å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å€¼ã€‚é€šå¸¸æ¥è¯´ action æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­ <code>type</code> å±æ€§æ ‡è¯†ç±»å‹ï¼Œå…¶å®ƒå±æ€§æºå¸¦é¢å¤–ä¿¡æ¯ã€‚</ul></section><section class="level4"aria-labelledby="è¿”å›å€¼-dispatch-returns"><h4 id="è¿”å›å€¼-dispatch-returns">è¿”å›å€¼ {/<em>dispatch-returns</em>/}</h4><p><code>dispatch</code> å‡½æ•°æ²¡æœ‰è¿”å›å€¼ã€‚</section><section class="level4"aria-labelledby="æ³¨æ„-setstate-caveats"><h4 id="æ³¨æ„-setstate-caveats">æ³¨æ„ {/<em>setstate-caveats</em>/}</h4><ul><li><p><code>dispatch</code> å‡½æ•° <strong>æ˜¯ä¸ºä¸‹ä¸€æ¬¡æ¸²æŸ“è€Œæ›´æ–° state</strong>ã€‚å› æ­¤åœ¨è°ƒç”¨ <code>dispatch</code> å‡½æ•°åè¯»å– state <a href="#ive-dispatched-an-action-but-logging-gives-me-the-old-state-value">å¹¶ä¸ä¼šæ‹¿åˆ°æ›´æ–°åçš„å€¼</a>ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½è·å–åˆ°è°ƒç”¨å‰çš„å€¼ã€‚<li><p>å¦‚æœä½ æä¾›çš„æ–°å€¼ä¸å½“å‰çš„ <code>state</code> ç›¸åŒï¼ˆä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a> æ¯”è¾ƒï¼‰ï¼ŒReact ä¼š <strong>è·³è¿‡ç»„ä»¶å’Œå­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“</strong>ï¼Œè¿™æ˜¯ä¸€ç§ä¼˜åŒ–æ‰‹æ®µã€‚è™½ç„¶åœ¨è·³è¿‡é‡æ–°æ¸²æŸ“å‰ React å¯èƒ½ä¼šè°ƒç”¨ä½ çš„ç»„ä»¶ï¼Œä½†æ˜¯è¿™ä¸åº”è¯¥å½±å“ä½ çš„ä»£ç ã€‚<li><p>React <a href="/learn/queueing-a-series-of-state-updates">ä¼šæ‰¹é‡æ›´æ–° state</a>ã€‚state ä¼šåœ¨ <strong>æ‰€æœ‰äº‹ä»¶å‡½æ•°æ‰§è¡Œå®Œæ¯•</strong> å¹¶ä¸”å·²ç»è°ƒç”¨è¿‡å®ƒçš„ <code>set</code> å‡½æ•°åè¿›è¡Œæ›´æ–°ï¼Œè¿™å¯ä»¥é˜²æ­¢åœ¨ä¸€ä¸ªäº‹ä»¶ä¸­å¤šæ¬¡è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚å¦‚æœåœ¨è®¿é—® DOM ç­‰æå°‘æ•°æƒ…å†µä¸‹éœ€è¦å¼ºåˆ¶ React æå‰æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ <a href="/reference/react-dom/flushSync"><code>flushSync</code></a>ã€‚</ul></section></section></section><section class="level2"aria-labelledby="ç”¨æ³•-usage"><h2 id="ç”¨æ³•-usage">ç”¨æ³• {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="å‘ç»„ä»¶æ·»åŠ -reducer-adding-a-reducer-to-a-component"><h3 id="å‘ç»„ä»¶æ·»åŠ -reducer-adding-a-reducer-to-a-component">å‘ç»„ä»¶æ·»åŠ  reducer {/<em>adding-a-reducer-to-a-component</em>/}</h3><p>åœ¨ç»„ä»¶çš„é¡¶å±‚ä½œç”¨åŸŸè°ƒç”¨ <code>useReducer</code> æ¥åˆ›å»ºä¸€ä¸ªç”¨äºç®¡ç†çŠ¶æ€ï¼ˆstateï¼‰çš„ <a href="/learn/extracting-state-logic-into-a-reducer">reducer</a>ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p><code>useReducer</code> è¿”å›ä¸€ä¸ªç”±ä¸¤ä¸ªå€¼ç»„æˆçš„æ•°ç»„ï¼š<ol><li><codestep step="{1}">å½“å‰çš„ state</codestep>ï¼Œé¦–æ¬¡æ¸²æŸ“æ—¶ä¸ºä½ æä¾›çš„<codestep step="{3}">åˆå§‹å€¼</codestep>ã€‚<li><codestep step="{2}"><code>dispatch</code> å‡½æ•°</codestep>ï¼Œè®©ä½ å¯ä»¥æ ¹æ®äº¤äº’ä¿®æ”¹ stateã€‚</ol><p>ä¸ºäº†æ›´æ–°å±å¹•ä¸Šçš„å†…å®¹ï¼Œä½¿ç”¨ä¸€ä¸ªè¡¨ç¤ºç”¨æˆ·æ“ä½œçš„ action æ¥è°ƒç”¨<codestep step="{2}"><code>dispatch</code></codestep>å‡½æ•°ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>React ä¼šæŠŠå½“å‰çš„ state å’Œè¿™ä¸ª action ä¸€èµ·ä½œä¸ºå‚æ•°ä¼ ç»™<codestep step="{4}">reducer å‡½æ•°</codestep>ï¼Œç„¶å reducer è®¡ç®—å¹¶è¿”å›æ–°çš„ stateï¼Œæœ€å React ä¿å­˜æ–°çš„ stateï¼Œå¹¶ä½¿ç”¨å®ƒæ¸²æŸ“ç»„ä»¶å’Œæ›´æ–° UIã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span> <span class="token operator">===</span> <span class="token string">'incremented_age'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Counter</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Increment</span> age
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Hello</span><span class="token operator">!</span> <span class="token maybe-class-name">You</span> are <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p><code>useReducer</code> å’Œ <a href="/reference/react/useState"><code>useState</code></a> éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒå¯ä»¥è®©ä½ æŠŠçŠ¶æ€æ›´æ–°é€»è¾‘ä»äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ç§»åŠ¨åˆ°ç»„ä»¶å¤–éƒ¨ã€‚è¯¦æƒ…å¯ä»¥å‚é˜… <a href="/learn/extracting-state-logic-into-a-reducer#comparing-usestate-and-usereducer">å¯¹æ¯” <code>useState</code> å’Œ <code>useReducer</code></a>ã€‚</section><section class="level3"aria-labelledby="å®ç°-reducer-å‡½æ•°-writing-the-reducer-function"><h3 id="å®ç°-reducer-å‡½æ•°-writing-the-reducer-function">å®ç° reducer å‡½æ•° {/<em>writing-the-reducer-function</em>/}</h3><p>reducer å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>ä½ éœ€è¦å¾€å‡½æ•°ä½“é‡Œé¢æ·»åŠ è®¡ç®—å¹¶è¿”å›æ–°çš„ state çš„é€»è¾‘ã€‚ä¸€èˆ¬ä¼šä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/switch"><code>switch</code> è¯­å¥</a> æ¥å®Œæˆã€‚åœ¨ <code>switch</code> è¯­å¥ä¸­é€šè¿‡åŒ¹é… <code>case</code> æ¡ä»¶æ¥è®¡ç®—å¹¶è¿”å›ç›¸åº”çš„ stateã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'changed_name'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">nextName</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>action å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œä¸è¿‡é€šå¸¸è‡³å°‘æ˜¯ä¸€ä¸ªå­˜åœ¨ <code>type</code> å±æ€§çš„å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒéœ€è¦æºå¸¦è®¡ç®—æ–°çš„ state å€¼æ‰€å¿…é¡»çš„æ•°æ®ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Taylor'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">function</span> <span class="token function">handleButtonClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleInputChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'changed_name'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">nextName</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span></code></pre><p>action çš„ type ä¾èµ–äºç»„ä»¶çš„å®é™…æƒ…å†µã€‚<a href="/learn/extracting-state-logic-into-a-reducer#writing-reducers-well">å³ä½¿å®ƒä¼šå¯¼è‡´æ•°æ®çš„å¤šæ¬¡æ›´æ–°ï¼Œæ¯ä¸ª action éƒ½åªæè¿°ä¸€æ¬¡äº¤äº’</a>ã€‚state çš„ç±»å‹ä¹Ÿæ˜¯ä»»æ„çš„ï¼Œä¸è¿‡ä¸€èˆ¬ä¼šä½¿ç”¨å¯¹è±¡æˆ–æ•°ç»„ã€‚<p>é˜…è¯» <a href="/learn/extracting-state-logic-into-a-reducer">è¿ç§»çŠ¶æ€é€»è¾‘è‡³ Reducer ä¸­</a> æ¥äº†è§£æ›´å¤šå†…å®¹ã€‚</p><pitfall><p>state æ˜¯åªè¯»çš„ã€‚å³ä½¿æ˜¯å¯¹è±¡æˆ–æ•°ç»„ä¹Ÿä¸è¦å°è¯•ä¿®æ”¹å®ƒï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ğŸš© ä¸è¦åƒä¸‹é¢è¿™æ ·ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡ç±»å‹çš„ stateï¼š</span>
      state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre><p>æ­£ç¡®çš„åšæ³•æ˜¯è¿”å›æ–°çš„å¯¹è±¡ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// âœ… æ­£ç¡®çš„åšæ³•æ˜¯è¿”å›æ–°çš„å¯¹è±¡</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre><p>é˜…è¯» <a href="/learn/updating-objects-in-state">æ›´æ–°å¯¹è±¡ç±»å‹çš„ state</a> å’Œ <a href="/learn/updating-arrays-in-state">æ›´æ–°æ•°ç»„ç±»å‹çš„ state</a> æ¥äº†è§£æ›´å¤šå†…å®¹ã€‚</p></pitfall><recipes titletext="useReducer çš„åŸºç¡€ç¤ºä¾‹"titleid="examples-basic"><section class="level4"aria-labelledby="è¡¨å•å¯¹è±¡ç±»å‹-form-object"><h4 id="è¡¨å•å¯¹è±¡ç±»å‹-form-object">è¡¨å•ï¼ˆå¯¹è±¡ç±»å‹ï¼‰ {/<em>form-object</em>/}</h4><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œstate æ˜¯ä¸€ä¸ªæœ‰ <code>name</code> å’Œ <code>age</code> å±æ€§çš„å¯¹è±¡ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'changed_name'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">nextName</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Taylor'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleButtonClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleInputChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'changed_name'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">nextName</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span>handleInputChange<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleButtonClick<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Increment</span> age
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span><span class="token maybe-class-name">Hello</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token punctuation">.</span> <span class="token property-access"><span class="token maybe-class-name">You</span></span> are <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="ä»£åŠäº‹é¡¹æ•°ç»„ç±»å‹-todo-list-array"><h4 id="ä»£åŠäº‹é¡¹æ•°ç»„ç±»å‹-todo-list-array">ä»£åŠäº‹é¡¹ï¼ˆæ•°ç»„ç±»å‹ï¼‰ {/<em>todo-list-array</em>/}</h4><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œreducer ç®¡ç†ä¸€ä¸ªåä¸º tasks çš„æ•°ç»„ã€‚æ•°ç»„ <a href="/learn/updating-arrays-in-state">ä¸èƒ½ä½¿ç”¨ä¿®æ”¹æ–¹æ³•</a> æ¥æ›´æ–°ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">AddTask</span></span> <span class="token keyword module">from</span> <span class="token string">'./AddTask.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TaskList</span></span> <span class="token keyword module">from</span> <span class="token string">'./TaskList.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">tasksReducer</span><span class="token punctuation">(</span><span class="token parameter">tasks<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'added'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span><span class="token spread operator">...</span>tasks<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">text</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">,</span>
        <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'changed'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> tasks<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> action<span class="token punctuation">.</span><span class="token property-access">task</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">return</span> action<span class="token punctuation">.</span><span class="token property-access">task</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">return</span> t<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'deleted'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> tasks<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token arrow operator">=></span> t<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> action<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TaskApp</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tasks<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>
    tasksReducer<span class="token punctuation">,</span>
    initialTasks
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddTask</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'added'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> text<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleChangeTask</span><span class="token punctuation">(</span><span class="token parameter">task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'changed'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">task</span><span class="token operator">:</span> task
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleDeleteTask</span><span class="token punctuation">(</span><span class="token parameter">taskId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'deleted'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Prague</span> itinerary<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddTask</span>
        onAddTask<span class="token operator">=</span><span class="token punctuation">{</span>handleAddTask<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TaskList</span>
        tasks<span class="token operator">=</span><span class="token punctuation">{</span>tasks<span class="token punctuation">}</span>
        onChangeTask<span class="token operator">=</span><span class="token punctuation">{</span>handleChangeTask<span class="token punctuation">}</span>
        onDeleteTask<span class="token operator">=</span><span class="token punctuation">{</span>handleDeleteTask<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> initialTasks <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddTask</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onAddTask <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        placeholder<span class="token operator">=</span><span class="token string">"Add task"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onAddTask</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Add</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TaskList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  tasks<span class="token punctuation">,</span>
  onChangeTask<span class="token punctuation">,</span>
  onDeleteTask
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
      <span class="token punctuation">{</span>tasks<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Task</span>
            task<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChangeTask<span class="token punctuation">}</span>
            onDelete<span class="token operator">=</span><span class="token punctuation">{</span>onDeleteTask<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Task</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> task<span class="token punctuation">,</span> onChange<span class="token punctuation">,</span> onDelete <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isEditing<span class="token punctuation">,</span> setIsEditing<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> taskContent<span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isEditing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    taskContent <span class="token operator">=</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token spread operator">...</span>task<span class="token punctuation">,</span>
              <span class="token literal-property property">text</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsEditing</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Save</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    taskContent <span class="token operator">=</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsEditing</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Edit</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        type<span class="token operator">=</span><span class="token string">"checkbox"</span>
        checked<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">done</span><span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token spread operator">...</span>task<span class="token punctuation">,</span>
            <span class="token literal-property property">done</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>taskContent<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onDelete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Delete</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">ul<span class="token punctuation">,</span> li</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="ä½¿ç”¨-immer-ç¼–å†™ç®€æ´çš„æ›´æ–°é€»è¾‘-writing-concise-update-logic-with-immer"><h4 id="ä½¿ç”¨-immer-ç¼–å†™ç®€æ´çš„æ›´æ–°é€»è¾‘-writing-concise-update-logic-with-immer">ä½¿ç”¨ Immer ç¼–å†™ç®€æ´çš„æ›´æ–°é€»è¾‘ {/<em>writing-concise-update-logic-with-immer</em>/}</h4><p>å¦‚æœä½¿ç”¨å¤åˆ¶æ–¹æ³•æ›´æ–°æ•°ç»„å’Œå¯¹è±¡è®©ä½ ä¸åŒå…¶çƒ¦ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <a href="https://github.com/immerjs/use-immer#useimmerreducer">Immer</a> è¿™æ ·çš„åº“æ¥å‡å°‘ä¸€äº›é‡å¤çš„æ ·æ¿ä»£ç ã€‚Immer è®©ä½ å¯ä»¥ä¸“æ³¨äºé€»è¾‘ï¼Œå› ä¸ºå®ƒåœ¨å†…éƒ¨å‡ä½¿ç”¨å¤åˆ¶æ–¹æ³•æ¥å®Œæˆæ›´æ–°ï¼š</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useImmerReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'use-immer'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">AddTask</span></span> <span class="token keyword module">from</span> <span class="token string">'./AddTask.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TaskList</span></span> <span class="token keyword module">from</span> <span class="token string">'./TaskList.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">tasksReducer</span><span class="token punctuation">(</span><span class="token parameter">draft<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'added'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      draft<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">text</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">,</span>
        <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'changed'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> index <span class="token operator">=</span> draft<span class="token punctuation">.</span><span class="token method function property-access">findIndex</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token arrow operator">=></span>
        t<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> action<span class="token punctuation">.</span><span class="token property-access">task</span><span class="token punctuation">.</span><span class="token property-access">id</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      draft<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> action<span class="token punctuation">.</span><span class="token property-access">task</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'deleted'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> draft<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token arrow operator">=></span> t<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> action<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TaskApp</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tasks<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useImmerReducer</span><span class="token punctuation">(</span>
    tasksReducer<span class="token punctuation">,</span>
    initialTasks
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddTask</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'added'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> text<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleChangeTask</span><span class="token punctuation">(</span><span class="token parameter">task</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'changed'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">task</span><span class="token operator">:</span> task
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleDeleteTask</span><span class="token punctuation">(</span><span class="token parameter">taskId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'deleted'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Prague</span> itinerary<span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">AddTask</span>
        onAddTask<span class="token operator">=</span><span class="token punctuation">{</span>handleAddTask<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TaskList</span>
        tasks<span class="token operator">=</span><span class="token punctuation">{</span>tasks<span class="token punctuation">}</span>
        onChangeTask<span class="token operator">=</span><span class="token punctuation">{</span>handleChangeTask<span class="token punctuation">}</span>
        onDeleteTask<span class="token operator">=</span><span class="token punctuation">{</span>handleDeleteTask<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> initialTasks <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AddTask</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onAddTask <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        placeholder<span class="token operator">=</span><span class="token string">"Add task"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onAddTask</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Add</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TaskList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  tasks<span class="token punctuation">,</span>
  onChangeTask<span class="token punctuation">,</span>
  onDeleteTask
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
      <span class="token punctuation">{</span>tasks<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Task</span>
            task<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChangeTask<span class="token punctuation">}</span>
            onDelete<span class="token operator">=</span><span class="token punctuation">{</span>onDeleteTask<span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Task</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> task<span class="token punctuation">,</span> onChange<span class="token punctuation">,</span> onDelete <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isEditing<span class="token punctuation">,</span> setIsEditing<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> taskContent<span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isEditing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    taskContent <span class="token operator">=</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          value<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token spread operator">...</span>task<span class="token punctuation">,</span>
              <span class="token literal-property property">text</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsEditing</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Save</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    taskContent <span class="token operator">=</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setIsEditing</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Edit</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        type<span class="token operator">=</span><span class="token string">"checkbox"</span>
        checked<span class="token operator">=</span><span class="token punctuation">{</span>task<span class="token punctuation">.</span><span class="token property-access">done</span><span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token spread operator">...</span>task<span class="token punctuation">,</span>
            <span class="token literal-property property">done</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">{</span>taskContent<span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">onDelete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Delete</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">button</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">ul<span class="token punctuation">,</span> li</span> <span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"immer"</span><span class="token operator">:</span> <span class="token string">"1.7.3"</span><span class="token punctuation">,</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token property">"use-immer"</span><span class="token operator">:</span> <span class="token string">"0.5.1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section></recipes></section><section class="level3"aria-labelledby="é¿å…é‡æ–°åˆ›å»ºåˆå§‹å€¼-avoiding-recreating-the-initial-state"><h3 id="é¿å…é‡æ–°åˆ›å»ºåˆå§‹å€¼-avoiding-recreating-the-initial-state">é¿å…é‡æ–°åˆ›å»ºåˆå§‹å€¼ {/<em>avoiding-recreating-the-initial-state</em>/}</h3><p>React ä¼šä¿å­˜ state çš„åˆå§‹å€¼å¹¶åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶å¿½ç•¥å®ƒã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createInitialState</span><span class="token punctuation">(</span><span class="token parameter">username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> username <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token function">createInitialState</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p>è™½ç„¶ <code>createInitialState(username)</code> çš„è¿”å›å€¼åªç”¨äºåˆæ¬¡æ¸²æŸ“ï¼Œä½†æ˜¯åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™éƒ½ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœå®ƒåˆ›å»ºäº†æ¯”è¾ƒå¤§çš„æ•°ç»„æˆ–è€…æ‰§è¡Œäº†æ˜‚è´µçš„è®¡ç®—å°±ä¼šæµªè´¹æ€§èƒ½ã€‚<p>ä½ å¯ä»¥é€šè¿‡ç»™ <code>useReducer</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥ <strong>åˆå§‹åŒ–å‡½æ•°</strong> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createInitialState</span><span class="token punctuation">(</span><span class="token parameter">username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> username <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> username<span class="token punctuation">,</span> createInitialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span></code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ä½ ä¼ å…¥çš„å‚æ•°æ˜¯ <code>createInitialState</code> è¿™ä¸ª <strong>å‡½æ•°è‡ªèº«</strong>ï¼Œè€Œä¸æ˜¯æ‰§è¡Œ <code>createInitialState()</code> åçš„è¿”å›å€¼ã€‚è¿™æ ·ä¼ å‚å°±å¯ä»¥ä¿è¯åˆå§‹åŒ–å‡½æ•°ä¸ä¼šå†æ¬¡è¿è¡Œã€‚<p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>createInitialState</code> æœ‰ä¸€ä¸ª <code>username</code> å‚æ•°ã€‚å¦‚æœåˆå§‹åŒ–å‡½æ•°ä¸éœ€è¦å‚æ•°å°±å¯ä»¥è®¡ç®—å‡ºåˆå§‹å€¼ï¼Œå¯ä»¥æŠŠ <code>useReducer</code> çš„ç¬¬äºŒä¸ªå‚æ•°æ”¹ä¸º <code>null</code>ã€‚</p><recipes titletext="ä½¿ç”¨åˆå§‹åŒ–å‡½æ•°å’Œç›´æ¥ä¼ å…¥åˆå§‹å€¼çš„åŒºåˆ«"titleid="examples-initializer"><section class="level4"aria-labelledby="ä½¿ç”¨åˆå§‹åŒ–å‡½æ•°-passing-the-initializer-function"><h4 id="ä½¿ç”¨åˆå§‹åŒ–å‡½æ•°-passing-the-initializer-function">ä½¿ç”¨åˆå§‹åŒ–å‡½æ•° {/<em>passing-the-initializer-function</em>/}</h4><p>è¿™ä¸ªç¤ºä¾‹ä½¿ç”¨äº†ä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°ï¼Œæ‰€ä»¥ <code>createInitialState</code> å‡½æ•°åªä¼šåœ¨åˆæ¬¡æ¸²æŸ“çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ã€‚å³ä½¿å¾€è¾“å…¥æ¡†ä¸­è¾“å…¥å†…å®¹å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œåˆå§‹åŒ–å‡½æ•°ä¹Ÿä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TodoList</span></span> <span class="token keyword module">from</span> <span class="token string">'./TodoList.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TodoList</span> username<span class="token operator">=</span><span class="token string">"Taylor"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createInitialState</span><span class="token punctuation">(</span><span class="token parameter">username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> initialTodos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    initialTodos<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> username <span class="token operator">+</span> <span class="token string">"'s task #"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">draft</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">todos</span><span class="token operator">:</span> initialTodos<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'changed_draft'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">draft</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">nextDraft</span><span class="token punctuation">,</span>
        <span class="token literal-property property">todos</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'added_todo'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">draft</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          <span class="token literal-property property">text</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">draft</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token spread operator">...</span>state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> username <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>
    reducer<span class="token punctuation">,</span>
    username<span class="token punctuation">,</span>
    createInitialState
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">draft</span><span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'changed_draft'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">nextDraft</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'added_todo'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Add</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section><section class="level4"aria-labelledby="ç›´æ¥ä¼ å…¥åˆå§‹å€¼-passing-the-initial-state-directly"><h4 id="ç›´æ¥ä¼ å…¥åˆå§‹å€¼-passing-the-initial-state-directly">ç›´æ¥ä¼ å…¥åˆå§‹å€¼ {/<em>passing-the-initial-state-directly</em>/}</h4><p>è¿™ä¸ªç¤ºä¾‹ <strong>æ²¡æœ‰ä½¿ç”¨</strong> åˆå§‹åŒ–å‡½æ•°ï¼Œæ‰€ä»¥å½“ä½ å¾€è¾“å…¥æ¡†è¾“å…¥å†…å®¹å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“çš„æ—¶å€™ï¼Œ<code>createInitialState</code> å‡½æ•°å°±ä¼šæ‰§è¡Œã€‚è™½ç„¶åœ¨æ¸²æŸ“ç»“æœä¸Šçœ‹æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä½†æ˜¯å¤šä½™çš„é€»è¾‘ä¼šå¯¼è‡´æ€§èƒ½å˜å·®ã€‚</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">TodoList</span></span> <span class="token keyword module">from</span> <span class="token string">'./TodoList.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">TodoList</span> username<span class="token operator">=</span><span class="token string">"Taylor"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createInitialState</span><span class="token punctuation">(</span><span class="token parameter">username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> initialTodos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    initialTodos<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> username <span class="token operator">+</span> <span class="token string">"'s task #"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">draft</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">todos</span><span class="token operator">:</span> initialTodos<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'changed_draft'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">draft</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">nextDraft</span><span class="token punctuation">,</span>
        <span class="token literal-property property">todos</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'added_todo'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">draft</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          <span class="token literal-property property">text</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">draft</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token spread operator">...</span>state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> username <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>
    reducer<span class="token punctuation">,</span>
    <span class="token function">createInitialState</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input
        value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">draft</span><span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'changed_draft'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">nextDraft</span><span class="token operator">:</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'added_todo'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Add</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token punctuation">{</span>item<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><solution></solution></section></recipes></section></section><section class="level2"aria-labelledby="ç–‘éš¾è§£ç­”-troubleshooting"><h2 id="ç–‘éš¾è§£ç­”-troubleshooting">ç–‘éš¾è§£ç­” {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="æˆ‘å·²ç»-dispatch-äº†ä¸€ä¸ª-actionä½†æ˜¯æ‰“å°å‡ºæ¥ä»ç„¶è¿˜æ˜¯æ—§çš„-state-ive-dispatched-an-action-but-logging-gives-me-the-old-state-value"><h3 id="æˆ‘å·²ç»-dispatch-äº†ä¸€ä¸ª-actionä½†æ˜¯æ‰“å°å‡ºæ¥ä»ç„¶è¿˜æ˜¯æ—§çš„-state-ive-dispatched-an-action-but-logging-gives-me-the-old-state-value">æˆ‘å·²ç» dispatch äº†ä¸€ä¸ª actionï¼Œä½†æ˜¯æ‰“å°å‡ºæ¥ä»ç„¶è¿˜æ˜¯æ—§çš„ state {/<em>ive-dispatched-an-action-but-logging-gives-me-the-old-state-value</em>/}</h3><p>è°ƒç”¨ <code>dispatch</code> å‡½æ•° <strong>ä¸ä¼šæ”¹å˜å½“å‰æ¸²æŸ“çš„ state</strong>ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 42</span>

  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç”¨ 43 è¿›è¡Œé‡æ–°æ¸²æŸ“</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¿˜æ˜¯ 42ï¼</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸€æ ·æ˜¯ 42ï¼</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>è¿™æ˜¯å› ä¸º <a href="/learn/state-as-a-snapshot">state çš„è¡Œä¸ºå’Œå¿«ç…§ä¸€æ ·</a>ã€‚æ›´æ–° state ä¼šä½¿ç”¨æ–°çš„å€¼æ¥å¯¹ç»„ä»¶è¿›è¡Œé‡æ–°æ¸²æŸ“ï¼Œä½†æ˜¯ä¸ä¼šæ”¹å˜å½“å‰æ‰§è¡Œçš„äº‹ä»¶å¤„ç†å‡½æ•°é‡Œé¢ <code>state</code> çš„å€¼ã€‚<p>å¦‚æœä½ éœ€è¦è·å–æ›´æ–°åçš„ stateï¼Œå¯ä»¥æ‰‹åŠ¨è°ƒç”¨ reducer æ¥å¾—åˆ°ç»“æœï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'incremented_age'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> nextState <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// { age: 42 }</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>nextState<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { age: 43 }</span></code></pre></section><section class="level3"aria-labelledby="æˆ‘å·²ç»-dispatch-äº†ä¸€ä¸ª-actionä½†æ˜¯å±å¹•å¹¶æ²¡æœ‰æ›´æ–°-ive-dispatched-an-action-but-the-screen-doesnt-update"><h3 id="æˆ‘å·²ç»-dispatch-äº†ä¸€ä¸ª-actionä½†æ˜¯å±å¹•å¹¶æ²¡æœ‰æ›´æ–°-ive-dispatched-an-action-but-the-screen-doesnt-update">æˆ‘å·²ç» dispatch äº†ä¸€ä¸ª actionï¼Œä½†æ˜¯å±å¹•å¹¶æ²¡æœ‰æ›´æ–° {/<em>ive-dispatched-an-action-but-the-screen-doesnt-update</em>/}</h3><p>React ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a> æ¯”è¾ƒæ›´æ–°å‰åçš„ stateï¼Œå¦‚æœ <strong>å®ƒä»¬ç›¸ç­‰å°±ä¼šè·³è¿‡è¿™æ¬¡æ›´æ–°</strong>ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºä½ ç›´æ¥ä¿®æ”¹äº†å¯¹è±¡æˆ–æ•°ç»„ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ğŸš© é”™è¯¯è¡Œä¸ºï¼šç›´æ¥ä¿®æ”¹å¯¹è±¡</span>
      state<span class="token punctuation">.</span><span class="token property-access">age</span><span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'changed_name'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ğŸš© é”™è¯¯è¡Œä¸ºï¼šç›´æ¥ä¿®æ”¹å¯¹è±¡</span>
      state<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> action<span class="token punctuation">.</span><span class="token property-access">nextName</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>ä½ ç›´æ¥ä¿®æ”¹å¹¶è¿”å›äº†ä¸€ä¸ª <code>state</code> å¯¹è±¡ï¼Œæ‰€ä»¥ React ä¼šè·³è¿‡è¿™æ¬¡æ›´æ–°ã€‚ä¸ºäº†ä¿®å¤è¿™ä¸ªé”™è¯¯ï¼Œä½ åº”è¯¥ç¡®ä¿æ€»æ˜¯ <a href="/learn/updating-objects-in-state">ä½¿ç”¨æ­£ç¡®çš„æ–¹å¼æ›´æ–°å¯¹è±¡</a> å’Œ <a href="/learn/updating-arrays-in-state">ä½¿ç”¨æ­£ç¡®çš„æ–¹å¼æ›´æ–°æ•°ç»„</a>ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// âœ… ä¿®å¤ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'changed_name'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// âœ… ä¿®å¤ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> action<span class="token punctuation">.</span><span class="token property-access">nextName</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></section><section class="level3"aria-labelledby="åœ¨-dispatch-å-state-çš„æŸäº›å±æ€§å˜ä¸ºäº†-undefined-a-part-of-my-reducer-state-becomes-undefined-after-dispatching"><h3 id="åœ¨-dispatch-å-state-çš„æŸäº›å±æ€§å˜ä¸ºäº†-undefined-a-part-of-my-reducer-state-becomes-undefined-after-dispatching">åœ¨ dispatch å state çš„æŸäº›å±æ€§å˜ä¸ºäº† <code>undefined</code> {/<em>a-part-of-my-reducer-state-becomes-undefined-after-dispatching</em>/}</h3><p>è¯·ç¡®ä¿æ¯ä¸ª <code>case</code> è¯­å¥ä¸­æ‰€è¿”å›çš„æ–°çš„ state <strong>éƒ½å¤åˆ¶äº†å½“å‰çš„å±æ€§</strong>ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span> <span class="token comment">// ä¸è¦å¿˜è®°å¤åˆ¶ä¹‹å‰çš„å±æ€§ï¼</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span></code></pre><p>å¦‚æœä¸Šé¢çš„ä»£ç æ²¡æœ‰ <code>...state</code> ï¼Œè¿”å›çš„æ–°çš„ state å°±åªæœ‰ <code>age</code> å±æ€§ã€‚</section><section class="level3"aria-labelledby="åœ¨-dispatch-åæ•´ä¸ª-state-éƒ½å˜ä¸ºäº†-undefined-my-entire-reducer-state-becomes-undefined-after-dispatching"><h3 id="åœ¨-dispatch-åæ•´ä¸ª-state-éƒ½å˜ä¸ºäº†-undefined-my-entire-reducer-state-becomes-undefined-after-dispatching">åœ¨ dispatch åæ•´ä¸ª state éƒ½å˜ä¸ºäº† <code>undefined</code> {/<em>my-entire-reducer-state-becomes-undefined-after-dispatching</em>/}</h3><p>å¦‚æœä½ çš„ state é”™è¯¯åœ°å˜æˆäº† <code>undefined</code>ï¼Œå¯èƒ½æ˜¯å› ä¸ºä½ å¿˜è®°åœ¨æŸä¸ªåˆ†æ”¯è¿”å› stateï¼Œæˆ–è€…æ˜¯ä½ é—æ¼äº†æŸäº› <code>case</code> åˆ†æ”¯ã€‚å¯ä»¥é€šè¿‡åœ¨ <code>switch</code> è¯­å¥ä¹‹åæŠ›å‡ºä¸€ä¸ªé”™è¯¯æ¥æŸ¥æ‰¾åŸå› ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'incremented_age'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'edited_name'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unknown action: '</span> <span class="token operator">+</span> action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ TypeScript ç­‰é™æ€æ£€æŸ¥å·¥å…·æ¥å‘ç°è¿™ç±»é”™è¯¯ã€‚</section><section class="level3"aria-labelledby="æˆ‘æ”¶åˆ°äº†ä¸€ä¸ªæŠ¥é”™too-many-re-renders-im-getting-an-error-too-many-re-renders"><h3 id="æˆ‘æ”¶åˆ°äº†ä¸€ä¸ªæŠ¥é”™too-many-re-renders-im-getting-an-error-too-many-re-renders">æˆ‘æ”¶åˆ°äº†ä¸€ä¸ªæŠ¥é”™ï¼šâ€œToo many re-rendersâ€ {/<em>im-getting-an-error-too-many-re-renders</em>/}</h3><p>ä½ å¯èƒ½ä¼šæ”¶åˆ°è¿™æ ·ä¸€æ¡æŠ¥é”™ä¿¡æ¯ï¼š<code>Too many re-renders. React limits the number of renders to prevent an infinite loop.</code>ã€‚è¿™é€šå¸¸æ˜¯åœ¨ <strong>æ¸²æŸ“æœŸé—´</strong> dispatch äº† action è€Œå¯¼è‡´ç»„ä»¶è¿›å…¥äº†æ— é™å¾ªç¯ï¼šdispatchï¼ˆä¼šå¯¼è‡´ä¸€æ¬¡é‡æ–°æ¸²æŸ“ï¼‰ã€æ¸²æŸ“ã€dispatchï¼ˆå†æ¬¡å¯¼è‡´é‡æ–°æ¸²æŸ“ï¼‰ï¼Œç„¶åæ— é™å¾ªç¯ã€‚å¤§å¤šæ•°è¿™æ ·çš„é”™è¯¯æ˜¯ç”±äºäº‹ä»¶å¤„ç†å‡½æ•°ä¸­å­˜åœ¨é”™è¯¯çš„é€»è¾‘ï¼š<pre class="language-js"><code class="language-js"><span class="token comment">// ğŸš© é”™è¯¯ï¼šæ¸²æŸ“æœŸé—´è°ƒç”¨äº†å¤„ç†å‡½æ•°</span>
<span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Click</span> me<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>

<span class="token comment">// âœ… ä¿®å¤ï¼šä¼ é€’ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œè€Œä¸æ˜¯è°ƒç”¨</span>
<span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Click</span> me<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>

<span class="token comment">// âœ… ä¿®å¤ï¼šä¼ é€’ä¸€ä¸ªå†…è”çš„ç®­å¤´å‡½æ•°</span>
<span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">handleClick</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token maybe-class-name">Click</span> me<span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span></code></pre><p>å¦‚æœä½ æ²¡æœ‰å‘ç°ä¸Šè¿°é”™è¯¯ï¼Œåœ¨æ§åˆ¶å°ç‚¹å¼€æŠ¥é”™æ—è¾¹çš„ç®­å¤´ä»¥æŸ¥çœ‹é”™è¯¯å †æ ˆï¼Œä»ä¸­æŸ¥æ‰¾æ˜¯å“ªä¸ª <code>dispatch</code> å‡½æ•°å¼•å‘çš„é”™è¯¯ã€‚</section><section class="level3"aria-labelledby="æˆ‘çš„-reducer-å’Œåˆå§‹åŒ–å‡½æ•°è¿è¡Œäº†ä¸¤æ¬¡-my-reducer-or-initializer-function-runs-twice"><h3 id="æˆ‘çš„-reducer-å’Œåˆå§‹åŒ–å‡½æ•°è¿è¡Œäº†ä¸¤æ¬¡-my-reducer-or-initializer-function-runs-twice">æˆ‘çš„ reducer å’Œåˆå§‹åŒ–å‡½æ•°è¿è¡Œäº†ä¸¤æ¬¡ {/<em>my-reducer-or-initializer-function-runs-twice</em>/}</h3><p><a href="/reference/react/StrictMode">ä¸¥æ ¼æ¨¡å¼</a> ä¸‹ React ä¼šè°ƒç”¨ä¸¤æ¬¡ reducer å’Œåˆå§‹åŒ–å‡½æ•°ï¼Œä½†æ˜¯è¿™ä¸åº”è¯¥ä¼šç ´åä½ çš„ä»£ç é€»è¾‘ã€‚<p>è¿™ä¸ª <strong>ä»…é™äºå¼€å‘æ¨¡å¼</strong> çš„è¡Œä¸ºå¯ä»¥å¸®åŠ©ä½  <a href="/learn/keeping-components-pure">ä¿æŒç»„ä»¶çº¯ç²¹</a>ï¼šReact ä¼šä½¿ç”¨å…¶ä¸­ä¸€æ¬¡è°ƒç”¨ç»“æœå¹¶å¿½ç•¥å¦ä¸€ä¸ªç»“æœã€‚å¦‚æœä½ çš„ç»„ä»¶ã€åˆå§‹åŒ–å‡½æ•°ä»¥åŠ reducer å‡½æ•°éƒ½æ˜¯çº¯å‡½æ•°ï¼Œè¿™å¹¶ä¸ä¼šå½±å“ä½ çš„é€»è¾‘ã€‚ä¸è¿‡ä¸€æ—¦å®ƒä»¬å­˜åœ¨å‰¯ä½œç”¨ï¼Œè¿™ä¸ªé¢å¤–çš„è¡Œä¸ºå°±å¯ä»¥å¸®åŠ©ä½ å‘ç°å®ƒã€‚<p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ª reducer å‡½æ•°ç›´æ¥ä¿®æ”¹äº†æ•°ç»„ç±»å‹çš„ stateï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'added_todo'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// ğŸš© é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹ state</span>
      <span class="token keyword control-flow">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>å› ä¸º React ä¼šè°ƒç”¨ reducer å‡½æ•°ä¸¤æ¬¡ï¼Œå¯¼è‡´ä½ çœ‹åˆ°æ·»åŠ äº†ä¸¤æ¡ä»£åŠäº‹é¡¹ï¼Œäºæ˜¯ä½ å°±å‘ç°äº†è¿™ä¸ªé”™è¯¯è¡Œä¸ºã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ <a href="/learn/updating-arrays-in-state#adding-to-an-array">è¿”å›æ–°çš„æ•°ç»„è€Œä¸æ˜¯ä¿®æ”¹æ•°ç»„</a> æ¥ä¿®å¤å®ƒï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'added_todo'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// âœ… ä¿®å¤ï¼šè¿”å›ä¸€ä¸ªæ–°çš„ state æ•°ç»„</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
        <span class="token spread operator">...</span>state<span class="token punctuation">,</span>
        <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token spread operator">...</span>state<span class="token punctuation">.</span><span class="token property-access">todos</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>ç°åœ¨è¿™ä¸ª reducer æ˜¯çº¯å‡½æ•°äº†ï¼Œè°ƒç”¨ä¸¤æ¬¡ä¹Ÿä¸ä¼šæœ‰ä¸ä¸€è‡´çš„è¡Œä¸ºã€‚è¿™å°±æ˜¯ React å¦‚ä½•é€šè¿‡è°ƒç”¨ä¸¤æ¬¡å‡½æ•°æ¥å¸®åŠ©ä½ å‘ç°é”™è¯¯ã€‚<strong>åªæœ‰ç»„ä»¶ã€åˆå§‹åŒ–å‡½æ•°å’Œ reducer å‡½æ•°éœ€è¦æ˜¯çº¯å‡½æ•°</strong>ã€‚äº‹ä»¶å¤„ç†å‡½æ•°ä¸éœ€è¦å®ç°ä¸ºçº¯å‡½æ•°ï¼Œå¹¶ä¸” React æ°¸è¿œä¸ä¼šè°ƒç”¨äº‹ä»¶å‡½æ•°ä¸¤æ¬¡ã€‚<p>é˜…è¯» <a href="/learn/keeping-components-pure">ä¿æŒç»„ä»¶çº¯ç²¹</a> ä»¥äº†è§£æ›´å¤šç›¸å…³ä¿¡æ¯ã€‚ <span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>