<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>renderToString</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="rendertostring"><h1 id="rendertostring">renderToString</h1><pitfall><p><code>renderToString</code> ä¸æ”¯æŒæµå¼ä¼ è¾“æˆ–ç­‰å¾…æ•°æ®ã€‚<a href="#alternatives">è¯·å‚è€ƒæ›¿ä»£æ–¹æ¡ˆ</a>ã€‚</p></pitfall><intro><p><code>renderToString</code> å°† React æ ‘æ¸²æŸ“ä¸ºä¸€ä¸ª HTML å­—ç¬¦ä¸²ã€‚<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span>reactNode<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="reference-reference"><h2 id="reference-reference">Reference {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="rendertostringreactnode-options-rendertostring"><h3 id="rendertostringreactnode-options-rendertostring"><code>renderToString(reactNode, options?)</code> {/<em>rendertostring</em>/}</h3><p>åœ¨æœåŠ¡å™¨ï¼Œè°ƒç”¨ <code>renderToString</code> å°†ä½ çš„åº”ç”¨æ¸²æŸ“ä¸º HTMLã€‚<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/server'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åœ¨å®¢æˆ·ç«¯ï¼Œè°ƒç”¨ <a href="/reference/react-dom/client/hydrateRoot"><code>hydrateRoot</code></a> æ¥ä½¿æœåŠ¡å™¨ç”Ÿæˆçš„ HTML å…·æœ‰äº¤äº’æ€§ã€‚<p><a href="#usage">è¯·å‚è€ƒä¸‹é¢çš„æ›´å¤šç¤ºä¾‹</a>ã€‚<section class="level4"aria-labelledby="å‚æ•°-parameters"><h4 id="å‚æ•°-parameters">å‚æ•° {/<em>parameters</em>/}</h4><ul><li><p><code>reactNode</code>ï¼šä½ è¦æ¸²æŸ“ä¸º HTML çš„ React èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª JSX èŠ‚ç‚¹ï¼Œå°±åƒ <code>&#x3C;App /></code>ã€‚<li><p><strong>optional</strong> <code>options</code>: An object for server render.<ul><li><strong>optional</strong> <code>identifierPrefix</code>: A string prefix React uses for IDs generated by <a href="/reference/react/useId"><code>useId</code>.</a> Useful to avoid conflicts when using multiple roots on the same page. Must be the same prefix as passed to <a href="/reference/react-dom/client/hydrateRoot#parameters"><code>hydrateRoot</code>.</a></ul></ul></section><section class="level4"aria-labelledby="returns-returns"><h4 id="returns-returns">Returns {/<em>returns</em>/}</h4><p>ä¸€ä¸ª HTML å­—ç¬¦ä¸²ã€‚</section><section class="level4"aria-labelledby="æ³¨æ„äº‹é¡¹-caveats"><h4 id="æ³¨æ„äº‹é¡¹-caveats">æ³¨æ„äº‹é¡¹ {/<em>caveats</em>/}</h4><ul><li><p><code>renderToString</code> å¯¹ Suspense çš„æ”¯æŒæœ‰é™ã€‚å¦‚æœä¸€ä¸ªç»„ä»¶æŒ‚èµ·ï¼ˆsuspendï¼‰ï¼Œ<code>renderToString</code> ä¼šç«‹å³å°†å…¶åå¤‡æ–¹æ¡ˆä½œä¸º HTML å‘é€ã€‚<li><p><code>renderToString</code> å¯ä»¥åœ¨æµè§ˆå™¨ä¸­å·¥ä½œï¼Œä½† <a href="#removing-rendertostring-from-the-client-code">ä¸æ¨è</a> åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ä½¿ç”¨å®ƒã€‚</ul></section></section></section><section class="level2"aria-labelledby="ç”¨æ³•-usage"><h2 id="ç”¨æ³•-usage">ç”¨æ³• {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="å°†-react-æ ‘æ¸²æŸ“ä¸º-html-å­—ç¬¦ä¸²-rendering-a-react-tree-as-html-to-a-string"><h3 id="å°†-react-æ ‘æ¸²æŸ“ä¸º-html-å­—ç¬¦ä¸²-rendering-a-react-tree-as-html-to-a-string">å°† React æ ‘æ¸²æŸ“ä¸º HTML å­—ç¬¦ä¸² {/<em>rendering-a-react-tree-as-html-to-a-string</em>/}</h3><p>è°ƒç”¨ <code>renderToString</code> å°†ä½ çš„åº”ç”¨æ¸²æŸ“ä¸º HTML å­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥å°†å…¶ä¸æœåŠ¡å™¨å“åº”ä¸€èµ·å‘é€ï¼š<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/server'</span><span class="token punctuation">;</span>

<span class="token comment">// è·¯ç”±å¤„ç†ç¨‹åºçš„è¯­æ³•å–å†³äºä½ ä½¿ç”¨çš„åç«¯æ¡†æ¶</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™å°†ç”Ÿæˆä½ çš„ React ç»„ä»¶çš„åˆå§‹éäº¤äº’å¼ HTML è¾“å‡ºã€‚åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œä½ éœ€è¦è°ƒç”¨ <a href="/reference/react-dom/client/hydrateRoot"><code>hydrateRoot</code></a> æ¥å°†æœåŠ¡å™¨ç”Ÿæˆçš„ HTML è¿›è¡Œæ¿€æ´»å¤„ç†ï¼Œä½¿å…¶å…·æœ‰äº¤äº’åŠŸèƒ½ã€‚</p><pitfall><p><code>renderToString</code> ä¸æ”¯æŒæµå¼ä¼ è¾“æˆ–ç­‰å¾…æ•°æ®ã€‚<a href="#alternatives">è¯·å‚è€ƒæ›¿ä»£æ–¹æ¡ˆ</a>ã€‚</p></pitfall></section></section><section class="level2"aria-labelledby="æ›¿ä»£æ–¹æ¡ˆ-alternatives"><h2 id="æ›¿ä»£æ–¹æ¡ˆ-alternatives">æ›¿ä»£æ–¹æ¡ˆ {/<em>alternatives</em>/}</h2><section class="level3"aria-labelledby="ä»-rendertostring-è¿ç§»åˆ°æœåŠ¡å™¨ä¸Šçš„æµå¼ä¼ è¾“æ–¹æ³•-migrating-from-rendertostring-to-a-streaming-method-on-the-server"><h3 id="ä»-rendertostring-è¿ç§»åˆ°æœåŠ¡å™¨ä¸Šçš„æµå¼ä¼ è¾“æ–¹æ³•-migrating-from-rendertostring-to-a-streaming-method-on-the-server">ä» <code>renderToString</code> è¿ç§»åˆ°æœåŠ¡å™¨ä¸Šçš„æµå¼ä¼ è¾“æ–¹æ³• {/<em>migrating-from-rendertostring-to-a-streaming-method-on-the-server</em>/}</h3><p><code>renderToString</code> ç«‹å³è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå› æ­¤ä¸æ”¯æŒæµå¼ä¼ è¾“æˆ–ç­‰å¾…æ•°æ®ã€‚<p>å¦‚æœå¯èƒ½çš„è¯ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨è¿™äº›åŠŸèƒ½å®Œæ•´çš„æ›¿ä»£æ–¹æ³•ï¼š<ul><li>å¦‚æœä½ ä½¿ç”¨ Node.jsï¼Œè¯·ä½¿ç”¨ <a href="/reference/react-dom/server/renderToPipeableStream"><code>renderToPipeableStream</code></a>ã€‚<li>å¦‚æœä½ ä½¿ç”¨ Deno æˆ–æ”¯æŒ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Streams_API">Web Streams</a> çš„ç°ä»£è¿è¡Œæ—¶ï¼Œè¯·ä½¿ç”¨ <a href="/reference/react-dom/server/renderToReadableStream"><code>renderToReadableStream</code></a>ã€‚</ul><p>å¦‚æœä½ çš„æœåŠ¡å™¨ç¯å¢ƒä¸æ”¯æŒæµå¼ä¼ è¾“ï¼Œä½ ä»ç„¶å¯ä»¥ç»§ç»­ä½¿ç”¨ <code>renderToString</code>ã€‚</section><section class="level3"aria-labelledby="ä»å®¢æˆ·ç«¯ä»£ç ä¸­ç§»é™¤-rendertostring-removing-rendertostring-from-the-client-code"><h3 id="ä»å®¢æˆ·ç«¯ä»£ç ä¸­ç§»é™¤-rendertostring-removing-rendertostring-from-the-client-code">ä»å®¢æˆ·ç«¯ä»£ç ä¸­ç§»é™¤ <code>renderToString</code> {/<em>removing-rendertostring-from-the-client-code</em>/}</h3><p>æœ‰æ—¶ï¼Œ<code>renderToString</code> ç”¨äºåœ¨å®¢æˆ·ç«¯å°†æŸä¸ªç»„ä»¶è½¬æ¢ä¸º HTMLã€‚<pre class="language-js"><code class="language-js"><span class="token comment">// ğŸš© ä¸å¿…è¦ï¼šåœ¨å®¢æˆ·ç«¯ä½¿ç”¨ renderToString</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/server'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">MyIcon</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¾‹å¦‚ï¼Œ"&#x3C;svg>...&#x3C;/svg>"</span></code></pre><p>åœ¨å®¢æˆ·ç«¯å¯¼å…¥ <code>react-dom/server</code> ä¼šä¸å¿…è¦åœ°å¢åŠ  bundle å¤§å°ï¼Œæ‰€ä»¥åº”è¯¥é¿å…è¿™æ ·åšã€‚å¦‚æœä½ éœ€è¦åœ¨æµè§ˆå™¨ä¸­å°†æŸä¸ªç»„ä»¶æ¸²æŸ“ä¸º HTMLï¼Œè¯·ä½¿ç”¨ <a href="/reference/react-dom/client/createRoot"><code>createRoot</code></a> å¹¶ä» DOM ä¸­è¯»å– HTMLã€‚<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> createRoot <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom/client'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> flushSync <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">createRoot</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">flushSync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  root<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">MyIcon</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span><span class="token property-access">innerHTML</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¾‹å¦‚ï¼Œ"&#x3C;svg>...&#x3C;/svg>"</span></code></pre><p><a href="/reference/react-dom/flushSync"><code>flushSync</code></a> è°ƒç”¨æ˜¯å¿…è¦çš„ï¼Œä»¥ä¾¿åœ¨è¯»å– <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/innerHTML"><code>innerHTML</code></a> å±æ€§ä¹‹å‰æ›´æ–° DOMã€‚</section></section><section class="level2"aria-labelledby="æ•…éšœæ’é™¤-troubleshooting"><h2 id="æ•…éšœæ’é™¤-troubleshooting">æ•…éšœæ’é™¤ {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="å½“ç»„ä»¶æš‚åœæ—¶html-ä¸­å§‹ç»ˆåŒ…å«ä¸€ä¸ªåå¤‡æ–¹æ¡ˆ-when-a-component-suspends-the-html-always-contains-a-fallback"><h3 id="å½“ç»„ä»¶æš‚åœæ—¶html-ä¸­å§‹ç»ˆåŒ…å«ä¸€ä¸ªåå¤‡æ–¹æ¡ˆ-when-a-component-suspends-the-html-always-contains-a-fallback">å½“ç»„ä»¶æš‚åœæ—¶ï¼ŒHTML ä¸­å§‹ç»ˆåŒ…å«ä¸€ä¸ªåå¤‡æ–¹æ¡ˆ {/<em>when-a-component-suspends-the-html-always-contains-a-fallback</em>/}</h3><p><code>renderToString</code> ä¸å®Œå…¨æ”¯æŒ Suspenseã€‚<p>å¦‚æœæŸä¸ªç»„ä»¶ suspendï¼ˆä¾‹å¦‚ï¼Œå› ä¸ºå®ƒä½¿ç”¨ <a href="/reference/react/lazy"><code>lazy</code></a> å®šä¹‰æˆ–è·å–æ•°æ®ï¼‰ï¼Œ<code>renderToString</code> ä¸ä¼šç­‰å¾…å…¶å†…å®¹è§£æå®Œæˆã€‚ç›¸åï¼Œ<code>renderToString</code> å°†æ‰¾åˆ°æœ€è¿‘çš„ <a href="/reference/react/Suspense"><code>&#x3C;Suspense></code></a> è¾¹ç•Œï¼Œå¹¶åœ¨ HTML ä¸­æ¸²æŸ“å…¶ <code>fallback</code> å±æ€§ã€‚ç›´åˆ°å®¢æˆ·ç«¯ä»£ç åŠ è½½åï¼Œå†…å®¹æ‰ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯·ä½¿ç”¨å…¶ä¸­ä¸€ä¸ª <a href="#migrating-from-rendertostring-to-a-streaming-method-on-the-server">æ¨èçš„æµå¼è§£å†³æ–¹æ¡ˆ</a>ã€‚å®ƒä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šé€æ­¥ä»¥å—çš„å½¢å¼æµå¼ä¼ è¾“å†…å®¹ï¼Œä½¿ç”¨æˆ·åœ¨å®¢æˆ·ç«¯ä»£ç åŠ è½½ä¹‹å‰é€æ­¥çœ‹åˆ°é¡µé¢å¡«å……ã€‚<p><span style="float:footnote"><a href="../../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>