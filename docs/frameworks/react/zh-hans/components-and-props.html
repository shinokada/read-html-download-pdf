<!doctype html><html lang="zh-hans"><meta charset="utf-8"><title>组件 &#x26; Props</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="组件--props"class="level1"><h1>组件 &#x26; Props</h1><p>组件允许你将 UI 拆分为独立可复用的代码片段，并对每个片段进行独立构思。本指南旨在介绍组件的相关理念。你可以<a href="./react-component.html">参考详细组件 API</a>。<p>组件，从概念上类似于 JavaScript 函数。它接受任意的入参（即 “props”），并返回用于描述页面展示内容的 React 元素。<section id="function-and-class-components"class="level2"><h2>函数组件与 class 组件</h2><p>定义组件最简单的方式就是编写 JavaScript 函数：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Welcome</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Hello</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>该函数是一个有效的 React 组件，因为它接收唯一带有数据的 “props”（代表属性）对象与并返回一个 React 元素。这类组件被称为“函数组件”，因为它本质上就是 JavaScript 函数。<p>你同时还可以使用 <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Classes">ES6 的 class</a> 来定义组件：<pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Welcome</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Hello</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>上述两个组件在 React 里是等效的。<p>我们将在<a href="./state-and-lifecycle.html">下一章节</a>中讨论关于函数组件和 class 组件的额外特性。</section><section id="rendering-a-component"class="level2"><h2>渲染组件</h2><p>之前，我们遇到的 React 元素都只是 DOM 标签：<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token operator">&#x3C;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span></code></pre><p>不过，React 元素也可以是用户自定义的组件：<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Welcome</span> name<span class="token operator">=</span><span class="token string">"Sara"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span></code></pre><p>当 React 元素为用户自定义组件时，它会将 JSX 所接收的属性（attributes）以及子组件（children）转换为单个对象传递给组件，这个对象被称之为 “props”。<p>例如，这段代码会在页面上渲染 “Hello, Sara”：<pre class="language-js{1,6}"><code class="language-js{1,6}">function Welcome(props) {
  return &#x3C;h1>Hello, {props.name}&#x3C;/h1>;
}

const root = ReactDOM.createRoot(document.getElementById('root'));
const element = &#x3C;Welcome name="Sara" />;
root.render(element);</code></pre><p><strong><a href="https://codepen.io/gaearon/pen/YGYmEG?editors=1010">在 CodePen 上试试</a></strong><p>让我们来回顾一下这个例子中发生了什么：<ol><li>我们调用 <code>root.render()</code> 函数，并传入 <code>&#x3C;Welcome name="Sara" /></code> 作为参数。<li>React 调用 <code>Welcome</code> 组件，并将 <code>{name: 'Sara'}</code> 作为 props 传入。<li><code>Welcome</code> 组件将 <code>&#x3C;h1>Hello, Sara&#x3C;/h1></code> 元素作为返回值。<li>React DOM 将 DOM 高效地更新为 <code>&#x3C;h1>Hello, Sara&#x3C;/h1></code>。</ol><blockquote><p><strong>注意：</strong> 组件名称必须以大写字母开头。<p>React 会将以小写字母开头的组件视为原生 DOM 标签。例如，<code>&#x3C;div /></code> 代表 HTML 的 div 标签，而 <code>&#x3C;Welcome /></code> 则代表一个组件，并且需在作用域内使用 <code>Welcome</code>。<p>你可以在<a href="./jsx-in-depth.html#user-defined-components-must-be-capitalized">深入 JSX</a> 中了解更多关于此规范的原因。</blockquote></section><section id="composing-components"class="level2"><h2>组合组件</h2><p>组件可以在其输出中引用其他组件。这就可以让我们用同一组件来抽象出任意层次的细节。按钮，表单，对话框，甚至整个屏幕的内容：在 React 应用程序中，这些通常都会以组件的形式表示。<p>例如，我们可以创建一个可以多次渲染 <code>Welcome</code> 组件的 <code>App</code> 组件：<pre class="language-js{8-10}"><code class="language-js{8-10}">function Welcome(props) {
  return &#x3C;h1>Hello, {props.name}&#x3C;/h1>;
}

function App() {
  return (
    &#x3C;div>
      &#x3C;Welcome name="Sara" />
      &#x3C;Welcome name="Cahal" />
      &#x3C;Welcome name="Edite" />
    &#x3C;/div>
  );
}</code></pre><p><strong><a href="https://codepen.io/gaearon/pen/KgQKPr?editors=1010">在 CodePen 上试试</a></strong><p>通常来说，每个新的 React 应用程序的顶层组件都是 <code>App</code> 组件。但是，如果你将 React 集成到现有的应用程序中，你可能需要使用像 <code>Button</code> 这样的小组件，并自下而上地将这类组件逐步应用到视图层的每一处。</section><section id="extracting-components"class="level2"><h2>提取组件</h2><p>将组件拆分为更小的组件。<p>例如，参考如下 <code>Comment</code> 组件：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Comment</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token string">"Comment"</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token string">"UserInfo"</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>img className<span class="token operator">=</span><span class="token string">"Avatar"</span>
          src<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">avatarUrl</span><span class="token punctuation">}</span>
          alt<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token string">"UserInfo-name"</span><span class="token operator">></span>
          <span class="token punctuation">{</span>props<span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token string">"Comment-text"</span><span class="token operator">></span>
        <span class="token punctuation">{</span>props<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>div className<span class="token operator">=</span><span class="token string">"Comment-date"</span><span class="token operator">></span>
        <span class="token punctuation">{</span><span class="token function">formatDate</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token property-access">date</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><strong><a href="https://codepen.io/gaearon/pen/VKQwEo?editors=1010">在 CodePen 上试试</a></strong><p>该组件用于描述一个社交媒体网站上的评论功能，它接收 <code>author</code>（对象），<code>text</code> （字符串）以及 <code>date</code>（日期）作为 props。<p>该组件由于嵌套的关系，变得难以维护，且很难复用它的各个部分。因此，让我们从中提取一些组件出来。<p>首先，我们将提取 <code>Avatar</code> 组件：<pre class="language-js{3-6}"><code class="language-js{3-6}">function Avatar(props) {
  return (
    &#x3C;img className="Avatar"
      src={props.user.avatarUrl}
      alt={props.user.name}
    />
  );
}</code></pre><p><code>Avatar</code> 不需知道它在 <code>Comment</code> 组件内部是如何渲染的。因此，我们给它的 props 起了一个更通用的名字：<code>user</code>，而不是 <code>author</code>。<p>我们建议从组件自身的角度命名 props，而不是依赖于调用组件的上下文命名。<p>我们现在针对 <code>Comment</code> 做些微小调整：<pre class="language-js{5}"><code class="language-js{5}">function Comment(props) {
  return (
    &#x3C;div className="Comment">
      &#x3C;div className="UserInfo">
        &#x3C;Avatar user={props.author} />
        &#x3C;div className="UserInfo-name">
          {props.author.name}
        &#x3C;/div>
      &#x3C;/div>
      &#x3C;div className="Comment-text">
        {props.text}
      &#x3C;/div>
      &#x3C;div className="Comment-date">
        {formatDate(props.date)}
      &#x3C;/div>
    &#x3C;/div>
  );
}</code></pre><p>接下来，我们将提取 <code>UserInfo</code> 组件，该组件在用户名旁渲染 <code>Avatar</code> 组件：<pre class="language-js{3-8}"><code class="language-js{3-8}">function UserInfo(props) {
  return (
    &#x3C;div className="UserInfo">
      &#x3C;Avatar user={props.user} />
      &#x3C;div className="UserInfo-name">
        {props.user.name}
      &#x3C;/div>
    &#x3C;/div>
  );
}</code></pre><p>进一步简化 <code>Comment</code> 组件：<pre class="language-js{4}"><code class="language-js{4}">function Comment(props) {
  return (
    &#x3C;div className="Comment">
      &#x3C;UserInfo user={props.author} />
      &#x3C;div className="Comment-text">
        {props.text}
      &#x3C;/div>
      &#x3C;div className="Comment-date">
        {formatDate(props.date)}
      &#x3C;/div>
    &#x3C;/div>
  );
}</code></pre><p><strong><a href="https://codepen.io/gaearon/pen/rrJNJY?editors=1010">在 CodePen 上试试</a></strong><p>最初看上去，提取组件可能是一件繁重的工作，但是，在大型应用中，构建可复用组件库是完全值得的。根据经验来看，如果 UI 中有一部分被多次使用（<code>Button</code>，<code>Panel</code>，<code>Avatar</code>），或者组件本身就足够复杂（<code>App</code>，<code>FeedStory</code>，<code>Comment</code>），那么它就是一个可提取出独立组件的候选项。</section><section id="props-are-read-only"class="level2"><h2>Props 的只读性</h2><p>组件无论是使用<a href="#function-and-class-components">函数声明还是通过 class 声明</a>，都绝不能修改自身的 props。来看下这个 <code>sum</code> 函数：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>这样的函数被称为<a href="https://en.wikipedia.org/wiki/Pure_function">“纯函数”</a>，因为该函数不会尝试更改入参，且多次调用下相同的入参始终返回相同的结果。<p>相反，下面这个函数则不是纯函数，因为它更改了自己的入参：<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">withdraw</span><span class="token punctuation">(</span><span class="token parameter">account<span class="token punctuation">,</span> amount</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  account<span class="token punctuation">.</span><span class="token property-access">total</span> <span class="token operator">-=</span> amount<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>React 非常灵活，但它也有一个严格的规则：<p><strong>所有 React 组件都必须像纯函数一样保护它们的 props 不被更改。</strong><p>当然，应用程序的 UI 是动态的，并会伴随着时间的推移而变化。在<a href="./state-and-lifecycle.html">下一章节</a>中，我们将介绍一种新的概念，称之为 “state”。在不违反上述规则的情况下，state 允许 React 组件随用户操作、网络响应或者其他变化而动态更改输出内容。 <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>