<!doctype html><html lang="zh-hant"><meta charset="utf-8"><title>Hook çš„è¦å‰‡</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="hook-çš„è¦å‰‡"class="level1"><h1>Hook çš„è¦å‰‡</h1><p><em>Hook</em> æ˜¯ React 16.8 æ–°åŠ å…¥çš„åŠŸèƒ½ï¼Œå®ƒå€‘è®“ä½ å¯ä»¥ä¸ç”¨å¯« class å°±èƒ½ä½¿ç”¨ state èˆ‡å…¶ä»– React çš„åŠŸèƒ½ã€‚<p>Hook æ˜¯ JavaScript functionï¼Œç•¶ä½ ä½¿ç”¨å®ƒå€‘æ™‚éœ€è¦éµå®ˆå…©å€‹è¦å‰‡ã€‚æˆ‘å€‘æä¾›äº†ä¸€å€‹ <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">linter plugin</a> ä¾†è‡ªå‹•åŒ–åœ°å¯¦è¡Œé€™äº›è¦å‰‡ï¼š<section id="only-call-hooks-at-the-top-level"class="level3"><h3>åªåœ¨æœ€ä¸Šå±¤å‘¼å« Hook</h3><p><strong>ä¸è¦åœ¨è¿´åœˆã€æ¢ä»¶å¼æˆ–æ˜¯å·¢ç‹€çš„ function å…§å‘¼å« Hookã€‚</strong>ç›¸åçš„ï¼Œåœ¨ä»»ä½• early return ä¹‹å‰ï¼Œè«‹åœ¨ React function top level ä½¿ç”¨ Hookã€‚è—‰ç”±éµå¾ªé€™äº›è¦å‰‡ï¼Œä½ å¯ä»¥ç¢ºä¿ç•¶æ¯æ¬¡ä¸€å€‹ component render æ™‚ Hook éƒ½ä¾ç…§æ­£ç¢ºçš„é †åºè¢«å‘¼å«ã€‚æ­£æ˜¯é€™å€‹ä½¿å¾— React æœ‰è¾¦æ³•åœ¨å¤šå€‹ <code>useState</code> å’Œ <code>useEffect</code> å‘¼å«é–“ï¼Œæ­£ç¢ºåœ°ä¿æŒ Hook çš„ stateã€‚ (å¦‚æœä½ æ„Ÿåˆ°å¥½å¥‡ï¼Œæˆ‘å€‘å°‡åœ¨<a href="#explanation">ä¸‹æ–¹</a>æ·±å…¥çš„è§£é‡‹å®ƒã€‚)</section><section id="only-call-hooks-from-react-functions"class="level3"><h3>åªåœ¨ React Function ä¸­å‘¼å« Hook</h3><p><strong>åˆ¥åœ¨ä¸€èˆ¬çš„ JavaScript function ä¸­å‘¼å« Hookã€‚</strong>ç›¸åçš„ï¼Œä½ å¯ä»¥ï¼š<ul><li>âœ… åœ¨ React function component ä¸­å‘¼å« Hookã€‚<li>âœ… åœ¨è‡ªå®šç¾©çš„ Hook ä¸­å‘¼å« Hookã€‚ï¼ˆæˆ‘å€‘å°‡æœƒ<a href="./hooks-custom.html">åœ¨ä¸‹ä¸€é </a>äº†è§£å®ƒå€‘ï¼‰ã€‚</ul><p>é€ééµå¾ªé€™äº›è¦å‰‡ï¼Œä½ ç¢ºä¿äº†åœ¨ component ä¸­æ‰€æœ‰çš„ stateful é‚è¼¯åœ¨å…¶åŸå§‹ç¢¼ä¸­å¯ä»¥æ¸…æ¥šåœ°è¢«çœ‹è¦‹ã€‚</section><section id="eslint-plugin"class="level2"><h2>ESLint Plugin</h2><p>æˆ‘å€‘ç™¼ä½ˆäº†ä¸€å€‹ ESLint plugin å«åš <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks"><code>eslint-plugin-react-hooks</code></a> ä¾†å¼·åˆ¶æ–½è¡Œé€™å…©å€‹è¦å‰‡ã€‚å¦‚æœä½ æƒ³å˜—è©¦çš„è©±ï¼Œå¯ä»¥å°‡é€™å€‹ plugin åŠ å…¥åˆ°ä½ çš„å°ˆæ¡ˆä¸­:<p><a href="./create-a-new-react-app.html#create-react-app">Create React App</a> é è¨­åŒ…å«æ­¤ pluginã€‚<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> eslint-plugin-react-hooks --save-dev</code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// ä½ çš„ ESLint é…ç½®</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token string">"react-hooks"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">"rules"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token string-property property">"react-hooks/rules-of-hooks"</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token comment">// æª¢æŸ¥ Hook çš„è¦å‰‡</span>
    <span class="token string-property property">"react-hooks/exhaustive-deps"</span><span class="token operator">:</span> <span class="token string">"warn"</span> <span class="token comment">// æª¢æŸ¥ effect çš„ç›¸ä¾æ€§</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><strong>ä½ ç¾åœ¨å¯ä»¥å…ˆè·³éï¼Œä¸‹ä¸€é å°‡è§£é‡‹å¦‚ä½•æ‰“é€ <a href="./hooks-custom.html">ä½ è‡ªå·±çš„ Hook</a>ã€‚</strong>åœ¨é€™é ï¼Œæˆ‘å€‘å°‡æœƒç¹¼çºŒè§£é‡‹é€™äº›è¦å‰‡èƒŒå¾Œçš„åŸå› ã€‚</section><section id="explanation"class="level2"><h2>è§£èªª</h2><p>å¦‚æˆ‘å€‘<a href="./hooks-state.html#tip-using-multiple-state-variables">å…ˆå‰æ‰€å­¸åˆ°çš„</a>ï¼Œæˆ‘å€‘å¯ä»¥åœ¨å–®ä¸€çš„ component ä¸­ä½¿ç”¨å¤šå€‹ State æˆ– Effect Hookï¼š<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. ä½¿ç”¨ name state è®Šæ•¸</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2. ä½¿ç”¨ä¸€å€‹ effect ä¾†ä¿å­˜è¡¨å–®</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 3. ä½¿ç”¨ surname state è®Šæ•¸</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>surname<span class="token punctuation">,</span> setSurname<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 4. ä½¿ç”¨ä¸€å€‹ effect ä¾†æ›´æ–°æ¨™é¡Œ</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">updateTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">title</span> <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> surname<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>æ‰€ä»¥ React æ˜¯å¦‚ä½•çŸ¥é“å“ªå€‹ state è¦å°æ‡‰åˆ°å“ªå€‹ <code>useState</code> çš„å‘¼å«ï¼Ÿç­”æ¡ˆæ˜¯ <strong>React ä»°è³´æ–¼ Hook è¢«å‘¼å«çš„é †åº</strong>ã€‚æˆ‘å€‘çš„ç¯„ä¾‹èƒ½åŸ·è¡Œæ˜¯å› ç‚ºåœ¨æ¯ä¸€æ¬¡çš„ render ä¸­ Hook éƒ½æ˜¯ä¾ç…§ä¸€æ¨£çš„é †åºè¢«å‘¼å«ï¼š<pre class="language-js"><code class="language-js"><span class="token comment">// ---------</span>
<span class="token comment">// ç¬¬ä¸€æ¬¡ render</span>
<span class="token comment">// ---------</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. ç”¨ 'Mary' ä¾†åˆå§‹åŒ– name state è®Šæ•¸</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>persistForm<span class="token punctuation">)</span>     <span class="token comment">// 2. å¢åŠ ä¸€å€‹ effect ä¾†ä¿å­˜è¡¨å–®</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// 3. ç”¨ 'Poppins' ä¾†åˆå§‹åŒ– surname state è®Šæ•¸</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// 4. å¢åŠ ä¸€å€‹ effect ä¾†æ›´æ–°æ¨™é¡Œ</span>

<span class="token comment">// ----------</span>
<span class="token comment">// ç¬¬äºŒæ¬¡ render</span>
<span class="token comment">// ----------</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. è®€å– name state è®Šæ•¸ (åƒæ•¸è¢«å¿½ç•¥äº†)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>persistForm<span class="token punctuation">)</span>     <span class="token comment">// 2. æ›¿æ›äº†ç”¨ä¾†ä¿å­˜è¡¨å–®çš„ effect</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// 3. è®€å– surname state è®Šæ•¸ (åƒæ•¸è¢«å¿½ç•¥äº†)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// 4. æ›¿æ›äº†ç”¨ä¾†æ›´æ–°æ¨™é¡Œçš„ effect</span>

<span class="token comment">// ...</span></code></pre><p>åªè¦ Hook åœ¨ render æ™‚è¢«å‘¼å«çš„é †åºæ˜¯ä¸€è‡´çš„ï¼ŒReact å¯ä»¥å°‡ä¸€äº› local state å’Œå®ƒå€‘ä¸€ä¸€è¯ç¹«åœ¨ä¸€èµ·ã€‚ä½†å¦‚æœæˆ‘å€‘æŠŠä¸€å€‹ Hook å‘¼å«ï¼ˆä¾‹å¦‚ï¼Œ<code>persistForm</code> effectï¼‰æ”¾åœ¨æ¢ä»¶å¼ä¸­æœƒç™¼ç”Ÿä»€éº¼äº‹å‘¢ï¼Ÿ<pre class="language-js"><code class="language-js">  <span class="token comment">// ğŸ”´ æˆ‘å€‘é•åäº†ç¬¬ä¸€å€‹è¦å‰‡ï¼Œåœ¨æ¢ä»¶å¼ä¸­ä½¿ç”¨ Hook</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>name <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre><p>é€™å€‹ <code>name !== ''</code> æ¢ä»¶å¼åœ¨åˆæ¬¡ render æ™‚ç‚º <code>true</code>ï¼Œæ‰€ä»¥æˆ‘å€‘åŸ·è¡Œäº†æ­¤ Hookã€‚ç„¶è€Œï¼Œåœ¨ä¸‹ä¸€æ¬¡ render æ™‚ä½¿ç”¨è€…å¯èƒ½æ¸…é™¤äº†è¡¨å–®ï¼Œä½¿å¾—æ¢ä»¶å¼è®Šç‚º <code>false</code>ã€‚è€Œç¾åœ¨æˆ‘å€‘åœ¨ render æœŸé–“è·³éäº†é€™ä¸€å€‹ Hookï¼ŒHook çš„å‘¼å«é †åºæœ‰æ‰€ä¸åŒï¼š<pre class="language-js"><code class="language-js"><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. è®€å– name state è®Šæ•¸ (åƒæ•¸è¢«å¿½ç•¥äº†)</span>
<span class="token comment">// useEffect(persistForm)  // ğŸ”´ é€™å€‹ Hook è¢«è·³éäº†ï¼</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// ğŸ”´ 2 (ä½†ä¹‹å‰æ˜¯ 3). æœªèƒ½è®€å– surname state è®Šæ•¸</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// ğŸ”´ 3 (ä½†ä¹‹å‰æ˜¯ 4). æœªèƒ½å–ä»£ effect</span></code></pre><p>React ä¸æœƒçŸ¥é“ç¬¬äºŒå€‹ <code>useState</code> Hook å‘¼å«å›å‚³ä»€éº¼ã€‚React é æœŸåœ¨é€™å€‹ component ä¸­çš„ç¬¬äºŒå€‹ Hook å‘¼å«å’Œ <code>persistForm</code> effect æ˜¯ç›¸å°æ‡‰çš„ï¼Œå°±å¦‚åŒåœ¨å‰ä¸€æ¬¡çš„ render ä¸€æ¨£ï¼Œä½†å®ƒä¸å†ä¸€æ¨£äº†ã€‚å¾é‚£æ™‚èµ·ï¼Œåœ¨æˆ‘å€‘è·³éçš„é‚£å€‹ Hook å¾Œé¢ï¼Œæ¯ä¸‹ä¸€å€‹ Hook å‘¼å«éƒ½æœƒ shift ä¸€å€‹ï¼Œå°è‡´ bug çš„ç™¼ç”Ÿã€‚<p><strong>é€™å°±æ˜¯ç‚ºä½•å¿…é ˆåœ¨æˆ‘å€‘çš„ component ä¹‹ä¸Šå±¤ä¾†å‘¼å« Hookã€‚</strong> å¦‚æœæˆ‘å€‘æƒ³è¦æœ‰æ¢ä»¶åœ°åŸ·è¡Œ effectï¼Œæˆ‘å€‘å¯ä»¥æŠŠé‚£å€‹æ¢ä»¶å¼æ”¾åœ¨æˆ‘å€‘çš„ Hook <em>è£¡</em>ï¼š<pre class="language-js"><code class="language-js">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ğŸ‘ æˆ‘å€‘ä¸å†é•åç¬¬ä¸€å€‹è¦å‰‡</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>name <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>æ³¨æ„ä½ ä¸éœ€è¦æ“”å¿ƒé€™å€‹å•é¡Œï¼Œå¦‚æœä½ ä½¿ç”¨<a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">æä¾›çš„ lint è¦å‰‡</a>ã€‚</strong>ä½†ç¾åœ¨ä½ ä¹Ÿäº†è§£<em>ç‚ºä½•</em> Hook æ˜¯é€™æ¨£é‹ä½œçš„ï¼Œå’Œé€™äº›ç”¨ä¾†é¿å…è€Œåˆ¶å®šçš„è¦å‰‡ã€‚</section><section id="next-steps"class="level2"><h2>ä¸‹ä¸€æ­¥</h2><p>æœ€å¾Œ, æˆ‘å€‘æº–å‚™å¥½å­¸ç¿’<a href="./hooks-custom.html">æ’°å¯«ä½ è‡ªå·±çš„ Hook</a>ï¼è‡ªå®šç¾©çš„ Hook è®“ä½ èƒ½çµåˆç”± React æä¾›çš„ Hook åˆ°ä½ è‡ªå·±çš„æŠ½è±¡åŒ–ä¸­ï¼Œè€Œä¸”åœ¨ä¸åŒçš„ component é–“é‡è¤‡ä½¿ç”¨ç›¸åŒçš„ stateful é‚è¼¯ã€‚ <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>