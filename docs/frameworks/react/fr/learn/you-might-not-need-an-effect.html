<!doctype html><html lang="fr"><meta charset="utf-8"><title>'Vous nâ€™avez pas forcÃ©ment besoin dâ€™un Effet'</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="vous-navez-pas-forcÃ©ment-besoin-dun-effet"><h1 id="vous-navez-pas-forcÃ©ment-besoin-dun-effet">'Vous nâ€™avez pas forcÃ©ment besoin dâ€™un Effet'</h1><intro><p>Les Effets sont une faÃ§on dâ€™Ã©chapper au paradigme de React. Ils vous permettent de Â«Â sortirÂ Â» de React et de synchroniser vos composants avec un systÃ¨me extÃ©rieur tel quâ€™un widget Ã©crit sans React, le rÃ©seau, ou le DOM du navigateur. Sâ€™il nâ€™y a pas de systÃ¨me extÃ©rieur dans lâ€™histoire (par exemple, vous voulez juste mettre Ã  jour lâ€™Ã©tat dâ€™un composant lorsque ses props ou son Ã©tat changent), vous ne devriez pas avoir besoin dâ€™un Effet. Retirer des Effets superflus rendra votre code plus simple Ã  comprendre, plus performant, et moins sujet aux erreurs.</p></intro><youwilllearn><ul><li>Pourquoi et comment retirer les Effets superflus de vos composants<li>Comment mettre en cache des calculs complexes sans Effet<li>Comment rÃ©initialiser ou modifier lâ€™Ã©tat de votre composant sans Effets<li>Comment partager des traitements entre gestionnaires dâ€™Ã©vÃ©nements<li>Quels traitements devraient Ãªtre dÃ©placÃ©s dans des gestionnaires dâ€™Ã©vÃ©nements<li>Comment notifier des composants parents dâ€™un changement</ul></youwilllearn><section class="level2"aria-labelledby="commment-retirer-les-effets-superflus-how-to-remove-unnecessary-effects"><h2 id="commment-retirer-les-effets-superflus-how-to-remove-unnecessary-effects">Commment retirer les Effets superflus {/<em>how-to-remove-unnecessary-effects</em>/}</h2><p>Il y a deux scÃ©narios principaux pour lesquels vous nâ€™avez pas besoin dâ€™EffetsÂ :<ul><li><strong>Vous nâ€™avez pas besoin dâ€™Effets pour transformer des donnÃ©es utilisÃ©es par le rendu.</strong> Disons par exemple que vous souhaitez filtrer une liste avant de lâ€™afficher. Vous pourriez etre tentÃ©Â·e dâ€™Ã©crire un Effet qui mette Ã  jour une variable dâ€™Ã©tat lorsque la liste change. Câ€™est pourtant inefficace. Lorsque vous mettez Ã  jour lâ€™Ã©tat, React va dâ€™abord appeler vos fonctions composants pour calculer ce quâ€™il doit afficher Ã  lâ€™Ã©cran. Puis React va <a href="/learn/render-and-commit">retranscrire</a> ces modifications auprÃ¨s du DOM (<em>phase de â€œcommitâ€, NdT)</em>, ce qui mettra lâ€™Ã©cran Ã  jour. Ensuite React exÃ©cutera vos Effets. Si votre Effet met immÃ©diatement lâ€™Ã©tat Ã  jour <em>lui aussi</em>, Ã§a va tout refaire du dÃ©butÂ ! Pour Ã©viter des passes de rendu superflues, transformez les donnÃ©es Ã  la racine de vos composants. Ce code sera automatiquement rÃ©-exÃ©cutÃ© dÃ¨s que vos props ou votre Ã©tat changera.<li><strong>Vous nâ€™avez pas besoin dâ€™Effets pour gÃ©rer les Ã©vÃ©nements utilisateurs.</strong> Supposons que vou souhaitez envoyer une requÃªte POST Ã  <code>/api/buy</code> et afficher une notification lorsque lâ€™utilisateur achÃ¨te un produit. Dans le gestionnaire dâ€™Ã©vÃ©nement clic du bouton Acheter, vous savez prÃ©cisÃ©ment pourquoi vous Ãªtes lÃ . Alors quâ€™au moment oÃ¹ lâ€™Effet sâ€™exÃ©cutera, vous ne saurez pas <em>ce quâ€™a fait</em> lâ€™utilisateur (par exemple, quel bouton il a cliquÃ©). Câ€™est pourquoi vous traiterez gÃ©nÃ©ralement les Ã©vÃ©nements utilisateurs directement au sein des gestionnaires dâ€™Ã©vÃ©nements concernÃ©s.</ul><p>En revanche, <em>vous avez besoin</em> dâ€™Effets pour <a href="/learn/synchronizing-with-effects#what-are-effects-and-how-are-they-different-from-events">synchroniser</a> votre composant avec des systÃ¨mes extÃ©rieurs. Par exemple, vous pouvez Ã©crire un Effet qui synchronise un widget basÃ© jQuery avec votre Ã©tat React. Vous pouvez aussi charger des donnÃ©es avec les Effets, par exemple pour synchroniser des rÃ©sultats de recherche avec la requÃªte Ã  jour. Gardez toutefois Ã  lâ€™esprit que les <a href="/learn/start-a-new-react-project#production-grade-react-frameworks">frameworks</a> modernes vous fournissent de base des mÃ©canismes de chargement de donnÃ©es plus efficaces que si vous lâ€™Ã©crivez directement dans vos Effets.<p>Pour vous aider Ã  affiner votre intuition sur ce sujet, examinons ensemble plusieurs cas concrets courantsÂ !<section class="level3"aria-labelledby="mettre-Ã -jour-un-Ã©tat-sur-base-des-props-ou-dun-autre-Ã©tat-updating-state-based-on-props-or-state"><h3 id="mettre-Ã -jour-un-Ã©tat-sur-base-des-props-ou-dun-autre-Ã©tat-updating-state-based-on-props-or-state">Mettre Ã  jour un Ã©tat sur base des props ou dâ€™un autre Ã©tat {/<em>updating-state-based-on-props-or-state</em>/}</h3><p>Supposons que vous ayez un composant avec deux variables dâ€™Ã©tatÂ : <code>firstName</code> et <code>lastName</code>. Vous souhaitez calculer <code>fullName</code> en les concatÃ©nant. Par ailleurs, vous aimeriez que <code>fullName</code> soit mis Ã  jour dÃ¨s que <code>firstName</code> ou <code>lastName</code> change. Votre premiÃ¨re pensÃ©e serait peut-Ãªtre dâ€™ajouter une variable dâ€™Ã©tat <code>fullName</code> et de la mettre Ã  jour dans un EffetÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> setFirstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Clara'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastName<span class="token punctuation">,</span> setLastName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Luciani'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ğŸ”´ Ã‰vitezÂ : Ã©tat redondant et Effet superflu</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>fullName<span class="token punctuation">,</span> setFullName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setFullName</span><span class="token punctuation">(</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Câ€™est inutilement compliquÃ©. Et câ€™est inefficace en primeÂ : une passe entiÃ¨re de rendu est faite avec une valeur obsolÃ¨te pour <code>fullName</code>, immÃ©diatement suivie dâ€™un nouveau rendu avec la valeur Ã  jour. Retirez cette variable dâ€™Ã©tat et lâ€™EffetÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> setFirstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Clara'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastName<span class="token punctuation">,</span> setLastName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Luciani'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// âœ… CorrectÂ : valeur calculÃ©e lors du rendu</span>
  <span class="token keyword">const</span> fullName <span class="token operator">=</span> firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><strong>Quand quelque chose peut Ãªtre calculÃ© Ã  partir des props et variables dâ€™Ã©tat existantes, <a href="/learn/choosing-the-state-structure#avoid-redundant-state">ne le mettez pas dans lâ€™Ã©tat</a>. Au lieu de Ã§a, calculez-le pendant le rendu.</strong> Ã‡a rendra votre code plus performant (pas de mises Ã  jour en cascade), plus simple (moins de code), et moins sujet Ã  erreurs (on Ã©vite les bugs dus Ã  la dÃ©synchronisation des variables dâ€™Ã©tat). Si cette approche vous paraÃ®t nouvelle, <a href="/learn/thinking-in-react#step-3-find-the-minimal-but-complete-representation-of-ui-state">Penser en React</a> vous explique ce qui devrait faire lâ€™objet de variables dâ€™Ã©tat.</section><section class="level3"aria-labelledby="mettre-en-cache-des-calculs-complexes-caching-expensive-calculations"><h3 id="mettre-en-cache-des-calculs-complexes-caching-expensive-calculations">Mettre en cache des calculs complexes {/<em>caching-expensive-calculations</em>/}</h3><p>Le composant ci-aprÃ¨s calcule <code>visibleTodos</code> en partant de sa prop <code>todos</code> et en la filtrant selon sa prop <code>filter</code>. Vous pourriez Ãªtre tentÃ©Â·e de stocker le rÃ©sultat dans lâ€™Ã©tat et de le mettre Ã  jour depuis un EffetÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> todos<span class="token punctuation">,</span> filter <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>newTodo<span class="token punctuation">,</span> setNewTodo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ğŸ”´ Ã‰vitezÂ : Ã©tat redondant et Effet superflu</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visibleTodos<span class="token punctuation">,</span> setVisibleTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setVisibleTodos</span><span class="token punctuation">(</span><span class="token function">getFilteredTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> filter<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Comme dans lâ€™exemple prÃ©cÃ©dent, ce code est Ã  la fois superflu et inefficace. Commencez par retirer la variable dâ€™Ã©tat et lâ€™EffetÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> todos<span class="token punctuation">,</span> filter <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>newTodo<span class="token punctuation">,</span> setNewTodo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// âœ… Ce code ira trÃ¨s bien si getFilteredTodos() est rapide.</span>
  <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> <span class="token function">getFilteredTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>En gÃ©nÃ©ral, Ã§a ira trÃ¨s bien comme Ã§aÂ ! Mais peut-Ãªtre que <code>getFilteredTodos()</code> est un peu lente, ou que vous avez <em>beaucoup</em> de tÃ¢ches Ã  filtrer. Dans un tel cas, vous ne voudrez sans doute pas recalculer <code>getFilteredTodos()</code> lorsquâ€™une autre variable dâ€™Ã©tat telle que <code>newTodo</code> change.<p>Vous pouvez alors mettre en cache (ou <a href="https://fr.wikipedia.org/wiki/M%C3%A9mo%C3%AFsation">Â«Â mÃ©moÃ¯serÂ Â»</a>) un calcul coÃ»teux en lâ€™enrobant dans un Hook <a href="/reference/react/useMemo"><code>useMemo</code></a>Â :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useMemo<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> todos<span class="token punctuation">,</span> filter <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>newTodo<span class="token punctuation">,</span> setNewTodo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// âœ… Ne se rÃ©-exÃ©cute que si les tÃ¢ches ou le filtre changent</span>
    <span class="token keyword control-flow">return</span> <span class="token function">getFilteredTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> filter<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Ou sur une seule ligneÂ :<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useMemo<span class="token punctuation">,</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> todos<span class="token punctuation">,</span> filter <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>newTodo<span class="token punctuation">,</span> setNewTodo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// âœ… Ne rÃ©-exÃ©cute getFilteredTodos que si les tÃ¢ches ou le filtre changent</span>
  <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">getFilteredTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> filter<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><strong>Ã‡a dit Ã  React que vous ne souhaitez pas rÃ©-exÃ©cuter la fonction imbriquÃ©e sauf si <code>todos</code> ou <code>filter</code> ont changÃ©.</strong> React se souviendra de la valeur renvoyÃ©e par <code>getFilteredTodos()</code> au moment du rendu initial. Lors des rendus ultÃ©rieurs, il vÃ©rifiera si <code>todos</code> ou <code>filter</code> ont changÃ©. Sâ€™ils sont identiques Ã  leurs valeurs du rendu prÃ©cÃ©dent, <code>useMemo</code> renverra le dernier rÃ©sultat quâ€™il avait stockÃ©. Mais si une diffÃ©rence survient, React rappellera la fonction imbriquÃ©e (et stockera le rÃ©sultat).<p>La fonction que vous enrobez avec <a href="/reference/react/useMemo"><code>useMemo</code></a> sâ€™exÃ©cute pendant le rendu, Ã§a ne sâ€™applique donc que pour <a href="/learn/keeping-components-pure">des fonctions de calcul pures</a>.</p><deepdive><section class="level4"aria-labelledby="comment-savoir-si-un-calcul-est-coÃ»teux-how-to-tell-if-a-calculation-is-expensive"><h4 id="comment-savoir-si-un-calcul-est-coÃ»teux-how-to-tell-if-a-calculation-is-expensive">Comment savoir si un calcul est coÃ»teuxÂ ? {/<em>how-to-tell-if-a-calculation-is-expensive</em>/}</h4><p>En rÃ¨gle gÃ©nÃ©rale, Ã  moins que vous ne crÃ©iez ou itÃ©riez Ã  travers des milliers dâ€™objets, Ã§a nâ€™est probablement pas coÃ»teux. Si vous avez besoin de vous rassurer, vous pouvez ajouter une mesure en console du temps passÃ© dans ce bout de codeÂ :<pre class="language-js"><code class="language-js"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">time</span><span class="token punctuation">(</span><span class="token string">'filtrage tableau'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> <span class="token function">getFilteredTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">timeEnd</span><span class="token punctuation">(</span><span class="token string">'filtrage tableau'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>RÃ©alisez lâ€™interaction Ã  mesurer (par exemple, saisissez quelque chose dans un champ). Vous verrez alors un message en console du genre <code>filtrage tableau: 0.15ms</code>. Si le temps cumulÃ© obtenu devient important (disons <code>1ms</code> ou plus), il peut Ãªtre pertinent de mÃ©moÃ¯ser le calcul. Ã€ titre dâ€™expÃ©rience, vous pouvez enrober le calcul avec <code>useMemo</code> pour vÃ©rifier si le temps total mesurÃ© sâ€™est rÃ©duit ou non pour votre interactionÂ :<pre class="language-js"><code class="language-js"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">time</span><span class="token punctuation">(</span><span class="token string">'filtrage tableau'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token function">getFilteredTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SautÃ© si todos et filter nâ€™ont pas changÃ©</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> filter<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">timeEnd</span><span class="token punctuation">(</span><span class="token string">'filtrage tableau'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>useMemo</code> nâ€™accÃ©lÃ¨rera pas le <em>premier</em> rendu. Il aide seulement Ã  sauter un traitement superflu lors des mises Ã  jour.<p>Gardez Ã  lâ€™esprit que votre machine est probablement plus rapide que celles de vos utilisateurs, il est donc recommandÃ© de tester la performance au sein dâ€™un ralentissement artificiel. Par exemple, Chrome propose une option de <a href="https://developer.chrome.com/blog/new-in-devtools-61/#throttling">bridage processeur</a> exprÃ¨s pour Ã§a.<p>Remarquez aussi que mesurer la performance en dÃ©veloppement ne vous donnera pas des rÃ©sultats trÃ¨s prÃ©cis. (Par exemple, quand le <a href="/reference/react/StrictMode">mode strict</a> est actif, chaque composant fait deux rendus au lieu dâ€™un.) Pour amÃ©liorer la pertinence de vos mesures, construisez la version de production de votre appli et testez-la sur des appareils similaires Ã  ceux de vos utilisateurs.</section></deepdive></section><section class="level3"aria-labelledby="rÃ©initialiser-tout-votre-Ã©tat-quand-une-prop-change-resetting-all-state-when-a-prop-changes"><h3 id="rÃ©initialiser-tout-votre-Ã©tat-quand-une-prop-change-resetting-all-state-when-a-prop-changes">RÃ©initialiser tout votre Ã©tat quand une prop change {/<em>resetting-all-state-when-a-prop-changes</em>/}</h3><p>Le composant <code>ProfilePage</code> ci-dessous reÃ§oit une prop <code>userId</code>. La page contient un champ de commentaire, et vous utilisez la variable dâ€™Ã©tat <code>comment</code> pour en stocker la valeur. Un beau jour, vous remarquez un problÃ¨meÂ : quand vous passez dâ€™un profil Ã  lâ€™autre, lâ€™Ã©tat <code>comment</code> nâ€™est pas rÃ©initialisÃ©. Du coup, il nâ€™est que trop facile dâ€™envoyer par accident un commentaire au mauvais profil utilisateur. Pour corriger Ã§a, vous essayez de vider la variable dâ€™Ã©tat <code>comment</code> chaque fois que <code>userId</code> changeÂ :<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ProfilePage</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> userId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>comment<span class="token punctuation">,</span> setComment<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ğŸ”´ Ã‰vitezÂ : rÃ©initialiser un Ã©tat sur base d'une prop dans un Effet</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setComment</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>userId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Câ€™est balourd parce que <code>ProfilePage</code> et ses enfants vont dâ€™abord faire un rendu basÃ© sur la valeur obsolÃ¨te, puis refaire un rendu. Câ€™est par ailleurs compliquÃ©, parce quâ€™il faut le faire dans <em>chaque</em> composant qui utilise un Ã©tat issu de <code>ProfilePage</code>. Ainsi, si lâ€™UI de commentaire est imbriquÃ©e, il faudra nettoyer lâ€™Ã©tat de commentaire imbriquÃ© aussi.<p>La bonne alternative consiste Ã  indiquer Ã  React que chaque composant de profil <em>reprÃ©sente un profil diffÃ©rent</em>, en leur fournissant une clÃ© explicite. DÃ©coupez votre composant en deux et passez une prop <code>key</code> du composant externe au composant interneÂ :<pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ProfilePage</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> userId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Profile</span>
      userId<span class="token operator">=</span><span class="token punctuation">{</span>userId<span class="token punctuation">}</span>
      key<span class="token operator">=</span><span class="token punctuation">{</span>userId<span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Profile</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> userId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// âœ… Toutes les variables dâ€™Ã©tat dÃ©clarÃ©es ici seront rÃ©initialisÃ©es automatiquement</span>
  <span class="token comment">// en cas de changement de clÃ©.</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>comment<span class="token punctuation">,</span> setComment<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>En temps normal, React prÃ©serve lâ€™Ã©tat lorsquâ€™un mÃªme composant fait son rendu au mÃªme endroit. <strong>En passant <code>userId</code> comme <code>key</code> au composant <code>Profile</code>, vous demandez Ã  React de traiter deux composants <code>Profile</code> de <code>userId</code> distincts comme ayant des Ã©tats sÃ©parÃ©s.</strong> DÃ¨s que la <code>key</code> (que vous avez dÃ©finie Ã  <code>userId</code>) change, React recrÃ©era le DOM et <a href="/learn/preserving-and-resetting-state#option-2-resetting-state-with-a-key">rÃ©initialisera lâ€™Ã©tat</a> du composant <code>Profile</code> et de tous ses enfants. DÃ©sormais le champ <code>comment</code> se videra automatiquement quand vous passerez dâ€™un profil Ã  lâ€™autre.<p>Remarquez que dans cet exemple, seul le composant externe <code>ProfilePage</code> est exportÃ© et visible par les autres fichiers du projet. Les composants qui exploitent <code>ProfilePage</code> nâ€™ont pas besoin de lui passer une clÃ©Â : ils passent <code>userId</code> comme une prop normale. Le fait que <code>ProfilePage</code> le passe comme <code>key</code> Ã  son composant interne <code>Profile</code> est un dÃ©tail dâ€™implÃ©mentation.</section><section class="level3"aria-labelledby="modifier-une-partie-de-lÃ©tat-quand-une-prop-change-adjusting-some-state-when-a-prop-changes"><h3 id="modifier-une-partie-de-lÃ©tat-quand-une-prop-change-adjusting-some-state-when-a-prop-changes">Modifier une partie de lâ€™Ã©tat quand une prop change {/<em>adjusting-some-state-when-a-prop-changes</em>/}</h3><p>Il arrive que vous souhaitiez ne rÃ©initialiser, ou ajuster, quâ€™une partie de lâ€™Ã©tat quand une prop change (plutÃ´t que lâ€™Ã©tat dans son intÃ©gralitÃ©).<p>Le composant <code>List</code> ci-aprÃ¨s reÃ§oit une liste dâ€™Ã©lÃ©ments <em>via</em> sa prop <code>items</code>, et garde lâ€™Ã©lÃ©ment sÃ©lectionnÃ© dans sa variable dâ€™Ã©tat <code>selection</code>. Vous souhaitez ramener <code>selection</code> Ã  <code>null</code> chaque fois que <code>items</code> reÃ§oit un nouveau tableauÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">List</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isReverse<span class="token punctuation">,</span> setIsReverse<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selection<span class="token punctuation">,</span> setSelection<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ğŸ”´ Ã‰vitezÂ : ajustement dâ€™Ã©tat sur changement de prop dans un Effet</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setSelection</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>items<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Ã‡a non plus, ce nâ€™est pas idÃ©al. Chaque fois que <code>items</code> change, le composant <code>List</code> et ses composants enfants commencent par calculer un rendu sur base dâ€™une valeur obsolÃ¨te de <code>selection</code>. React met ensuite Ã  jour le DOM et exÃ©cute les Effets. Enfin, lâ€™appel <code>setSelection(null)</code> cause un nouveau rendu de <code>List</code> et de ses enfants, relanÃ§ant tout le processus.<p>Commencez par retirer lâ€™Effet. Ajustez plutÃ´t lâ€™Ã©tat directement au sein du renduÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">List</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isReverse<span class="token punctuation">,</span> setIsReverse<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selection<span class="token punctuation">,</span> setSelection<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// MieuxÂ : ajustement de lâ€™Ã©tat au sein du rendu</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>prevItems<span class="token punctuation">,</span> setPrevItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>items <span class="token operator">!==</span> prevItems<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setPrevItems</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setSelection</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><a href="/reference/react/useState#storing-information-from-previous-renders">Stocker des infos issues de rendus prÃ©cÃ©dents</a> de cette faÃ§on peut Ãªtre difficile Ã  comprendre, mais câ€™est toujours mieux que de faire la mÃªme mise Ã  jour au sein dâ€™un Effet. Dans lâ€™exemple ci-dessus, <code>setSelection</code> est appelÃ©e directement au sein du rendu. React refera le rendu de <code>List</code> <em>immÃ©diatement</em> aprÃ¨s quâ€™il aura terminÃ© au moyen de son instruction <code>return</code>. React nâ€™aura pas encore fait le rendu des composants enfants de <code>List</code>, et encore moins mis Ã  jour le DOM, ce qui permet aux enfants de <code>List</code> dâ€™Ã©viter un rendu sur base dâ€™une valeur obsolÃ¨te de <code>selection</code>.<p>Quand vous mettez Ã  jour un composant au sein de son rendu, React jette le JSX renvoyÃ© et retente immÃ©diatement un rendu. Pour Ã©viter des cascades dÃ©sastreuses de tentatives, React ne vous permet de mettre Ã  jour que lâ€™Ã©tat du <em>mÃªme</em> composant au sein dâ€™un rendu. Si vous tentez dâ€™y mettre Ã  jour lâ€™Ã©tat dâ€™un autre composant, vous obtiendrez une erreur. Une condition telle que <code>items !== prevItems</code> est nÃ©cessaire pour Ã©viter les boucles. Vous pouvez ajuster lâ€™Ã©tat ainsi, mais tout autre effet de bord (tel quâ€™une modification du DOM, ou la dÃ©finition de timers) devrait rester dans des gestionnaires dâ€™Ã©vÃ©nements ou des Effets afin de <a href="/learn/keeping-components-pure">garder vos composants purs</a>.<p><strong>MÃªme si cette approche est plus efficace quâ€™un Effet, la plupart des composants ne devraient pas en avoir besoin non plus.</strong> Peu importe comment vous vous y prenez, ajuster lâ€™Ã©tat sur base des props ou dâ€™un autre Ã©tat rend votre flux de donnÃ©es plus difficile Ã  comprendre et Ã  dÃ©boguer. VÃ©rifiez toujours si vous ne pourriez pas plutÃ´t <a href="#resetting-all-state-when-a-prop-changes">rÃ©initialiser tout votre Ã©tat Ã  lâ€™aide dâ€™une clÃ©</a> ou <a href="#updating-state-based-on-props-or-state">tout calculer pendant le rendu</a>. Par exemple, au lieu de stocker (et rÃ©initialiser) <em>lâ€™Ã©lÃ©ment</em> sÃ©lectionnÃ©, vous pourriez stocker <em>son ID</em>Â :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">List</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> items <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isReverse<span class="token punctuation">,</span> setIsReverse<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedId<span class="token punctuation">,</span> setSelectedId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// âœ… NickelÂ : on calcule tout au moment du rendu</span>
  <span class="token keyword">const</span> selection <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=></span> item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> selectedId<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Ã€ prÃ©sent, plus du tout besoin Â«Â dâ€™ajusterÂ Â» lâ€™Ã©tat. Si lâ€™Ã©lÃ©ment correspondant Ã  lâ€™ID est dans la liste, il restera sÃ©lectionnÃ©. Sâ€™il nâ€™y est pas, la <code>selection</code> calculÃ©e pendant le rendu sera <code>null</code> faute de correspondance trouvÃ©e. Le comportement est diffÃ©rent, mais on pourrait mÃªme dire quâ€™il est meilleur, car la plupart des changements de <code>items</code> prÃ©serveront la sÃ©lection.</section><section class="level3"aria-labelledby="partager-des-traitements-entre-gestionnaires-dÃ©vÃ©nements-sharing-logic-between-event-handlers"><h3 id="partager-des-traitements-entre-gestionnaires-dÃ©vÃ©nements-sharing-logic-between-event-handlers">Partager des traitements entre gestionnaires dâ€™Ã©vÃ©nements {/<em>sharing-logic-between-event-handlers</em>/}</h3><p>Disons que vous avez une page produit avec deux boutons (Acheter et Payer), qui tous les deux vous permettent dâ€™acheter le produit. Vous voulez afficher une notification lorsque lâ€™utilisateur ajoute le produit au panier. Appeler <code>showNotification()</code> dans les gestionnaires de clics des deux boutons semble rÃ©pÃ©titif, et vous Ãªtes tentÃ©Â·e de centraliser ce comportement dans un EffetÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ProductPage</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> product<span class="token punctuation">,</span> addToCart <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ğŸ”´ Ã‰vitezÂ : comportement liÃ© Ã  un Ã©vÃ©nement dans un Effet</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token property-access">isInCart</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Vous avez ajoutÃ© </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>product<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> au panierÂ !</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>product<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleBuyClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">addToCart</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleCheckoutClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">addToCart</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token string">'/checkout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Cet Effet est superflu. Il causera par ailleurs sans doute des bugs. Par exemple, disons que votre appli Â«Â se souvientÂ Â» du panier Ã  travers le rechargement de la page. Si vous ajoutez un produit au panier puis rafraÃ®chissez la page, la notification rÃ©apparaÃ®tra. Elle recommencera Ã  chaque rafraÃ®chissement de la page produit. Câ€™est parce que <code>product.isInCart</code> sera dÃ©jÃ  Ã  <code>true</code> au chargement de la page, donc l'Effet ci-dessus appellera <code>showNotification()</code>.<p><strong>Quand vous ne savez pas trop si du code devrait Ãªtre dans un Effet ou un gestionnaire dâ€™Ã©vÃ©nement, demandez-vous <em>pourquoi</em> ce code a besoin de sâ€™exÃ©cuter. Utilisez les Effets uniquement pour du code qui devrait sâ€™exÃ©cuter <em>parce que</em> le composant a Ã©tÃ© affichÃ© Ã  lâ€™utilisateur.</strong> Dans notre exemple, la notification devrait apparaÃ®tre parce que lâ€™utilisateur <em>a pressÃ© un bouton</em>, pas parce que la page sâ€™afficheÂ ! Supprimez lâ€™Effet et mettez le traitement partagÃ© dans une fonction appelÃ©e depuis les deux gestionnaires dâ€™Ã©vÃ©nementsÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ProductPage</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> product<span class="token punctuation">,</span> addToCart <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// âœ… CorrectÂ : comportement liÃ© Ã  un Ã©vÃ©nement dans un gestionnaire dâ€™Ã©vÃ©nement</span>
  <span class="token keyword">function</span> <span class="token function">buyProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">addToCart</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Vous avez ajoutÃ© </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>product<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> au panierÂ !</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleBuyClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">buyProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleCheckoutClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">buyProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token string">'/checkout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Non seulement Ã§a retire un Effet superflu, mais Ã§a corrige le bug au passage.</section><section class="level3"aria-labelledby="envoyer-une-requÃªte-post-sending-a-post-request"><h3 id="envoyer-une-requÃªte-post-sending-a-post-request">Envoyer une requÃªte POST {/<em>sending-a-post-request</em>/}</h3><p>Ce composant <code>Form</code> envoie deux types de requÃªtes POST. Il envoie un Ã©vÃ©nement analytique au moment du montage. Et lorsque vous remplissez les champs et cliquez sur le bouton Envoyer, il envoie une requÃªte POST au point dâ€™accÃ¨s <code>/api/register</code>Â :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> setFirstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastName<span class="token punctuation">,</span> setLastName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// âœ… CorrectÂ : ce traitement devrait sâ€™exÃ©cuter Ã  lâ€™affichage initial</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/analytics/event'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">eventName</span><span class="token operator">:</span> <span class="token string">'visit_form'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ğŸ”´ Ã‰vitezÂ : traitement liÃ© Ã  un Ã©vÃ©nement dans un Effet</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>jsonToSubmit<span class="token punctuation">,</span> setJsonToSubmit<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>jsonToSubmit <span class="token operator">!==</span> <span class="token keyword null nil">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/register'</span><span class="token punctuation">,</span> jsonToSubmit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>jsonToSubmit<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setJsonToSubmit</span><span class="token punctuation">(</span><span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> lastName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Appliquons les mÃªmes critÃ¨res que pour lâ€™exemple prÃ©cÃ©dent.<p>La requÃªte POST analytique devrait rester dans un Effet. En effet (ah ah), la <em>raison</em> de notre Ã©vÃ©nement analytique, câ€™est justement le fait que le formulaire ait Ã©tÃ© affichÃ©. (Ã‡a sâ€™exÃ©cuterait deux fois en dÃ©veloppement, mais <a href="/learn/synchronizing-with-effects#sending-analytics">voyez comment gÃ©rer cet aspect</a>).<p>En revanche, la requÃªte POST Ã  <code>/api/register</code> nâ€™est pas due Ã  <em>lâ€™affichage</em> du formulaire. On veut seulement envoyer cette requÃªte pour une raison prÃ©ciseÂ : quand lâ€™utilisateur appuie sur le bouton. Ã‡a ne devrait arriver que <em>suite Ã  cette interaction spÃ©cifique</em>. Supprimez le deuxiÃ¨me Effet et dÃ©placez la requÃªte POST dans le gestionnaire dâ€™Ã©vÃ©nementÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> setFirstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastName<span class="token punctuation">,</span> setLastName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// âœ… CorrectÂ : ce traitement devrait sâ€™exÃ©cuter Ã  lâ€™affichage initial</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/analytics/event'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">eventName</span><span class="token operator">:</span> <span class="token string">'visit_form'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// âœ… CorrectÂ : traitement liÃ© Ã  un Ã©vÃ©nement dans le gestionnaire dâ€™Ã©vÃ©nement</span>
    <span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/register'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> lastName <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Quand vous dÃ©cidez si vous placez un traitement dans un gestionnaire dâ€™Ã©vÃ©nement ou dans un Effet, la question principale doit Ãªtre <em>de quel type de traitement sâ€™agit-il</em> du point de vue utilisateur. Si Ã§a fait suite Ã  une interaction spÃ©cifique, gardez-le dans un gestionnaire dâ€™Ã©vÃ©nement. Si câ€™est dÃ» au fait que lâ€™utilisateur <em>voit</em> le composant Ã  lâ€™Ã©cran, gardez-le dans un Effet.</section><section class="level3"aria-labelledby="chaÃ®nes-de-calculs-chains-of-computations"><h3 id="chaÃ®nes-de-calculs-chains-of-computations">ChaÃ®nes de calculs {/<em>chains-of-computations</em>/}</h3><p>Peut-Ãªtre chaÃ®nez-vous parfois les Effets pour que chacun ajuste une partie spÃ©cifique de lâ€™Ã©tat, sur base dâ€™autres parties de lâ€™Ã©tatÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Game</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>card<span class="token punctuation">,</span> setCard<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>goldCardCount<span class="token punctuation">,</span> setGoldCardCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>round<span class="token punctuation">,</span> setRound<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isGameOver<span class="token punctuation">,</span> setIsGameOver<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ğŸ”´ Ã‰vitezÂ : chaÃ®nes dâ€™Effets pour ajuster des bouts dâ€™Ã©tat de faÃ§on interdÃ©pendante</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>card <span class="token operator">!==</span> <span class="token keyword null nil">null</span> <span class="token operator">&#x26;&#x26;</span> card<span class="token punctuation">.</span><span class="token property-access">gold</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setGoldCardCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>card<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>goldCardCount <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setRound</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token arrow operator">=></span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token function">setGoldCardCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>goldCardCount<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>round <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setIsGameOver</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>round<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Belle partieÂ !'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>isGameOver<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handlePlaceCard</span><span class="token punctuation">(</span><span class="token parameter">nextCard</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isGameOver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'La partie est dÃ©jÃ  terminÃ©e.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token function">setCard</span><span class="token punctuation">(</span>nextCard<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span></code></pre><p>Ce code pose deux problÃ¨mes.<p>Le premier problÃ¨me est quâ€™il est trÃ¨s inefficaceÂ : le composant (et ses enfants) doivent refaire un rendu entre chaque appel <code>set</code> de la chaÃ®ne. Dans lâ€™exemple ci-dessus, dans le pire des cas (<code>setCard</code> â†’ rendu â†’ <code>setGoldCardCount</code> â†’ rendu â†’ <code>setRound</code> â†’ rendu â†’ <code>setIsGameOver</code> â†’ rendu) on a pas moins de trois rendus superflus de lâ€™arbre au sein du composant.<p>MÃªme si ce nâ€™Ã©tait pas lent, au fil de lâ€™Ã©volution de votre code, vous tomberez sur des cas oÃ¹ la Â«Â chaÃ®neÂ Â» que vous avez construite ne correspond plus aux nouvelles spÃ©cifications. Imaginez que vous ajoutiez une Ã©tape au sein de lâ€™historique des mouvements de la partie. Pour ce faire, vous devriez mettre Ã  jour chaque variable dâ€™Ã©tat sur base dâ€™une valeur passÃ©e. Seulement voilÃ , redÃ©finir <code>card</code> Ã  une valeur passÃ©e dÃ©clencherait Ã  nouveau la chaÃ®ne dâ€™Effets et modifierait la donnÃ©e affichÃ©e. Ce genre de code est rigide et fragile.<p>Dans un tel cas, il vaut largement mieux calculer tout ce quâ€™on peut pendant le rendu, et ajuster lâ€™Ã©tat au sein dâ€™un gestionnaire dâ€™Ã©vÃ©nementÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Game</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>card<span class="token punctuation">,</span> setCard<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>goldCardCount<span class="token punctuation">,</span> setGoldCardCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>round<span class="token punctuation">,</span> setRound<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// âœ… Calculer tout ce quâ€™on peut au sein du rendu</span>
  <span class="token keyword">const</span> isGameOver <span class="token operator">=</span> round <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handlePlaceCard</span><span class="token punctuation">(</span><span class="token parameter">nextCard</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isGameOver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">(</span><span class="token string">'La partie est dÃ©jÃ  terminÃ©e.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// âœ… Calculer le prochain Ã©tat dans le gestionnaire dâ€™Ã©vÃ©nement</span>
    <span class="token function">setCard</span><span class="token punctuation">(</span>nextCard<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>nextCard<span class="token punctuation">.</span><span class="token property-access">gold</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>goldCardCount <span class="token operator">&#x3C;=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setGoldCardCount</span><span class="token punctuation">(</span>goldCardCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token function">setGoldCardCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setRound</span><span class="token punctuation">(</span>round <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>round <span class="token operator">===</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Belle partieÂ !'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span></code></pre><p>Ce code est beaucoup plus performant. Par ailleurs, si vous deviez implÃ©menter une faÃ§on de consulter lâ€™historique du jeu, vous pourriez dÃ©sormais ramener chaque variable dâ€™Ã©tat Ã  des valeurs passÃ©es sans dÃ©clencher une chaÃ®ne dâ€™Effets qui Ã©craserait dâ€™autres valeurs. Si vous devez rÃ©utiliser des traitements dans plusieurs gestionnaires dâ€™Ã©vÃ©nements, vous pouvez <a href="#sharing-logic-between-event-handlers">extraire une fonction</a> et lâ€™appeler depuis ces gestionnaires.<p>Souvenez-vous quâ€™au sein des gestionnaires dâ€™Ã©vÃ©nements, <a href="/learn/state-as-a-snapshot">lâ€™Ã©tat se comporte comme une photo instantanÃ©e</a>. Par exemple, mÃªme aprÃ¨s avoir appelÃ© <code>setRound(round + 1)</code>, la variable <code>round</code> continue Ã  reflÃ©ter la valeur au moment oÃ¹ lâ€™utilisateur avait cliquÃ© sur le bouton. Si vous avez besoin de la prochaine valeur pour vos calculs, dÃ©finissez-la manuellement comme dans <code>const nextRound = round + 1</code>.<p>Il peut arriver que vous <em>ne puissiez pas</em> calculer le prochain Ã©tat directement depuis le gestionnaire dâ€™Ã©vÃ©nement. Imaginez par exemple un formulaire avec de nombreuses listes dÃ©roulantes, oÃ¹ les options de la liste suivante dÃ©pendent de la valeur de la liste prÃ©cÃ©dente. Dans un tel cas, une chaÃ®ne dâ€™Effets serait pertinente, parce que vous synchronisez votre composant avec le rÃ©seau.</section><section class="level3"aria-labelledby="initialiser-lapplication-initializing-the-application"><h3 id="initialiser-lapplication-initializing-the-application">Initialiser lâ€™application {/<em>initializing-the-application</em>/}</h3><p>Certains traitements ne devraient sâ€™exÃ©cuter quâ€™une fois, au dÃ©marrage de lâ€™appli.<p>Il pourrait Ãªtre tentant de les placer dans un Effet du composant racineÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ğŸ”´ Ã‰vitezÂ : Effet avec un traitement Ã  usage unique</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">loadDataFromLocalStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">checkAuthToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Pourtant vous rÃ©aliserez rapidement quâ€™il <a href="/learn/synchronizing-with-effects#how-to-handle-the-effect-firing-twice-in-development">sâ€™exÃ©cutera deux fois en dÃ©veloppement</a>. Ã‡a peut causer divers problÃ¨mes--peut-Ãªtre y invalidez-vous le jeton dâ€™authentification parce que la fonction nâ€™a pas Ã©tÃ© conÃ§ue pour Ãªtre appelÃ©e deux fois. En gÃ©nÃ©ral, vos composants devraient rÃ©sister Ã  un deuxiÃ¨me montage, y compris votre composant racine <code>App</code>.<p>MÃªme sâ€™il ne sera sans doute jamais remontÃ© en pratique en production, y respecter les mÃªmes contraintes que pour tous vos composants facilitera la refonte du code. Si un traitement doit sâ€™exÃ©cuter <em>une fois par chargement de lâ€™appli</em> plutÃ´t quâ€™<em>une fois par montage du composant</em>, ajoutez une variable racine pour dÃ©terminer si il a dÃ©jÃ  Ã©tÃ© exÃ©cutÃ©Â :<pre class="language-js"><code class="language-js"><span class="token keyword">let</span> didInit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>didInit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      didInit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token comment">// âœ… Ne sâ€™exÃ©cute quâ€™une fois par chargement applicatif</span>
      <span class="token function">loadDataFromLocalStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">checkAuthToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Vous pouvez aussi lâ€™exÃ©cuter Ã  lâ€™initialisation du module, avant que lâ€™appli nâ€™entame son renduÂ :<pre class="language-js"><code class="language-js"><span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token dom variable">window</span> <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// VÃ©rifie quâ€™on est dans un navigateur.</span>
  <span class="token comment">// âœ… Ne sâ€™exÃ©cute quâ€™une fois par chargement applicatif</span>
  <span class="token function">checkAuthToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">loadDataFromLocalStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Le code au niveau racine sâ€™exÃ©cute une fois au moment de lâ€™import du composant--mÃªme si ce dernier nâ€™est au final jamais exploitÃ©. Pour Ã©viter les ralentissements ou comportements surprenants Ã  lâ€™import de composants quelconques, nâ€™abusez pas de cette approche. Centralisez les traitements dâ€™initialisation applicative dans les modules du composant racine tels que <code>App.js</code> ou dans le point dâ€™entrÃ©e de lâ€™application.</section><section class="level3"aria-labelledby="notifier-des-composants-parents-dun-changement-notifying-parent-components-about-state-changes"><h3 id="notifier-des-composants-parents-dun-changement-notifying-parent-components-about-state-changes">Notifier des composants parents dâ€™un changement {/<em>notifying-parent-components-about-state-changes</em>/}</h3><p>Imaginons que vous Ã©criviez un composant <code>Toggle</code> avec un Ã©tat interne <code>isOn</code> qui peut Ãªtre <code>true</code> ou <code>false</code>. Il y a plusieurs faÃ§ons de le faire basculer (en cliquant dessus ou en le faisant glisser). Vous souhaitez notifier le composant parent chaque fois que lâ€™Ã©tat interne du <code>Toggle</code> change, du coup vous exposez un Ã©vÃ©nement <code>onChange</code> que vous appelez depuis un EffetÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Toggle</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onChange <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isOn<span class="token punctuation">,</span> setIsOn<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ğŸ”´ Ã€ Ã©viterÂ : le gestionnaire onChange est appelÃ© trop tard</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">onChange</span><span class="token punctuation">(</span>isOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>isOn<span class="token punctuation">,</span> onChange<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setIsOn</span><span class="token punctuation">(</span><span class="token operator">!</span>isOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleDragEnd</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">isCloserToRightEdge</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setIsOn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token function">setIsOn</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Comme prÃ©cÃ©demment, ce nâ€™est pas idÃ©al. Le <code>Toggle</code> met dâ€™abord Ã  jour son Ã©tat, puis React rafraÃ®chit lâ€™affichage. Ensuite seulement React exÃ©cute lâ€™Effet, qui appelle la fonction <code>onChange</code> passÃ©e par le composant parent. Câ€™est au tour de celui-ci de mettre Ã  jour son propre Ã©tat, ce qui dÃ©clenche une nouvelle passe de rendu. Il serait prÃ©fÃ©rable que tout soit fait en une seule passe.<p>Retirez lâ€™Effet et mettez plutÃ´t Ã  jour lâ€™Ã©tat des <em>deux</em> composants au sein du mÃªme gestionnaire dâ€™Ã©vÃ©nementÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Toggle</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onChange <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isOn<span class="token punctuation">,</span> setIsOn<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">updateToggle</span><span class="token punctuation">(</span><span class="token parameter">nextIsOn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// âœ… CorrectÂ : on rÃ©alise toutes les mises Ã  jour en traitant lâ€™Ã©vÃ©nement dÃ©clencheur</span>
    <span class="token function">setIsOn</span><span class="token punctuation">(</span>nextIsOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onChange</span><span class="token punctuation">(</span>nextIsOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">updateToggle</span><span class="token punctuation">(</span><span class="token operator">!</span>isOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleDragEnd</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">isCloserToRightEdge</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">updateToggle</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token function">updateToggle</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Avec cette approche, tant le composant <code>Toggle</code> que son parent mettent Ã  jour leurs Ã©tats lors de la gestion de lâ€™Ã©vÃ©nement. React <a href="/learn/queueing-a-series-of-state-updates">regroupe les mises Ã  jour</a> issues de diffÃ©rents composants, de sorte quâ€™on ne fait quâ€™une passe de rendu.<p>Peut-Ãªtre mÃªme pouvez-vous carrÃ©ment retirer lâ€™Ã©tat, et recevoir <code>isOn</code> depuis votre composant parentÂ :<pre class="language-js"><code class="language-js"><span class="token comment">// âœ… Valable aussiÂ : le composant est entiÃ¨rement contrÃ´lÃ© par son parent</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Toggle</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> isOn<span class="token punctuation">,</span> onChange <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token operator">!</span>isOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleDragEnd</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">isCloserToRightEdge</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p><a href="/learn/sharing-state-between-components">Â«Â Faire remonter lâ€™Ã©tatÂ Â»</a> permet au composant parent de pleinement contrÃ´ler le <code>Toggle</code> au moyen de lâ€™Ã©tat propre au parent. Certes, le composant parent devra contenir davantage de logique, mais vous aurez aussi moins de variables dâ€™Ã©tat Ã  gÃ©rer au final. Chaque fois que vous vous retrouvez Ã  tenter de synchroniser plusieurs variables dâ€™Ã©tat, voyez si vous ne pouvez pas plutÃ´t faire remonter lâ€™Ã©tatÂ !</section><section class="level3"aria-labelledby="passer-des-donnÃ©es-au-parent-passing-data-to-the-parent"><h3 id="passer-des-donnÃ©es-au-parent-passing-data-to-the-parent">Passer des donnÃ©es au parent {/<em>passing-data-to-the-parent</em>/}</h3><p>Le composant <code>Child</code> charge des donnÃ©es et les passe au composant <code>Parent</code> au sein dâ€™un EffetÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Parent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Child</span> onFetched<span class="token operator">=</span><span class="token punctuation">{</span>setData<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Child</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onFetched <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">useSomeAPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ğŸ”´ Ã€ Ã©viterÂ : passer des donnÃ©es au parent depuis un Effet</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onFetched</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>onFetched<span class="token punctuation">,</span> data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Dans React, les donnÃ©es circulent des composants parents vers leurs enfants. Quand vous remarquez une erreur Ã  lâ€™Ã©cran, vous pouvez pister lâ€™information jusquâ€™Ã  sa source en remontant la chaÃ®ne des composants jusquâ€™Ã  trouver celui qui a passÃ© la mauvaise valeur de prop ou qui contient une variable dâ€™Ã©tat erronÃ©e. Lorsque des composants enfants mettent Ã  jour lâ€™Ã©tat de leurs composants parents au sein dâ€™Effets, le flux de donnÃ©es devient trÃ¨s difficile Ã  suivre. Puisque lâ€™enfant comme le parent ont besoin des mÃªmes donnÃ©es, laissez plutÃ´t le parent charger celles-ci puis <em>passez-les</em> Ã  lâ€™enfantÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Parent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">useSomeAPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// âœ… CorrectÂ : passer les donnÃ©es Ã  lâ€™enfant</span>
  <span class="token keyword control-flow">return</span> <span class="token operator">&#x3C;</span><span class="token maybe-class-name">Child</span> data<span class="token operator">=</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Child</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Câ€™est plus simple et Ã§a rend le flux de donnÃ©es plus prÃ©visibleÂ : les donnÃ©es descendent du parent vers lâ€™enfant.</section><section class="level3"aria-labelledby="sabonner-Ã -une-source-de-donnÃ©es-extÃ©rieure-subscribing-to-an-external-store"><h3 id="sabonner-Ã -une-source-de-donnÃ©es-extÃ©rieure-subscribing-to-an-external-store">Sâ€™abonner Ã  une source de donnÃ©es extÃ©rieure {/<em>subscribing-to-an-external-store</em>/}</h3><p>Il arrive que vos composants aient besoin de sâ€™abonner Ã  une source de donnÃ©es extÃ©rieure, hors des Ã©tats React. Elles pourraient provenir dâ€™une bibliothÃ¨que tierce ou dâ€™une API du navigateur. Dans la mesure oÃ¹ ces donnÃ©es sont susceptibles dâ€™Ã©voluer sans que React le sache, vous devez manuellement y abonner vos composants. Câ€™est le plus souvent fait au sein dâ€™un Effet, comme dans cet exempleÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">useOnlineStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Pas idÃ©alÂ : abonnement manuel au sein dâ€™un Effet</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isOnline<span class="token punctuation">,</span> setIsOnline<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">updateState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setIsOnline</span><span class="token punctuation">(</span><span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">onLine</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">updateState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span> updateState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">,</span> updateState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span> updateState<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">,</span> updateState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> isOnline<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatIndicator</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isOnline <span class="token operator">=</span> <span class="token function">useOnlineStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Dans ce code, le composant sâ€™abonne Ã  une source de donnÃ©es extÃ©rieure (dans ce cas prÃ©cis, lâ€™API <code>navigator.onLine</code> du navigateur). Dans la mesure oÃ¹ cette API nâ€™existe pas cÃ´tÃ© serveur (et ne peut donc pas Ãªtre utilisÃ©e pour le HTML initial), lâ€™Ã©tat est initialisÃ© Ã  <code>true</code>. DÃ¨s que cette donnÃ©e change dans le navigateur, le composant met Ã  jour son Ã©tat.<p>Bien quâ€™il soit courant de recourir aux Effets dans ce type de cas, React a un Hook sur-mesure pour les abonnements Ã  des sources extÃ©rieures de donnÃ©es, que vous devriez alors employer. Retirez lâ€™Effet et remplacez-le par un appel Ã  <a href="/reference/react/useSyncExternalStore"><code>useSyncExternalStore</code></a>:<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useOnlineStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// âœ… CorrectÂ : abonnement Ã  une source de donnÃ©es tierce via un Hook prÃ©-fourni</span>
  <span class="token keyword control-flow">return</span> <span class="token function">useSyncExternalStore</span><span class="token punctuation">(</span>
    subscribe<span class="token punctuation">,</span> <span class="token comment">// React ne se rÃ©abonnera pas tant que cette fonction ne changera pas</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">onLine</span><span class="token punctuation">,</span> <span class="token comment">// Lecture de la valeur cÃ´tÃ© client</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token boolean">true</span> <span class="token comment">// Lecture de la valeur cÃ´tÃ© serveur</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ChatIndicator</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isOnline <span class="token operator">=</span> <span class="token function">useOnlineStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Cette approche pose moins de problÃ¨mes que la synchronisation manuelle dâ€™un Ã©tat React avec des donnÃ©es variables au sein dâ€™un Effet. Habituellement, vous Ã©crirez un Hook personnalisÃ© tel que le <code>useOnlineStatus()</code> ci-avant afin de ne pas avoir Ã  rÃ©pÃ©ter ce code dâ€™un composant Ã  lâ€™autre. <a href="/reference/react/useSyncExternalStore">En savoir plus sur lâ€™abonnement Ã  des sources de donnÃ©es extÃ©rieures depuis des composants React</a>.</section><section class="level3"aria-labelledby="charger-des-donnÃ©es-fetching-data"><h3 id="charger-des-donnÃ©es-fetching-data">Charger des donnÃ©es {/<em>fetching-data</em>/}</h3><p>De nombreuses applis utilisent des Effets pour lancer un chargement de donnÃ©es. Ce type de scÃ©nario ressemble Ã  Ã§aÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SearchResults</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> query <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>results<span class="token punctuation">,</span> setResults<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>page<span class="token punctuation">,</span> setPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// ğŸ”´ Ã€ Ã©viterÂ : chargement sans code de nettoyage</span>
    <span class="token function">fetchResults</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">setResults</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> page<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleNextPageClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setPage</span><span class="token punctuation">(</span>page <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Vous nâ€™avez <em>pas besoin</em> de dÃ©placer ce chargement dans un gestionnaire dâ€™Ã©vÃ©nement.<p>Ã‡a peut sembler contradictoire avec les exemples vus jusquâ€™ici, qui nous enjoignaient de dÃ©placer la logique dans des gestionnaires dâ€™Ã©vÃ©nementsÂ ! Ceci dit, gardez Ã  lâ€™esprit que <em>lâ€™Ã©vÃ©nement de saisie clavier</em> nâ€™est pas ici la cause principale du chargement. Les champs de recherche sont souvent prÃ©-remplis Ã  partir de lâ€™URL, et lâ€™utilisateur pourrait trÃ¨s bien naviguer dâ€™avant en arriÃ¨re sans toucher au champ.<p>Peu importe dâ€™oÃ¹ viennent <code>page</code> et <code>query</code>. Lorsque ce composant est affichÃ©, vous voulez garantir que <code>results</code> reste <a href="/learn/synchronizing-with-effects">synchronisÃ©</a> avec les donnÃ©es fournies par le rÃ©seau pour les <code>page</code> et <code>query</code> actuelles. VoilÃ  pourquoi câ€™est un Effet.<p>NÃ©anmoins, le code ci-avant a un bug. Supposons que vous tapiez <code>"hello"</code> rapidement. Ã‡a modifierait successivement <code>query</code> de <code>"h"</code> Ã  <code>"he"</code>, <code>"hel"</code>, <code>"hell"</code>, et enfin <code>"hello"</code>. Ã‡a dÃ©clencherait Ã  chaque fois un chargement dÃ©diÃ©, mais on nâ€™a aucune garantie que les rÃ©ponses rÃ©seau arriveront dans le bon ordre. Par exemple, la rÃ©ponse pour <code>"hell"</code> pourrait arriver <em>aprÃ¨s</em> la rÃ©ponse pour <code>"hello"</code>. Comme elle appellera <code>setResults()</code> en dernier, on affichera les mauvais rÃ©sultats de rechercheâ€¦ un bug dâ€™enfer. Ce scÃ©nario sâ€™appelle une <em><a href="https://fr.wikipedia.org/wiki/Situation_de_comp%C3%A9tition">â€œrace conditionâ€</a></em>Â : deux requÃªtes distinctes ont Â«Â fait la courseÂ Â» lâ€™une contre lâ€™autre et sont arrivÃ©es dans un ordre diffÃ©rent de celui attendu.<p><strong>Pour corriger cette <em>race condition</em>, <a href="/learn/synchronizing-with-effects#fetching-data">ajoutez une fonction de nettoyage</a> pour ignorer les rÃ©ponses pÃ©rimÃ©esÂ :</strong><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SearchResults</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> query <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>results<span class="token punctuation">,</span> setResults<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>page<span class="token punctuation">,</span> setPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ignore <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">fetchResults</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setResults</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      ignore <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> page<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleNextPageClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setPage</span><span class="token punctuation">(</span>page <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Ã‡a garantit que lorsque votre Effet charge des donnÃ©es, toutes les rÃ©ponses hormis la derniÃ¨re sont ignorÃ©es.<p>La gestion des <em>race conditions</em> nâ€™est dâ€™ailleurs pas la seule difficultÃ© lorsquâ€™on implÃ©mente un chargement de donnÃ©es. Vous aurez peut-Ãªtre Ã  vous prÃ©occuper de la mise en cache des donnÃ©es (afin quâ€™en naviguant en arriÃ¨re vos utilisateurs retrouvent instantanÃ©ment lâ€™Ã©cran prÃ©cÃ©dent), de leur chargement cÃ´tÃ© serveur (pour que le HTML initial fourni par le serveur contienne dÃ©jÃ  les donnÃ©es plutÃ´t quâ€™un indicateur de chargement), et dâ€™Ã©viter les cascades rÃ©seau (afin quâ€™un composant enfant puisse charger ses donnÃ©es sans devoir attendre que chaque parent ait fini ses chargements).<p><strong>Ces problÃ©matiques existent dans toutes les bibliothÃ¨ques dâ€™UI, pas seulement dans React. Leur rÃ©solution nâ€™est pas chose aisÃ©e, câ€™est pourquoi les <a href="/learn/start-a-new-react-project#production-grade-react-frameworks">frameworks</a> modernes fournissent des mÃ©canismes intÃ©grÃ©s de chargement de donnÃ©es plus efficaces que du chargement manuel au sein dâ€™Effets.</strong><p>Si vous nâ€™utilisez pas de framework (et ne voulez pas crÃ©er le vÃ´tre) mais aimeriez quand mÃªme amÃ©liorer lâ€™ergonomie du chargement de donnÃ©es depuis des Effets, envisagez dâ€™extraire votre logique de chargement dans un Hook personnalisÃ©, comme dans lâ€™exemple que voiciÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">SearchResults</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> query <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>page<span class="token punctuation">,</span> setPage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query<span class="token punctuation">,</span> page <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token function">useData</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/search?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleNextPageClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setPage</span><span class="token punctuation">(</span>page <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useData</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ignore <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token arrow operator">=></span> response<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setData</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      ignore <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Vous voudrez sans doute y ajouter de la logique de gestion dâ€™erreur et de suivi de progression du chargement. Vous pouvez construire un Hook de ce type vous-mÃªme, ou utiliser une des nombreuses solutions dÃ©jÃ  disponibles dans lâ€™Ã©cosystÃ¨me React. <strong>MÃªme si cette approche ne sera pas aussi efficace que le recours aux mÃ©canismes de chargement intÃ©grÃ©s dâ€™un framework, dÃ©placer la logique de chargement dans un Hook personnalisÃ© facilitera lâ€™adoption ultÃ©rieure dâ€™une stratÃ©gie de chargement performante.</strong><p>De faÃ§on gÃ©nÃ©rale, dÃ¨s que vous devez recourir Ã  des Effets, gardez un Å“il sur les opportunitÃ©s dâ€™extraction de bouts de fonctionnalitÃ©s vers des Hooks personnalisÃ©s, afin de proposer une API plus dÃ©clarative et orientÃ©e mÃ©tier telle que le <code>useData</code> ci-avant. Moins vos composants auront dâ€™appels <code>useEffect</code> directs, plus il sera facile de maintenir votre application.</p><recap><ul><li>Si vous pouvez calculer quelque chose au sein du rendu, vous nâ€™avez pas besoin dâ€™un Effet.<li>Pour mettre en cache des calculs coÃ»teux, utilisez <code>useMemo</code> plutÃ´t que <code>useEffect</code>.<li>Pour rÃ©initialiser lâ€™intÃ©gralitÃ© de lâ€™Ã©tat dâ€™un arbre de composants, passez-lui une <code>key</code> diffÃ©rente.<li>Pour rÃ©initialiser juste une partie de lâ€™Ã©tat suite Ã  un changement de prop, modifiez-la au sein du rendu.<li>Si du code doit Ãªtre dÃ©clenchÃ© simplement en raison du <em>rendu</em>, il peut Ãªtre dans un EffetÂ ; le reste devrait Ãªtre liÃ© Ã  des Ã©vÃ©nements.<li>Si vous devez mettre Ã  jour lâ€™Ã©tat de plusieurs composants, regroupez ces modifications dans un seul gestionnaire dâ€™Ã©vÃ©nement.<li>Chaque fois que vous vous retrouvez Ã  devoir synchroniser lâ€™Ã©tat de plusieurs composants, essayez plutÃ´t de faire remonter lâ€™Ã©tat.<li>Vous pouvez charger des donnÃ©es dans les Effets, mais vous devrez implÃ©menter une fonction de nettoyage pour Ã©viter les <em>race conditions</em>.</ul></recap><challenges><section class="level4"aria-labelledby="transformer-les-donnÃ©es-sans-effet-transform-data-without-effects"><h4 id="transformer-les-donnÃ©es-sans-effet-transform-data-without-effects">Transformer les donnÃ©es sans Effet {/<em>transform-data-without-effects</em>/}</h4><p>La <code>TodoList</code> ci-aprÃ¨s affiche une liste de tÃ¢ches. Lorsque la case Ã  cocher Â«Â Seulement les tÃ¢ches Ã  faireÂ Â» est cochÃ©e, les tÃ¢ches terminÃ©es ne figurent pas dans la liste. IndÃ©pendamment des tÃ¢ches affichÃ©es, le pied de page affiche le nombre de tÃ¢ches qui restent Ã  effectuer.<p>Simplifiez ce composant en retirant les variables d'Ã©tat et Effets superflus.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTodos<span class="token punctuation">,</span> createTodo <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./todos.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> setTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialTodos<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showActive<span class="token punctuation">,</span> setShowActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>activeTodos<span class="token punctuation">,</span> setActiveTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visibleTodos<span class="token punctuation">,</span> setVisibleTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>footer<span class="token punctuation">,</span> setFooter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setActiveTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=></span> <span class="token operator">!</span>todo<span class="token punctuation">.</span><span class="token property-access">completed</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>todos<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setVisibleTodos</span><span class="token punctuation">(</span>showActive <span class="token operator">?</span> activeTodos <span class="token operator">:</span> todos<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>showActive<span class="token punctuation">,</span> todos<span class="token punctuation">,</span> activeTodos<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setFooter</span><span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>footer<span class="token operator">></span>
        <span class="token punctuation">{</span>activeTodos<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">}</span> tÃ¢ches Ã  faire
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>footer<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>activeTodos<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>showActive<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setShowActive</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">Seulement</span> les tÃ¢ches Ã  faire
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">NewTodo</span> onAdd<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">newTodo</span> <span class="token arrow operator">=></span> <span class="token function">setTodos</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token spread operator">...</span>todos<span class="token punctuation">,</span> newTodo<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>visibleTodos<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">completed</span> <span class="token operator">?</span> <span class="token operator">&#x3C;</span>s<span class="token operator">></span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>s<span class="token operator">></span> <span class="token operator">:</span> todo<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
      <span class="token punctuation">{</span>footer<span class="token punctuation">}</span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">NewTodo</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onAdd <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onAdd</span><span class="token punctuation">(</span><span class="token function">createTodo</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleAddClick<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Ajouter</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> completed <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    text<span class="token punctuation">,</span>
    completed
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> initialTodos <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des pommes'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des oranges'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des carottes'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><hint><p>Si vous pouvez calculer quelque chose au sein du rendu, vous nâ€™avez besoin ni dâ€™un Ã©tat ni dâ€™un Effet pour le tenir Ã  jour.</p></hint><solution><p>Cet exemple ne comprend que deux Ã©lÃ©ments dâ€™Ã©tat essentielsÂ : la liste des tÃ¢ches <code>todos</code> et la variable dâ€™Ã©tat <code>showActive</code> qui reprÃ©sente lâ€™Ã©tat de la case Ã  cocher. Toutes les autres variables dâ€™Ã©tat sont <a href="/learn/choosing-the-state-structure#avoid-redundant-state">redondantes</a> et devraient plutÃ´t Ãªtre calculÃ©es lors du rendu, y compris le <code>footer</code> qui peut Ãªtre directement mis au sein du JSX principal.<p>Votre rÃ©sultat devrait ressembler Ã  ceciÂ :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTodos<span class="token punctuation">,</span> createTodo <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./todos.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> setTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialTodos<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showActive<span class="token punctuation">,</span> setShowActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> activeTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=></span> <span class="token operator">!</span>todo<span class="token punctuation">.</span><span class="token property-access">completed</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> showActive <span class="token operator">?</span> activeTodos <span class="token operator">:</span> todos<span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>showActive<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setShowActive</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">Seulement</span> les tÃ¢ches Ã  faire
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">NewTodo</span> onAdd<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">newTodo</span> <span class="token arrow operator">=></span> <span class="token function">setTodos</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token spread operator">...</span>todos<span class="token punctuation">,</span> newTodo<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>visibleTodos<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">completed</span> <span class="token operator">?</span> <span class="token operator">&#x3C;</span>s<span class="token operator">></span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>s<span class="token operator">></span> <span class="token operator">:</span> todo<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>footer<span class="token operator">></span>
        <span class="token punctuation">{</span>activeTodos<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">}</span> tÃ¢ches Ã  faire
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>footer<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">NewTodo</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onAdd <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onAdd</span><span class="token punctuation">(</span><span class="token function">createTodo</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleAddClick<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Ajouter</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> completed <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    text<span class="token punctuation">,</span>
    completed
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> initialTodos <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des pommes'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des oranges'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des carottes'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack></solution></section><section class="level4"aria-labelledby="mettre-en-cache-un-calcul-sans-effets-cache-a-calculation-without-effects"><h4 id="mettre-en-cache-un-calcul-sans-effets-cache-a-calculation-without-effects">Mettre en cache un calcul sans Effets {/<em>cache-a-calculation-without-effects</em>/}</h4><p>Dans cet exemple, on a extrait le filtrage des tÃ¢ches dans une fonction dÃ©diÃ©e appelÃ©e <code>getVisibleTodos()</code>. Cette fonction contient un appel Ã  <code>console.log()</code> qui nous permet de savoir quâ€™elle est appelÃ©e. Basculez le rÃ©glage Â«Â Seulement les tÃ¢ches Ã  faireÂ Â» et remarquez que la fonction <code>getVisibleTodos()</code> est appelÃ©e Ã  nouveau. Câ€™est normal, puisque les tÃ¢ches visibles changent selon le rÃ©glage choisi.<p>Votre objectif est de retirer lâ€™Effet qui recalcule la liste <code>visibleTodos</code> dans le composant <code>TodoList</code>. Cependant, vous devrez vous assurer que <code>getVisibleTodos()</code> nâ€™est <em>pas</em> appelÃ©e Ã  nouveau (et donc nâ€™affiche rien dans la console) lorsque vous saisissez un intitulÃ© de tÃ¢che.</p><hint><p>Une solution serait dâ€™ajouter un <code>useMemo</code> pour mettre en cache les tÃ¢ches visibles. Il existe toutefois une autre solution, moins Ã©vidente.</p></hint><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTodos<span class="token punctuation">,</span> createTodo<span class="token punctuation">,</span> getVisibleTodos <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./todos.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> setTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialTodos<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showActive<span class="token punctuation">,</span> setShowActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visibleTodos<span class="token punctuation">,</span> setVisibleTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setVisibleTodos</span><span class="token punctuation">(</span><span class="token function">getVisibleTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> showActive<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> showActive<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTodos</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token spread operator">...</span>todos<span class="token punctuation">,</span> <span class="token function">createTodo</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>showActive<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setShowActive</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">Seulement</span> les tÃ¢ches Ã  faire
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleAddClick<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Ajouter</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>visibleTodos<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">completed</span> <span class="token operator">?</span> <span class="token operator">&#x3C;</span>s<span class="token operator">></span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>s<span class="token operator">></span> <span class="token operator">:</span> todo<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> calls <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getVisibleTodos</span><span class="token punctuation">(</span><span class="token parameter">todos<span class="token punctuation">,</span> showActive</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">getVisibleTodos() a Ã©tÃ© appelÃ©e </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">++</span>calls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> fois</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> activeTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=></span> <span class="token operator">!</span>todo<span class="token punctuation">.</span><span class="token property-access">completed</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> showActive <span class="token operator">?</span> activeTodos <span class="token operator">:</span> todos<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> visibleTodos<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> completed <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    text<span class="token punctuation">,</span>
    completed
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> initialTodos <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des pommes'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des oranges'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des carottes'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>Retirez la variable dâ€™Ã©tat ainsi que lâ€™Effet, et ajoutez plutÃ´t un appel Ã  <code>useMemo</code> pour mettre en cache le rÃ©sultat de lâ€™appel Ã  la fonction <code>getVisibleTodos()</code>Â :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useMemo <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTodos<span class="token punctuation">,</span> createTodo<span class="token punctuation">,</span> getVisibleTodos <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./todos.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> setTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialTodos<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showActive<span class="token punctuation">,</span> setShowActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">getVisibleTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> showActive<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> showActive<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTodos</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token spread operator">...</span>todos<span class="token punctuation">,</span> <span class="token function">createTodo</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>showActive<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setShowActive</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">Seulement</span> les tÃ¢ches Ã  faire
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleAddClick<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Ajouter</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>visibleTodos<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">completed</span> <span class="token operator">?</span> <span class="token operator">&#x3C;</span>s<span class="token operator">></span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>s<span class="token operator">></span> <span class="token operator">:</span> todo<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> calls <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getVisibleTodos</span><span class="token punctuation">(</span><span class="token parameter">todos<span class="token punctuation">,</span> showActive</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">getVisibleTodos() a Ã©tÃ© appelÃ©e </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">++</span>calls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> fois</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> activeTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=></span> <span class="token operator">!</span>todo<span class="token punctuation">.</span><span class="token property-access">completed</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> showActive <span class="token operator">?</span> activeTodos <span class="token operator">:</span> todos<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> visibleTodos<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> completed <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    text<span class="token punctuation">,</span>
    completed
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> initialTodos <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des pommes'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des oranges'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des carottes'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>GrÃ¢ce Ã  cette modification, <code>getVisibleTodos()</code> ne sera appelÃ©e que lorsque <code>todos</code> ou <code>showActive</code> change. La saisie dans le champ ne modifie que la variable dâ€™Ã©tat <code>text</code>, et donc ne dÃ©clenche pas dâ€™appel Ã  <code>getVisibleTodos()</code>.<p>Il existe une autre solution qui nâ€™a pas besoin de <code>useMemo</code>. Dans la mesure oÃ¹ la variable dâ€™Ã©tat <code>text</code> ne peut en aucun cas affecter la liste des tÃ¢ches, vous pouvez extraire le formulaire dans un composant <code>NewTodo</code> distinct, en y dÃ©plaÃ§ant cette variable dâ€™Ã©tatÂ :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useMemo <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> initialTodos<span class="token punctuation">,</span> createTodo<span class="token punctuation">,</span> getVisibleTodos <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./todos.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TodoList</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> setTodos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialTodos<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showActive<span class="token punctuation">,</span> setShowActive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> <span class="token function">getVisibleTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> showActive<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"checkbox"</span>
          checked<span class="token operator">=</span><span class="token punctuation">{</span>showActive<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setShowActive</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token maybe-class-name">Seulement</span> les tÃ¢ches Ã  faire
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">NewTodo</span> onAdd<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">newTodo</span> <span class="token arrow operator">=></span> <span class="token function">setTodos</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token spread operator">...</span>todos<span class="token punctuation">,</span> newTodo<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>visibleTodos<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">completed</span> <span class="token operator">?</span> <span class="token operator">&#x3C;</span>s<span class="token operator">></span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>s<span class="token operator">></span> <span class="token operator">:</span> todo<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">NewTodo</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onAdd <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAddClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onAdd</span><span class="token punctuation">(</span><span class="token function">createTodo</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleAddClick<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Ajouter</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> nextId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> calls <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getVisibleTodos</span><span class="token punctuation">(</span><span class="token parameter">todos<span class="token punctuation">,</span> showActive</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">getVisibleTodos() a Ã©tÃ© appelÃ©e </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">++</span>calls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> fois</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> activeTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token arrow operator">=></span> <span class="token operator">!</span>todo<span class="token punctuation">.</span><span class="token property-access">completed</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> showActive <span class="token operator">?</span> activeTodos <span class="token operator">:</span> todos<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> visibleTodos<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> completed <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    text<span class="token punctuation">,</span>
    completed
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">export</span> <span class="token keyword">const</span> initialTodos <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des pommes'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des oranges'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token string">'Acheter des carottes'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">input</span> <span class="token punctuation">{</span> <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Cette approche satisfait elle aussi nos critÃ¨res. Lorsque vous saisissez une valeur dans le champ, seule la variable dâ€™Ã©tat <code>text</code> est mise Ã  jour. Puisquâ€™elle rÃ©side dans la composant enfant <code>NewTodo</code>, elle nâ€™entraÃ®ne pas un nouveau rendu du composant parent <code>TodoList</code>. Câ€™est pour Ã§a que <code>getVisibleTodos()</code> nâ€™est pas rappelÃ©e lors de la saisie. (Elle le serait tout de mÃªme si <code>TodoList</code> refaisait un rendu pour une autre raison.)</p></solution></section><section class="level4"aria-labelledby="rÃ©initialiser-lÃ©tat-sans-effet-reset-state-without-effects"><h4 id="rÃ©initialiser-lÃ©tat-sans-effet-reset-state-without-effects">RÃ©initialiser lâ€™Ã©tat sans Effet {/<em>reset-state-without-effects</em>/}</h4><p>Ce composant <code>EditContact</code> reÃ§oit un objet contact de forme <code>{ id, name, email }</code> <em>via</em> sa prop <code>savedContact</code>. Essayez de modifier les champs de nom et dâ€™e-mail. Lorsque vous appuyez sur Enregistrer, le bouton du contact situÃ© au-dessus est mis Ã  jour avec le nouveau nom. Lorsque vous appuyez sur RÃ©initialiser, toute modification en cours dans le formulaire est abandonnÃ©e. Prenez un moment pour manipuler cette interface afin dâ€™en saisir le fonctionnement.<p>Lorsque vous sÃ©lectionnez un contact au moyen des boutons du haut, le formulaire est rÃ©initialisÃ© pour reflÃ©ter les dÃ©tails de ce contact. Câ€™est implÃ©mentÃ© au moyen dâ€™un Effet dans <code>EditContact.js</code>. Retirez cet Effet, et trouvez une autre faÃ§on de rÃ©initaliser lâ€™Ã©tat du formulaire lorsque <code>savedContact.id</code> change.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ContactList</span></span> <span class="token keyword module">from</span> <span class="token string">'./ContactList.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">EditContact</span></span> <span class="token keyword module">from</span> <span class="token string">'./EditContact.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ContactManager</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>
    contacts<span class="token punctuation">,</span>
    setContacts
  <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialContacts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>
    selectedId<span class="token punctuation">,</span>
    setSelectedId
  <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> selectedContact <span class="token operator">=</span> contacts<span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span>
    c<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> selectedId
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleSave</span><span class="token punctuation">(</span><span class="token parameter">updatedData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> nextContacts <span class="token operator">=</span> contacts<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> updatedData<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> updatedData<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> c<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setContacts</span><span class="token punctuation">(</span>nextContacts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ContactList</span>
        contacts<span class="token operator">=</span><span class="token punctuation">{</span>contacts<span class="token punctuation">}</span>
        selectedId<span class="token operator">=</span><span class="token punctuation">{</span>selectedId<span class="token punctuation">}</span>
        onSelect<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">id</span> <span class="token arrow operator">=></span> <span class="token function">setSelectedId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">EditContact</span>
        savedContact<span class="token operator">=</span><span class="token punctuation">{</span>selectedContact<span class="token punctuation">}</span>
        onSave<span class="token operator">=</span><span class="token punctuation">{</span>handleSave<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> initialContacts <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ContactList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  contacts<span class="token punctuation">,</span>
  selectedId<span class="token punctuation">,</span>
  onSelect
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>section<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>contacts<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">contact</span> <span class="token arrow operator">=></span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>contact<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
              <span class="token function">onSelect</span><span class="token punctuation">(</span>contact<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
              <span class="token punctuation">{</span>contact<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> selectedId <span class="token operator">?</span>
                <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>contact<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span> <span class="token operator">:</span>
                contact<span class="token punctuation">.</span><span class="token property-access">name</span>
              <span class="token punctuation">}</span>
            <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">EditContact</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> savedContact<span class="token punctuation">,</span> onSave <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>savedContact<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>email<span class="token punctuation">,</span> setEmail<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>savedContact<span class="token punctuation">.</span><span class="token property-access">email</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setName</span><span class="token punctuation">(</span>savedContact<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setEmail</span><span class="token punctuation">(</span>savedContact<span class="token punctuation">.</span><span class="token property-access">email</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>savedContact<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>section<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token literal-property property">Nom</span>Â <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"text"</span>
          value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token constant">E</span><span class="token operator">-</span>mailÂ <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"email"</span>
          value<span class="token operator">=</span><span class="token punctuation">{</span>email<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setEmail</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> updatedData <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
          <span class="token literal-property property">email</span><span class="token operator">:</span> email
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">onSave</span><span class="token punctuation">(</span>updatedData<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Enregistrer</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setName</span><span class="token punctuation">(</span>savedContact<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setEmail</span><span class="token punctuation">(</span>savedContact<span class="token punctuation">.</span><span class="token property-access">email</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token constant">R</span>Ã©initialiser
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">ul<span class="token punctuation">,</span> li</span> <span class="token punctuation">{</span>
  <span class="token property">list-style</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li button</span> <span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack><hint><p>Ce serait chouette sâ€™il y avait un moyen de dire Ã  React que lorsque <code>savedContact.id</code> est diffÃ©rent, le formulaire <code>EditContact</code> est conceptuellement un <em>formulaire de contact diffÃ©rent</em> et ne devrait donc pas prÃ©server son Ã©tat. Vous souvenez-vous dâ€™un tel moyenÂ ?</p></hint><solution><p>DÃ©coupez le composant <code>EditContact</code> en deux. DÃ©placez tout lâ€™Ã©tat du formulaire dans le composant interne <code>EditForm</code>. Exportez le composant principal <code>EditContact</code> et faites-lui passer <code>savedContact.id</code> comme <code>key</code> au composant interne <code>EditForm</code>. GrÃ¢ce Ã  Ã§a, le composant interne <code>EditForm</code> rÃ©initialisera tout son Ã©tat de formulaire et recrÃ©era le DOM chaque fois que vous choisissez un contact diffÃ©rent.</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ContactList</span></span> <span class="token keyword module">from</span> <span class="token string">'./ContactList.js'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">EditContact</span></span> <span class="token keyword module">from</span> <span class="token string">'./EditContact.js'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ContactManager</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>
    contacts<span class="token punctuation">,</span>
    setContacts
  <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialContacts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>
    selectedId<span class="token punctuation">,</span>
    setSelectedId
  <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> selectedContact <span class="token operator">=</span> contacts<span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span>
    c<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> selectedId
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleSave</span><span class="token punctuation">(</span><span class="token parameter">updatedData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> nextContacts <span class="token operator">=</span> contacts<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> updatedData<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> updatedData<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> c<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setContacts</span><span class="token punctuation">(</span>nextContacts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">ContactList</span>
        contacts<span class="token operator">=</span><span class="token punctuation">{</span>contacts<span class="token punctuation">}</span>
        selectedId<span class="token operator">=</span><span class="token punctuation">{</span>selectedId<span class="token punctuation">}</span>
        onSelect<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">id</span> <span class="token arrow operator">=></span> <span class="token function">setSelectedId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>hr <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">EditContact</span>
        savedContact<span class="token operator">=</span><span class="token punctuation">{</span>selectedContact<span class="token punctuation">}</span>
        onSave<span class="token operator">=</span><span class="token punctuation">{</span>handleSave<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> initialContacts <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">ContactList</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  contacts<span class="token punctuation">,</span>
  selectedId<span class="token punctuation">,</span>
  onSelect
<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>section<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span>contacts<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">contact</span> <span class="token arrow operator">=></span>
          <span class="token operator">&#x3C;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>contact<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
              <span class="token function">onSelect</span><span class="token punctuation">(</span>contact<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
              <span class="token punctuation">{</span>contact<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> selectedId <span class="token operator">?</span>
                <span class="token operator">&#x3C;</span>b<span class="token operator">></span><span class="token punctuation">{</span>contact<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>b<span class="token operator">></span> <span class="token operator">:</span>
                contact<span class="token punctuation">.</span><span class="token property-access">name</span>
              <span class="token punctuation">}</span>
            <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
          <span class="token operator">&#x3C;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">EditContact</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token maybe-class-name">EditForm</span>
      <span class="token punctuation">{</span><span class="token spread operator">...</span>props<span class="token punctuation">}</span>
      key<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span><span class="token property-access">savedContact</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">EditForm</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> savedContact<span class="token punctuation">,</span> onSave <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>savedContact<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>email<span class="token punctuation">,</span> setEmail<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>savedContact<span class="token punctuation">.</span><span class="token property-access">email</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>section<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token literal-property property">Nom</span>Â <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"text"</span>
          value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>label<span class="token operator">></span>
        <span class="token constant">E</span><span class="token operator">-</span>mailÂ <span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">}</span>
        <span class="token operator">&#x3C;</span>input
          type<span class="token operator">=</span><span class="token string">"email"</span>
          value<span class="token operator">=</span><span class="token punctuation">{</span>email<span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setEmail</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>label<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> updatedData <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
          <span class="token literal-property property">email</span><span class="token operator">:</span> email
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">onSave</span><span class="token punctuation">(</span>updatedData<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Enregistrer</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">setName</span><span class="token punctuation">(</span>savedContact<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setEmail</span><span class="token punctuation">(</span>savedContact<span class="token punctuation">.</span><span class="token property-access">email</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token constant">R</span>Ã©initialiser
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">ul<span class="token punctuation">,</span> li</span> <span class="token punctuation">{</span>
  <span class="token property">list-style</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">li</span> <span class="token punctuation">{</span> <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token selector">li button</span> <span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">label</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">button</span> <span class="token punctuation">{</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></sandpack></solution></section><section class="level4"aria-labelledby="envoyer-un-formulaire-sans-effet-submit-a-form-without-effects"><h4 id="envoyer-un-formulaire-sans-effet-submit-a-form-without-effects">Envoyer un formulaire sans Effet {/<em>submit-a-form-without-effects</em>/}</h4><p>Ce composant <code>Form</code> vous permet dâ€™envoyer un message Ã  un ami. Lorsque vous validez le formulaire, la variable dâ€™Ã©tat <code>showForm</code> est mise Ã  <code>false</code>, ce qui dÃ©clenche un Effet qui appelle <code>sendMessage(message)</code>, envoyant le message (vous pouvez le voir en console). Une fois le message envoyÃ©, vous voyez un message Â«Â MerciÂ Â» avec un bouton Â«Â Ouvrir la discussionÂ Â» qui vous permet de revenir au formulaire.<p>Les utilisateurs de votre appli envoient beaucoup trop de messages. Pour rendre la discussion un peu plus difficile, vous avez dÃ©cidÃ© dâ€™afficher le message Â«Â MerciÂ Â» <em>en premier</em> plutÃ´t que le formulaire. Modifiez la variable dâ€™Ã©tat <code>showForm</code> pour lâ€™initialiser Ã  <code>false</code> plutÃ´t quâ€™Ã  <code>true</code>. DÃ¨s que vous ferez ce changement, la console affichera quâ€™un message vide a Ã©tÃ© envoyÃ©. Quelque chose dans la logique du code va de travers !<p>Quelle est la cause racine de ce problÃ¨meÂ ? Comment pouvez-vous le corrigerÂ ?</p><hint><p>Le message devrait-il Ãªtre envoyÃ© <em>parce que</em> lâ€™utilisateur a vu le message Â«Â MerciÂ Â ? Ou est-ce plutÃ´t lâ€™inverseÂ ?</p></hint><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showForm<span class="token punctuation">,</span> setShowForm<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>showForm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>showForm<span class="token punctuation">,</span> message<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setShowForm</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>showForm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Merci</span> pour votre confianceÂ <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setShowForm</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Ouvrir</span> la discussion
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>textarea
        placeholder<span class="token operator">=</span><span class="token string">"Message"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span> disabled<span class="token operator">=</span><span class="token punctuation">{</span>message <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Envoyer</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Envoi du messageÂ : '</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label<span class="token punctuation">,</span> textarea</span> <span class="token punctuation">{</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><solution><p>La variable dâ€™Ã©tat <code>showForm</code> dÃ©termine sâ€™il faut afficher le formulaire ou le message de remerciement. Seulement voilÃ , vous nâ€™envoyez pas le message simplement parce que le message <em>est affichÃ©</em>. Vous souhaitez envoyer le message parce que lâ€™utilisateur a <em>soumis le formulaire</em>. Retirez cet Effet trompeur et dÃ©placez lâ€™appel Ã  <code>sendMessage</code> dans le gestionnaire dâ€™Ã©vÃ©nement <code>handleSubmit</code>Â :</p><sandpack><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showForm<span class="token punctuation">,</span> setShowForm<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> setMessage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setShowForm</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>showForm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span><span class="token operator">></span>
        <span class="token operator">&#x3C;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Merci</span> pour votre confianceÂ <span class="token operator">!</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token operator">&#x3C;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
          <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setShowForm</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token maybe-class-name">Ouvrir</span> la discussion
        <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>textarea
        placeholder<span class="token operator">=</span><span class="token string">"Message"</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> <span class="token function">setMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span>button type<span class="token operator">=</span><span class="token string">"submit"</span> disabled<span class="token operator">=</span><span class="token punctuation">{</span>message <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token maybe-class-name">Envoyer</span>
      <span class="token operator">&#x3C;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Envoi du messageÂ : '</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><pre class="language-css"><code class="language-css"><span class="token selector">label<span class="token punctuation">,</span> textarea</span> <span class="token punctuation">{</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre></sandpack><p>Remarquez que dans cette version, seule <em>la soumission du formulaire</em> (qui est un Ã©vÃ©nement) cause lâ€™envoi du message. Ã‡a fonctionne peu importe la valeur initiale de <code>showForm</code>Â : <code>true</code> ou <code>false</code>. (Mettez-la Ã  <code>false</code> et remarquez lâ€™absence de message superflu en console.)</p></solution><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></challenges></section></section></section>