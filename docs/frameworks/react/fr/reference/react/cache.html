<!doctype html><html lang="fr"><meta charset="utf-8"><title>cache</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"type="text/css"href="../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="cache"><h1 id="cache">cache</h1><p>canary: true</p><canary><ul><li><p><code>cache</code> n'est destin√©e qu'aux <a href="/blog/2023/03/22/react-labs-what-we-have-been-working-on-march-2023#react-server-components">React Server Components</a>. D√©couvrez quels <a href="/learn/start-a-new-react-project#bleeding-edge-react-frameworks">frameworks</a> prennent en charge les Composants Serveur.<li><p><code>cache</code> n'est disponible que dans les canaux de livraison <a href="/community/versioning-policy#canary-channel">Canary</a> et <a href="/community/versioning-policy#experimental-channel">Exp√©rimental</a>. Assurez-vous d'en comprendre les limitations avant d'utiliser <code>cache</code> en production. Apprenez-en davantage sur les <a href="/community/versioning-policy#all-release-channels">canaux de livraison React</a>.</ul></canary><intro><p><code>cache</code> vous permet de mettre en cache le r√©sultat d'un chargement de donn√©es ou d'un calcul.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> cachedFn <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></intro><inlinetoc><section class="level2"aria-labelledby="r√©f√©rence-reference"><h2 id="r√©f√©rence-reference">R√©f√©rence {/<em>reference</em>/}</h2><section class="level3"aria-labelledby="cachefn-cache"><h3 id="cachefn-cache"><code>cache(fn)</code> {/<em>cache</em>/}</h3><p>Appelez <code>cache</code> hors de tout composant pour cr√©er une variante d'une fonction dot√©e de mise en cache.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">calculateMetrics</span> <span class="token keyword module">from</span> <span class="token string">'lib/metrics'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getMetrics <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateMetrics<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Chart</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>data<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getMetrics</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Lors du premier appel de <code>getMetrics</code> avec <code>data</code>, <code>getMetrics</code> appellera <code>calculateMetrics(data)</code> et mettra le r√©sultat en cache. Si <code>getMetrics</code> est rappel√©e avec le m√™me argument <code>data</code>, elle renverra le r√©sultat mis en cache plut√¥t que de rappeler <code>calculateMetrics(data)</code>.<p><a href="#usage">Voir d'autres exemples plus bas</a>.<section class="level4"aria-labelledby="param√®tres-parameters"><h4 id="param√®tres-parameters">Param√®tres {/<em>parameters</em>/}</h4><ul><li><code>fn</code>¬†: la fonction dont vous voulez mettre les r√©sultats en cache. <code>fn</code> peut prendre un nombre quelconque d'arguments et renvoyer n'importe quel type de r√©sultat.</ul></section><section class="level4"aria-labelledby="valeur-renvoy√©e-returns"><h4 id="valeur-renvoy√©e-returns">Valeur renvoy√©e {/<em>returns</em>/}</h4><p><code>cache</code> renvoie une version de <code>fn</code> dot√©e d'un cache, avec la m√™me signature de type. Elle n'appelle pas <code>fn</code> √† ce moment-l√†.<p>Lors d'un appel √† <code>cachedFn</code> avec des arguments donn√©s, elle v√©rifiera d'abord si un r√©sultat correspondant existe dans le cache. Si tel est le cas, elle renverra ce r√©sultat. Dans le cas contraire, elle appellera <code>fn</code> avec les arguments, mettra le r√©sultat en cache et le renverra. <code>fn</code> n'est appel√©e qu'en cas d'absence de correspondance dans le cache <em>(cache miss, NdT)</em>.</p><note><p>L'optimisation qui consiste √† mettre en cache les valeurs r√©sultats sur base des arguments pass√©s est g√©n√©ralement appel√©e <a href="https://fr.wikipedia.org/wiki/M%C3%A9mo%C3%AFsation"><em>m√©mo√Øsation</em></a>. La fonction renvoy√©e par <code>cache</code> est dite ¬´¬†fonction m√©mo√Øs√©e¬†¬ª.</p></note></section><section class="level4"aria-labelledby="limitations-caveats"><h4 id="limitations-caveats">Limitations {/<em>caveats</em>/}</h4><ul><li>React invalidera le cache de toutes les fonctions m√©mo√Øs√©es √† chaque requ√™te serveur.<li>Chaque appel √† <code>cache</code> cr√©e une nouvelle fonction. √áa signifie qu'appeler <code>cache</code> plusieurs fois avec la m√™me fonction renverra plusieurs fonctions m√©mo√Øs√©es distinctes, avec chacune leur propre cache.<li><code>cachedFn</code> mettra √©galement les erreurs en cache. Si <code>fn</code> l√®ve une exception pour certains arguments, ce sera mis en cache, et la m√™me erreur sera lev√©e lorsque <code>cachedFn</code> sera rappel√©e avec ces m√™mes arguments.<li><code>cache</code> est destin√©e uniquement aux <a href="/blog/2023/03/22/react-labs-what-we-have-been-working-on-march-2023#react-server-components">Composants Serveur</a>.</ul></section></section></section><section class="level2"aria-labelledby="utilisation-usage"><h2 id="utilisation-usage">Utilisation {/<em>usage</em>/}</h2><section class="level3"aria-labelledby="mettre-en-cache-un-calcul-co√ªteux-cache-expensive-computation"><h3 id="mettre-en-cache-un-calcul-co√ªteux-cache-expensive-computation">Mettre en cache un calcul co√ªteux {/<em>cache-expensive-computation</em>/}</h3><p>Utilisez <code>cache</code> pour √©viter de dupliquer un traitement.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">calculateUserMetrics</span> <span class="token keyword module">from</span> <span class="token string">'lib/user'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getUserMetrics <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateUserMetrics<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Profile</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>user<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> metrics <span class="token operator">=</span> <span class="token function">getUserMetrics</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">TeamReport</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>users<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> user <span class="token keyword">of</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> metrics <span class="token operator">=</span> <span class="token function">getUserMetrics</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Si le m√™me objet <code>user</code> est affich√© dans <code>Profile</code> et <code>TeamReport</code>, les deux composants peuvent mutualiser le travail et n'appeler <code>calculateUserMetrics</code> qu'une fois pour ce <code>user</code>.<p>Supposons que <code>Profile</code> fasse son rendu en premier. Il appellera<codestep step="{1}"><code>getUserMetrics</code></codestep>, qui v√©rifiera si un r√©sultat existe en cache. Comme il s'agit du premier appel de <code>getUserMetrics</code> pour ce <code>user</code>, elle ne trouvera aucune correspondance. <code>getUserMetrics</code> appellera alors effectivement <code>calculateUserMetrics</code> avec ce <code>user</code> puis mettra le r√©sultat en cache.<p>Lorsque <code>TeamReport</code> affichera sa liste de <code>users</code> et atteindra le m√™me objet <code>user</code>, il appellera<codestep step="{2}"><code>getUserMetrics</code></codestep>qui lira le r√©sultat depuis son cache.</p><pitfall><section class="level4"aria-labelledby="appeler-des-fonctions-m√©mo√Øs√©es-distinctes-lira-des-caches-distincts-pitfall-different-memoized-functions"><h4 id="appeler-des-fonctions-m√©mo√Øs√©es-distinctes-lira-des-caches-distincts-pitfall-different-memoized-functions">Appeler des fonctions m√©mo√Øs√©es distinctes lira des caches distincts {/<em>pitfall-different-memoized-functions</em>/}</h4><p>Pour partager un cache, des composants doivent appeler la m√™me fonction m√©mo√Øs√©e.<pre class="language-js"><code class="language-js"><span class="token comment">// Temperature.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>calculateWeekReport<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./report'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Temperature</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>cityData<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// üö© Erron√©¬†: Appeler `cache` au sein du composant</span>
  <span class="token comment">// cr√©e une nouvelle `getWeekReport` √† chaque rendu</span>
  <span class="token keyword">const</span> getWeekReport <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateWeekReport<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getWeekReport</span><span class="token punctuation">(</span>cityData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// Precipitation.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>calculateWeekReport<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./report'</span><span class="token punctuation">;</span>

<span class="token comment">// üö© Erron√©¬†: `getWeekReport` n‚Äôest accessible que depuis</span>
<span class="token comment">// le composant `Precipitation`.</span>
<span class="token keyword">const</span> getWeekReport <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateWeekReport<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Precipitation</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>cityData<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getWeekReport</span><span class="token punctuation">(</span>cityData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Dans l'exemple ci-dessus,<codestep step="{2}"><code>Precipitation</code></codestep>et<codestep step="{1}"><code>Temperature</code></codestep>appellent chacun <code>cache</code> pour cr√©er une nouvelle fonction m√©mo√Øs√©e, qui dispose √† chaque fois de son propre cache. Si les deux composants s'affichent avec les m√™mes <code>cityData</code>, ils dupliqueront tout de m√™me le travail en appelant √† chaque fois <code>calculateWeekReport</code>.<p>Qui plus est, <code>Temperature</code> cr√©e une<codestep step="{1}">nouvelle fonction m√©mo√Øs√©e</codestep>√† chaque rendu, ce qui ne permet aucun partage de cache.<p>Pour maximiser les correspondances trouv√©es et r√©duire la charge de calcul, les deux composants devraient s'assurer de partager la m√™me fonction m√©mo√Øs√©e, pour pouvoir acc√©der au m√™me cache. D√©finissez plut√¥t la fonction m√©mo√Øs√©e dans un module d√©di√© qui peut faire l'objet d'un <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Statements/import"><code>import</code></a> dans les divers composants.<pre class="language-js"><code class="language-js"><span class="token comment">// getWeekReport.js</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>calculateWeekReport<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./report'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token function">cache</span><span class="token punctuation">(</span>calculateWeekReport<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// Temperature.js</span>
<span class="token keyword module">import</span> <span class="token imports">getWeekReport</span> <span class="token keyword module">from</span> <span class="token string">'./getWeekReport'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Temperature</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>cityData<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getWeekReport</span><span class="token punctuation">(</span>cityData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// Precipitation.js</span>
<span class="token keyword module">import</span> <span class="token imports">getWeekReport</span> <span class="token keyword module">from</span> <span class="token string">'./getWeekReport'</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Precipitation</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>cityData<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">getWeekReport</span><span class="token punctuation">(</span>cityData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>D√©sormais les deux composants appellent la<codestep step="{3}">m√™me fonction m√©mo√Øs√©e</codestep>, export√©e depuis <code>./getWeekReport.js</code>, afin de lire et d'√©crire dans le m√™me cache.</section></pitfall></section><section class="level3"aria-labelledby="partager-un-instantan√©-de-donn√©es-take-and-share-snapshot-of-data"><h3 id="partager-un-instantan√©-de-donn√©es-take-and-share-snapshot-of-data">Partager un instantan√© de donn√©es {/<em>take-and-share-snapshot-of-data</em>/}</h3><p>Pour partager un instantan√© de donn√©es d'un composant √† l'autre, appelez <code>cache</code> sur une fonction de chargement de donn√©es telle que <code>fetch</code>. Lorsque plusieurs composants feront le m√™me chargement de donn√©es, seule une requ√™te sera faite, et ses donn√©es r√©sultantes mises en cache et partag√©es √† travers plusieurs composants. Tous les composants utiliseront le m√™me instantan√© de ces donn√©es au sein du rendu c√¥t√© serveur.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>fetchTemperature<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./api.js'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getTemperature <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">city</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token function">fetchTemperature</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AnimatedWeatherCard</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>city<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> temperature <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getTemperature</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MinimalWeatherCard</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>city<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> temperature <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getTemperature</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Si <code>AnimatedWeatherCard</code> et <code>MinimalWeatherCard</code> s'affichent tous deux avec la m√™me<codestep step="{1}">city</codestep>, ils recevront le m√™me instantan√© de donn√©es depuis la<codestep step="{2}">fonction m√©mo√Øs√©e</codestep>.<p>Si <code>AnimatedWeatherCard</code> et <code>MinimalWeatherCard</code> fournissent un argument<codestep step="{1}">city</codestep>diff√©rent √†<codestep step="{2}"><code>getTemperature</code></codestep>, alors <code>fetchTemperature</code> sera appel√©e deux fois, et chaque point d'appel recevra ses donn√©es sp√©cifiques.<p>La<codestep step="{1}">city</codestep>agit comme une cl√© de cache.</p><note><p><codestep step="{3}">Le rendu asynchrone</codestep>n'est possible que dans les Composants Serveur.<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">AnimatedWeatherCard</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>city<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> temperature <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getTemperature</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></note></section><section class="level3"aria-labelledby="pr√©charger-des-donn√©es-preload-data"><h3 id="pr√©charger-des-donn√©es-preload-data">Pr√©charger des donn√©es {/<em>preload-data</em>/}</h3><p>En mettant en cache un chargement de donn√©es qui prendrait du temps, vous pouvez d√©marrer des traitements asynchrones avant de faire le rendu d'un composant.<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> getUser <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Profile</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>section</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>img</span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span><span class="token property-access">profilePic</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>user<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>section</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Page</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ‚úÖ Malin¬†: commence √† charger les donn√©es utilisateur</span>
  <span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ... des calculs ici</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Profile</span></span> <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Lorsque <code>Page</code> fait son rendu, le composant appelle<codestep step="{1}"><code>getUser</code></codestep>, mais remarquez qu'il n'utilise pas les donn√©es renvoy√©es. Cet appel anticip√© √†<codestep step="{1}"><code>getUser</code></codestep>d√©clenche la requ√™te asynchrone √† la base de donn√©es, qui s'ex√©cute pendant que <code>Page</code> fait d'autres calculs puis d√©clenche le rendu de ses enfants.<p>Lorsque <code>Profile</code> fait son rendu, nous appelons √† nouveau<codestep step="{2}"><code>getUser</code></codestep>. Si l'appel initial √†<codestep step="{1}"><code>getUser</code></codestep>a fini son chargement et mis en cache les donn√©es utilisateur, lorsque <code>Profile</code><codestep step="{2}">demande ces donn√©es puis attend</codestep>, il n'a plus qu'√† les lire du cache, sans relancer un appel r√©seau. Si la<codestep step="{1}">requ√™te de donn√©es initiale</codestep>n'est pas encore termin√©e, cette approche de pr√©chargement r√©duit tout de m√™me le d√©lai d'obtention des donn√©es.</p><deepdive><section class="level4"aria-labelledby="mettre-en-cache-un-traitement-asynchrone-caching-asynchronous-work"><h4 id="mettre-en-cache-un-traitement-asynchrone-caching-asynchronous-work">Mettre en cache un traitement asynchrone {/<em>caching-asynchronous-work</em>/}</h4><p>Lorsque vous √©valuez une <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Statements/async_function">fonction asynchrone</a>, vous recevez une <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> repr√©sentant le traitement. La promesse maintient un √©tat pour le traitement (<em>en attente</em>, <em>accompli</em> ou <em>rejet√©</em>) ainsi que l'aboutissement du traitement √† terme.<p>Dans cet exemple, la fonction asynchrone<codestep step="{1}"><code>fetchData</code></codestep>renvoie une promesse pour le r√©sultat de notre appel √† <code>fetch</code>.<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> getData <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>fetchData<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MyComponent</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ... des calculs ici</span>
  <span class="token keyword control-flow">await</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>En appelant<codestep step="{2}"><code>getData</code></codestep>pour la premi√®re fois, la promesse renvoy√©e par<codestep step="{1}"><code>fetchData</code></codestep>est mise en cache. Les appels ult√©rieurs utiliseront la m√™me promesse.<p>Remarquez que le premier appel √†<codestep step="{2}"><code>getData</code></codestep>n'appelle pas <code>await</code>, alors que le<codestep step="{3}">second</codestep>le fait. <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Operators/await"><code>await</code></a> est un op√©rateur JavaScript qui attend l'√©tablissement de la promesse et renvoie son r√©sultat accompli (ou l√®ve son erreur de rejet). Le premier appel √†<codestep step="{2}"><code>getData</code></codestep>lance simplement le chargement (<code>fetch</code>) pour mettre la promesse en cache, afin que le deuxi√®me<codestep step="{3}"><code>getData</code></codestep>la trouve d√©j√† en cours d'ex√©cution.<p>Si lors du<codestep step="{3}">deuxi√®me appel</codestep>la promesse est toujours <em>en attente</em>, alors <code>await</code> attendra son r√©sultat. L'optimisation tient √† ce que, pendant le <code>fetch</code> issu du premier appel, React peut continuer son travail de calcul, ce qui r√©duit l'attente pour le<codestep step="{3}">deuxi√®me appel</codestep>.<p>Si la promesse est d√©j√† √©tablie √† ce moment-l√†, <code>await</code> renverra imm√©diatement la valeur accomplie (ou l√®vera imm√©diatement l'erreur de rejet). Dans les deux cas, on am√©liore la performance per√ßue.</section></deepdive><pitfall><section class="level4"aria-labelledby="appeler-une-fonction-m√©mo√Øs√©e-hors-dun-composant-nutilisera-pas-le-cache-pitfall-memoized-call-outside-component"><h4 id="appeler-une-fonction-m√©mo√Øs√©e-hors-dun-composant-nutilisera-pas-le-cache-pitfall-memoized-call-outside-component">Appeler une fonction m√©mo√Øs√©e hors d'un composant n'utilisera pas le cache {/<em>pitfall-memoized-call-outside-component</em>/}</h4><pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> getUser <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword control-flow">await</span> db<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token method function property-access">query</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// üö© Erron√©¬†: Appeler une fontion m√©mo√Øs√©e hors d‚Äôun composant</span>
<span class="token comment">// n‚Äôexploitera pas le cache.</span>
<span class="token function">getUser</span><span class="token punctuation">(</span><span class="token string">'demo-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">DemoProfile</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ‚úÖ Correct¬†: `getUser` exploitera le cache.</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token string">'demo-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Profile</span></span> <span class="token attr-name">user</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>React ne fournit un acc√®s au cache pour les fonctions m√©mo√Øs√©es qu'au sein d'un composant. Si vous appelez<codestep step="{1}"><code>getUser</code></codestep>hors d'un composant, il √©valuera la fonction mais n'utilisera pas le cache (ni en lecture ni en √©criture).<p>C'est parce que l'acc√®s au cache est fourni via un <a href="/learn/passing-data-deeply-with-context">contexte</a>, et que les contextes ne sont accessibles que depuis les composants.</section></pitfall><deepdive><section class="level4"aria-labelledby="comment-choisir-entre-cache-memo-et-usememo-cache-memo-usememo"><h4 id="comment-choisir-entre-cache-memo-et-usememo-cache-memo-usememo">Comment choisir entre <code>cache</code>, <a href="/reference/react/memo"><code>memo</code></a> et <a href="/reference/react/useMemo"><code>useMemo</code></a>¬†? {/<em>cache-memo-usememo</em>/}</h4><p>Toutes ces API proposent de la m√©mo√Øsation, mais diff√®rent sur ce que vous cherchez √† m√©mo√Øser, sur les destinataires du cache, et sur les m√©thodes d'invalidation de ce cache.</section><section class="level4"aria-labelledby="usememo-deep-dive-use-memo"><h4 id="usememo-deep-dive-use-memo"><code>useMemo</code> {/<em>deep-dive-use-memo</em>/}</h4><p>Vous devriez g√©n√©ralement utiliser <a href="/reference/react/useMemo"><code>useMemo</code></a> pour mettre en cache d'un rendu √† l'autre un calcul co√ªteux dans un Composant Client. √áa pourrait par exemple m√©mo√Øser une transformation de donn√©es dans un composant.<pre class="language-jsx"><code class="language-jsx"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">WeatherReport</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> avgTemp <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">calculateAvg</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> record <span class="token operator">=</span> <span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">WeatherReport</span></span> <span class="token attr-name">record</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">WeatherReport</span></span> <span class="token attr-name">record</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Dans cet exemple, <code>App</code> affiche deux <code>WeatherReport</code> avec le m√™me enregistrement. M√™me si les deux composants font le m√™me travail, ils ne peuvent pas partager des traitements. Le cache de <code>useMemo</code> est local √† chaque composant.<p>En revanche, <code>useMemo</code> s'assure bien que si <code>App</code> refait un rendu et que l'objet <code>record</code> n'a pas chang√©, chaque instance du composant √©vitera son calcul et utilisera plut√¥t sa valeur <code>avgTemp</code> m√©mo√Øs√©e. <code>useMemo</code> mettra le dernier calcul d'<code>avgTemp</code> en cache sur base des d√©pendances qu'on lui fournit.</section><section class="level4"aria-labelledby="cache-deep-dive-cache"><h4 id="cache-deep-dive-cache"><code>cache</code> {/<em>deep-dive-cache</em>/}</h4><p>Vous utiliserez <code>cache</code> dans des Composants Serveur pour m√©mo√Øser du travail √† partager entre plusieurs composants.<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> cachedFetchReport <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span>fetchReport<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">WeatherReport</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>city<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> report <span class="token operator">=</span> <span class="token function">cachedFetchReport</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> city <span class="token operator">=</span> <span class="token string">"Paris"</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">WeatherReport</span> city<span class="token operator">=</span><span class="token punctuation">{</span>city<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">WeatherReport</span> city<span class="token operator">=</span><span class="token punctuation">{</span>city<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>En r√©√©crivant l'exemple pr√©c√©dent pour utiliser <code>cache</code>, cette fois la<codestep step="{3}">deuxi√®me instance de <code>WeatherReport</code></codestep>pourra s'√©viter une duplication d'effort et lira depuis le m√™me cache que le<codestep step="{1}">premier <code>WeatherReport</code></codestep>. Une autre diff√©rence avec l'exemple pr√©c√©dent, c'est que <code>cache</code> est √©galement conseill√©e pour<codestep step="{2}">m√©mo√Øser des chargements de donn√©es</codestep>, contrairement √† <code>useMemo</code> qui ne devrait √™tre utilis√©e que pour des calculs.<p>Pour le moment, <code>cache</code> ne devrait √™tre utilis√©e que dans des Composants Serveur, et le cache sera invalid√© √† chaque requ√™te serveur.</section><section class="level4"aria-labelledby="memo-deep-dive-memo"><h4 id="memo-deep-dive-memo"><code>memo</code> {/<em>deep-dive-memo</em>/}</h4><p>Vous devriez utiliser <a href="reference/react/memo"><code>memo</code></a> pour √©viter qu'un composant ne recalcule son rendu alors que ses props n'ont pas chang√©.<pre class="language-js"><code class="language-js"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">WeatherReport</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>record<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> avgTemp <span class="token operator">=</span> <span class="token function">calculateAvg</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">MemoWeatherReport</span> <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token maybe-class-name">WeatherReport</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> record <span class="token operator">=</span> <span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MemoWeatherReport</span> record<span class="token operator">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MemoWeatherReport</span> record<span class="token operator">=</span><span class="token punctuation">{</span>record<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Dans cet exemple, les deux composants <code>MemoWeatherReport</code> appelleront <code>calculateAvg</code> lors de leur premier rendu. Cependant, si <code>App</code> refait son rendu, sans pour autant changer <code>record</code>, aucune des props n'aura chang√© et <code>MemoWeatherReport</code> ne refera pas son rendu.<p>Compar√© √† <code>useMemo</code>, <code>memo</code> m√©mo√Øse le rendu du composant sur base de ses props, au lieu de m√©mo√Øser des calculs sp√©cifiques. Un peu comme avec <code>useMemo</code>, le composant m√©mo√Øs√© ne met en cache que le dernier rendu, avec les derni√®res valeurs de props. D√®s que les props changent, le cache est invalid√© et le composant refait son rendu.</section></deepdive></section></section><section class="level2"aria-labelledby="d√©pannage-troubleshooting"><h2 id="d√©pannage-troubleshooting">D√©pannage {/<em>troubleshooting</em>/}</h2><section class="level3"aria-labelledby="ma-fonction-m√©mo√Øs√©e-est-r√©-ex√©cut√©e-alors-que-je-lai-appel√©e-avec-les-m√™mes-arguments-memoized-function-still-runs"><h3 id="ma-fonction-m√©mo√Øs√©e-est-r√©-ex√©cut√©e-alors-que-je-lai-appel√©e-avec-les-m√™mes-arguments-memoized-function-still-runs">Ma fonction m√©mo√Øs√©e est r√©-ex√©cut√©e alors que je l'ai appel√©e avec les m√™mes arguments {/<em>memoized-function-still-runs</em>/}</h3><p>Voyez d√©j√† les pi√®ges signal√©s plus haut¬†:<ul><li><a href="#pitfall-different-memoized-functions">Appeler des fonctions m√©mo√Øs√©es distinctes lira des caches distincts</a><li><a href="#pitfall-memoized-call-outside-component">Appeler une fonction m√©mo√Øs√©e hors d'un composant n'utilisera pas le cache</a></ul><p>Si rien de tout √ßa ne s'applique, le probl√®me peut √™tre li√© √† la fa√ßon dont React v√©rifie l'existence de quelque chose dans le cache.<p>Si vos arguments ne sont pas des <a href="https://developer.mozilla.org/fr/docs/Glossary/Primitive">primitives</a> (ce sont par exemple des objets, des fonctions, des tableaux), assurez-vous de toujours passer la m√™me r√©f√©rence d'objet.<p>Lors d'un appel √† une fonction m√©mo√Øs√©e, React utilisera les arguments pass√©s pour d√©terminer si un r√©sultat existe d√©j√† dans le cache. React utilisera pour ce faire une comparaison superficielle des arguments.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> calculateNorm <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">vector</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MapMarker</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// üö© Erron√©¬†: les props sont un objet diff√©rent √† chaque rendu.</span>
  <span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token function">calculateNorm</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Dans le cas ci-dessus, les deux <code>MapMarker</code> semblent faire exactement la m√™me chose et appeler <code>calculateNorm</code> avec les m√™mes valeurs <code>{x: 10, y: 10, z:10}</code>. M√™me si les objets contiennent des valeurs identiques, il ne s'agit pas d'une unique r√©f√©rence √† un m√™me objet, car chaque composant cr√©e son propre objet <code>props</code>.<p>React appellera <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a> sur chaque argument pour v√©rifier l'existence dans le cache.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> calculateNorm <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MapMarker</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ‚úÖ Correct¬†: passe des primitives √† la fonction m√©mo√Øs√©e</span>
  <span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token function">calculateNorm</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span><span class="token property-access">z</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> x<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> y<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> z<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Une fa√ßon de rem√©dier √† √ßa consiste √† passer les dimensions du vecteur √† <code>calculateNorm</code>. √áa fonctionne parce que chaque dimension pass√©e est une valeur primitive.<p>Vous pourriez aussi passer l'objet vecteur lui-m√™me comme prop au composant. Il vous faudrait toutefois passer le m√™me objet en m√©moire aux deux instances du composant.<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>cache<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> calculateNorm <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">vector</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">MapMarker</span></span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ‚úÖ Correct¬†: passe le m√™me objet `vector`</span>
  <span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token function">calculateNorm</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span><span class="token property-access">vector</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">App</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vector <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&#x3C;</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> vector<span class="token operator">=</span><span class="token punctuation">{</span>vector<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&#x3C;</span><span class="token maybe-class-name">MapMarker</span> vector<span class="token operator">=</span><span class="token punctuation">{</span>vector<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&#x3C;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><span style="float:footnote"><a href="../../index.html#toc">Go to TOC</a></span></section></section></inlinetoc></section>