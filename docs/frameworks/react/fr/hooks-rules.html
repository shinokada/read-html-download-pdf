<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <title>Les r√®gles des Hooks</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://raw.githubusercontent.com/shinokada/prism-coy-theme/main/theme_common.css">
  </head>
  <body>
    <section id="les-r√®gles-des-hooks" class="level1">
      <h1>Les r√®gles des Hooks</h1>
      <p>Les <em>Hooks</em> sont arriv√©s avec React 16.8. Ils vous permettent de b√©n√©ficier d‚Äôun √©tat local et d'autres fonctionnalit√©s de React sans avoir √† √©crire une classe.</p>
      <p>Les Hooks sont des fonctions JavaScript, mais vous devez suivre deux r√®gles lorsque vous les utilisez. Nous mettons √† votre disposition un <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">plugin de <em>linter</em></a> pour v√©rifier ces r√®gles automatiquement¬†:</p>
      <section id="only-call-hooks-at-the-top-level" class="level3">
        <h3>Appelez les Hooks uniquement au niveau racine</h3>
        <p><strong>N'appelez pas de Hooks √† l'int√©rieur de boucles, de code conditionnel ou de fonctions imbriqu√©es.</strong> Au lieu de √ßa, utilisez seulement les Hooks au niveau racine de votre fonction React. En suivant cette r√®gle, vous garantissez que les Hooks sont appel√©s dans le m√™me ordre √† chaque affichage du composant. C'est ce qui permet √† React de garantir le bon √©tat des Hooks entre plusieurs appels √† <code>useState</code> et <code>useEffect</code>. (Si vous √™tes curieux¬∑se, nous expliquerons √ßa en d√©tail <a href="#explanation">plus bas</a>.)</p>
      </section>
      <section id="only-call-hooks-from-react-functions" class="level3">
        <h3>Appelez les Hooks uniquement depuis des fonctions React</h3>
        <p><strong>N'appelez pas les Hooks depuis des fonctions JavaScript classiques.</strong> Vous pouvez en revanche¬†:</p>
        <ul>
          <li>‚úÖ Appeler les Hooks depuis des fonctions composants React.</li>
          <li>‚úÖ Appeler les Hooks depuis des Hooks personnalis√©s (nous aborderons le sujet <a href="./hooks-custom.html">dans la prochaine page</a>).</li>
        </ul>
        <p>En suivant cette r√®gle, vous garantissez que toute la logique d‚Äô√©tat d‚Äôun composant est clairement identifiable dans son code source.</p>
      </section>
      <section id="eslint-plugin" class="level2">
        <h2>Plugin ESLint</h2>
        <p>Nous avons publi√© un plugin ESLint appel√© <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks"><code>eslint-plugin-react-hooks</code></a> qui assure le respect de ces deux r√®gles. Vous pouvez ajouter ce plugin √† votre projet si vous souhaitez l'utiliser¬†:</p>
        <p>Ce plugin est inclus par d√©faut dans Create React App<a href="./create-a-new-react-app.html#create-react-app">Create React App</a>.</p>
        <pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> eslint-plugin-react-hooks --save-dev</code></pre>
        <pre class="language-js"><code class="language-js"><span class="token comment">// Votre configuration ESLint</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token string">"react-hooks"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">"rules"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token string-property property">"react-hooks/rules-of-hooks"</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token comment">// V√©rifie les r√®gles des Hooks</span>
    <span class="token string-property property">"react-hooks/exhaustive-deps"</span><span class="token operator">:</span> <span class="token string">"warn"</span>  <span class="token comment">// V√©rifie les tableaux de d√©pendances</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
        <p><strong>Vous pouvez maintenant passer directement √† la prochaine page, qui explique comment √©crire <a href="./hooks-custom.html">vos propres Hooks</a>.</strong> Dans cette page, nous allons maintenant expliquer le raisonnement qui se cache derri√®re ces r√®gles.</p>
      </section>
      <section id="explanation" class="level2">
        <h2>Explications</h2>
        <p>Comme nous l'avons <a href="./hooks-state.html#tip-using-multiple-state-variables">appris plus t√¥t</a>, nous pouvons utiliser plusieurs Hooks <em>State</em> ou <em>Effect</em> au sein d'un m√™me composant¬†:</p>
        <pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. Utilise la variable d'√©tat name</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2. Utilise un effet pour persister le formulaire</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 3. Utilise la variable d'√©tat surname</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>surname<span class="token punctuation">,</span> setSurname<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 4. Utilise un effet pour mettre √† jour le titre</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">updateTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">title</span> <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> surname<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre>
        <p>Alors, comment React sait-il quel √©tat correspond √† quel appel √† <code>useState</code>¬†? R√©ponse¬†: <strong>React se repose sur l'ordre dans lequel les Hooks sont appel√©s</strong>. Notre exemple fonctionne car l'ordre d'appel des Hooks est le m√™me √† chaque affichage¬†:</p>
        <pre class="language-js"><code class="language-js"><span class="token comment">// ---------</span>
<span class="token comment">// Premier affichage</span>
<span class="token comment">// ---------</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. Initialise la variable d'√©tat name avec 'Mary'</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>persistForm<span class="token punctuation">)</span>     <span class="token comment">// 2. Ajoute un effet pour persister le formulaire</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// 3. Initialise la variable d'√©tat surname avec 'Poppins'</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// 4. Ajoute un effet pour mettre √† jour le titre</span>

<span class="token comment">// ----------</span>
<span class="token comment">// Deuxi√®me affichage</span>
<span class="token comment">// ----------</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. Lit la variable d'√©tat name (l'argument est ignor√©)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>persistForm<span class="token punctuation">)</span>     <span class="token comment">// 2. Remplace l'effet pour persister le formulaire</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// 3. Lit la variable d'√©tat surname (l'argument est ignor√©)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// 4. Remplace l'effet pour mettre √† jour le titre</span>

<span class="token comment">// ...</span></code></pre>
        <p>Tant que l'ordre d'appel aux Hooks est le m√™me d‚Äôun affichage √† l‚Äôautre, React peut associer un √©tat local √† chacun d'entre eux. Mais que se passerait-il si nous appelions un Hook (par exemple, l'effet <code>persistForm</code>) de fa√ßon conditionnelle¬†?</p>
        <pre class="language-js"><code class="language-js">  <span class="token comment">// üî¥ Nous enfreignons la premi√®re r√®gle en utilisant un Hook de fa√ßon conditionnelle</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>name <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre>
        <p>La condition <code>name !== ''</code> est vraie au premier affichage, donc nous ex√©cutons ce Hook. Cependant, lors du prochain affichage l'utilisateur risque de vider le formulaire, ce qui invalidera la condition. √Ä pr√©sent que nous sautons ce Hook lors de l‚Äôaffichage, l'ordre d'appel aux Hooks devient diff√©rent¬†:</p>
        <pre class="language-js"><code class="language-js"><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. Lit la variable d'√©tat name (l'argument est ignor√©)</span>
<span class="token comment">// useEffect(persistForm)  // üî¥ Ce Hook n'a pas √©t√© appel√©¬†!</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// üî¥ 2. (mais √©tait 3). √âchoue √† lire la variable d'√©tat surname</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// üî¥ 3. (mais √©tait 4). √âchoue √† remplacer de l'effet</span></code></pre>
        <p>React ne saurait pas quoi renvoyer lors du second appel au Hook <code>useState</code>. React s'attendait √† ce que le deuxi√®me appel √† un Hook dans ce composant corresponde √† l'effet <code>persistForm</code>, comme lors de l‚Äôaffichage pr√©c√©dent, mais ce n'est plus le cas. A partir de l√†, chaque appel √† un Hook ult√©rieur √† celui que nous avons saut√© sera aussi d√©cal√© de un, provoquant des bugs.</p>
        <p><strong>C'est pourquoi les Hooks doivent √™tre appel√©s au niveau racine de vos composants.</strong> Si vous voulez ex√©cuter un effet de mani√®re conditionnelle, vous pouvez mettre cette condition <em>√† l'int√©rieur</em> de votre Hook¬†:</p>
        <pre class="language-js"><code class="language-js">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// üëç Nous n‚Äôenfreignons plus la premi√®re r√®gle</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>name <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
        <p><strong>Remarquez que vous n‚Äôavez pas √† vous inqui√©ter de √ßa si vous utilisez <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">le plugin de <em>linter</em> fourni</a>.</strong> Mais maintenant, vous savez <em>pourquoi</em> les Hooks fonctionnent de cette mani√®re et quels probl√®mes ces r√®gles √©vitent.</p>
      </section>
      <section id="next-steps" class="level2">
        <h2>Prochaines √©tapes</h2>
        <p>
          Enfin, nous sommes pr√™ts pour apprendre √† <a href="./hooks-custom.html">√©crire nos propres Hooks</a>¬†! Les Hooks personnalis√©s vous permettent de combiner les Hooks fournis par React pour cr√©er vos propres abstractions et r√©utiliser une logique d‚Äô√©tat commune dans diff√©rents composants.
          <span style="float: footnote;"><a href="./index.html#toc">Go to TOC</a></span>
        </p>
      </section>
    </section>
  </body>
</html>
