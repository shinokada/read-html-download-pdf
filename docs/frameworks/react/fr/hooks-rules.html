<!doctype html><html lang="fr"><meta charset="utf-8"><title>Les rÃ¨gles des Hooks</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="les-rÃ¨gles-des-hooks"class="level1"><h1>Les rÃ¨gles des Hooks</h1><p>Les <em>Hooks</em> sont arrivÃ©s avec React 16.8. Ils vous permettent de bÃ©nÃ©ficier dâ€™un Ã©tat local et d'autres fonctionnalitÃ©s de React sans avoir Ã  Ã©crire une classe.<p>Les Hooks sont des fonctions JavaScript, mais vous devez suivre deux rÃ¨gles lorsque vous les utilisez. Nous mettons Ã  votre disposition un <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">plugin de <em>linter</em></a> pour vÃ©rifier ces rÃ¨gles automatiquementÂ :<section id="only-call-hooks-at-the-top-level"class="level3"><h3>Appelez les Hooks uniquement au niveau racine</h3><p><strong>N'appelez pas de Hooks Ã  l'intÃ©rieur de boucles, de code conditionnel ou de fonctions imbriquÃ©es.</strong> Au lieu de Ã§a, utilisez seulement les Hooks au niveau racine de votre fonction React. En suivant cette rÃ¨gle, vous garantissez que les Hooks sont appelÃ©s dans le mÃªme ordre Ã  chaque affichage du composant. C'est ce qui permet Ã  React de garantir le bon Ã©tat des Hooks entre plusieurs appels Ã  <code>useState</code> et <code>useEffect</code>. (Si vous Ãªtes curieuxÂ·se, nous expliquerons Ã§a en dÃ©tail <a href="#explanation">plus bas</a>.)</section><section id="only-call-hooks-from-react-functions"class="level3"><h3>Appelez les Hooks uniquement depuis des fonctions React</h3><p><strong>N'appelez pas les Hooks depuis des fonctions JavaScript classiques.</strong> Vous pouvez en revancheÂ :<ul><li>âœ… Appeler les Hooks depuis des fonctions composants React.<li>âœ… Appeler les Hooks depuis des Hooks personnalisÃ©s (nous aborderons le sujet <a href="./hooks-custom.html">dans la prochaine page</a>).</ul><p>En suivant cette rÃ¨gle, vous garantissez que toute la logique dâ€™Ã©tat dâ€™un composant est clairement identifiable dans son code source.</section><section id="eslint-plugin"class="level2"><h2>Plugin ESLint</h2><p>Nous avons publiÃ© un plugin ESLint appelÃ© <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks"><code>eslint-plugin-react-hooks</code></a> qui assure le respect de ces deux rÃ¨gles. Vous pouvez ajouter ce plugin Ã  votre projet si vous souhaitez l'utiliserÂ :<p>Ce plugin est inclus par dÃ©faut dans Create React App<a href="./create-a-new-react-app.html#create-react-app">Create React App</a>.<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> eslint-plugin-react-hooks --save-dev</code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// Votre configuration ESLint</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token string">"react-hooks"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">"rules"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token string-property property">"react-hooks/rules-of-hooks"</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token comment">// VÃ©rifie les rÃ¨gles des Hooks</span>
    <span class="token string-property property">"react-hooks/exhaustive-deps"</span><span class="token operator">:</span> <span class="token string">"warn"</span>  <span class="token comment">// VÃ©rifie les tableaux de dÃ©pendances</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><strong>Vous pouvez maintenant passer directement Ã  la prochaine page, qui explique comment Ã©crire <a href="./hooks-custom.html">vos propres Hooks</a>.</strong> Dans cette page, nous allons maintenant expliquer le raisonnement qui se cache derriÃ¨re ces rÃ¨gles.</section><section id="explanation"class="level2"><h2>Explications</h2><p>Comme nous l'avons <a href="./hooks-state.html#tip-using-multiple-state-variables">appris plus tÃ´t</a>, nous pouvons utiliser plusieurs Hooks <em>State</em> ou <em>Effect</em> au sein d'un mÃªme composantÂ :<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Form</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. Utilise la variable d'Ã©tat name</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2. Utilise un effet pour persister le formulaire</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 3. Utilise la variable d'Ã©tat surname</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>surname<span class="token punctuation">,</span> setSurname<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 4. Utilise un effet pour mettre Ã  jour le titre</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">updateTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">title</span> <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> surname<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><p>Alors, comment React sait-il quel Ã©tat correspond Ã  quel appel Ã  <code>useState</code>Â ? RÃ©ponseÂ : <strong>React se repose sur l'ordre dans lequel les Hooks sont appelÃ©s</strong>. Notre exemple fonctionne car l'ordre d'appel des Hooks est le mÃªme Ã  chaque affichageÂ :<pre class="language-js"><code class="language-js"><span class="token comment">// ---------</span>
<span class="token comment">// Premier affichage</span>
<span class="token comment">// ---------</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. Initialise la variable d'Ã©tat name avec 'Mary'</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>persistForm<span class="token punctuation">)</span>     <span class="token comment">// 2. Ajoute un effet pour persister le formulaire</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// 3. Initialise la variable d'Ã©tat surname avec 'Poppins'</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// 4. Ajoute un effet pour mettre Ã  jour le titre</span>

<span class="token comment">// ----------</span>
<span class="token comment">// DeuxiÃ¨me affichage</span>
<span class="token comment">// ----------</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. Lit la variable d'Ã©tat name (l'argument est ignorÃ©)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>persistForm<span class="token punctuation">)</span>     <span class="token comment">// 2. Remplace l'effet pour persister le formulaire</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// 3. Lit la variable d'Ã©tat surname (l'argument est ignorÃ©)</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// 4. Remplace l'effet pour mettre Ã  jour le titre</span>

<span class="token comment">// ...</span></code></pre><p>Tant que l'ordre d'appel aux Hooks est le mÃªme dâ€™un affichage Ã  lâ€™autre, React peut associer un Ã©tat local Ã  chacun d'entre eux. Mais que se passerait-il si nous appelions un Hook (par exemple, l'effet <code>persistForm</code>) de faÃ§on conditionnelleÂ ?<pre class="language-js"><code class="language-js">  <span class="token comment">// ğŸ”´ Nous enfreignons la premiÃ¨re rÃ¨gle en utilisant un Hook de faÃ§on conditionnelle</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>name <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre><p>La condition <code>name !== ''</code> est vraie au premier affichage, donc nous exÃ©cutons ce Hook. Cependant, lors du prochain affichage l'utilisateur risque de vider le formulaire, ce qui invalidera la condition. Ã€ prÃ©sent que nous sautons ce Hook lors de lâ€™affichage, l'ordre d'appel aux Hooks devient diffÃ©rentÂ :<pre class="language-js"><code class="language-js"><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Mary'</span><span class="token punctuation">)</span>           <span class="token comment">// 1. Lit la variable d'Ã©tat name (l'argument est ignorÃ©)</span>
<span class="token comment">// useEffect(persistForm)  // ğŸ”´ Ce Hook n'a pas Ã©tÃ© appelÃ©Â !</span>
<span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'Poppins'</span><span class="token punctuation">)</span>        <span class="token comment">// ğŸ”´ 2. (mais Ã©tait 3). Ã‰choue Ã  lire la variable d'Ã©tat surname</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span>updateTitle<span class="token punctuation">)</span>     <span class="token comment">// ğŸ”´ 3. (mais Ã©tait 4). Ã‰choue Ã  remplacer de l'effet</span></code></pre><p>React ne saurait pas quoi renvoyer lors du second appel au Hook <code>useState</code>. React s'attendait Ã  ce que le deuxiÃ¨me appel Ã  un Hook dans ce composant corresponde Ã  l'effet <code>persistForm</code>, comme lors de lâ€™affichage prÃ©cÃ©dent, mais ce n'est plus le cas. A partir de lÃ , chaque appel Ã  un Hook ultÃ©rieur Ã  celui que nous avons sautÃ© sera aussi dÃ©calÃ© de un, provoquant des bugs.<p><strong>C'est pourquoi les Hooks doivent Ãªtre appelÃ©s au niveau racine de vos composants.</strong> Si vous voulez exÃ©cuter un effet de maniÃ¨re conditionnelle, vous pouvez mettre cette condition <em>Ã  l'intÃ©rieur</em> de votre HookÂ :<pre class="language-js"><code class="language-js">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">persistForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ğŸ‘ Nous nâ€™enfreignons plus la premiÃ¨re rÃ¨gle</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>name <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token dom variable">localStorage</span><span class="token punctuation">.</span><span class="token method function property-access">setItem</span><span class="token punctuation">(</span><span class="token string">'formData'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>Remarquez que vous nâ€™avez pas Ã  vous inquiÃ©ter de Ã§a si vous utilisez <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">le plugin de <em>linter</em> fourni</a>.</strong> Mais maintenant, vous savez <em>pourquoi</em> les Hooks fonctionnent de cette maniÃ¨re et quels problÃ¨mes ces rÃ¨gles Ã©vitent.</section><section id="next-steps"class="level2"><h2>Prochaines Ã©tapes</h2><p>Enfin, nous sommes prÃªts pour apprendre Ã  <a href="./hooks-custom.html">Ã©crire nos propres Hooks</a>Â ! Les Hooks personnalisÃ©s vous permettent de combiner les Hooks fournis par React pour crÃ©er vos propres abstractions et rÃ©utiliser une logique dâ€™Ã©tat commune dans diffÃ©rents composants. <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section>