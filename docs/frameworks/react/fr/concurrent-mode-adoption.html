<!doctype html><html lang="fr"><meta charset="utf-8"><title>Adopter le mode concurrent (expÃ©rimental)</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="adopter-le-mode-concurrent-expÃ©rimental"class="level1"><h1>Adopter le mode concurrent (expÃ©rimental)</h1><style>.scary>blockquote{background-color:rgba(237,51,21,.2);border-left-color:#ed3315}</style><div class="scary"><blockquote><p>Attention<p>Cette page dÃ©crit <strong>des fonctionnalitÃ©s expÃ©rimentales qui <a href="./concurrent-mode-adoption.html">ne sont pas encore disponibles</a> dans une version stable</strong>. Ne vous basez pas sur les builds expÃ©rimentaux de React pour vos applis en production. Ces fonctionnalitÃ©s sont susceptibles dâ€™Ã©voluer de faÃ§on significative et sans avertissement avant dâ€™intÃ©grer officiellement React.<p>Cette documentation est destinÃ©e aux personnes curieuses ou habituÃ©es Ã  adopter les nouvelles technologies trÃ¨s tÃ´t. <strong>Si vous dÃ©butez en React, ne vous prÃ©occupez pas de ces fonctionnalitÃ©s</strong>Â : vous nâ€™avez pas besoin de les apprendre pour le moment.</blockquote></div><ul><li><a href="#installation">Installation</a><ul><li><a href="#who-is-this-experimental-release-for">Ã€ qui sâ€™adresse cette version expÃ©rimentaleÂ ?</a><li><a href="#enabling-concurrent-mode">Activer le mode concurrent</a></ul><li><a href="#what-to-expect">Ã€ quoi sâ€™attendreÂ ?</a><ul><li><a href="#migration-step-blocking-mode">Ã‰tape de migrationÂ : le mode bloquant</a><li><a href="#why-so-many-modes">Pourquoi tant de modesÂ ?</a><li><a href="#feature-comparison">Comparaison des fonctionnalitÃ©s</a></ul></ul><section id="installation"class="level2"><h2>Installation</h2><p>Le mode concurrent est disponible uniquement dans les <a href="/blog/2019/10/22/react-release-channels.html#experimental-channel">builds expÃ©rimentaux</a> de React. Pour les installer, exÃ©cutezÂ :<pre class="language-text"><code class="language-text">npm install react@experimental react-dom@experimental</code></pre><p><strong>Les builds expÃ©rimentaux nâ€™offrent aucune des garanties de la gestion sÃ©mantique des versions.</strong> Nous sommes susceptibles dâ€™ajouter, modifier ou retirer des API dans nâ€™importe quelle version <code>@experimental</code>.<p><strong>Les versions expÃ©rimentales rompront souvent la compatibilitÃ© ascendante.</strong><p>Vous pouvez essayer ces builds sur des projets personnels ou dans une branche, mais nous dÃ©conseillons leur utilisation en production. Chez Facebook, nous les utilisons <em>effectivement</em> en production, mais uniquement parce que nous sommes Ã  mÃªme dâ€™en corriger les bugs immÃ©diatement. Vous voilÃ  avertiÂ·eÂ !<section id="who-is-this-experimental-release-for"class="level3"><h3>Ã€ qui sâ€™adresse cette version expÃ©rimentaleÂ ?</h3><p>Cette version est surtout destinÃ©e aux personnes habituÃ©es Ã  adopter les nouvelles technologies trÃ¨s tÃ´t, aux mainteneurs de bibliothÃ¨ques et, de faÃ§on plus gÃ©nÃ©rale, aux personnes curieuses.<p>Nous utilisons ce code en production (et Ã§a fonctionne pour nous) mais il reste quelques bugs, des fonctionnalitÃ©s manquantes, et des lacunes dans la documentation. Nous sommes avides de vos retours sur ce qui casse en mode concurrent, afin que nous puissions mieux le prÃ©parer pour sa sortie prochaine au sein dâ€™une version stable.</section><section id="enabling-concurrent-mode"class="level3"><h3>Activer le mode concurrent</h3><p>En temps normal, quand nous ajoutons des fonctionnalitÃ©s Ã  React, vous pouvez vous en servir immÃ©diatement. Les fragments, les Contextes ou mÃªme les Hooks sont autant dâ€™exemples rÃ©cents. Vous pouvez les utiliser dans du nouveau code sans avoir Ã  changer quoi que ce soit au code existant.<p>Il en va diffÃ©remment pour le mode concurrent. Il introduit des changements sÃ©mantiques dans le fonctionnement de React. Si ce nâ€™Ã©tait pas le cas, les <a href="./concurrent-mode-patterns.html">nouvelles fonctionnalitÃ©s</a> quâ€™il permet <em>ne seraient pas possibles</em>. Câ€™est pourquoi nous les avons regroupÃ©es dans un Â«Â modeÂ Â» au lieu de les sortir, une Ã  une, en isolation.<p>Vous ne pouvez pas activer le mode concurrent seulement pour une partie de lâ€™arborescence React. Au lieu de Ã§a, pour lâ€™activer, vous devez le faire Ã  lâ€™endroit oÃ¹, aujourdâ€™hui, vous appelez <code>ReactDOM.render()</code>.<p><strong>Voici comment activer le mode concurrent pour toute lâ€™arborescence de <code>&#x3C;App /></code>Â :</strong><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token maybe-class-name">ReactDOM</span></span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token comment">// Si vous aviez auparavantÂ :</span>
<span class="token comment">//</span>
<span class="token comment">// ReactDOM.render(&#x3C;App />, document.getElementById('root'));</span>
<span class="token comment">//</span>
<span class="token comment">// Vous pouvez dÃ©sormais activer le mode concurrent en Ã©crivantÂ :</span>

<span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">unstable_createRoot</span><span class="token punctuation">(</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">App</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>Remarque<p>Les API du mode concurrent, telles que <code>createRoot</code>, nâ€™existent que dans les builds expÃ©rimentaux de React.</blockquote><p>En mode concurrent, les mÃ©thodes de cycle de vie qui Ã©taient <a href="/blog/2018/03/27/update-on-async-rendering.html">auparavant dÃ©signÃ©es</a> comme Â«Â dangereusesÂ Â» <em>(â€œunsafeâ€, NdT)</em> sont <em>effectivement</em> dangereuses, et peuvent entraÃ®ner des bugs encore plus souvent que dans le code React habituel. Nous vous dÃ©conseillons de tester le mode concurrent tant que votre appli nâ€™est pas compatible avec le <a href="./strict-mode.html">mode strict</a>.</section></section><section id="what-to-expect"class="level2"><h2>Ã€ quoi sâ€™attendreÂ ?</h2><p>Si vous avez une grosse appli existante, ou si votre appli dÃ©pend de nombreux modules tiers, ne vous attendez pas Ã  pouvoir utiliser le mode concurrent immÃ©diatement. <strong>Par exemple, chez Facebook nous utilisons le mode concurrent sur le nouveau site web, mais nous nâ€™avons pas lâ€™intention de lâ€™activer sur lâ€™ancien site.</strong> Câ€™est parce que notre ancien site utilise encore de nombreuses mÃ©thodes de cycle de vie classÃ©es dangereuses, dans son code produit comme dans des bibliothÃ¨ques tierces, ainsi que diverses approches qui ne fonctionnent pas bien avec le mode concurrent.<p>Lâ€™expÃ©rience nous indique que la maniÃ¨re la plus simple de fonctionner en mode concurrent, câ€™est dâ€™avoir du code qui utilise des approches React idiomatiques et ne repose pas sur des solutions externes de gestion de lâ€™Ã©tat. Dans les prochaines semaines, nous documenterons sÃ©parÃ©ment les problÃ¨mes courants que nous avons rencontrÃ©s et leurs solutions.<section id="migration-step-blocking-mode"class="level3"><h3>Ã‰tape de migrationÂ : le mode bloquant</h3><p>Le mode concurrent est sans doute une fausse bonne idÃ©e pour les bases de code anciennes. Câ€™est pourquoi nous fournissons aussi un nouveau Â«Â mode bloquantÂ Â» dans nos builds expÃ©rimentaux. Vous pouvez lâ€™essayer en remplaÃ§ant <code>createRoot</code> par <code>createBlockingRoot</code>. Il ne fournit quâ€™un <em>petit sous-ensemble</em> des fonctionnalitÃ©s du mode concurrent, mais il est plus proche de la faÃ§on dont React fonctionne aujourdâ€™hui et peut vous faciliter la transition.<p>En rÃ©sumÃ©Â :<ul><li><strong>Mode historiqueÂ :</strong> <code>ReactDOM.render(&#x3C;App />, rootNode)</code>. Câ€™est le fonctionnement actuel de React. Nous nâ€™avons pas lâ€™intention de retirer le mode historique dans un avenir proche, mais il ne prendra pas en charge ces nouvelles fonctionnalitÃ©s.<li><strong>Mode bloquantÂ :</strong> <code>ReactDOM.createBlockingRoot(rootNode).render(&#x3C;App />)</code>. Il est expÃ©rimental pour le moment. Il est pensÃ© comme une premiÃ¨re Ã©tape de migration pour les applis qui veulent bÃ©nÃ©ficier dâ€™au moins certaines fonctionnalitÃ©s du mode concurrent.<li><strong>Mode concurrentÂ :</strong> <code>ReactDOM.createRoot(rootNode).render(&#x3C;App />)</code>. Il est expÃ©rimental pour le moment. Ã€ lâ€™avenir, une fois quâ€™il sera stabilisÃ©, nous comptons en faire le mode par dÃ©faut de React. Ce mode active <em>toutes</em> les nouvelles fonctionnalitÃ©s.</ul></section><section id="why-so-many-modes"class="level3"><h3>Pourquoi tant de modesÂ ?</h3><p>Nous estimons quâ€™il est prÃ©fÃ©rable de proposer une <a href="./faq-versioning.html#commitment-to-stability">stratÃ©gie de migration graduelle</a> plutÃ´t que de faire dâ€™Ã©normes ruptures de compatibilitÃ© ascendanteâ€”qui sclÃ©roseraient React jusquâ€™Ã  le rendre hors-sujet.<p>En pratique, nous pensons que la plupart des applis utilisant aujourdâ€™hui le mode historique devraient pouvoir migrer vers au moins le mode bloquant (voire le mode concurrent). Cette fragmentation peut Ãªtre irritante pour les bibliothÃ¨ques qui essaient de prendre en charge lâ€™ensemble des modes sur le court terme. Toutefois, Ã©loigner progressivement lâ€™Ã©cosystÃ¨me du mode historique va aussi <em>rÃ©soudre</em> des problÃ¨mes qui affectent des bibliothÃ¨ques de premier plan dans lâ€™Ã©cosystÃ¨me React, telles que <a href="https://github.com/facebook/react/issues/14536">des comportements dÃ©routants de Suspense lorsquâ€™on lit la mise en page</a> et <a href="https://github.com/facebook/react/issues/15080">le manque de garanties stables de traitement par lot</a>. Un certain nombre de bugs ne peuvent pas Ãªtre corrigÃ©s en mode historique, sans changement de sÃ©mantique, mais nâ€™existent pas dans les modes bloquant et concurrent.<p>Pensez au mode bloquant comme Ã  une version en Â«Â gracieusement dÃ©gradÃ©eÂ Â» du mode concurrent. <strong>RÃ©sultat, sur le long terme nous devrions pouvoir converger et totalement cesser de nous prÃ©occuper des diffÃ©rents modes.</strong> Mais pour le moment, les modes constituent une importante stratÃ©gie de migration. Ils permettent Ã  chacunÂ·e de dÃ©cider si la migration vaut le coup, et de rÃ©aliser la mise Ã  jour Ã  leur propre rythme.</section><section id="feature-comparison"class="level3"><h3>Comparaison des fonctionnalitÃ©s</h3><style>#feature-table table{border-collapse:collapse}#feature-table th{padding-right:30px}#feature-table tr{border-bottom:1px solid #eee}</style><div id="feature-table"><table><thead><tr><th><th>Mode histo.<th>Mode bloquant<th>Mode concurrent<tbody><tr><td><a href="./refs-and-the-dom.html#legacy-api-string-refs">Refs de type string</a><td>âœ…<td>ğŸš«**<td>ğŸš«**<tr><td><a href="./legacy-context.html">API historique de Contexte</a><td>âœ…<td>ğŸš«**<td>ğŸš«**<tr><td><a href="./strict-mode.html#warning-about-deprecated-finddomnode-usage"><code>findDOMNode</code></a><td>âœ…<td>ğŸš«**<td>ğŸš«**<tr><td><a href="./concurrent-mode-suspense.html#what-is-suspense-exactly"><code>Suspense</code></a><td>âœ…<td>âœ…<td>âœ…<tr><td><a href="./concurrent-mode-patterns.html#suspenselist"><code>SuspenseList</code></a><td>ğŸš«<td>âœ…<td>âœ…<tr><td>Suspense cÃ´tÃ© serveur + Hydratation<td>ğŸš«<td>âœ…<td>âœ…<tr><td>Hydratation progressive<td>ğŸš«<td>âœ…<td>âœ…<tr><td>Hydratation sÃ©lective<td>ğŸš«<td>ğŸš«<td>âœ…<tr><td>MultitÃ¢ches coopÃ©ratif<td>ğŸš«<td>ğŸš«<td>âœ…<tr><td>Regroupement automatique de multiples <code>setState</code><td>ğŸš«*<td>âœ…<td>âœ…<tr><td><a href="./concurrent-mode-patterns.html#splitting-high-and-low-priority-state">Rendu basÃ© sur prioritÃ©s</a><td>ğŸš«<td>ğŸš«<td>âœ…<tr><td><a href="./concurrent-mode-intro.html#interruptible-rendering">PrÃ©rendu interruptible</a><td>ğŸš«<td>ğŸš«<td>âœ…<tr><td><a href="./concurrent-mode-patterns.html#transitions"><code>useTransition</code></a><td>ğŸš«<td>ğŸš«<td>âœ…<tr><td><a href="./concurrent-mode-patterns.html#deferring-a-value"><code>useDeferredValue</code></a><td>ğŸš«<td>ğŸš«<td>âœ…<tr><td><a href="./concurrent-mode-patterns.html#suspense-reveal-train">Â«Â TrainÂ Â» de rÃ©vÃ©lations de Suspense</a><td>ğŸš«<td>ğŸš«<td>âœ…</table></div><p>*Â : le mode historique regroupe automatiquement les Ã©vÃ©nements gÃ©rÃ©s par React, mais il est limitÃ© Ã  une tÃ¢che navigateur. Les Ã©vÃ©nements non-React doivent le demander explicitement en appelant <code>unstable_batchedUpdates</code>. Dans les modes bloquant et concurrent, tous les <code>setState</code>s sont traitÃ©s par lot par dÃ©faut.<p>**Â : affiche des avertissements en dÃ©veloppement. <span style="float:footnote"><a href="./index.html#toc">Go to TOC</a></span></section></section></section>