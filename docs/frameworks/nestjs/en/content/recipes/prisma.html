<!doctype html><html lang="en"><meta charset="utf-8"><title>Prisma</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="stylesheet"href="../../../../../../../../../docs/themes/packages/prism-coy-theme/theme_common.css"><section id="prisma"class="level3"><h3>Prisma</h3><p><a href="https://www.prisma.io">Prisma</a> is an <a href="https://github.com/prisma/prisma">open-source</a> ORM for Node.js and TypeScript. It is used as an <strong>alternative</strong> to writing plain SQL, or using another database access tool such as SQL query builders (like <a href="https://knexjs.org/">knex.js</a>) or ORMs (like <a href="https://typeorm.io/">TypeORM</a> and <a href="https://sequelize.org/">Sequelize</a>). Prisma currently supports PostgreSQL, MySQL, SQL Server, SQLite, MongoDB and CockroachDB (<a href="https://www.prisma.io/docs/reference/database-reference/supported-databases">Preview</a>).<p>While Prisma can be used with plain JavaScript, it embraces TypeScript and provides a level to type-safety that goes beyond the guarantees other ORMs in the TypeScript ecosystem. You can find an in-depth comparison of the type-safety guarantees of Prisma and TypeORM <a href="https://www.prisma.io/docs/concepts/more/comparisons/prisma-and-typeorm#type-safety">here</a>.<blockquote><p>info <strong>Note</strong> If you want to get a quick overview of how Prisma works, you can follow the <a href="https://www.prisma.io/docs/getting-started/quickstart">Quickstart</a> or read the <a href="https://www.prisma.io/docs/understand-prisma/introduction">Introduction</a> in the <a href="https://www.prisma.io/docs/">documentation</a>. There also are ready-to-run examples for <a href="https://github.com/prisma/prisma-examples/tree/latest/typescript/rest-nestjs">REST</a> and <a href="https://github.com/prisma/prisma-examples/tree/latest/typescript/graphql-nestjs">GraphQL</a> in the <a href="https://github.com/prisma/prisma-examples/"><code>prisma-examples</code></a> repo.</blockquote><section id="getting-started"class="level4"><h4>Getting started</h4><p>In this recipe, you'll learn how to get started with NestJS and Prisma from scratch. You are going to build a sample NestJS application with a REST API that can read and write data in a database.<p>For the purpose of this guide, you'll use a <a href="https://sqlite.org/">SQLite</a> database to save the overhead of setting up a database server. Note that you can still follow this guide, even if you're using PostgreSQL or MySQL – you'll get extra instructions for using these databases at the right places.<blockquote><p>info <strong>Note</strong> If you already have an existing project and consider migrating to Prisma, you can follow the guide for <a href="https://www.prisma.io/docs/getting-started/setup-prisma/add-to-existing-project-typescript-postgres">adding Prisma to an existing project</a>. If you are migrating from TypeORM, you can read the guide <a href="https://www.prisma.io/docs/guides/migrate-to-prisma/migrate-from-typeorm">Migrating from TypeORM to Prisma</a>.</blockquote></section><section id="create-your-nestjs-project"class="level4"><h4>Create your NestJS project</h4><p>To get started, install the NestJS CLI and create your app skeleton with the following commands:<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> -g @nestjs/cli
$ nest new hello-prisma</code></pre><p>See the <a href="https://docs.nestjs.com/first-steps">First steps</a> page to learn more about the project files created by this command. Note also that you can now run <code>npm start</code> to start your application. The REST API running at <code>http://localhost:3000/</code> currently serves a single route that's implemented in <code>src/app.controller.ts</code>. Over the course of this guide, you'll implement additional routes to store and retrieve data about <em>users</em> and <em>posts</em>.</section><section id="set-up-prisma"class="level4"><h4>Set up Prisma</h4><p>Start by installing the Prisma CLI as a development dependency in your project:<pre class="language-bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> hello-prisma
$ <span class="token function">npm</span> <span class="token function">install</span> prisma --save-dev</code></pre><p>In the following steps, we'll be utilizing the <a href="https://www.prisma.io/docs/reference/tools-and-interfaces/prisma-cli">Prisma CLI</a>. As a best practice, it's recommended to invoke the CLI locally by prefixing it with <code>npx</code>:<pre class="language-bash"><code class="language-bash">$ npx prisma</code></pre><details><summary>Expand if you're using Yarn</summary><p>If you're using Yarn, then you can install the Prisma CLI as follows:<pre class="language-bash"><code class="language-bash">$ <span class="token function">yarn</span> <span class="token function">add</span> prisma --dev</code></pre><p>Once installed, you can invoke it by prefixing it with <code>yarn</code>:<pre class="language-bash"><code class="language-bash">$ <span class="token function">yarn</span> prisma</code></pre></details><p>Now create your initial Prisma setup using the <code>init</code> command of the Prisma CLI:<pre class="language-bash"><code class="language-bash">$ npx prisma init</code></pre><p>This command creates a new <code>prisma</code> directory with the following contents:<ul><li><code>schema.prisma</code>: Specifies your database connection and contains the database schema<li><code>.env</code>: A <a href="https://github.com/motdotla/dotenv">dotenv</a> file, typically used to store your database credentials in a group of environment variables</ul></section><section id="set-the-database-connection"class="level4"><h4>Set the database connection</h4><p>Your database connection is configured in the <code>datasource</code> block in your <code>schema.prisma</code> file. By default it's set to <code>postgresql</code>, but since you're using a SQLite database in this guide you need to adjust the <code>provider</code> field of the <code>datasource</code> block to <code>sqlite</code>:<pre class="language-groovy"><code class="language-groovy">datasource db <span class="token punctuation">{</span>
  provider <span class="token operator">=</span> <span class="token string gstring">"sqlite"</span>
  url      <span class="token operator">=</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string gstring">"DATABASE_URL"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

generator client <span class="token punctuation">{</span>
  provider <span class="token operator">=</span> <span class="token string gstring">"prisma-client-js"</span>
<span class="token punctuation">}</span></code></pre><p>Now, open up <code>.env</code> and adjust the <code>DATABASE_URL</code> environment variable to look as follows:<pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span><span class="token string">"file:./dev.db"</span></code></pre><p>SQLite databases are simple files; no server is required to use a SQLite database. So instead of configuring a connection URL with a <em>host</em> and <em>port</em>, you can just point it to a local file which in this case is called <code>dev.db</code>. This file will be created in the next step.<details><summary>Expand if you're using PostgreSQL or MySQL</summary><p>With PostgreSQL and MySQL, you need to configure the connection URL to point to the <em>database server</em>. You can learn more about the required connection URL format <a href="https://www.prisma.io/docs/reference/database-reference/connection-urls">here</a>.<p><strong>PostgreSQL</strong><p>If you're using PostgreSQL, you have to adjust the <code>schema.prisma</code> and <code>.env</code> files as follows:<p><strong><code>schema.prisma</code></strong><pre class="language-groovy"><code class="language-groovy">datasource db <span class="token punctuation">{</span>
  provider <span class="token operator">=</span> <span class="token string gstring">"postgresql"</span>
  url      <span class="token operator">=</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string gstring">"DATABASE_URL"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

generator client <span class="token punctuation">{</span>
  provider <span class="token operator">=</span> <span class="token string gstring">"prisma-client-js"</span>
<span class="token punctuation">}</span></code></pre><p><strong><code>.env</code></strong><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span><span class="token string">"postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=SCHEMA"</span></code></pre><p>Replace the placeholders spelled in all uppercase letters with your database credentials. Note that if you're unsure what to provide for the <code>SCHEMA</code> placeholder, it's most likely the default value <code>public</code>:<pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span><span class="token string">"postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=public"</span></code></pre><p>If you want to learn how to set up a PostgreSQL database, you can follow this guide on <a href="https://dev.to/prisma/how-to-setup-a-free-postgresql-database-on-heroku-1dc1">setting up a free PostgreSQL database on Heroku</a>.<p><strong>MySQL</strong><p>If you're using MySQL, you have to adjust the <code>schema.prisma</code> and <code>.env</code> files as follows:<p><strong><code>schema.prisma</code></strong><pre class="language-groovy"><code class="language-groovy">datasource db <span class="token punctuation">{</span>
  provider <span class="token operator">=</span> <span class="token string gstring">"mysql"</span>
  url      <span class="token operator">=</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string gstring">"DATABASE_URL"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

generator client <span class="token punctuation">{</span>
  provider <span class="token operator">=</span> <span class="token string gstring">"prisma-client-js"</span>
<span class="token punctuation">}</span></code></pre><p><strong><code>.env</code></strong><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span><span class="token string">"mysql://USER:PASSWORD@HOST:PORT/DATABASE"</span></code></pre><p>Replace the placeholders spelled in all uppercase letters with your database credentials.</details></section><section id="create-two-database-tables-with-prisma-migrate"class="level4"><h4>Create two database tables with Prisma Migrate</h4><p>In this section, you'll create two new tables in your database using <a href="https://www.prisma.io/docs/concepts/components/prisma-migrate">Prisma Migrate</a>. Prisma Migrate generates SQL migration files for your declarative data model definition in the Prisma schema. These migration files are fully customizable so that you can configure any additional features of the underlying database or include additional commands, e.g. for seeding.<p>Add the following two models to your <code>schema.prisma</code> file:<pre class="language-groovy"><code class="language-groovy">model User <span class="token punctuation">{</span>
  id    Int     @<span class="token keyword">default</span><span class="token punctuation">(</span><span class="token function">autoincrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@id</span>
  email String  <span class="token annotation punctuation">@unique</span>
  name  String<span class="token operator">?</span>
  posts Post<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

model Post <span class="token punctuation">{</span>
  id        Int      @<span class="token keyword">default</span><span class="token punctuation">(</span><span class="token function">autoincrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@id</span>
  title     String
  content   String<span class="token operator">?</span>
  published Boolean<span class="token operator">?</span> @<span class="token keyword">default</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  author    User<span class="token operator">?</span>    <span class="token annotation punctuation">@relation</span><span class="token punctuation">(</span>fields<span class="token punctuation">:</span> <span class="token punctuation">[</span>authorId<span class="token punctuation">]</span><span class="token punctuation">,</span> references<span class="token punctuation">:</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>
  authorId  Int<span class="token operator">?</span>
<span class="token punctuation">}</span></code></pre><p>With your Prisma models in place, you can generate your SQL migration files and run them against the database. Run the following commands in your terminal:<pre class="language-bash"><code class="language-bash">$ npx prisma migrate dev --name init</code></pre><p>This <code>prisma migrate dev</code> command generates SQL files and directly runs them against the database. In this case, the following migration files was created in the existing <code>prisma</code> directory:<pre class="language-bash"><code class="language-bash">$ tree prisma
prisma
├── dev.db
├── migrations
│   └── 20201207100915_init
│       └── migration.sql
└── schema.prisma</code></pre><details><summary>Expand to view the generated SQL statements</summary><p>The following tables were created in your SQLite database:<pre class="language-sql"><code class="language-sql"><span class="token comment">-- CreateTable</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">"User"</span> <span class="token punctuation">(</span>
    <span class="token string">"id"</span> <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> AUTOINCREMENT<span class="token punctuation">,</span>
    <span class="token string">"email"</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">"name"</span> <span class="token keyword">TEXT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateTable</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">"Post"</span> <span class="token punctuation">(</span>
    <span class="token string">"id"</span> <span class="token keyword">INTEGER</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> AUTOINCREMENT<span class="token punctuation">,</span>
    <span class="token string">"title"</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token string">"content"</span> <span class="token keyword">TEXT</span><span class="token punctuation">,</span>
    <span class="token string">"published"</span> <span class="token keyword">BOOLEAN</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string">"authorId"</span> <span class="token keyword">INTEGER</span><span class="token punctuation">,</span>

    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token string">"authorId"</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token string">"User"</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">SET</span> <span class="token boolean">NULL</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- CreateIndex</span>
<span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token string">"User.email_unique"</span> <span class="token keyword">ON</span> <span class="token string">"User"</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></details></section><section id="install-and-generate-prisma-client"class="level4"><h4>Install and generate Prisma Client</h4><p>Prisma Client is a type-safe database client that's <em>generated</em> from your Prisma model definition. Because of this approach, Prisma Client can expose <a href="https://www.prisma.io/docs/concepts/components/prisma-client/crud">CRUD</a> operations that are <em>tailored</em> specifically to your models.<p>To install Prisma Client in your project, run the following command in your terminal:<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> @prisma/client</code></pre><p>Note that during installation, Prisma automatically invokes the <code>prisma generate</code> command for you. In the future, you need to run this command after <em>every</em> change to your Prisma models to update your generated Prisma Client.<blockquote><p>info <strong>Note</strong> The <code>prisma generate</code> command reads your Prisma schema and updates the generated Prisma Client library inside <code>node_modules/@prisma/client</code>.</blockquote></section><section id="use-prisma-client-in-your-nestjs-services"class="level4"><h4>Use Prisma Client in your NestJS services</h4><p>You're now able to send database queries with Prisma Client. If you want to learn more about building queries with Prisma Client, check out the <a href="https://www.prisma.io/docs/reference/tools-and-interfaces/prisma-client/crud">API documentation</a>.<p>When setting up your NestJS application, you'll want to abstract away the Prisma Client API for database queries within a service. To get started, you can create a new <code>PrismaService</code> that takes care of instantiating <code>PrismaClient</code> and connecting to your database.<p>Inside the <code>src</code> directory, create a new file called <code>prisma.service.ts</code> and add the following code to it:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">INestApplication</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Injectable</span><span class="token punctuation">,</span> <span class="token maybe-class-name">OnModuleInit</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">PrismaClient</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@prisma/client'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">PrismaService</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">PrismaClient</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token maybe-class-name">OnModuleInit</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">onModuleInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">$connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">enableShutdownHooks</span><span class="token punctuation">(</span>app<span class="token operator">:</span> <span class="token maybe-class-name">INestApplication</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">$on</span><span class="token punctuation">(</span><span class="token string">'beforeExit'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>info <strong>Note</strong> The <code>onModuleInit</code> is optional — if you leave it out, Prisma will connect lazily on its first call to the database. We don't bother with <code>onModuleDestroy</code>, since Prisma has its own shutdown hooks where it will destroy the connection. For more info on <code>enableShutdownHooks</code>, please see <a href="recipes/prisma#issues-with-enableshutdownhooks">Issues with <code>enableShutdownHooks</code></a></blockquote><p>Next, you can write services that you can use to make database calls for the <code>User</code> and <code>Post</code> models from your Prisma schema.<p>Still inside the <code>src</code> directory, create a new file called <code>user.service.ts</code> and add the following code to it:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Injectable</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">PrismaService</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./prisma.service'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">User</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Prisma</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@prisma/client'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">UserService</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> prisma<span class="token operator">:</span> <span class="token maybe-class-name">PrismaService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">user</span><span class="token punctuation">(</span>
    userWhereUniqueInput<span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">UserWhereUniqueInput</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">User</span> <span class="token operator">|</span> <span class="token keyword null nil">null</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">prisma</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token method function property-access">findUnique</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      where<span class="token operator">:</span> userWhereUniqueInput<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">users</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">{</span>
    skip<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    take<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    cursor<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">UserWhereUniqueInput</span></span><span class="token punctuation">;</span>
    where<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">UserWhereInput</span></span><span class="token punctuation">;</span>
    orderBy<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">UserOrderByWithRelationInput</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">User</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> skip<span class="token punctuation">,</span> take<span class="token punctuation">,</span> cursor<span class="token punctuation">,</span> where<span class="token punctuation">,</span> orderBy <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">prisma</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token method function property-access">findMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      skip<span class="token punctuation">,</span>
      take<span class="token punctuation">,</span>
      cursor<span class="token punctuation">,</span>
      where<span class="token punctuation">,</span>
      orderBy<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">createUser</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">UserCreateInput</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">User</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">prisma</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      data<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">updateUser</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">UserWhereUniqueInput</span></span><span class="token punctuation">;</span>
    data<span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">UserUpdateInput</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">User</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> where<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">prisma</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      data<span class="token punctuation">,</span>
      where<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span>where<span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">UserWhereUniqueInput</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">User</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">prisma</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      where<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Notice how you're using Prisma Client's generated types to ensure that the methods that are exposed by your service are properly typed. You therefore save the boilerplate of typing your models and creating additional interface or DTO files.<p>Now do the same for the <code>Post</code> model.<p>Still inside the <code>src</code> directory, create a new file called <code>post.service.ts</code> and add the following code to it:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Injectable</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">PrismaService</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./prisma.service'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Post</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Prisma</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@prisma/client'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">PostService</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> prisma<span class="token operator">:</span> <span class="token maybe-class-name">PrismaService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">post</span><span class="token punctuation">(</span>
    postWhereUniqueInput<span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">PostWhereUniqueInput</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Post</span> <span class="token operator">|</span> <span class="token keyword null nil">null</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">prisma</span><span class="token punctuation">.</span><span class="token property-access">post</span><span class="token punctuation">.</span><span class="token method function property-access">findUnique</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      where<span class="token operator">:</span> postWhereUniqueInput<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">posts</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">{</span>
    skip<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    take<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    cursor<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">PostWhereUniqueInput</span></span><span class="token punctuation">;</span>
    where<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">PostWhereInput</span></span><span class="token punctuation">;</span>
    orderBy<span class="token operator">?</span><span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">PostOrderByWithRelationInput</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Post</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> skip<span class="token punctuation">,</span> take<span class="token punctuation">,</span> cursor<span class="token punctuation">,</span> where<span class="token punctuation">,</span> orderBy <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">prisma</span><span class="token punctuation">.</span><span class="token property-access">post</span><span class="token punctuation">.</span><span class="token method function property-access">findMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      skip<span class="token punctuation">,</span>
      take<span class="token punctuation">,</span>
      cursor<span class="token punctuation">,</span>
      where<span class="token punctuation">,</span>
      orderBy<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">createPost</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">PostCreateInput</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Post</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">prisma</span><span class="token punctuation">.</span><span class="token property-access">post</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      data<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">updatePost</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">{</span>
    where<span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">PostWhereUniqueInput</span></span><span class="token punctuation">;</span>
    data<span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">PostUpdateInput</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Post</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> where <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">prisma</span><span class="token punctuation">.</span><span class="token property-access">post</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      data<span class="token punctuation">,</span>
      where<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">deletePost</span><span class="token punctuation">(</span>where<span class="token operator">:</span> <span class="token maybe-class-name">Prisma</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">PostWhereUniqueInput</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">Post</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">prisma</span><span class="token punctuation">.</span><span class="token property-access">post</span><span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      where<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Your <code>UserService</code> and <code>PostService</code> currently wrap the CRUD queries that are available in Prisma Client. In a real world application, the service would also be the place to add business logic to your application. For example, you could have a method called <code>updatePassword</code> inside the <code>UserService</code> that would be responsible for updating the password of a user.<section id="implement-your-rest-api-routes-in-the-main-app-controller"class="level5"><h5>Implement your REST API routes in the main app controller</h5><p>Finally, you'll use the services you created in the previous sections to implement the different routes of your app. For the purpose of this guide, you'll put all your routes into the already existing <code>AppController</code> class.<p>Replace the contents of the <code>app.controller.ts</code> file with the following code:<pre class="language-typescript"><code class="language-typescript"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>
  <span class="token maybe-class-name">Controller</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">Get</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">Param</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">Post</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">Body</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">Put</span><span class="token punctuation">,</span>
  <span class="token maybe-class-name">Delete</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">UserService</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./user.service'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">PostService</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./post.service'</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">User</span> <span class="token keyword module">as</span> <span class="token maybe-class-name">UserModel</span><span class="token punctuation">,</span> <span class="token maybe-class-name">Post</span> <span class="token keyword module">as</span> <span class="token maybe-class-name">PostModel</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'@prisma/client'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">AppController</span></span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> userService<span class="token operator">:</span> <span class="token maybe-class-name">UserService</span><span class="token punctuation">,</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> postService<span class="token operator">:</span> <span class="token maybe-class-name">PostService</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'post/:id'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">getPostById</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">PostModel</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">postService</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'feed'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">getPublishedPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">PostModel</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">postService</span><span class="token punctuation">.</span><span class="token method function property-access">posts</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      where<span class="token operator">:</span> <span class="token punctuation">{</span> published<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'filtered-posts/:searchString'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">getFilteredPosts</span><span class="token punctuation">(</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'searchString'</span><span class="token punctuation">)</span> searchString<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">PostModel</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">postService</span><span class="token punctuation">.</span><span class="token method function property-access">posts</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      where<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token constant">OR</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token punctuation">{</span> contains<span class="token operator">:</span> searchString <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            content<span class="token operator">:</span> <span class="token punctuation">{</span> contains<span class="token operator">:</span> searchString <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'post'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">createDraft</span><span class="token punctuation">(</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> postData<span class="token operator">:</span> <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> content<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> authorEmail<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">PostModel</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> content<span class="token punctuation">,</span> authorEmail <span class="token punctuation">}</span> <span class="token operator">=</span> postData<span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">postService</span><span class="token punctuation">.</span><span class="token method function property-access">createPost</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
      content<span class="token punctuation">,</span>
      author<span class="token operator">:</span> <span class="token punctuation">{</span>
        connect<span class="token operator">:</span> <span class="token punctuation">{</span> email<span class="token operator">:</span> authorEmail <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">signupUser</span><span class="token punctuation">(</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> userData<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> email<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">UserModel</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">userService</span><span class="token punctuation">.</span><span class="token method function property-access">createUser</span><span class="token punctuation">(</span>userData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Put</span></span><span class="token punctuation">(</span><span class="token string">'publish/:id'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">publishPost</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">PostModel</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">postService</span><span class="token punctuation">.</span><span class="token method function property-access">updatePost</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      where<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span> published<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Delete</span></span><span class="token punctuation">(</span><span class="token string">'post/:id'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">deletePost</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token known-class-name class-name">Promise</span><span class="token operator">&#x3C;</span><span class="token maybe-class-name">PostModel</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">postService</span><span class="token punctuation">.</span><span class="token method function property-access">deletePost</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>This controller implements the following routes:<section id="get"class="level6"><h6><code>GET</code></h6><ul><li><code>/post/:id</code>: Fetch a single post by its <code>id</code><li><code>/feed</code>: Fetch all <em>published</em> posts<li><code>/filter-posts/:searchString</code>: Filter posts by <code>title</code> or <code>content</code></ul></section><section id="post"class="level6"><h6><code>POST</code></h6><ul><li><code>/post</code>: Create a new post<ul><li>Body:<ul><li><code>title: String</code> (required): The title of the post<li><code>content: String</code> (optional): The content of the post<li><code>authorEmail: String</code> (required): The email of the user that creates the post</ul></ul><li><code>/user</code>: Create a new user<ul><li>Body:<ul><li><code>email: String</code> (required): The email address of the user<li><code>name: String</code> (optional): The name of the user</ul></ul></ul></section><section id="put"class="level6"><h6><code>PUT</code></h6><ul><li><code>/publish/:id</code>: Publish a post by its <code>id</code></ul></section><section id="delete"class="level6"><h6><code>DELETE</code></h6><ul><li><code>/post/:id</code>: Delete a post by its <code>id</code></ul></section></section></section><section id="issues-with-enableshutdownhooks"class="level4"><h4>Issues with <code>enableShutdownHooks</code></h4><p>Prisma interferes with NestJS <code>enableShutdownHooks</code>. Prisma listens for shutdown signals and will call <code>process.exit()</code> before your application shutdown hooks fire. To deal with this, you would need to add a listener for Prisma <code>beforeExit</code> event.<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// main.ts</span>
<span class="token spread operator">...</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">PrismaService</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'./services/prisma/prisma.service'</span><span class="token punctuation">;</span>
<span class="token spread operator">...</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token spread operator">...</span>
  <span class="token keyword">const</span> prismaService <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token maybe-class-name">PrismaService</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">await</span> prismaService<span class="token punctuation">.</span><span class="token method function property-access">enableShutdownHooks</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
  <span class="token spread operator">...</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>You can <a href="https://github.com/prisma/prisma/issues/2917#issuecomment-708340112">read more</a> about Prisma handling of shutdown signal, and <code>beforeExit</code> event.</section><section id="summary"class="level4"><h4>Summary</h4><p>In this recipe, you learned how to use Prisma along with NestJS to implement a REST API. The controller that implements the routes of the API is calling a <code>PrismaService</code> which in turn uses Prisma Client to send queries to a database to fulfill the data needs of incoming requests.<p>If you want to learn more about using NestJS with Prisma, be sure to check out the following resources:<ul><li><a href="https://www.prisma.io/nestjs">NestJS &#x26; Prisma</a><li><a href="https://github.com/prisma/prisma-examples/">Ready-to-run example projects for REST &#x26; GraphQL</a><li><a href="https://github.com/notiz-dev/nestjs-prisma-starter#instructions">Production-ready starter kit</a><li><a href="https://www.youtube.com/watch?v=UlVJ340UEuk&#x26;ab_channel=Prisma">Video: Accessing Databases using NestJS with Prisma (5min)</a> by <a href="https://github.com/marcjulian">Marc Stammerjohann</a> <span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></ul></section></section>