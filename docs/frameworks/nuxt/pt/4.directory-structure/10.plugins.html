<!doctype html><html lang="pt"><meta charset="utf-8"><title>Diret√≥rio de Extens√µes</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="navigation.title"content="plugins"><meta name="description"content="O diret√≥rio de extens√µes cont√©m as nossas extens√µes de JavaScript que queremos executar antes de instanciar a raiz da aplica√ß√£o de Vue.js."><meta name="category"content="directory-structure"><meta name="csb_link_plugins_client"content="https://codesandbox.io/embed/github/nuxt-academy/guides-examples/tree/master/04_directory_structure/12_plugins_client?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark"><meta name="csb_link_plugins_external"content="https://codesandbox.io/embed/github/nuxt-academy/guides-examples/tree/master/04_directory_structure/12_plugins_external?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark"><meta name="csb_link_plugins_custom"content="https://codesandbox.io/embed/github/nuxt-academy/guides-examples/tree/master/04_directory_structure/12_plugins_custom_plugin?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark"><meta name="csb_link_plugins_vue"content="https://codesandbox.io/embed/github/nuxt-academy/guides-examples/tree/master/04_directory_structure/12_plugins_vue?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark"><link rel="stylesheet"type="text/css"href="../../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="diret√≥rio-de-extens√µes"><h1 id="diret√≥rio-de-extens√µes">Diret√≥rio de Extens√µes</h1><p>O diret√≥rio <code>plugins</code> cont√©m as nossas extens√µes de JavaScript que queremos executar antes de instanciar a raiz da aplica√ß√£o de Vue.js.<hr><p><img src="../docs/plugins.svg"><p>√â nesta pasta onde adicionamos as extens√µes de Vue e injetamos as fun√ß√µes ou constantes. Toda a vez que precisarmos utilizar <code>Vue.use()</code>, devemos criar um ficheiro em <code>plugins/</code> e adicionar o seu caminho na propriedade <code>plugins</code> no <code>nuxt.config.js</code>:<section class="level2"aria-labelledby="pacotes-externos"><h2 id="pacotes-externos">Pacotes Externos</h2><p>Podemos querer utilizar pacotes ou m√≥dulos externos na nossa aplica√ß√£o (um √≥timo exemplo √© <a href="https://axios.nuxtjs.org"><code>axios</code></a>) para fazer requisi√ß√µes de protocolo de hipertexto tanto para o servidor quanto para o cliente.<p>Primeiro, o instalamos atrav√©s de <code>npm</code> ou <code>yarn</code>:<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> @nuxtjs/axios</code></pre><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @nuxtjs/axios</code></pre><p>Podemos configurar, por exemplo, os intercetores da <code>axios</code> para reagir a poss√≠veis erros das suas chamadas de interface de programa√ß√£o de aplica√ß√£o em toda a aplica√ß√£o. Neste exemplo, redirecionamos o utilizador para uma p√°gina de erro personalizada chamada <code>sorry</code> quando recebemos um erro de estado <code>500</code> da nossa interface de programa√ß√£o de aplica√ß√£o:<pre class="language-js{}[plugins/axios.js]"><code class="language-js{}[plugins/axios.js]">export default function ({ $axios, redirect }) {
  $axios.onError(error => {
    if (error.response.status === 500) {
      redirect('/sorry')
    }
  })
}</code></pre><p>Por √∫ltimo, mas n√£o menos importante, adicionamos o m√≥dulo e a extens√£o rec√©m criada √† configura√ß√£o do projeto:<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">module.exports = {
  modules: ['@nuxtjs/axios'],
  plugins: ['~/plugins/axios.js']
}</code></pre><p>Depois, podemos utiliz√°-la diretamente nos componentes da nossa p√°gina:<pre class="language-js{}[pages/index.vue]"><code class="language-js{}[pages/index.vue]">&#x3C;template>
  &#x3C;h1>{{ post.title }}&#x3C;/h1>
&#x3C;/template>

&#x3C;script>
export default {
	async asyncData ({ $axios, params }) {
	  const  post  = await $axios.$get(`https://api.nuxtjs.dev/posts/${params.id}`)
	  return { post }
	}
}
&#x3C;/script></code></pre><p>Outra maneira de utilizar a <code>axios</code> sem instalar o m√≥dulo √© importando a <code>axios</code> diretamente no marcador <code>&#x3C;script></code>:<pre class="language-js{}[pages/index.vue]"><code class="language-js{}[pages/index.vue]">&#x3C;script>
import axios from 'axios'

export default {
	async asyncData ({ params }) {
	  const { data: post }  = await axios.get(`https://api.nuxtjs.dev/posts/${params.id}`)
	  return { post }
	}
}
&#x3C;/script></code></pre><section class="level4"aria-labelledby="info"><h4 id="info">Info</h4><p>Se recebermos um erro <code>cannot use import statement outside a module</code>, podemos precisar adicionar o nosso pacote √† op√ß√£o <code>build</code> > <code>transpile</code> no <code>nuxt.config.js</code> para o carregador da Webpack disponibilizar a nossa extens√£o.<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">build: {
  // Podemos estender a configura√ß√£o da Webpack neste objeto.
  transpile: ['npm-package-name'],
},</code></pre></section></section><section class="level2"aria-labelledby="extens√µes-da-vue"><h2 id="extens√µes-da-vue">Extens√µes da Vue</h2><p>Se quisermos usar extens√µes de Vue, como a <a href="https://akryum.github.io/v-tooltip"><code>v-tooltip</code></a> para exibir dicas de ferramentas na nossa aplica√ß√£o, precisamos configurar a extens√£o antes de iniciar a aplica√ß√£o.<p>Primeiro, precisamos de instal√°-la:<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> v-tooltip</code></pre><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> v-tooltip</code></pre><p>Depois criamos o ficheiro <code>plugins/vue-tooltip.js</code>.<pre class="language-js{}[plugins/vue-tooltip.js]"><code class="language-js{}[plugins/vue-tooltip.js]">import Vue from 'vue'
import VTooltip from 'v-tooltip'

Vue.use(VTooltip)</code></pre><section class="level3"aria-labelledby="a-propriedade-plugins"><h3 id="a-propriedade-plugins">A Propriedade <code>plugins</code></h3><p>Depois adicionamos o caminho do ficheiro na chave <code>plugins</code> do nosso <code>nuxt.config.js</code>. A propriedade <code>plugins</code> permite-nos adicionar extens√µes de Vue facilmente √† nossa aplica√ß√£o principal. Todos os caminhos definidos na propriedade <code>plugins</code> ser√£o importados antes de inicializar a aplica√ß√£o principal:<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  plugins: ['~/plugins/vue-tooltip.js']
}</code></pre></section><section class="level3"aria-labelledby="extens√µes-de-ecmascript-6"><h3 id="extens√µes-de-ecmascript-6">Extens√µes de ECMAScript 6</h3><p>Se a extens√£o estiver localizada em <code>node_modules</code> e exportar um m√≥dulo de ECMAScript 6, podemos precisar adicion√°-la √† op√ß√£o de constru√ß√£o (compila√ß√£o) <code>transpile</code>:<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">module.exports = {
  build: {
    transpile: ['vue-tooltip']
  }
}</code></pre><p>Podemos consultar a <a href="./configuration-glossary/configuration-build#transpile">documenta√ß√£o da configura√ß√£o da constru√ß√£o (compila√ß√£o)</a> por mais op√ß√µes de constru√ß√£o.</section></section><section class="level2"aria-labelledby="s√≥-do-lado-do-cliente-ou-do-servidor"><h2 id="s√≥-do-lado-do-cliente-ou-do-servidor">S√≥ do Lado do Cliente ou do Servidor</h2><p>Algumas extens√µes podem funcionar apenas no navegador porque n√£o t√™m suporte a interpreta√ß√£o do lado do servidor.<section class="level3"aria-labelledby="conven√ß√£o-de-nomea√ß√£o-de-extens√£o"><h3 id="conven√ß√£o-de-nomea√ß√£o-de-extens√£o">Conven√ß√£o de Nomea√ß√£o de Extens√£o</h3><p>Se √© suposto executar uma extens√£o apenas no lado do cliente ou do servidor, <code>.client.js</code> ou <code>.server.js</code> pode ser aplicado como uma extens√£o do ficheiro da extens√£o. O ficheiro ser√° automaticamente inclu√≠do apenas no lado respetivo (cliente ou servidor):<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  plugins: [
    '~/plugins/foo.client.js', // apenas no lado do cliente
    '~/plugins/bar.server.js', // apenas no lado do servidor
    '~/plugins/baz.js' // ambos cliente e servidor
  ]
}</code></pre></section><section class="level3"aria-labelledby="sintaxe-de-objeto"><h3 id="sintaxe-de-objeto">Sintaxe de Objeto</h3><p>Tamb√©m podemos utilizar a sintaxe de objeto com a propriedade <code>mode</code> (<code>'client'</code> ou <code>'server'</code>) em <code>plugins</code>:<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  plugins: [
    { src: '~/plugins/both-sides.js' },
    { src: '~/plugins/client-only.js', mode: 'client' }, // apenas no lado do cliente
    { src: '~/plugins/server-only.js', mode: 'server' } // apenas no lado do servidor
  ]
}</code></pre></section></section><section class="level2"aria-labelledby="injetar-na-root-e-no-contexto"><h2 id="injetar-na-root-e-no-contexto">Injetar na <code>$root</code> e no Contexto</h2><p>Por vezes, queremos disponibilizar fun√ß√µes ou valores em toda a nossa aplica√ß√£o. Podemos injetar essas vari√°veis em inst√¢ncias de Vue (do lado do cliente), no contexto (do lado do servidor) e at√© no armaz√©m de estado da Vuex. √â uma conven√ß√£o prefixar essas fun√ß√µes com um <code>$</code>.<p>A Nuxt fornece-nos um m√©todo <code>inject(key, value)</code> para fazer isto facilmente. A <code>inject</code> √© dada como segundo par√¢metro ao exportar uma fun√ß√£o. O <code>$</code> ser√° anexado automaticamente √† chave.<section class="level4"aria-labelledby="info-1"><h4 id="info-1">Info</h4><p>√â importante saber que em qualquer <a href="https://v2.vuejs.org/v2/guide/instance.html#Lifecycle-Diagram">ciclo de vida duma inst√¢ncia de Vue</a>, apenas as fun√ß√µes gatilhos <code>beforeCreate</code> e <code>created</code> s√£o chamadas tanto do lado do cliente quanto do lado do servidor. Todas as outras fun√ß√µes gatilhos s√£o chamadas apenas do lado do cliente.<pre class="language-js{}[plugins/hello.js]"><code class="language-js{}[plugins/hello.js]">export default ({ app }, inject) => {
  // Injetar `$hello(msg)` na Vue, contexto e armaz√©m de estado.
  inject('hello', msg => console.log(`Hello ${msg}!`))
}</code></pre><pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  plugins: ['~/plugins/hello.js']
}</code></pre><p>Agora o servi√ßo <code>$hello</code> pode ser acedido a partir de <code>context</code> e <code>this</code> em p√°ginas, componentes, extens√µes, e a√ß√µes do armaz√©m de estado:<pre class="language-js{}[example-component.vue]"><code class="language-js{}[example-component.vue]">export default {
  mounted() {
    this.$hello('mounted')
    // imprimir√° 'Hello mounted!'
  },
  asyncData({ app, $hello }) {
    $hello('asyncData')
    // Se usarmos Nuxt &#x3C;= 2.12, usamos üëá
    app.$hello('asyncData')
  }
}</code></pre><pre class="language-js{}[store/index.js]"><code class="language-js{}[store/index.js]">export const state = () => ({
  someValue: ''
})

export const actions = {
  setSomeValueToWhatever({ commit }) {
    this.$hello('store action')
    const newValue = 'whatever'
    commit('changeSomeValue', newValue)
  }
}</code></pre></section><section class="level4"aria-labelledby="warning"><h4 id="warning">Warning</h4><p>N√£o √© recomendado usar <code>Vue.use()</code>, <code>Vue.component()</code>, e n√£o √© recomendado fazer altera√ß√µes no prot√≥tipo da Vue ou no objeto global da Vue <strong>na</strong> fun√ß√£o exportada pela nossa extens√£o. (Isto causaria um vazamento de mem√≥ria no lado do servidor). Consultar tamb√©m <a href="#misturas-globais">misturas globais</a>.</section></section><section class="level2"aria-labelledby="a-propriedade-extendplugins"><h2 id="a-propriedade-extendplugins">A Propriedade <code>extendPlugins</code></h2><p>Podemos querer estender as extens√µes ou alterar a ordem das extens√µes criada pela Nuxt. Esta fun√ß√£o aceita um vetor de objetos de <a href="./configuration-glossary/configuration-plugins">extens√£o</a> e deve retornar um vetor de objetos de extens√£o.<p>Exemplo de altera√ß√£o da ordem das extens√µes:<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  extendPlugins(plugins) {
    const pluginIndex = plugins.findIndex(
      ({ src }) => src === '~/plugins/shouldBeFirst.js'
    )
    const shouldBeFirstPlugin = plugins[pluginIndex]

    plugins.splice(pluginIndex, 1)
    plugins.unshift(shouldBeFirstPlugin)

    return plugins
  }
}</code></pre></section><section class="level2"aria-labelledby="misturas-globais"><h2 id="misturas-globais">Misturas Globais</h2><p>As misturas globais podem ser facilmente adicionadas com as extens√µes de Nuxt, mas podem causar problemas e fugas de mem√≥ria quando n√£o s√£o tratadas corretamente. Sempre que adicionarmos uma mistura global √† nossa aplica√ß√£o, devemos utilizar um sinalizador para evitar regist√°-la v√°rias vezes:<pre class="language-js{}[plugins/my-mixin-plugin.js]"><code class="language-js{}[plugins/my-mixin-plugin.js]">import Vue from "vue"

// Nos certificamos de que escolhemos um nome √∫nico para o sinalizador,
// para n√£o entrar em conflito com qualquer outra mistura.
if (!Vue.__my_mixin__) {
  Vue.__my_mixin__ = true
  Vue.mixin({ ... }) // Configurar a nossa mistura.
}</code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>