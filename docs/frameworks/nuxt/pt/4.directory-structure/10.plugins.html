<!doctype html><html lang="pt"><meta charset="utf-8"><title>O diret√≥rio plugins</title><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="navigation.title"content="plugins"><meta name="description"content="O diret√≥rio plugins cont√©m seus plugins escritos em JavaScript que voc√™ deseja executar antes da instancia√ß√£o da raiz da aplica√ß√£o Vue.js."><meta name="category"content="directory-structure"><meta name="csb_link_plugins_client"content="https://codesandbox.io/embed/github/nuxt-academy/guides-examples/tree/master/04_directory_structure/12_plugins_client?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark"><meta name="csb_link_plugins_external"content="https://codesandbox.io/embed/github/nuxt-academy/guides-examples/tree/master/04_directory_structure/12_plugins_external?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark"><meta name="csb_link_plugins_custom"content="https://codesandbox.io/embed/github/nuxt-academy/guides-examples/tree/master/04_directory_structure/12_plugins_custom_plugin?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark"><meta name="csb_link_plugins_vue"content="https://codesandbox.io/embed/github/nuxt-academy/guides-examples/tree/master/04_directory_structure/12_plugins_vue?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark"><link rel="stylesheet"href="../../../../../../../themes/packages/prism-coy-theme/theme_common.css"><section class="level1"aria-labelledby="o-diret√≥rio-plugins"><h1 id="o-diret√≥rio-plugins">O diret√≥rio plugins</h1><p>O diret√≥rio <code>plugins</code> cont√©m seus plugins escritos em JavaScript que voc√™ deseja executar antes da instancia√ß√£o da raiz da aplica√ß√£o Vue.js.<hr><p><img src="../docs/plugins.svg"><p>Este √© o lugar para adicionar os plugins do Vue e injetar fun√ß√µes ou constantes. Toda vez que voc√™ precisar usar o <code>Vue.use()</code>, voc√™ deve criar um ficheiro dentro de <code>plugins/</code> e adicionar seu caminho ao <code>plugins</code> dentro do <code>nuxt.config.js</code>.<section class="level2"aria-labelledby="pacotes-externos"><h2 id="pacotes-externos">Pacotes externos</h2><p>Voc√™ pode querer usar pacotes/m√≥dulos externos dentro da sua aplica√ß√£o (um grande exemplo √© o <a href="https://axios.nuxtjs.org/">axios</a>) para fazer requisi√ß√µes HTTP para ambos servidor e cliente.<p>Primeiro, instale ele via npm ou yarn.<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> @nuxtjs/axios</code></pre><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> @nuxtjs/axios</code></pre><p>Voc√™ pode configurar por exemplo os intercetores para reagir a poss√≠veis erros da chamadas da sua API atrav√©s da aplica√ß√£o. Dentro deste exemplo n√≥s redirecionamos o usu√°rio para uma p√°gina de erro personalizada chamada desculpa (sorry) quando n√≥s recebemos um estado de erro 500 por parte da nossa API.<pre class="language-js{}[plugins/axios.js]"><code class="language-js{}[plugins/axios.js]">export default function ({ $axios, redirect }) {
  $axios.onError(error => {
    if (error.response.status === 500) {
      redirect('/sorry')
    }
  })
}</code></pre><p>Por √∫ltimo mas n√£o menos importante, adicionar o m√≥dulo e o recentemente criado plugin √† configura√ß√£o do projeto.<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">module.exports = {
  modules: ['@nuxtjs/axios'],
  plugins: ['~/plugins/axios.js']
}</code></pre><p>Depois podemos usar ele diretamente dentro do seu componentes de p√°gina:<pre class="language-js{}[pages/index.vue]"><code class="language-js{}[pages/index.vue]">&#x3C;template>
  &#x3C;h1>{{ post.title }}&#x3C;/h1>
&#x3C;/template>

&#x3C;script>
export default {
	async asyncData ({ $axios, params }) {
	  const  post  = await $axios.$get(`https://api.nuxtjs.dev/posts/${params.id}`)
	  return { post }
	}
}
&#x3C;/script></code></pre><p>Uma outra maneira de usar o <code>axios</code> sem instalar o m√≥dulo √© importando <code>axios</code> diretamente dentro da tag <code>&#x3C;script></code>.<pre class="language-js{}[pages/index.vue]"><code class="language-js{}[pages/index.vue]">&#x3C;script>
import axios from 'axios'

export default {
	async asyncData ({ params }) {
	  const { data: post }  = await axios.get(`https://api.nuxtjs.dev/posts/${params.id}`)
	  return { post }
	}
}
&#x3C;/script></code></pre><section class="level4"aria-labelledby="info"><h4 id="info">Info</h4><p>Se voc√™ receber um erro <em>Cannot use import statement outside a module (Voc√™ n√£o pode usar a declara√ß√£o de importa√ß√£o fora de um m√≥dulo)</em>, voc√™ pode precisar adicionar o seu pacote √† op√ß√£o <code>build</code> > <code>transpile</code> dentro do <code>nuxt.config.js</code> para o carregador do webpack tornar o seu plugin dispon√≠vel.<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">build: {
  // Voc√™ pode estender a configura√ß√£o do webpack aqui
  transpile: ['npm-package-name'],
},</code></pre></section></section><section class="level2"aria-labelledby="plugins-de-vue"><h2 id="plugins-de-vue">Plugins de Vue</h2><p>Se voc√™ quiser usar plugins do vue, como <a href="https://akryum.github.io/v-tooltip">v-tooltip</a> para exibir dicas da ferramenta (tooltips) dentro da sua aplica√ß√£o, n√≥s precisamos configurar o plugin antes do lan√ßamento da aplica√ß√£o.<p>Primeiro, n√≥s precisamos instalar ele<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> v-tooltip</code></pre><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> v-tooltip</code></pre><p>Depois criamos o ficheiro <code>plugins/vue-tooltip.js</code><pre class="language-js{}[plugins/vue-tooltip.js]"><code class="language-js{}[plugins/vue-tooltip.js]">import Vue from 'vue'
import VTooltip from 'v-tooltip'

Vue.use(VTooltip)</code></pre><section class="level3"aria-labelledby="a-propriedade-plugins"><h3 id="a-propriedade-plugins">A propriedade plugins</h3><p>Ent√£o n√≥s adicionamos o caminho do ficheiro dentro a chave <code>plugins</code> do nosso <code>nuxt.config.js</code>. A propriedade plugins permite voc√™ adicionar plugins do Vue.js √† sua aplica√ß√£o principal. Todos os caminhos definidos dentro da propriedade <code>plugins</code> ser√£o importados antes da inicializa√ß√£o da aplica√ß√£o principal.<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  plugins: ['~/plugins/vue-tooltip.js']
}</code></pre></section><section class="level3"aria-labelledby="plugins-do-es6"><h3 id="plugins-do-es6">Plugins do ES6</h3><p>Se o plugin est√° localizado dentro do <code>node_modules</code> e exporta um m√≥dulo ES6, voc√™ pode precisar adicionar ele √† op√ß√£o de constru√ß√£o <code>transpile</code>:<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">module.exports = {
  build: {
    transpile: ['vue-tooltip']
  }
}</code></pre><p>Voc√™ pode recorrer a documenta√ß√£o da <a href="./configuration-glossary/configuration-build#transpile">configura√ß√£o do build</a> para saber mais sobre a op√ß√£o build.</section></section><section class="level2"aria-labelledby="apenas-no-lado-do-cliente-ou-servidor"><h2 id="apenas-no-lado-do-cliente-ou-servidor">Apenas no lado do cliente ou servidor</h2><p>Alguns plugins podem funcionar apenas dentro do browser por causa da falta suporte ao SSR.<section class="level3"aria-labelledby="nomear-de-maneira-convencional-o-plugin"><h3 id="nomear-de-maneira-convencional-o-plugin">Nomear de maneira convencional o plugin</h3><p>Se √© suposto um plugin ser executado apenas no lado do cliente ou servidor, <code>.client.js</code> ou <code>.server.js</code> podem ser aplicados como uma extens√£o do ficheiro do plugin. O ficheiro ser√° automaticamente inclu√≠do apenas no respetivo lado (do cliente ou servidor).<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  plugins: [
    '~/plugins/foo.client.js', // apenas no lado do cliente
    '~/plugins/bar.server.js', // apenas no lado do servidor
    '~/plugins/baz.js' // ambos cliente e servidor
  ]
}</code></pre></section><section class="level3"aria-labelledby="a-sintaxe-de-objeto"><h3 id="a-sintaxe-de-objeto">A sintaxe de objeto</h3><p>Voc√™ pode tamb√©m usar a sintaxe de objeto com a propriedade <code>mode</code> com o valor (<code>'client'</code> ou <code>'server'</code>) dento de <code>plugins</code>.<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  plugins: [
    { src: '~/plugins/both-sides.js' },
    { src: '~/plugins/client-only.js', mode: 'client' }, // apenas no lado do cliente
    { src: '~/plugins/server-only.js', mode: 'server' } // apenas no lado do servidor
  ]
}</code></pre></section></section><section class="level2"aria-labelledby="injetar-dentro-do-root-e-contexto"><h2 id="injetar-dentro-do-root-e-contexto">Injetar dentro do <code>$root</code> e contexto</h2><p>Algumas vezes voc√™ deseja tornar as fun√ß√µes ou valores dispon√≠veis ao longo da sua aplica√ß√£o. Voc√™ pode injetar essas vari√°veis dentro das inst√¢ncias do Vue (lado do cliente), o contexto (lado do servidor) e at√© dentro da mem√≥ria do Vuex. √â uma conven√ß√£o prefixar essas fun√ß√µes com um <code>$</code>.<p>O Nuxt fornece a voc√™ uma maneira de fazer isso facilmente com um m√©todo <code>inject(key, value)</code>. O inject √© dado como segundo par√¢metro quando exportamos uma fun√ß√£o. O <code>$</code> ser√° pr√©-adicionado automaticamente a chave.<section class="level4"aria-labelledby="info-1"><h4 id="info-1">Info</h4><p>√â importante saber que de todo <a href="https://v2.vuejs.org/v2/guide/instance.html#Lifecycle-Diagram">ciclo de vida da inst√¢ncia do Vue</a>, apenas os gatilhos <code>beforeCreate</code> e <code>created</code> s√£o chamados ambos, no lado do cliente e no lado do servidor. Todos os outros gatilhos s√£o apenas chamado no lado do cliente.<pre class="language-js{}[plugins/hello.js]"><code class="language-js{}[plugins/hello.js]">export default ({ app }, inject) => {
  // Injete $hello(msg) dentro do Vue, contexto e mem√≥ria.
  inject('hello', msg => console.log(`Hello ${msg}!`))
}</code></pre><pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  plugins: ['~/plugins/hello.js']
}</code></pre><p>Agora o servi√ßo <code>$hello</code> pode ser acessado a partir do <code>context</code> e <code>this</code> dentro das p√°ginas, componentes, plugins, e a√ß√µes da mem√≥ria.<pre class="language-js{}[example-component.vue]"><code class="language-js{}[example-component.vue]">export default {
  mounted() {
    this.$hello('mounted')
    // ir√° exibir no terminal 'Hello mounted!'
  },
  asyncData({ app, $hello }) {
    $hello('asyncData')
    // Se estiver usando Nuxt &#x3C;= 2.12, use üëá
    app.$hello('asyncData')
  }
}</code></pre><pre class="language-js{}[store/index.js]"><code class="language-js{}[store/index.js]">export const state = () => ({
  someValue: ''
})

export const actions = {
  setSomeValueToWhatever({ commit }) {
    this.$hello('store action')
    const newValue = 'whatever'
    commit('changeSomeValue', newValue)
  }
}</code></pre></section><section class="level4"aria-labelledby="warning"><h4 id="warning">Warning</h4><p>N√£o use o <code>Vue.use()</code>, <code>Vue.component()</code> e globalmente n√£o conecte nada ao Vue <strong>dentro</strong> desta fun√ß√£o, dedicada a inje√ß√£o do Nuxt. Isso causar√° vazamento de mem√≥ria no lado do servidor.</section></section><section class="level2"aria-labelledby="a-propriedade-extendplugins"><h2 id="a-propriedade-extendplugins">A propriedade extendPlugins</h2><p>Voc√™ talvez queira estender os plugins ou mudar as ordem dos plugins criada pelo Nuxt. Esta fun√ß√£o aceita um array de objetos de <a href="./configuration-glossary/configuration-plugins">plugin</a> e deve retornar um array de objetos de plugin.<p>Exemplo de mudan√ßa da ordem de plugins:<pre class="language-js{}[nuxt.config.js]"><code class="language-js{}[nuxt.config.js]">export default {
  extendPlugins(plugins) {
    const pluginIndex = plugins.findIndex(
      ({ src }) => src === '~/plugins/shouldBeFirst.js'
    )
    const shouldBeFirstPlugin = plugins[pluginIndex]

    plugins.splice(pluginIndex, 1)
    plugins.unshift(shouldBeFirstPlugin)

    return plugins
  }
}</code></pre></section><section class="level2"aria-labelledby="mixins-global"><h2 id="mixins-global">Mixins global</h2><p>Mixins global pode ser facilmente adicionado com plugins do Nuxt mas pode causar problemas e vazamento de mem√≥ria quando n√£o manipulado corretamente. Sempre que voc√™ adicionar um mixin global a sua aplica√ß√£o, voc√™ deve usar um bandeira para evitar registar ele v√°rias vezes:<pre class="language-js{}[plugins/my-mixin-plugin.js]"><code class="language-js{}[plugins/my-mixin-plugin.js]">import Vue from "vue"

// Certifique-se de pegar um nome √∫nico para a bandeira
// assim ele n√£o ir√° entrar em conflito com qualquer outro mixin.
if (!Vue.__my_mixin__) {
  Vue.__my_mixin__ = true
  Vue.mixin({ ... }) // Depois configure o seu mixin
}</code></pre><p><span style="float:footnote"><a href="../index.html#toc">Go to TOC</a></span></section></section>